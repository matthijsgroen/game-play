!function(){"use strict"}(),function(){(function(){Crafty.c("BigText",{init:function(){return this.requires("2D, Text, Tween, Delay, UILayerDOM")},bigText:function(a,b){var c,d,e,f;return null==b&&(b={}),b=_.defaults(b,{color:"#EEEEEE",mode:"fadeIn","super":null,blink_amount:3,blink_speed:1e3}),e={fadeIn:{enter:function(a){var b,c,d,e;for(b=WhenJS.defer(),a[0].one("TweenEnd",function(){return b.resolve()}),d=0,e=a.length;e>d;d++)c=a[d],c.tween({alpha:1},3e3);return b.promise},wait:function(a){var b;return b=WhenJS.defer(),a[0].delay(function(){return b.resolve()},3e3,0),b.promise},leave:function(a){var b,c,d,e;for(b=WhenJS.defer(),a[0].one("TweenEnd",function(){return b.resolve()}),d=0,e=a.length;e>d;d++)c=a[d],c.tween({viewportY:c.viewportY+100,alpha:0},1500);return b.promise}},blink:{enter:function(a){var b,c,d;for(c=0,d=a.length;d>c;c++)b=a[c],b.attr({alpha:1});return WhenJS()},wait:function(a){var c;return c=WhenJS.defer(),a[0].delay(function(){var b,c,d,e;for(e=[],c=0,d=a.length;d>c;c++)b=a[c],e.push(b.attr({alpha:(b.alpha+1)%2}));return e},b.blink_speed,2*(b.blink_amount-1)+1,function(){return c.resolve()}),c.promise},leave:function(a){var b,c,d;for(c=0,d=a.length;d>c;c++)b=a[c],b.attr({alpha:0});return WhenJS()}}},f=[this],null!=b["super"]&&(c=Crafty.e("2D, Text, Tween, UILayerDOM").attr({w:Crafty.viewport.width,z:1,alpha:0}).textAlign("center").text(b["super"]).attr({x:this.x,y:200,z:-1}).textColor(b.color).textFont({size:"16px",weight:"bold",family:"Press Start 2P"}),f.push(c)),this.attr({w:Crafty.viewport.width,z:1,alpha:0}).textAlign("center").text(a).attr({x:this.x,y:240,z:-1}).textColor(b.color).textFont({size:"30px",weight:"bold",family:"Press Start 2P"}),d=e[b.mode],d.enter(f).then(function(){return d.wait(f).then(function(){return d.leave(f).then(function(){var a,b,c,d;for(c=[],a=0,b=f.length;b>a;a++)d=f[a],c.push(d.destroy());return c})})})}})}).call(this),function(){}.call(this),function(){Crafty.c("Enemy",{init:function(){return this.requires("2D, WebGL, Collision, Tween, Choreography, ViewportFixed, Hideable, Flipable, Scalable, SunBlock, Hostile"),this.attr({pointsOnHit:10,pointsOnDestroy:50,damage:2}),this.invincible=!1},enemy:function(a){return null==a&&(a={}),a=_.defaults(a,{projectile:"Bullet"}),Crafty.trigger("EnemySpawned",this),this.onHit(a.projectile,function(a){var b;if(!Game.paused&&!this.hidden)return b=a[0].obj,this.invincible||(this.juice!==!1&&this.attr({hitFlash:{_red:255,_green:255,_blue:0}}),this.absorbDamage(b),this.trigger("Hit",{entity:this,projectile:b})),b.destroy()},function(){return this.attr({hitFlash:!1})}),this.onHit("Explosion",function(a){var b,c,d,e,f;if(!Game.paused&&!this.hidden&&!this.invincible){for(e=[],c=0,d=a.length;d>c;c++)b=a[c],f=b.obj,f.damage>0?(this.trigger("Hit",{entity:this,projectile:f}),this.juice!==!1&&this.attr({hitFlash:{_red:255,_green:255,_blue:128}}),this.absorbDamage(f),e.push(f.damage=0)):e.push(void 0);return e}},function(){return this.attr({hitFlash:!1})}),this},absorbDamage:function(a){var b,c,d,e,f;if(null!=a)return e=this.x+this.w/2,f=this.y+this.h/2,b={pointsOnHit:this.pointsOnHit,pointsOnDestroy:this.pointsOnDestroy,location:{x:e,y:f}},this.health-=a.damage,"function"==typeof this.updatedHealth&&this.updatedHealth(),this.health<=0?(Crafty.trigger("EnemyDestroyed",this),this.trigger("Destroyed",this),this.destroy(),null!=(c=a.ship)&&c.trigger("DestroyTarget",b),this.deathCause=a.ship):null!=(d=a.ship)?d.trigger("HitTarget",b):void 0}})}.call(this),function(){Crafty.c("Invincible",{init:function(){return this.requires("Delay")},_blink:function(){return null==this.blinkOn&&(this.blinkOn=!0),this.blinkOn=!this.blinkOn,this.blinkOn?this.alpha=.5:this.alpha=1},remove:function(){return this.cancelDelay(this._blink),this.alpha=1},invincibleDuration:function(a){return this.delay(this._blink,250,-1),-1===a?this:(this.delay(function(){return this.removeComponent("Invincible")},a,0),this)}})}.call(this),function(){Crafty.c("ScrollWall",{init:function(){return this.requires("2D, Edge, Collision, Acceleration"),this.shakes=[],this.motions=[],this.attr({x:0,y:0,w:2,h:Crafty.viewport.height,speed:{x:0,y:0}}),this.wallEnd=Crafty.e("2D, ScrollFront, Edge").attr({x:-(Crafty.viewport.x-Crafty.viewport.width)-3,y:0,h:Crafty.viewport.height,w:12}),this.attach(this.wallEnd),this.wallTop=Crafty.e("2D, Edge, Collision").attr({x:0,y:40,h:2,w:Crafty.viewport.width}),this.attach(this.wallTop),this.wallBottom=Crafty.e("2D, Edge, Collision").attr({x:0,y:Crafty.viewport.height-2,h:2,w:Crafty.viewport.width}),this.attach(this.wallBottom),this.bind("GameLoop",function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;for(o=this._currentSpeed.x,p=this._currentSpeed.y,this.updateAcceleration(),this.x+=o/1e3*a.dt,this.y+=p/1e3*a.dt,r=0,t=0,l=this.shakes,i=h=l.length-1;h>=0;i=h+=-1)n=l[i],n.easing.tick(a.dt),c=n.coords(n.easing.value()),r+=c[0],t+=c[1],n.easing.complete&&this.shakes.splice(i,1);for(b={x:0,y:0},m=this.motions,i=j=m.length-1;j>=0;i=j+=-1)k=m[i],e=k.coords(k.easing.value()),k.easing.tick(a.dt),d=k.coords(k.easing.value()),f=d[0]-e[0],g=d[1]-e[1],b.x+=f,b.y+=g,this.x+=f,this.y+=g,k.easing.complete&&this.motions.splice(i,1);return q=this.x+r,s=this.y+t,Crafty.viewport.y!==-s&&(Crafty.viewport.y=-s),Crafty.viewport.x!==-q&&(Crafty.viewport.x=-q),Crafty.viewport.xShift=r,Crafty.viewport.yShift=t,Crafty.trigger("CameraMove",{x:Math.round(this.x),y:Math.round(this.y),panning:b}),Crafty.trigger("ViewportMove",{x:Math.round(q),y:Math.round(s)})})},screenShake:function(a,b){return this.shakes.push({amount:a,duration:b,shakeX:Math.ceil(b/100),shakeY:Math.ceil(b/200),easing:new Crafty.easing(b,"linear"),startX:Math.random()>.5?-1:1,startY:Math.random()>.5?-1:1,coords:function(b){var c,d;return c=Math.cos(Math.PI/2+b*this.shakeX*(Math.PI/2)),d=Math.cos(Math.PI/2+b*this.shakeY*(Math.PI/2)),[c*a*this.startX,d*a*this.startY]}})},cameraPan:function(a){var b,c;return this.motions.push({easing:new Crafty.easing(a.duration,"easeInOutQuad"),x:null!=(b=a.x)?b:0,y:null!=(c=a.y)?c:0,coords:function(a){return[this.x*a,this.y*a]}})},scrollWall:function(a,b){return null==b&&(b={}),this.targetSpeed(a,b)},setHeight:function(a){return this.y+=a,Crafty.viewport.y=-this.y},setAllowPushing:function(a){this.allowPushing=a},off:function(){return this.wallEnd.removeComponent("Edge"),this.unbind("GameLoop")},remove:function(){return this.unbind("GameLoop")}})}.call(this),function(){Crafty.c("ShipSpawnable",{init:function(){return this.requires("Listener"),this.bind("Activated",this.spawnShip)},remove:function(){return this.unbind("Activated",this.spawnShip)},spawnPosition:function(a){return this.spawnPosition=a,null==this.spawnPosition&&(this.spawnPosition=function(){return{x:x,y:y}}),this},spawnShip:function(a){var b,c,d,e,f;return null==a&&(a={}),this.has("ControlScheme")&&this.lives>0?(e=this.spawnPosition(),e.x<10&&(e.x=10),null!=this.ship&&(e={x:this.ship.x+Crafty.viewport.x,y:this.ship.y+Crafty.viewport.y},this.ship.destroy(),this.ship=null),this.ship=Crafty.e(this.level.getShipType()).attr({x:e.x-Crafty.viewport.x,y:e.y-Crafty.viewport.y,z:this.z,playerNumber:this.playerNumber}),this.ship.playerColor=this.color(),"function"==typeof(b=this.ship).colorOverride&&b.colorOverride(this.color(),"partial"),this.has("Color")&&"function"==typeof(c=this.ship).color&&c.color(this.color()),"function"==typeof(d=this.ship).setSealevel&&d.setSealevel(Crafty.viewport.height-20+(null!=(f=this.level.sealevelOffset)?f:0)),this.has("ControlScheme")&&this.assignControls(this.ship),this.listenTo(this.ship,"HitTarget",function(a){var b,c;return this.stats.shotsHit+=1,b=null!=(c=a.pointsOnHit)?c:0,null!=a?this.addPoints(b,a.location):void 0}),this.listenTo(this.ship,"DestroyTarget",function(a){var b,c,d;return this.stats.enemiesKilled+=1,b=(null!=(c=a.pointsOnDestroy)?c:0)+(null!=(d=a.pointsOnHit)?d:0),null!=a?this.addPoints(b,a.location):void 0}),this.listenTo(this.ship,"BonusPoints",function(a){return this.addPoints(a.points,a.location)}),this.listenTo(this.ship,"PowerUp",function(a){return"ship"===a.type&&("life"===a.contains&&this.gainLife(),"points"===a.contains&&this.addPoints(500)),this.addPoints(20)}),this.listenTo(this.ship,"Shoot",function(){return this.stats.shotsFired+=1}),this.trigger("ShipSpawned",this.ship),Crafty.trigger("ShipSpawned",this.ship),this.ship.stats(a),this.ship.start(),this.listenTo(this.ship,"Hit",function(a){var b,c;return this.loseHealth(a.damage),c=0,b=this.health/this.maxHealth,.3>b&&(c=2),this.ship.sprite(0,c),this.health<0?this.ship.trigger("Die"):void 0}),this.listenTo(this.ship,"Destroyed",function(){return this.ship.destroy(),a=this.ship.stats(),this.ship=null,Crafty.e("Delay").delay(function(b){return function(){return b.loseLife(),b.spawnShip(a)}}(this),2e3,0)}),this):void 0}})}.call(this),function(){Crafty.c("TextInput",{init:function(){return this.requires("2D, DOM, Text")},remove:function(){},textInput:function(a,b){var c,d;return this.defer=WhenJS.defer(),d="A  ",c=0,this.text(d),a.bind("Up",function(a){return function(){return d=a._updateText(d,c,1),a.text(d)}}(this)),a.bind("Down",function(a){return function(){return d=a._updateText(d,c,-1),a.text(d)}}(this)),a.bind("Left",function(a){return function(){return c=Math.max(c-1,0),a._updateCursor(c)}}(this)),a.bind("Right",function(a){return function(){return c=Math.min(c+1,b-1),a._updateCursor(c)}}(this)),a.bind("Fire",function(e){return function(){var f;return f=c,c=Math.min(c+1,b-1),e._updateCursor(c),c===f&&c===b-1?(a.unbind("Up"),a.unbind("Down"),a.unbind("Left"),a.unbind("Right"),a.unbind("Fire"),e.defer.resolve(d)):void 0}}(this)),this.cursor=Crafty.e("2D, DOM, Text").attr({x:this.x,y:this.y,w:this.w}).text("_  ").textColor("#0000FF").textAlign("left").textFont({size:"20px",weight:"bold",family:"Press Start 2P"}),this.attach(this.cursor),this.defer.promise},_updateCursor:function(a){var b;return b=Array(a+1).join("&nbsp;")+"_",this.cursor.text(b)},_updateText:function(a,b,c){var d,e,f,g;return d="ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890-_.=!$& ",e=a[b],f=d.indexOf(e)+d.length,g=d[(f+c)%d.length],a.slice(0,b)+g+a.slice(b+1)}})}.call(this),function(){Crafty.c("BulletCircle",{bulletCircle:function(a){return this.shootConfig=_.defaults(a,{burstAmount:10}),this},shootRing:function(){var a,b,c,d,e,f,g,h,i;if(!this.hidden||this.shootConfig.shootWhenHidden){for(this.lastShotAt=0,this.currentBurst+=1,i=this.weaponOrigin||this.shootConfig.weaponOrigin||[this.w/2,this.h/2],i[0]*=null!=(d=this.scale)?d:1,i[1]*=null!=(e=this.scale)?e:1,a=360/this.shootConfig.burstAmount,h=Math.random()*a,g=[],b=c=0,f=this.shootConfig.burstAmount;f>=0?f>c:c>f;b=f>=0?++c:--c)g.push(this.shootConfig.projectile(i[0]+this.x,i[1]+this.y,h+b*a));return g}}})}.call(this),function(){Crafty.c("BurstShot",{remove:function(){return this.unbind("GameLoop",this._checkForShot)},burstShot:function(a){return this.shootConfig=_.defaults(a,{targetType:"PlayerControlledShip",burstCooldown:800,cooldown:200,burstAmount:10,aim:0,angle:0,angleDeviation:0}),this.currentBurst=0,this.bind("GameLoop",this._checkForShot)},_checkForShot:function(a){var b,c,d;if(null!=this.lastShotAt)if(this.lastShotAt+=a.dt,this.shootConfig.burstAmount<=this.currentBurst){if(this.lastShotAt<this.shootConfig.burstCooldown)return;this.currentBurst=0}else if(this.lastShotAt<this.shootConfig.cooldown)return;return d=this,b=0,Crafty(this.shootConfig.targetType).each(function(){return b=Math.atan2(d.y-this.y,d.x-this.x),b*=180/Math.PI}),c=b,c>this.shootConfig.angle+this.shootConfig.aim?c=this.shootConfig.angle+this.shootConfig.aim:c<this.shootConfig.angle-this.shootConfig.aim&&(c=this.shootConfig.angle-this.shootConfig.aim),c=c-Math.floor(this.shootConfig.angleDeviation/2)+Math.random()*this.shootConfig.angleDeviation,c=(c+360)%360,this.currentBurst<this.shootConfig.burstAmount?this._shoot(c):void 0},_shoot:function(a){var b,c,d,e;if(!this.hidden||this.shootConfig.shootWhenHidden)return this.lastShotAt=0,this.currentBurst+=1,e=null!=(b=this.weaponOrigin)?b:[0,0],e[0]*=null!=(c=this.scale)?c:1,e[1]*=null!=(d=this.scale)?d:1,this.shootConfig.projectile(e[0]+this.x,e[1]+this.y,a)}})}.call(this),function(){Crafty.c("ShootOnSight",{init:function(){return this.requires("Delay")},remove:function(){return this.unbind("GameLoop",this._checkForShot)},shootOnSight:function(a){var b,c,d,e;return this.shootConfig=_.defaults(a,{targetType:"PlayerControlledShip",sightAngle:10,shootWhenHidden:!1,cooldown:800}),e=null!=(b=this.weaponOrigin)?b:[0,0],e[0]*=null!=(c=this.scale)?c:1,e[1]*=null!=(d=this.scale)?d:1,null==this.muzzleFlash&&(this.muzzleFlash=Crafty.e("Sphere").attr({x:this.x+e[0],y:this.y+e[1],alpha:0}).muzzle(),this.attach(this.muzzleFlash)),this.muzzleFlash.attr({alpha:0}),this.lastShotAt=0,this.bind("GameLoop",this._checkForShot),this.bind("Revealing",function(a){return function(){return a.muzzleFlash.attr({alpha:0})}}(this))},_checkForShot:function(a){var b,c,d;if(!(this.shooting||null!=this.lastShotAt&&(this.lastShotAt+=a.dt,this.lastShotAt<this.shootConfig.cooldown)))return b=this,d=[],Crafty(this.shootConfig.targetType).each(function(){var a;return a=b._determineAngle(this),Math.abs(a-b.rotation)<b.shootConfig.sightAngle?d.push(this):void 0}),d.length>0?(c=_.sample(d),this._shoot(c)):void 0},_determineAngle:function(a){var b;return b=Math.atan2(this.y-a.y,this.x-a.x),b*=180/Math.PI,this.xFlipped&&(b+=180),(b+360)%360},_shoot:function(a){return!this.hidden||this.shootConfig.shootWhenHidden?(this.shooting=!0,this.muzzleFlash.attr({alpha:1}),this.delay(function(b){return function(){var c,d,e,f,g;return b.lastShotAt=0,g=null!=(d=b.weaponOrigin)?d:[0,0],g[0]*=null!=(e=b.scale)?e:1,g[1]*=null!=(f=b.scale)?f:1,c=b._determineAngle(a),b.xFlipped&&(c+=180),c=(c+360)%360,b.shootConfig.projectile(g[0]+b.x,g[1]+b.y,c),b.muzzleFlash.attr({alpha:0}),b.shooting=!1}}(this),300)):void 0}})}.call(this),function(){Crafty.c("GamepadControls",{init:function(){return this.requires("Listener"),this.bind("RemoveComponent",function(a){return"ControlScheme"===a?this.removeComponent("GamepadControls"):void 0}),this.emits={}},remove:function(){return this.unbind("GamepadKeyChange",this._keyHandling)},setupControls:function(a){return a.addComponent("GamepadControls").controls(this.controlMap).addComponent("ControlScheme")},controls:function(a){return this.controlMap=a,null!=a.gamepadIndex?(this.requires("Gamepad"),this.gamepad(a.gamepadIndex),this.bind("GamepadKeyChange",this._keyHandling),this.bind("GamepadAxisChange",this._stickHandling),this):void 0},_stickHandling:function(a){var b;return 1===a.axis&&(b="vertical",a.value<-.5?this._startEmit(b,"Up"):a.value>.5?this._startEmit(b,"Down"):this._stopEmit(b)),0===a.axis?(b="horizontal",a.value<-.5?this._startEmit(b,"Left"):a.value>.5?this._startEmit(b,"Right"):this._stopEmit(b)):void 0},_startEmit:function(a,b){var c;if((null!=(c=this.emits[a])?c.value:void 0)!==b)return this._stopEmit(a),this.trigger(b),this.emits[a]={interval:setInterval(function(a){return function(){return a.trigger(b)}}(this),200),value:b}},_stopEmit:function(a){var b;return clearInterval(null!=(b=this.emits[a])?b.interval:void 0),delete this.emits[a]},_keyHandling:function(a){return this.lastPressed&&this.lastPressed.getTime()>(new Date).getTime()-200?void 0:(this.lastPressed=new Date,a.button===this.controlMap.fire&&a.pressed&&this.trigger("Fire",a),a.button===this.controlMap.up&&a.pressed&&this.trigger("Up",a),a.button===this.controlMap.down&&a.pressed&&this.trigger("Down",a),a.button===this.controlMap.left&&a.pressed&&this.trigger("Left",a),a.button===this.controlMap.right&&a.pressed?this.trigger("Right",a):void 0)},assignControls:function(a){return a.addComponent("GamepadMultiway").gamepadMultiway({speed:{y:400,x:400},gamepadIndex:this.controlMap.gamepadIndex,analog:!0}),this.listenTo(a,"GamepadKeyChange",function(b){return function(c){return c.button===b.controlMap.fire&&a.shoot(c.pressed),c.button===b.controlMap.switchWeapon&&a.switchWeapon(c.pressed),c.button===b.controlMap["super"]&&a.superWeapon(c.pressed),c.button===b.controlMap.pause&&c.pressed?Game.togglePause():void 0}}(this))}})}.call(this),function(){Crafty.c("KeyboardControls",{init:function(){return this.requires("Listener"),this.bind("RemoveComponent",function(a){return"ControlScheme"===a?this.removeComponent("KeyboardControls"):void 0})},remove:function(){return this.unbind("KeyDown",this._keyHandling)},setupControls:function(a){return a.addComponent("KeyboardControls").controls(this.controlMap).addComponent("ControlScheme")},controls:function(a){return this.controlMap=a,this.bind("KeyDown",this._keyHandling),this},_keyHandling:function(a){return a.key===this.controlMap.fire&&this.trigger("Fire",a),a.key===this.controlMap.up&&this.trigger("Up",a),a.key===this.controlMap.down&&this.trigger("Down",a),a.key===this.controlMap.left&&this.trigger("Left",a),a.key===this.controlMap.right?this.trigger("Right",a):void 0},assignControls:function(a){var b,c,d,e,f,g,h,i,j;b=this.controlMap,h={},d={up:-90,down:90,left:180,right:0};for(c in d){j=d[c],g=b[c],i=Crafty.keys;for(e in i)f=i[e],f===g&&(h[e]=j)}return a.addComponent("Multiway, Keyboard").multiway({y:400,x:400},h,{clamp:!0}).bind("GamePause",function(a){return a?(this.disabledBeforePause=this.disableControls,this.disableControl()):this.disabledBeforePause?void 0:this.enableControl()}),this.listenTo(a,"KeyDown",function(c){return c.key===b.fire&&a.shoot(!0),c.key===b.switchWeapon&&a.switchWeapon(!0),c.key===b["super"]&&a.superWeapon(!0),c.key===b.pause?Game.togglePause():void 0}),this.listenTo(a,"KeyUp",function(c){return c.key===b.fire&&a.shoot(!1),c.key===b.switchWeapon&&a.switchWeapon(!1),c.key===b["super"]?a.superWeapon(!1):void 0})}})}.call(this),function(){Crafty.c("Blast",{init:function(){return this.requires("2D, WebGL, explosionStart, SpriteAnimation, Horizon, Collision")},remove:function(){return this.unbind("GameLoop")},explode:function(a,b){var c,d,e,f;return d=null!=(e=a.radius)?e:20,c=(null!=(f=a.duration)?f:160)/1e3,this.attr(a),this.attr({w:4*a.radius,h:4*a.radius}),this.attr({x:this.x-this.w/2,y:this.y-this.h/2}),this.collision([.2*this.w,.2*this.h,.8*this.w,.2*this.h,.8*this.w,.8*this.h,.2*this.w,.8*this.h]),this.reel("explode",3e3*c,[[0,0],[1,0],[2,0],[3,0],[4,0],[0,1],[1,1],[2,1],[3,1],[4,1],[0,2],[1,2],[2,2],[3,2],[4,2],[0,3],[1,3]]),b&&this.bind("GameLoop",function(a){return function(){var c;return c=b.call(a),a.attr(c)}}(this)),this.bind("AnimationEnd",function(a){return function(){return a.destroy()}}(this)),this.animate("explode"),this}})}.call(this),function(){Crafty.c("CameraCrew",{init:function(){return this.requires("2D, WebGL, Choreography, ViewportFixed, Collision, Hideable, helicopter, SpriteAnimation, Flipable, Scalable, Tween"),this.reel("fly",200,[[0,6,4,2],[4,6,4,2]]),this.crop(0,9,128,55),this.attr({w:128,h:55}),this.origin("center")},cameraCrew:function(){return this.animate("fly",-1),this.onHit("BackgroundBullet",function(a){var b;if(!Game.paused)return this.pauseAnimation(),this.sprite(8,6),b=a[0].obj,this.trigger("Hit",this),b.destroy()}),this}})}.call(this),function(){Crafty.c("Drone",{init:function(){return this.requires("Enemy, standardDrone")},drone:function(a){return null==a&&(a={}),this.attr(_.defaults(a,{w:40,h:40,health:100,defaultSpeed:100})),this.origin("center"),this.collision([2,25,8,18,20,13,30,15,33,28,14,34,4,30]),this.attr({weaponOrigin:[2,25]}),this.enemy(),this.bind("Hit",function(a){return function(b){return a.juice!==!1&&(a.shiftedX+=5),a.juice!==!1&&Crafty.audio.play("hit",1,.5),b.projectile.has("Bullet")&&a.juice!==!1?Crafty.e("Blast, LaserHit").explode({x:b.projectile.x,y:b.projectile.y,radius:4,duration:50}):void 0}}(this)),this},updatedHealth:function(){return this.juice!==!1?this.health<200?this.sprite(2,4,2,2):this.sprite(0,4,2,2):void 0},updateMovementVisuals:function(a,b,c,d){return this.vx=b*(1e3/d),this.vy=c*(1e3/d),b>0?this.flipX():this.unflipX()}})}.call(this),function(){Crafty.c("DroneShip",{init:function(){var a,b,c,d,e;return this.requires("2D, WebGL, Tween, Choreography, Solid, Collision,ViewportFixed, Hideable, Flipable, Scalable, SunBlock, WaterSplashes"),this.attr({w:384,h:160,z:6,waterRadius:8,minSplashDuration:1700,defaultWaterCooldown:800,waterSplashSpeed:700,minOffset:2,splashUpwards:!1}),this.collision([20,50,352,50,352,128,20,128]),d=Crafty.e("2D, WebGL, aircraftCarrierStart").attr({x:this.x,y:this.y,z:-13}),this.attach(d),c=Crafty.e("2D, WebGL, aircraftCarrierRadar").attr({x:this.x+256,y:this.y-24,z:-12}),this.attach(c),a=Crafty.e("2D, WebGL, aircraftCarrierEnd").attr({x:this.x+192,y:this.y,z:-13}),this.attach(a),e=Crafty.e("2D, WebGL, aircraftCarrierStart").attr({x:this.x,y:this.y+60,z:3}).crop(0,60,192,160),this.attach(e),b=Crafty.e("2D, WebGL, aircraftCarrierEnd").attr({x:this.x+192,y:this.y+60,z:3}).crop(0,60,192,160),this.attach(b),this.hatch=Crafty.e("carrierHatch").attr({x:this.x+96,y:this.y+28,z:-5}),this.attach(this.hatch)},open:function(){return this.hatch.animate("open")},close:function(){return this.hatch.animate("close")}})}.call(this),function(){Crafty.c("Helicopter",{init:function(){return this.requires("Enemy, helicopter, SpriteAnimation"),this.reel("fly",200,[[0,6,4,2],[4,6,4,2]]),this.crop(0,9,128,55),this.origin("center"),this.collision([8,5,120,5,112,35,12,47])},helicopter:function(a){var b,c;return null==a&&(a={}),b=2750,this.attr(_.defaults(a,{w:128,h:55,health:b,maxHealth:null!=(c=a.health)?c:b,weaponOrigin:[5,46]})),this.origin("center"),this.flip("x"),this.animate("fly",-1),this.enemy(),this.bind("Hit",function(a){return function(b){return b.projectile.has("Bullet")?(a.shiftedX+=2,Crafty.audio.play("hit",1,.5),Crafty.e("Blast, LaserHit").explode({x:b.projectile.x,y:b.projectile.y,radius:4,duration:50})):void 0}}(this)),this},updatedHealth:function(){var a;return a=this.health/this.maxHealth,.01>a?(this.pauseAnimation(),this.sprite(8,6)):this.isPlaying("fly")?void 0:this.animate("fly",-1)},updateMovementVisuals:function(a,b,c,d){return this.vx=b*(1e3/d),this.vy=c*(1e3/d)}})}.call(this),function(){Crafty.c("LargeDrone",{init:function(){return this.requires("Enemy, standardLargeDrone, SpriteAnimation")},drone:function(a){var b,c;return null==a&&(a={}),b=36e4,this.crop(0,0,90,70),this.attr(_.defaults(a,{health:b,maxHealth:null!=(c=a.health)?c:b,z:-1})),this.origin("center"),this.collision([2,36,16,15,86,2,88,4,62,15,57,46,46,66,18,66,3,47]),this.eye=Crafty.e("2D, WebGL, eyeStart, SpriteAnimation"),this.eye.crop(0,0,20,26),this.attach(this.eye),this.eye.attr({x:2+this.x,y:18+this.y,z:1}),this.eye.reel("slow",1500,[[6,0],[7,0],[8,0],[9,0],[6,1],[7,1],[8,1],[9,1]]),this.wing=Crafty.e("2D, WebGL, wingLoaded, SpriteAnimation"),this.wing.crop(0,0,46,21),this.attach(this.wing),this.wing.attr({x:19+this.x,y:28+this.y,z:1,h:21,w:46}),this.wing.reel("emptyWing",30,[[14,2,2,1]]),this.wing.reel("reload",500,[[6,2,2,1],[8,2,2,1],[10,2,2,1],[12,2,2,1]]),this.enemy(),this.onHit("Mine",function(a){var b,c,d,e;if(!Game.paused&&!this.hidden)for(c=0,d=a.length;d>c;c++){if(b=a[c],e=b.obj,e.hidden)return;if(e.z<0)return;e.absorbDamage(300)}}),this.updatedHealth(),this.bind("Hit",function(a){return function(b){return b.projectile.has("Bullet")?(a.shiftedX+=1,Crafty.audio.play("hit",1,.5),Crafty.e("Blast, LaserHit").explode({x:b.projectile.x,y:b.projectile.y,z:a.z+2,radius:4,duration:50})):void 0}}(this)),this},healthBelow:function(a){return this.health/this.maxHealth<a},updatedHealth:function(){var a;return a=this.health/this.maxHealth,.3>a?this.sprite(9,8,3,3):.6>a?this.sprite(6,8,3,3):.9>a?this.sprite(3,8,3,3):this.sprite(0,8,3,3)},updateMovementVisuals:function(a,b,c,d){return this.vx=b*(1e3/d),this.vy=c*(1e3/d)}})}.call(this),function(){Crafty.c("Mine",{init:function(){return this.requires("Enemy, standardMine, SpriteAnimation"),this.reel("open",200,[[4,3],[5,3]]),this.reel("close",200,[[4,3],[3,3]]),this.reel("blink",100,[[5,3],[6,3]]),this.bind("GameLoop",function(a){var b;return b=.09*a.dt,this.attr({rotation:this.rotation+b})})},mine:function(a){return null==a&&(a={}),this.crop(4,4,25,25),this.attr(_.defaults(a,{h:25,w:25,health:100,weaponOrigin:[12,12]})),this.origin("center"),this.enemy(),this},updateMovementVisuals:function(a,b,c,d){return this.vx=b*(1e3/d),this.vy=c*(1e3/d)}})}.call(this),function(){Crafty.c("OldDrone",{init:function(){return this.requires("Enemy, Color")},drone:function(a){return null==a&&(a={}),this.color("#0000FF"),this.attr(_.defaults(a,{w:40,h:40,health:200})),this.origin("center"),this.attr({weaponOrigin:[2,25]}),this.enemy(),this}})}.call(this),function(){Crafty.c("OldExplosion",{init:function(){return this.requires("2D,Tween,Delay"),this.explosionMode=window.Game.explosionMode,"block"===this.explosionMode?this.requires("WebGL,Color"):void 0},explode:function(a){var b,c,d,e,f,g;return e=null!=(f=a.radius)?f:20,c=(null!=(g=a.duration)?g:160)/1e3,this.attr(a),d={maxParticles:13*a.radius,size:2*a.radius,sizeRandom:8,speed:a.radius/13,speedRandom:.5,lifeSpan:19,lifeSpanRandom:7,angle:0,angleRandom:360,startColour:[235,135,5,1],startColourRandom:[28,150,45,.2],endColour:[135,135,135,0],endColourRandom:[60,60,60,.1],sharpness:10,sharpnessRandom:10,spread:a.radius/2,duration:c*Crafty.timer.FPS(),fastMode:!1,gravity:{x:0,y:0},jitter:0},this.attr({w:1,h:1}),"block"===this.explosionMode&&this.color("#FF0000"),this.tween({x:this.x-e,y:this.y-e,w:this.w+2*e,h:this.h+2*e,alpha:.2},500),this.bind("TweenEnd",function(){return this.destroy()}),"particles"===this.explosionMode&&(d.fastMode=!0,d.maxParticles=3*a.radius,d.size=a.radius),("particles"===this.explosionMode||null===this.explosionMode)&&(b=(d.lifeSpan+d.lifeSpanRandom)*Crafty.timer.FPS(),Crafty.e("2D,Particles,Delay").attr({x:this.x-a.radius/2,y:this.y-a.radius/2}).particles(d).bind("ParticleEnd",function(){return this.delay(function(){return this.destroy()},b)})),this}})}.call(this),function(){Crafty.c("PlayerClone",{init:function(){return this.requires("Enemy, playerShip")},playerClone:function(a){var b,c;return null==a&&(a={}),b=300,this.attr(_.defaults(a,{h:45,w:71,health:b,maxHealth:null!=(c=a.health)?c:b,weaponOrigin:[5,30]})),this.origin("center"),this.colorOverride("#808080","partial"),this.enemy(),this.bind("Hit",function(a){return function(b){return b.projectile.has("Bullet")?(a.shiftedX+=2,Crafty.audio.play("hit",1,.5),Crafty.e("Blast, LaserHit").explode({x:b.projectile.x,y:b.projectile.y,radius:4,duration:50})):void 0}}(this)),this},updatedHealth:function(){var a,b;return b=0,a=this.health/this.maxHealth,.3>a&&(b=2),this.sprite(0,b)},updateMovementVisuals:function(a,b,c,d){return this.vx=b*(1e3/d),this.vy=c*(1e3/d)}})}.call(this),function(){Crafty.c("PowerUp",{init:function(){return this.requires("2D, WebGL, ColorEffects, powerUpBox, SpriteAnimation, TweenPromise, Scalable"),this.reel("blink",600,[[10,1],[11,1],[12,1],[11,1]]),this.attr({w:32,h:32}),this.pickedUp=!1},remove:function(){},powerUp:function(a){var b,c,d,e,f;return this.settings=a,this.animate("blink",-1),b="#802020",this.settings.type&&(f={weapon:"#202080",weaponBoost:"#D06000",weaponUpgrade:"#30B030",ship:"#802020"},b=f[this.settings.type]),this.colorOverride(b,"partial"),this.settings.icon?(c=Crafty.e("2D,WebGL,ColorEffects").addComponent(this.settings.icon).colorOverride("white","partial").attr({w:22,h:22,x:5,y:5}),this.attach(c)):this.settings.marking&&(e="16px",d={x:8,y:8},2===this.settings.marking.length&&(e="9px",d={x:3,y:8}),c=Crafty.e("2D,DOM,Text").textColor("#FFF").textFont({size:e,family:"Press Start 2P"}).text(this.settings.marking).attr(d),this.attach(c)),this},pickup:function(){return this.pickedUp=!0,this.tweenPromise({scale:1.5,x:this.x-12,y:this.y-12},120).then(function(a){return function(){return a.tweenPromise({alpha:0,scale:.3,z:20,x:a.x+15,y:a.y+15},120).then(function(){return a.destroy()})}}(this))}})}.call(this),function(){Crafty.c("Projectile",{init:function(){return this.requires("2D, WebGL, ViewportFixed")},shoot:function(a,b,c){return this.attr({x:a,y:b,rotation:c}),this.bind("GameLoop",function(a){var b;return b=a.dt*(this.speed/1e3),this.x-=Math.cos(this.rotation/180*Math.PI)*b,this.y-=Math.sin(this.rotation/180*Math.PI)*b,(this.x<-Crafty.viewport.x||this.x>-Crafty.viewport.x+Crafty.viewport.width)&&this.destroy(),this.y<-Crafty.viewport.y||this.y>-Crafty.viewport.y+Crafty.viewport.height?this.destroy():void 0}),this}})}.call(this),function(){Crafty.c("Rocket",{init:function(){return this.requires("Enemy, standardRocket")},rocket:function(a){return null==a&&(a={}),this.crop(0,0,47,17),this.attr(_.defaults(a,{health:300})),this.origin("center"),this.enemy(),this},updateMovementVisuals:function(a,b,c,d){return this.vx=b*(1e3/d),this.vy=c*(1e3/d),null!=a?this.rotation=a:void 0}})}.call(this),function(){Crafty.c("Sun",{init:function(){var a,b,c,d;return this.requires("2D, WebGL, Collision, Choreography, ViewportFixed, sun"),this.crop(0,1,64,64),this.attr({w:20,h:20,z:-1e3}),this.origin("center"),this.glare=[],c=Crafty.e("2D, WebGL, Glare, directGlare").crop(0,0,175,175).attr({w:3*this.w,h:3*this.h,z:90,alpha:.8,originalAlpha:.8}).origin("center"),this.attach(c),this.glare.push(c),b=Crafty.e("2D, WebGL, Glare, bigGlare, Horizon").crop(0,0,200,200).attr({mirrored:!0,w:80,h:80,z:91,res:.9,alpha:.4,originalAlpha:.4,blur:2}).origin("center").saturationGradient(1,1),this.attach(b),this.glare.push(b),d=Crafty.e("2D, WebGL, Glare, bigGlare, ColorEffects").crop(0,0,200,200).colorOverride("#fd6565").attr({mirrored:!0,w:10,h:10,z:92,res:.8,alpha:.6,originalAlpha:.6}).origin("center"),this.attach(d),this.glare.push(d),a=Crafty.e("2D, WebGL, Glare, bigGlare").crop(0,0,200,200).attr({mirrored:!0,w:200,h:200,z:93,alpha:.2,res:1.1,originalAlpha:.2}).origin("center"),this.attach(a),this.glare.push(a)},sun:function(a){return this.attr(a),this.uniqueBind("GameLoop",this._updateGlare),this},remove:function(){return this.unbind("GameLoop",this._updateGlare)},_updateGlare:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C;if(d=[0],x=this.area(),c=this.hit("SunBlock"))for(l=0,o=c.length;o>l;l++)r=c[l],g=r.obj,"SAT"===r.type?d.push(-1*r.overlap/50*x):(A=Math.max(this.x,g.x),z=Math.min(this.x+this.w,g.x+g.w),y=z-A,C=Math.max(this.y,g.y),B=Math.min(this.y+this.h,g.y+g.h),h=B-C,d.push(y*h));for(q=1.7*Math.max.apply(Math,d),s=q/x,q>x&&(s=1),k=Crafty.viewport.width/2,i=Crafty.viewport.height/2,e=this.x+this.w/2-(-1*Crafty.viewport.x+k),f=this.y+this.h/2-(-1*Crafty.viewport.y+i),t=e/k,u=f/i,v=this.glare,m=0,p=v.length;p>m;m++)g=v[m],g.attr({alpha:g.originalAlpha*(1-s)}),g.mirrored?g.attr({x:this.x+this.w/2-g.w/2-2*e*g.res,y:this.y+this.h/2-g.h/2-2*f*g.res}):g.attr({w:5*this.w,h:5*this.h,x:this.x-2*this.w,y:this.y-2*this.h});return j=Crafty.viewport.height-225-Crafty.viewport._y-this.y,w=65-30*(Math.min(Math.max(j,0),200)/200),a=2-2*(Math.min(Math.max(j,0),200)/200),this.attr({blur:a}),this.w=w,this.h=w,n=.4+Math.max(j-150,0)/200,b=Math.min(Math.max(.4,n),1),Crafty("cloud").each(function(){return this.attr({lightness:b})}),Crafty("GoldenStripe").each(function(){return 0>=j?this.attr({alpha:1-Math.min(Math.abs(j),20)/20,h:3}):j>0&&1>j?this.attr({alpha:1,h:3}):60>j?this.attr({alpha:1,h:Math.abs(Math.max(Math.min(j/2,40),3))}):120>j?this.attr({alpha:1-Math.min(Math.abs(j-60),60)/60,h:Math.abs(Math.max(Math.min(j/2,40),1))}):this.attr({alpha:0,h:10})})}})}.call(this),function(){Crafty.c("Tank",{init:function(){return this.requires("Enemy, laserTank, Delay"),this.crop(6,5,179,103)},tank:function(a){var b,c,d;return null==a&&(a={}),b=2750,this.attr(_.defaults(a,{w:179,h:103,health:b,maxHealth:null!=(d=a.health)?d:b,aimSpeed:45})),this.barrel=Crafty.e("2D, WebGL, laserTankBarrel, TweenPromise"),this.barrel.crop(5,4,109,38),this.barrel.attr({x:this.x+54,y:this.y,z:this.z-1,w:109,h:38}),this.barrel.origin(this.barrel.w-32,32),this.charge=Crafty.e("2D, Color, WebGL, TweenPromise"),this.charge.color("#F0F"),this.charge.attr({x:this.barrel.x-10,y:this.barrel.y+5,w:10,h:28,alpha:0}),this.charge.origin(this.charge.w-32,32),
this.laser=Crafty.e("2D, Color, WebGL, TweenPromise, Collision"),this.laser.color("#F0F"),c=1e3,this.laser.attr({x:this.barrel.x-c,y:this.barrel.y+5,w:c,h:28,alpha:0}),this.laser.origin(this.laser.w-10,10),this.attach(this.barrel),this.barrel.attach(this.charge),this.barrel.attach(this.laser),this.enemy(),this},updatedHealth:function(){},execute:function(a,b,c){switch(a){case"searchAim":return this.aimAt(c.player("anyActive"));case"shoot":return this.shoot()}},aimAt:function(a){var b,c;return b=this.aimAngle(a),null===b?WhenJS().delay(1e3).then(function(b){return function(){return b.aimAt(a)}}(this)):(-80>b&&(b=(b+360)%360),c=1e3*Math.abs(this.barrel.rotation-b)/this.aimSpeed,this.barrel.tweenPromise({rotation:b},c).then(function(b){return function(){var c;return c=Math.abs(b.aimAngle(a)-b.barrel.rotation),c>10?b.aimAt(a):void 0}}(this)))},aimAngle:function(a){var b,c,d;return d=a.ship(),null===d?null:(b=[this.barrel.x+this.barrel._origin.x,this.barrel.y+this.barrel._origin.y],c=[d.x+d.w/2,d.y+d.h/2],180*Math.atan2(b[1]-c[1],b[0]-c[0])/Math.PI)},shoot:function(){var a,b;return a=500,b=100,this.charge.tweenPromise({alpha:1},a).then(function(a){return function(){return a.charge.attr({alpha:0}),a.laser.addComponent("Hostile"),a.laser.attr({alpha:1}),WhenJS().delay(b).then(function(){return a.laser.removeComponent("Hostile"),a.laser.attr({alpha:0})})}}(this))}})}.call(this),function(){Crafty.c("WaterSplash",{init:function(){return this.requires("2D,Particles,Delay"),this.explosionMode=window.Game.explosionMode,"block"===this.explosionMode?this.requires("WebGL, Color, Tween"):void 0},waterSplash:function(a){var b,c,d;return c={maxParticles:2*a.size,size:a.size/1.5,sizeRandom:4,speed:a.size/20,speedRandom:.2,lifeSpan:a.size/3,lifeSpanRandom:7,angle:350,angleRandom:20,startColour:[40,40,170,1],startColourRandom:[0,0,0,0],endColour:[205,205,205,.1],endColourRandom:[30,30,30,.1],sharpness:10,sharpnessRandom:5,spread:a.size/3,duration:900/Crafty.timer.FPS(),fastMode:!1,gravity:{x:0,y:.25},jitter:0},b=(c.lifeSpan+c.lifeSpanRandom)*Crafty.timer.FPS(),"particles"===this.explosionMode&&(c.fastMode=!0),"block"!==this.explosionMode?this.attr({x:a.x,y:a.y}).particles(c).bind("ParticleEnd",function(){return this.delay(function(){return this.destroy()},b)}):(d=60,this.attr({x:a.x,y:a.y,w:30,h:0}),this.color("#FFFFFF"),this.tween({y:this.y-d,h:this.h+d,alpha:.2},500),this.bind("TweenEnd",function(){return this.destroy()})),this}})}.call(this),function(){Crafty.c("Acceleration",{init:function(){return this._currentSpeed={x:0,y:0},this._targetSpeed={x:0,y:0},this._accelerate={x:.01,y:.01},this._currentAcceleration={x:0,y:0}},updateAcceleration:function(){return this._handleAcceleration("x"),this._handleAcceleration("y")},targetSpeed:function(a,b){return null==b&&(b={}),b=_.defaults(b,{accellerate:!0}),b.accellerate?this._accelerate={x:.01,y:.01}:this._accelerate={x:1/0,y:1/0},null!=a.x&&null!=a.y?(this._targetSpeed.x=a.x,this._targetSpeed.y=a.y):(this._targetSpeed.x=a,this._targetSpeed.y=0),this},_handleAcceleration:function(a){var b;if(this._currentSpeed[a]!==this._targetSpeed[a]&&(b=1,this._currentSpeed[a]>this._targetSpeed[a]&&(b=-1),this._currentAcceleration[a]+=this._accelerate[a]*b,this._currentSpeed[a]+=this._currentAcceleration[a],!(this._currentAcceleration[a]>0&&this._currentSpeed[a]<this._targetSpeed[a]||this._currentAcceleration[a]<0&&this._currentSpeed[a]>this._targetSpeed[a])))return this._currentSpeed[a]=this._targetSpeed[a],this._currentAcceleration[a]=0}})}.call(this),function(){Crafty.c("Choreography",{init:function(){return this._ctypes={delay:this._executeDelay,linear:this._executeLinear,viewport:this._executeMoveIntoViewport,viewportBezier:this._executeViewportBezier}},remove:function(){return this.unbind("GameLoop",this._choreographyTick),null!=this._currentPart?(this._currentPart=null,this._choreography=[],this.trigger("ChoreographyEnd")):void 0},choreography:function(a,b){var c,d;if(null==b&&(b={}),this.uniqueBind("GameLoop",this._choreographyTick),this._options=_.defaults(b,{repeat:0,compensateCameraSpeed:!1,skip:0}),this._options.compensateCameraSpeed&&(this.camera=Crafty(Crafty("ScrollWall")[0]),this._options.cameraLock={x:this.camera.x}),this._choreography=a,this._repeated=0,c=0,this._setupCPart(c),d=b.skip,this._toSkip=0,d>0){for(;c<this._choreography.length-1&&d>this._currentPart.duration;)d-=this._currentPart.duration,c+=1,this._setupCPart(c);this._toSkip=d}return this},synchChoreography:function(a){return this._choreography=_.clone(a._choreography),this._options=a._options,this._repeated=a._repeated,this._toSkip=a._toSkip,this._currentPart=_.clone(a._currentPart),this._currentPart.easing=_.clone(a._currentPart.easing),this.uniqueBind("GameLoop",this._choreographyTick)},_setupCPart:function(a){var b;if(this._currentPart=null,!(a<this._choreography.length)){if(!(this._repeated<this._options.repeat||-1===this._options.repeats))return null!=this.updateMovementVisuals&&this.updateMovementVisuals(void 0,0,0,1),this._choreography=[],this.unbind("GameLoop",this._choreographyTick),void this.trigger("ChoreographyEnd");this._repeated+=1,a=0}return b=this._choreography[a],null!=b.event&&this.trigger(b.event,{entity:this,data:b.data}),this._setupPart(b,a)},_choreographyTick:function(a){var b,c,d;if(null!=this._currentPart)return c=this._currentPart.easing.value(),b=a.dt+this._toSkip,this._currentPart.easing.tick(b),this._toSkip=0,d=this._currentPart.easing.value(),this._ctypes[this._currentPart.type].apply(this,[d,c,b]),this._options.compensateCameraSpeed&&(this.x+=this.camera.x-this._options.cameraLock.x),this._currentPart.easing.complete?this._setupCPart(this._currentPart.part+1):void 0},_setupPart:function(a,b){var c,d,e,f,g;if(d=null!=(f=a.easingFn)?f:"linear",this._currentPart=_.extend(_.clone(a),{part:b,x:this.x,y:this.y,dx:a.x,dy:a.y,rotation:a.rotation,easing:new Crafty.easing(null!=(g=a.duration)?g:0,d)}),a.properties){c={};for(e in a.properties)c[e]=this[e];return this._currentPart.currentProperties=c}},_executeLinear:function(a,b){var c,d,e,f,g,h;return c=a*(null!=(e=this._currentPart.dx)?e:0)-b*(null!=(f=this._currentPart.dx)?f:0),d=a*(null!=(g=this._currentPart.dy)?g:0)-b*(null!=(h=this._currentPart.dy)?h:0),this.x+=c,this.y+=d},_executeDelay:function(a){},_executeMoveIntoViewport:function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p;return g=this._currentPart.dx,k=0,g&&(null==(e=this._currentPart).moveOriginX&&(e.moveOriginX=this._currentPart.x+Crafty.viewport.x-Crafty.viewport.xShift),i=g-this._currentPart.moveOriginX,m=i*a,o=i*b,k=m-o),h=this._currentPart.dy,l=0,h&&(null==(f=this._currentPart).moveOriginY&&(f.moveOriginY=this._currentPart.y+Crafty.viewport.y-Crafty.viewport.yShift),j=h-this._currentPart.moveOriginY,n=j*a,p=j*b,l=n-p),null!=this.updateMovementVisuals&&(this._currentPart.rotation?(d=Math.atan2(l,k),d*=180/Math.PI,d=(d+360+180)%360):d=void 0,this.updateMovementVisuals(d,k,l,c)),this.x+=k,this.y+=l},_executeViewportBezier:function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;if(d=new Game.BezierPath,null==this._currentPart.bPath){if(l=this._currentPart.path,null!=this._lastBezierPathPoint&&this._currentPart.continuePath&&l.unshift({x:this._lastBezierPathPoint.x,y:this._lastBezierPathPoint.y}),this._currentPart.bPath=d.buildPathFrom(l),null!=this._lastBezierPathPoint&&this._currentPart.continuePath){for(i=this._currentPart.bPath.curves.shift(),o=0,p=this._currentPart.bPath.curves,j=0,k=p.length;k>j;j++)e=p[j],o+=e.distance;this._currentPart.bPath.distance=o,this._lastBezierPathPoint=null}this._lastBezierPathPoint=this._currentPart.path[this._currentPart.path.length-2]}return null==this._currentPart.viewport&&(this._currentPart.viewport={y:Crafty.viewport.y}),r=this._currentPart.viewport.y-Crafty.viewport.y,m=d.pointOnPath(this._currentPart.bPath,a),n=d.pointOnPath(this._currentPart.bPath,b),null==this.shiftedX&&(this.shiftedX=0),f=this.shiftedX,this.shiftedX=Math.max(0,this.shiftedX-.5),g=m.x-n.x+(this.shiftedX-f),h=m.y-n.y,this._currentPart.rotation&&(q=d.angleOnPath(this._currentPart.bPath,a)),null!=this.updateMovementVisuals?this.updateMovementVisuals(q,g,h,c):null!=q&&(this.rotation=q),this.x+=g,this.y+=h}})}.call(this),function(){Crafty.c("ColorFade",{colorFade:function(a,b,c){var d,e;return this.bottomColors=b,this.topColors=c,this.duration=a.duration,e=a.skip,this.v=0,this.v+=null!=(d=Math.max(e,0))?d:0,this.bind("GameLoop",this._recolor)},remove:function(){return this.unbind("GameLoop",this._recolor)},_recolor:function(a){var b,c,d;return this.v+=a.dt,c=this.v/this.duration,0>c&&(c=0),c>=1&&(this.unbind("GameLoop",this._recolor),this.trigger("ColorFadeFinished"),c=1),b=this._buildColor(c,this.bottomColors),d=this._buildColor(c,this.topColors),Crafty.trigger("BackgroundColor",b),Crafty.background(b),this.bottomColor(b),this.topColor(d)},_buildColor:function(a,b){var c,d,e,f,g,h;return f=1/(b.length-1),d=Math.floor(a/f),c=b[d],h=null!=(g=b[d+1])?g:c,e=(a-d*f)/f,this._mix(e,c,h)},_mix:function(a,b,c){var d,e,f,g,h;return e=this._strToColor(b),h=this._strToColor(c),d={r:Math.round(e.r*(1-a)+h.r*a),g:Math.round(e.g*(1-a)+h.g*a),b:Math.round(e.b*(1-a)+h.b*a)},"#"+function(){var a;a=[];for(g in d)f=d[g],a.push(("0"+f.toString(16)).slice(-2));return a}().join("")},_strToColor:function(a){return{r:parseInt(a.slice(1,3),16),g:parseInt(a.slice(3,5),16),b:parseInt(a.slice(5,7),16)}}})}.call(this),function(){Crafty.c("Listener",{init:function(){return this.listeners=[]},remove:function(){var a,b,c,d,e,f,g,h;for(f=this.listeners,h=[],c=0,d=f.length;d>c;c++)g=f[c],e=g.object,b=g.event,a=g.callback,h.push(e.unbind(b,a));return h},listenTo:function(a,b,c,d){var e;return null==d&&(d=this),e=function(){return c.apply(d,arguments)},this.listeners.push({object:a,event:b,callback:e}),a.bind(b,e)}})}.call(this),function(){var a=[].slice;Crafty.c("TweenPromise",{init:function(){return this.requires("Tween")},tweenPromise:function(){var b,c;return b=1<=arguments.length?a.call(arguments,0):[],c=WhenJS.defer(),this.one("TweenEnd",function(){return c.resolve()}),this.tween.apply(this,b),c.promise}})}.call(this),function(){Crafty.c("ViewportFixed",{init:function(){return this._initialViewport={x:Crafty.viewport.x,y:Crafty.viewport.y},this.motion=Crafty.bind("CameraMove",function(a){return function(b){var c,d;return c=a._initialViewport.x+b.x,d=a._initialViewport.y+b.y,null==a.shiftedX&&(a.shiftedX=0),a.shiftedX=Math.max(0,a.shiftedX-.5),a.attr({x:a.x+c+a.shiftedX-b.panning.x,y:a.y+d-b.panning.y}),a._initialViewport={x:-b.x,y:-b.y}}}(this))},remove:function(){return Crafty.unbind("CameraMove",this.motion)}})}.call(this),function(){Crafty.c("ViewportRelativeMotion",{init:function(){},remove:function(){},viewportRelativeMotion:function(a){var b,c,d,e,f,g,h,i,j;return i=a.x,j=a.y,h=a.speed,b=a.distanceSky,this._distanceSky=b,this._startLocation={x:i,y:j},this._speed=h,this._initialViewport={x:Crafty.viewport.width/4},this._location={sx:i+(i-this._initialViewport.x)*(this._speed-1),sy:j,dx:null!=(e=this.dx)?e:0,dy:null!=(f=this.dy)?f:0},g=(this._initialViewport.x-Crafty.viewport._x)*(this._speed-1),c=this._location.sx-g+this._location.dx,d=this._location.sy-Crafty.viewport._y*(1-this._speed)+this._location.dy,this._location.x=Math.floor(c),this._location.y=Math.floor(d),this.attr(this._location),this.motion=Crafty.bind("CameraMove",function(a){return function(b){return g=(a._initialViewport.x+b.x)*(a._speed-1),c=a._location.sx-g+a.dx,d=a._distanceSky?a._location.sy- -b.y*(1-a._speed)+a.dy:a._location.sy- -b.y*(1-1.2*(a._speed-.225))+a.dy,a.attr({x:c,y:d})}}(this)),this},remove:function(){return Crafty.unbind("CameraMove",this.motion)}})}.call(this),function(){Crafty.c("ControlScheme",{init:function(){return this.has("Cheats")||this.addComponent("Cheats"),this.trigger("Activated"),Crafty.trigger("PlayerActivated")},remove:function(){return this.removeComponent("Cheats"),this.trigger("Deactivated"),Crafty.trigger("PlayerDeactivated")}})}.call(this),function(){Crafty.c("InventoryWeapons",{init:function(){},stats:function(a){var b,c,d,e,f,g,h;return null==a&&(a={}),null!=a.primary&&(this.primaryWeapon.stats=a.primary.stats,this.primaryWeapon._determineWeaponSettings()),h={},h.primary={stats:null!=(b=null!=(c=this.primaryWeapon)?c.stats:void 0)?b:{},boosts:null!=(d=null!=(e=this.primaryWeapon)?e.boosts:void 0)?d:{},boostTimings:null!=(f=null!=(g=this.primaryWeapon)?g.boostTimings:void 0)?f:{}},h},installItem:function(a){var b;if(null!=a){if("weapon"===a.type){if(this.hasItem(a.contains))return;if(this.items.push(a),"lasers"===a.contains)return this._installPrimary("RapidWeaponLaser"),!0;if("oldlasers"===a.contains)return this._installPrimary("OldWeaponLaser"),!0;if("diagonals"===a.contains)return this._installPrimary("RapidDiagonalLaser"),!0}if("ship"===a.type){if("life"===a.contains)return this.scoreText("Extra life!"),!0;if("points"===a.contains)return this.scoreText("+500 points!"),!0;if("xp"===a.contains)return"function"==typeof(b=this.primaryWeapon).addXP&&b.addXP(1e3),!0}return"weaponUpgrade"===a.type?(this.primaryWeapon.upgrade(a.contains),!0):"weaponBoost"===a.type?(this.primaryWeapon.boost(a.contains),!0):void 0}}})}.call(this),function(){Crafty.c("Player",{init:function(){return this.reset()},reset:function(){return this.softReset(),this.removeComponent("ControlScheme")},softReset:function(){return this.stats={shotsFired:0,shotsHit:0,enemiesKilled:0,bonus:0},this.attr({lives:3,health:5,maxHealth:5,points:0})},loseHealth:function(a){return this.health-=a,this.trigger("UpdateHealth",{lives:this.health})},loseLife:function(){return this.lives>0?(this.lives-=1,this.health=this.maxHealth,this.trigger("UpdateLives",{lives:this.lives}),this.lives<=0?Crafty.trigger("PlayerDied",this):void 0):void 0},gainLife:function(){return this.lives+=1,this.trigger("UpdateLives",{lives:this.lives})},eligibleForExtraLife:function(){return this.lastExtraLifeThreshold||(this.lastExtraLifeThreshold=0),this.points-this.lastExtraLifeThreshold>=1e4?!0:void 0},rewardExtraLife:function(){return this.lastExtraLifeThreshold=this.points},addPoints:function(a,b){return this.lives>0?(b&&a>0&&this.ship.scoreText("+"+a,{location:b,attach:!1,duration:200,distance:30,delay:10}),this.points+=a,this.trigger("UpdatePoints",{points:this.points})):void 0}})}.call(this),function(){Crafty.c("PlayerAssignable",{init:function(){return this._attachControllerAssignTrigger(),this.preferredPlayer=null},_assignControls:function(){var a;return a=this._preferredplayer()||this._firstUnassignedPlayer(),null==a?void this._attachControllerAssignTrigger():(this.preferredPlayer=a.getId(),this.setupControls(a),a.one("Deactivated",function(a){return function(){return a._attachControllerAssignTrigger()}}(this)))},_attachControllerAssignTrigger:function(){return this.one("Fire",this._assignControls)},_preferredplayer:function(a){var b;return null===this.preferredPlayer||(b=Crafty(this.preferredPlayer),b.has("ControlScheme"))?void 0:b},_firstUnassignedPlayer:function(){var a,b,c,d,e;for(e=Crafty("Player"),a=0,b=e.length;b>a;a++)if(d=e[a],c=Crafty(d),!c.has("ControlScheme"))return c}})}.call(this),function(){Crafty.c("PlayerControlledCube",{init:function(){return this.requires("2D, WebGL, Color, Listener, Collision, SunBlock, PlayerControlledShip, Acceleration, InventoryWeapons"),this.attr({w:40,h:40}),this.bind("Moved",function(a){var b;return this.hit("Edge")||this.hit("Solid")?(b={},b[a.axis]=a.oldValue,this.attr(b)):void 0}),this.primaryWeapon=void 0,this.primaryWeapons=[],this.secondaryWeapon=void 0,this.superUsed=0,this.weaponsEnabled=!0,this.currentRenderedSpeed=0},start:function(){return this.addComponent("Invincible").invincibleDuration(2e3),this.onHit("Enemy",function(a){var b,c,d,e;if(!Game.paused&&!this.has("Invincible")){for(c=!1,d=0,e=a.length;e>d;d++)b=a[d],b.obj.hidden||(c=!0);return c?this.trigger("Hit"):void 0}}),this.onHit("PowerUp",function(a){var b,c,d,e;if(!Game.paused){for(e=[],b=0,c=a.length;c>b;b++)d=a[b],this.pickUp(d.obj),e.push(this.trigger("PowerUp",d.obj));return e}}),this.bind("Hit",function(){return this.trigger("Destroyed",this)}),this.bind("GameLoop",function(a){var b,c;return b=this._currentSpeed.x/1e3*a.dt,c=this._currentSpeed.y/1e3*a.dt,this.updateAcceleration(),this.x+=b,this.y+=c,(this.hit("Edge")||this.hit("Solid"))&&(this.x-=b,this.y-=c),this.hit("Edge")||this.hit("Solid")?this.trigger("Hit"):void 0}),this},forcedSpeed:function(a,b){return this.targetSpeed(a,b)},shoot:function(a){return this.weaponsEnabled?(null!=this.primaryWeapon&&this.primaryWeapon.shoot(a),null!=this.secondaryWeapon?this.secondaryWeapon.shoot(a):void 0):void 0},switchWeapon:function(a){var b,c;if(a)return b=(this.currentPrimary+1)%this.primaryWeapons.length,null!=(c=this.primaryWeapon)&&c.uninstall(),this.primaryWeapon=this.primaryWeapons[b],this.primaryWeapon.install(this),this.currentPrimary=b},superWeapon:function(a){return a?this.superUsed+=1:void 0},pickUp:function(a){var b;return b=a.settings.contains,this.installItem(a.settings)?(this.trigger("PowerUp",a.settings),a.pickup()):void 0},clearItems:function(){var a,b,c,d,e;for(null!=(c=this.primaryWeapon)&&c.uninstall(),this.primaryWeapon=null,d=this.primaryWeapons,a=0,b=d.length;b>a;a++)e=d[a],e.destroy();return this.primaryWeapons=[],this.items=[]},_installPrimary:function(a){var b,c;return c=Crafty.e(a),c.install(this),null!=(b=this.primaryWeapon)&&b.uninstall(),this.primaryWeapon=c,this.listenTo(c,"levelUp",function(a){return function(b){return a.scoreText("L +"+b)}}(this)),this.primaryWeapons.push(c),this.currentPrimary=this.primaryWeapons.length-1},hasItem:function(a){return null==this.items&&(this.items=[]),~this.items.indexOf(a)},scoreText:function(a){return Crafty.e("Text, DOM, 2D, Tween").textColor("#FFFFFF").text(a).attr({x:this.x,y:this.y-10,z:990,w:100}).textFont({size:"10px",weight:"bold",family:"Press Start 2P"}).tween({y:this.y-40,alpha:.5},1e3).one("TweenEnd",function(){return this.destroy()})}})}.call(this),function(){Crafty.c("PlayerInfo",{init:function(){return this.requires("2D, Listener"),this.boosts={},this.visible=!0},playerInfo:function(a,b){return this.player=b,this.score=Crafty.e("2D, Text, UILayerDOM").attr({w:220,h:20,x:a,y:10,z:200}).textFont({size:"10px",family:"Press Start 2P"}),this.player.has("Color")&&this.score.textColor(this.player.color()),this.lives=Crafty.e("2D, Text, UILayerDOM").attr({w:220,h:20,x:a,y:30,z:200}).textFont({size:"10px",family:"Press Start 2P"}),this.heart=Crafty.e("2D, ColorEffects, heart, UILayerWebGL").attr({w:16,h:16,x:a-2,y:26,z:200}).colorOverride(b.color(),"partial"),this.player.has("Color")&&this.lives.textColor(b.color()),this.updatePlayerInfo(),this.createBoostsVisuals(a),this.listenTo(b,"UpdateLives",this.updatePlayerInfo),this.listenTo(b,"UpdatePoints",this.updatePlayerInfo),this.listenTo(b,"UpdateHealth",this.updatePlayerInfo),this.listenTo(b,"Activated",function(a){return function(){return a.updatePlayerInfo()}}(this)),this.listenTo(b,"Deactivated",function(a){return function(){return a.updatePlayerInfo()}}(this)),this.listenTo(b,"GameLoop",function(a){return function(){return a.updateBoostInfo()}}(this)),this},setVisibility:function(a){return this.visible=a},createBoostsVisuals:function(a){var b;return b=this.player.color(),this.boosts.speedb=Crafty.e("2D, UILayerWebGL, speedBoost, ColorEffects").attr({w:16,h:16}).attr({x:a,y:45,z:200}).colorOverride(b,"partial"),this.boosts.rapidb=Crafty.e("2D, UILayerWebGL, rapidFireBoost, ColorEffects").attr({w:16,h:16}).attr({x:a+20,y:44,z:200}).colorOverride(b,"partial"),this.boosts.aimb=Crafty.e("2D, UILayerWebGL, aimBoost, ColorEffects").attr({w:16,h:16}).attr({x:a+40,y:44,z:200}).colorOverride(b,"partial"),this.boosts.damageb=Crafty.e("2D, UILayerWebGL, damageBoost, ColorEffects").attr({w:16,h:16}).attr({x:a+50,y:44,z:200}).colorOverride(b,"partial")},updateBoostInfo:function(){var a,b,c,d,e,f,g,h,i;e=this.boosts;for(d in e)c=e[d],c.attr({alpha:0});if(this.player.has("ControlScheme")&&this.visibile!==!1&&null!=this.player.ship){h=this.player.ship.stats(),f=h.primary.boostTimings,g=[];for(b in f)i=f[b],a=1,2e3>i&&Math.floor(i/200)%2===0&&(a=0),g.push(this.boosts[b].attr({alpha:a}));return g}},updatePlayerInfo:function(){var a,b,c,d,e,f;if(this.player.has("ControlScheme")?this.score.text("Score: "+this.player.points):this.score.text(this.player.name),this.player.has("ControlScheme"))return 0===this.player.lives?(this.lives.text("Game Over"),this.heart.attr({alpha:0,visible:!1})):(this.visibile===!0&&this.heart.attr({alpha:1}),this.heart.attr({visible:!0}),f=this.player.lives-1,f===1/0&&(f="Demo mode"),b=Array(Math.max(0,this.player.health)).fill("▩").join(""),this.lives.text("&nbsp;  "+f+" "+b));this.lives.text("Press fire to start!"),this.heart.attr({alpha:0,visible:!1}),d=this.boosts,e=[];for(c in d)a=d[c],e.push(a.attr({alpha:0}));return e}})}.call(this),function(){Crafty.c("PlayerSpaceship",{init:function(){return this.requires("2D, WebGL, playerShip, ColorEffects, Listener, Collision, SunBlock, WaterSplashes, PlayerControlledShip, Acceleration, InventoryWeapons"),this.attr({w:71,h:45}),this.collision([21,13,56,13,66,32,35,32]),this.bind("Moved",function(a){var b;return this.hit("Edge")||this.hit("Solid")?(b={},b[a.axis]=a.oldValue,this.attr(b)):void 0}),this.primaryWeapon=void 0,this.primaryWeapons=[],this.secondaryWeapon=void 0,this.superUsed=0,this.weaponsEnabled=!0,this.currentRenderedSpeed=0,this.flip("X")},updateMovementVisuals:function(a,b,c,d){var e;return e=Math.max(b*(1e3/d),0),this._updateFlyingSpeed(e,d)},_updateFlyingSpeed:function(a,b){var c,d,e;return c=30>a?a/2:15+a/400*100,this.currentRenderedSpeed>c?this.currentRenderedSpeed-=12:this.currentRenderedSpeed<c&&(this.currentRenderedSpeed+=12),this.currentRenderedSpeed<0&&(this.currentRenderedSpeed=0),e=10+this.currentRenderedSpeed,d=Math.min(e/3,15),this.backFire.attr({x:this.x-e+9,y:this.y+20-Math.floor(d/2),w:e,h:d})},start:function(){var a,b,c,d,e,f,g,h,i;for(this.backFire=Crafty.e("2D, WebGL, shipEngineFire, ColorEffects").crop(28,0,68,29),this.backFire.timing=0,i=68,d=10,this.backFire.attr({x:this.x-i,y:this.y+20-Math.floor(d/2),w:i,h:d,alpha:.8,z:this.z-1}),this.attach(this.backFire),b={},a={_red:255,_green:255,_blue:255},Crafty.assignColor(this.playerColor,b),h=["_red","_green","_blue"],e=0,f=h.length;f>e;e++)c=h[e],g=(b[c]+a[c]+a[c])/3,b[c]=g;return this.backFire.colorOverride(b),this.addComponent("Invincible").invincibleDuration(2e3),this.setDetectionOffset(40,0),this.onHit("Hostile",function(a){var b,c,d,e,f;if(!Game.paused&&!this.has("Invincible")){for(d=!1,b=0,e=0,f=a.length;f>e;e++)c=a[e],c.obj.damage&&c.obj.damage>b&&!c.obj.damageHandled&&(b=c.obj.damage,c.obj.damageHandled=!0),c.obj.hidden||(d=!0);return d?this.trigger("Hit",{damage:b}):void 0}}),this.onHit("PowerUp",function(a){var b,c,d,e;if(!Game.paused){for(e=[],b=0,c=a.length;c>b;b++)d=a[b],d.obj.pickedUp?e.push(void 0):e.push(this.pickUp(d.obj));return e}}),this.bind("Hit",function(){return this.addComponent("Invincible").invincibleDuration(1e3),Crafty.e("Blast, Explosion").explode({x:this.x+this.w/2,y:this.y+this.h/2,radius:this.w/3}),Crafty.audio.play("explosion"),Crafty("ScrollWall").get(0).screenShake(10,500)}),this.bind("Die",function(){return Crafty.e("Blast, Explosion").explode({x:this.x+this.w/2,y:this.y+this.h/2,radius:this.w}),Crafty.audio.play("explosion"),Crafty("ScrollWall").get(0).screenShake(20,2e3),this.trigger("Destroyed",this)}),this.bind("GameLoop",function(a){var b,c,d,e,f,g,h,i;return this.has("AnimationMode")?void(0===(null!=(g=this._choreography)?g.length:void 0)&&this._updateFlyingSpeed(this._currentSpeed.x,a.dt)):(b=this._currentSpeed.x/1e3*a.dt,c=this._currentSpeed.y/1e3*a.dt,h=this._currentSpeed.x+this.vx,i=this._currentSpeed.y+this.vy,this.updateAcceleration(),f=this.rotation,d=i/40,e=f,d>f?e+=1:f>d&&(e-=1),this.rotation=e,(this.hit("Edge")||this.hit("Solid"))&&(e=f),this.rotation=0,this._updateFlyingSpeed(h,a.dt),this.rotation=e,this.x+=b,this.y+=c,(this.hit("Edge")||this.hit("Solid"))&&(this.x-=b,this.y-=c),this.hit("Edge")||this.hit("Solid")?this.trigger("Hit",{damage:1e3}):void 0)}),this},forcedSpeed:function(a,b){return null==b&&(b={}),this.targetSpeed(a,b)},shoot:function(a){return this.weaponsEnabled?(null!=this.primaryWeapon&&this.primaryWeapon.shoot(a),null!=this.secondaryWeapon?this.secondaryWeapon.shoot(a):void 0):void 0},switchWeapon:function(a){var b,c;if(a)return b=(this.currentPrimary+1)%this.primaryWeapons.length,null!=(c=this.primaryWeapon)&&c.uninstall(),this.primaryWeapon=this.primaryWeapons[b],this.primaryWeapon.install(this),this.currentPrimary=b},superWeapon:function(a){return a?this.superUsed+=1:void 0},pickUp:function(a){var b;return b=a.settings.contains,this.installItem(a.settings)?(Crafty.audio.play("powerup"),this.trigger("PowerUp",a.settings),a.pickup()):void 0},clearItems:function(){var a,b,c,d,e;for(null!=(c=this.primaryWeapon)&&c.uninstall(),d=this.primaryWeapons,a=0,b=d.length;b>a;a++)e=d[a],e.destroy();return this.primaryWeapons=[],this.items=[]},_installPrimary:function(a){var b,c;return c=Crafty.e(a),c.install(this),null!=(b=this.primaryWeapon)&&b.uninstall(),this.primaryWeapon=c,this.listenTo(c,"levelUp",function(a){return function(b){var c;return c={damage:"Damage",rapid:"RapidFire",aim:"AimAssist",speed:"BulletSpeed"},a.scoreText(c[b.aspect]+" +"+b.level)}}(this)),this.listenTo(c,"boost",function(a){return function(b){var c;return c={damageb:"Damage",rapidb:"RapidFire",aimb:"AimAssist",speedb:"BulletSpeed"},a.scoreText(c[b.aspect]+" Boost!")}}(this)),this.listenTo(c,"boostExpired",function(a){return function(b){var c;return c={damageb:"Damage",rapidb:"RapidFire",aimb:"AimAssist",speedb:"BulletSpeed"},a.scoreText(c[b.aspect]+" Boost expired",{positive:!1})}}(this)),this.primaryWeapons.push(c),this.currentPrimary=this.primaryWeapons.length-1},hasItem:function(a){var b,c,d,e;for(null==this.items&&(this.items=[]),e=this.items,c=0,d=e.length;d>c;c++)if(b=e[c],b.contains===a)return!0;return!1},scoreText:function(a,b){var c,d;return null==b&&(b={}),b=_.defaults(b,{positive:!0,location:{x:this.x,y:this.y},attach:!0,duration:1e3,distance:70,delay:400}),c="function"==typeof b.location?b.location():void 0,c&&(c={x:c.x-Crafty.viewport.x,y:c.y-Crafty.viewport.y}),null==c&&(c=b.location),d=Crafty.e("Text, DOM, 2D, Tween, Delay").textColor(b.positive?"#DDD":"#F00").text(a).attr({x:c.x,y:c.y-10,z:990,w:250,alpha:.75}).textFont({size:"10px",weight:"bold",family:"Press Start 2P"}),b.attach?this.attach(d):d.addComponent("ViewportFixed"),d.delay(function(a){return function(){return b.attach&&a.detach(d),d.tween({rotation:0,y:d.y-b.distance,alpha:.5},b.duration,"easeInQuad"),d.one("TweenEnd",function(){return d.destroy()})}}(this),b.delay)}})}.call(this),function(){Crafty.c("ColorEffects",{colorDesaturation:function(a){var b;return null==a?this:(b={},Crafty.assignColor(a,b),this.attr({desaturationColor:b}),this.trigger("Invalidate"),this)},colorOverride:function(a,b){var c;return null==b&&(b="all"),null==a?this:(c={},_.isObject(a)?c=a:Crafty.assignColor(a,c),this.attr({overrideColor:c,overrideColorMode:b}),this.trigger("Invalidate"),this)},clearColorOverride:function(){return this.attr({overrideColor:null,overrideColorMode:"all"}),this.trigger("Invalidate"),this},saturationGradient:function(a,b){return this.attr({topDesaturation:a,bottomDesaturation:b}),this}})}.call(this),function(){var a,b,c;c="attribute vec2 aPosition;\nattribute vec3 aOrientation;\nattribute vec2 aLayer;\nattribute vec4 aColor;\nattribute vec4 aDesaturation;\nattribute vec2 aGradient;\n\nvarying lowp vec4 vColor;\nvarying lowp vec4 vDesaturation;\nvarying lowp vec2 vGradient;\nvarying lowp vec2 vLayer;\nuniform  vec4 uViewport;\n\nmat4 viewportScale = mat4(2.0 / uViewport.z, 0, 0, 0,    0, -2.0 / uViewport.w, 0,0,    0, 0,1,0,    -1,+1,0,1);\nvec4 viewportTranslation = vec4(uViewport.xy, 0, 0);\n\nvoid main() {\n  vec2 pos = aPosition;\n  vec2 entityOrigin = aOrientation.xy;\n  mat2 entityRotationMatrix = mat2(cos(aOrientation.z), sin(aOrientation.z), -sin(aOrientation.z), cos(aOrientation.z));\n\n  pos = entityRotationMatrix * (pos - entityOrigin) + entityOrigin;\n  gl_Position = viewportScale * (viewportTranslation + vec4(pos, 1.0/(1.0+exp(aLayer.x) ), 1) );\n\n  vColor = aColor;\n  vDesaturation = aDesaturation;\n  vGradient = aGradient;\n  vLayer = aLayer;\n}",b="precision mediump float;\nvarying lowp vec4 vColor;\nvarying lowp vec2 vGradient;\nvarying lowp vec4 vDesaturation;\nvarying lowp vec2 vLayer;\nvoid main(void) {\n\n  //gl_FragColor = vec4(vColor.rgb*vColor.a*vLayer.y, vColor.a*vLayer.y);\n\n  mediump float mixFactor = vGradient.x;\n\n  mediump float lightness = (0.2126*vColor.r + 0.7152*vColor.g + 0.0722*vColor.b);\n  mediump float lightnessBase = (0.2126*vDesaturation.r + 0.7152*vDesaturation.g + 0.0722*vDesaturation.b);\n  mediump vec4 baseColor = vec4(vDesaturation.rgb, vColor.a) * (1.0 + (lightness - lightnessBase));\n  mediump vec4 mixColor = vec4(\n    (baseColor.rgba * mixFactor) + (vColor.rgba * (1.0 - mixFactor))\n  );\n\n  gl_FragColor = vec4(\n    mixColor.rgb * vColor.a * vLayer.y,\n    vColor.a * vLayer.y\n  );\n}",a=[{name:"aPosition",width:2},{name:"aOrientation",width:3},{name:"aLayer",width:2},{name:"aColor",width:4},{name:"aDesaturation",width:4},{name:"aGradient",width:2}],Crafty.defaultShader("Color",new Crafty.WebGLShader(c,b,a,function(a,b){var c,d,e,f,g,h,i,j;return d=null!=(e=b.desaturationColor)?e:{_red:0,_green:0,_blue:0},a.program.writeVector("aColor",b._red/255,b._green/255,b._blue/255,b._strength),a.program.writeVector("aDesaturation",d._red/255,d._green/255,d._blue/255,1),i=null!=(f=b.scale)?f:1,j=null!=(g=b.topDesaturation)?g:0,c=null!=(h=b.bottomDesaturation)?h:0,a.program.writeVector("aGradient",j+1.15*(1-i),c+1.15*(1-i))}))}.call(this),function(){var a,b,c,d=[].slice;c="attribute vec2 aPosition;\nattribute vec3 aOrientation;\nattribute vec2 aLayer;\nattribute vec4 aColor;\n\nvarying lowp vec4 vColor;\nvarying lowp vec2 vLayer;\nuniform  vec4 uViewport;\n\nmat4 viewportScale = mat4(2.0 / uViewport.z, 0, 0, 0,    0, -2.0 / uViewport.w, 0,0,    0, 0,1,0,    -1,+1,0,1);\nvec4 viewportTranslation = vec4(uViewport.xy, 0, 0);\n\nvoid main() {\n  vec2 pos = aPosition;\n  vec2 entityOrigin = aOrientation.xy;\n  mat2 entityRotationMatrix = mat2(cos(aOrientation.z), sin(aOrientation.z), -sin(aOrientation.z), cos(aOrientation.z));\n\n  pos = entityRotationMatrix * (pos - entityOrigin) + entityOrigin;\n  gl_Position = viewportScale * (viewportTranslation + vec4(pos, 1.0/(1.0+exp(aLayer.x) ), 1) );\n\n  vColor = aColor;\n  vLayer = aLayer;\n}",b="precision mediump float;\nvarying lowp vec4 vColor;\nvarying lowp vec2 vLayer;\nvoid main(void) {\n  gl_FragColor = vec4(vColor.rgb*vColor.a*vLayer.y, vColor.a*vLayer.y);\n}",a=[{name:"aPosition",width:2},{name:"aOrientation",width:3},{name:"aLayer",width:2},{name:"aColor",width:4}],Crafty.extend({defaultGradientShader:function(d){return 0===arguments.length?(void 0===this._defaultGradientShader&&(this._defaultGradientShader=new Crafty.WebGLShader(c,b,a,function(a){})),this._defaultGradientShader):this._defaultGradientShader=d}}),Crafty.c("Gradient",{init:function(){return this._topColor={_red:0,_green:0,_blue:0,_strength:1},this._bottomColor={_red:0,_green:0,_blue:0,_strength:1},this.ready=!0,this.bind("Draw",this._drawGradient),this.has("WebGL")&&this._establishShader("Gradient",Crafty.defaultGradientShader()),this.trigger("Invalidate")},remove:function(){return this.unbind("Draw",this._drawGradient),this.has("DOM")&&(this._element.style.backgroundColor="transparent"),this.trigger("Invalidate")},_drawGradient:function(a){return"webgl"===a.type?a.program.writeVector("aColor",this._topColor._red/255,this._topColor._green/255,this._topColor._blue/255,this._topColor._strength,this._bottomColor._red/255,this._bottomColor._green/255,this._bottomColor._blue/255,this._bottomColor._strength):void 0},topColor:function(a){return 0===arguments.length?this._topColor:this._setColor.apply(this,[this._topColor].concat(d.call(arguments)));
},bottomColor:function(a){return 0===arguments.length?this._bottomColor:this._setColor.apply(this,[this._bottomColor].concat(d.call(arguments)))},_setColor:function(a,b){return arguments.length>=4?(a._red=arguments[1],a._green=arguments[2],a._blue=arguments[3],"number"==typeof arguments[4]&&(a._strength=arguments[4])):(Crafty.assignColor(b,a),"number"==typeof arguments[2]&&(a._strength=arguments[2])),this.trigger("Invalidate"),this}})}.call(this),function(){var a,b,c;c="attribute vec2 aPosition;\nattribute vec4 aSpriteDimensions;\nattribute vec3 aOrientation;\nattribute vec2 aLayer;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute vec4 aOverrideColor;\nattribute vec4 aGradient;\n\nvarying mediump vec3 vTextureCoord;\nvarying lowp vec4 vColor;\nvarying lowp vec4 vOverrideColor;\nvarying lowp vec4 vGradient;\nvarying lowp vec4 vSpriteDimensions;\n\nuniform vec4 uViewport;\nuniform mediump vec2 uTextureDimensions;\n\nmat4 viewportScale = mat4(2.0 / uViewport.z, 0, 0, 0,    0, -2.0 / uViewport.w, 0,0,    0, 0,1,0,    -1,+1,0,1);\nvec4 viewportTranslation = vec4(uViewport.xy, 0, 0);\n\nvoid main() {\n  vec2 pos = aPosition;\n  vec2 entityOrigin = aOrientation.xy;\n  mat2 entityRotationMatrix = mat2(cos(aOrientation.z), sin(aOrientation.z), -sin(aOrientation.z), cos(aOrientation.z));\n\n  pos = entityRotationMatrix * (pos - entityOrigin) + entityOrigin ;\n  gl_Position = viewportScale * (viewportTranslation + vec4(pos, 1.0/(1.0+exp(aLayer.x) ), 1) );\n  vTextureCoord = vec3(aTextureCoord, aLayer.y);\n  vColor = aColor;\n  vOverrideColor = aOverrideColor;\n  vGradient = aGradient;\n  vSpriteDimensions = aSpriteDimensions;\n}",b="precision mediump float;\nvarying mediump vec3 vTextureCoord;\nvarying mediump vec4 vColor;\nvarying mediump vec4 vOverrideColor;\nvarying mediump vec4 vGradient;\nvarying mediump vec4 vSpriteDimensions;\n\nuniform sampler2D uSampler;\nuniform mediump vec2 uTextureDimensions;\n\nfloat random(vec3 scale, float seed) {\n  // use the fragment position for a different seed per-pixel\n  return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n}\n\nvec3 rgb2hsv(vec3 c) {\n  vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n  vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\n  vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n  //vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n  //vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\n  float d = q.x - min(q.w, q.y);\n  float e = 1.0e-10;\n  return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\n\nvec3 hsv2rgb(vec3 c) {\n  vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n  vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\nvoid main() {\n  highp vec2 coord =   vTextureCoord.xy / uTextureDimensions;\n  float blur = vGradient.z;\n\n  if ((vGradient.a >= 0.0) && (vTextureCoord.y >= vGradient.a)) {\n    gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n    return;\n  }\n\n  mediump vec4 texelColor = texture2D(uSampler, coord);\n\n  if (blur > 0.0) {\n    vec4 color = vec4(0.0);\n    float total = 0.0;\n\n    // randomize the lookup values to hide the fixed number of samples\n    float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n\n    for (float t = -30.0; t <= 30.0; t++) {\n      float percent = (t + offset - 0.5) / 30.0;\n      float weight = 1.0 - abs(percent);\n      vec4 sample = texture2D(uSampler, coord + (blur * percent) / uTextureDimensions);\n      // switch to pre-multiplied alpha to correctly blur transparent images\n      sample.rgb *= sample.a;\n\n      color += sample * weight;\n      total += weight;\n    }\n\n    texelColor = color / total;\n    texelColor.rgb /= texelColor.a + 0.00001;\n  }\n\n  mediump float yCoord = (vTextureCoord.y - vSpriteDimensions.y) / vSpriteDimensions.a;\n  mediump float mixFactor = (vGradient.x * (1.0 - yCoord)) + (vGradient.y * yCoord);\n\n  mediump float lightness = (0.2126*texelColor.r + 0.7152*texelColor.g + 0.0722*texelColor.b);\n  if (vOverrideColor.a == 1.0) {\n    texelColor = vec4(vOverrideColor.rgb * (lightness * 1.3), texelColor.a);\n  }\n  if (vOverrideColor.a == 2.0) {\n    vec3 texelHSV = rgb2hsv(texelColor.rgb);\n    if ((texelHSV.x < .84) && (texelHSV.x > .82)) {\n      vec3 overrideHSV = rgb2hsv(vOverrideColor.rgb);\n      texelHSV.x = overrideHSV.x;\n      texelHSV.y *= overrideHSV.y;\n      texelHSV.z *= overrideHSV.z;\n      vec3 texelRGB = hsv2rgb(texelHSV);\n      texelColor = vec4(texelRGB.rgb, texelColor.a);\n    }\n  }\n\n  mediump float lightnessBase = (0.2126*vColor.r + 0.7152*vColor.g + 0.0722*vColor.b);\n  mediump vec4 baseColor = vec4(vColor.rgb, texelColor.a) * (1.0 + (lightness - lightnessBase));\n  mediump vec4 mixColor = vec4(\n    (baseColor.rgba * mixFactor) + (texelColor.rgba * (1.0 - mixFactor))\n  );\n\n  if (vColor.a > 1.0) {\n    mixColor.rgb = vColor.rgb;\n  }\n\n  gl_FragColor = vec4(\n    mixColor.rgb * vColor.a * texelColor.a * vTextureCoord.z,\n    texelColor.a * vTextureCoord.z\n  );\n}",a=[{name:"aPosition",width:2},{name:"aOrientation",width:3},{name:"aLayer",width:2},{name:"aTextureCoord",width:2},{name:"aColor",width:4},{name:"aOverrideColor",width:4},{name:"aGradient",width:4},{name:"aSpriteDimensions",width:4}],Crafty.defaultShader("Sprite",new Crafty.WebGLShader(c,b,a,function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;return f=a.co,a.program.writeVector("aTextureCoord",f.x,f.y,f.x,f.y+f.h,f.x+f.w,f.y,f.x+f.w,f.y+f.h),a.program.writeVector("aSpriteDimensions",f.x,f.y,f.w,f.h),g=null!=(l=b.desaturationColor)?l:{_red:0,_green:0,_blue:0},j=null!=(m=b.overrideColor)?m:{_red:0,_green:0,_blue:0},i=null!=(n=b.lightness)?n:1,s=b.hidden&&null!=(o=b.scale)?o:1,d=null!=(p=b.blur)?p:0,t=null!=(q=b.topDesaturation)?q:0,c=null!=(r=b.bottomDesaturation)?r:0,u=t+1.15*(1-s),e=c+1.15*(1-s),b.hitFlash&&(g=b.hitFlash,u=3,e=3),window.Game.webGLMode===!1&&(u=0,e=0,b.has("cloud")&&(i=1)),a.program.writeVector("aColor",g._red/255,g._green/255,g._blue/255,i),k=0,null!=b.overrideColor&&(k=1),"partial"===b.overrideColorMode&&(k=2),a.program.writeVector("aOverrideColor",j._red/255,j._green/255,j._blue/255,k),h=b.hideAt?Math.max(0,f.y+(b.hideAt-b.y)/b.h*f.h):-1,a.program.writeVector("aGradient",u,e,d,h)}))}.call(this),function(){Crafty.c("WaterSplashes",{init:function(){return this.bind("GameLoop",this._waterSplashes),this.cooldown=0,null==this.defaultWaterCooldown&&(this.defaultWaterCooldown=70),null==this.waterRadius&&(this.waterRadius=5),null==this.minSplashDuration&&(this.minSplashDuration=210),this.detectionOffset=0,this.minOffset=-10,null==this.waterAlpha&&(this.waterAlpha=.6),this.splashUpwards=!1},remove:function(){return this.unbind("GameLoop",this._waterSplashes)},setSealevel:function(a){return this.sealevel=a,this},setDetectionOffset:function(a,b){return this.detectionOffset=a,this.minOffset=null!=b?b:-10,this},_waterSplashes:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;if(null==window.Game.explosionMode){if(this.cooldown-=a.dt,this.y+this.h+this.detectionOffset>this.sealevel&&this.y<this.sealevel&&this.cooldown<=0)for(o=null!=(j=this.waterSplashSpeed)?j:this.defaultSpeed,this.cooldown=this.defaultWaterCooldown,p=1,this._lastWaterY!==this.y&&this.splashUpwards&&(p=(o-20)/30),p*=null!=(k=this.scale)?k:1,b=45,g=this.w/b,i=0,d=e=0,l=g;l>=0?l>e:e>l;d=l>=0?++e:--e)for(c=f=0,m=Math.min(p,3);m>=0?m>f:f>m;c=m>=0?++f:--f)i+=1,h=Math.random(),n=this.sealevel,Crafty.e("Blast").colorOverride("#FFFFFF").explode({upwards:i%2===0?p:0,x:this.x+d*b+h*b,y:this.sealevel+this.minOffset,z:this.z+3,duration:this.minSplashDuration+100*Math.random(),radius:this.waterRadius,topDesaturation:this.topDesaturation,bottomDesaturation:this.bottomDesaturation,alpha:this.waterAlpha,gravity:.2},function(){return{gravity:this.gravity+.3,alpha:Math.max(.1,this.alpha-.03*Math.random()),y:Math.min(this.y-Math.random()*this.upwards+this.gravity,n-10),x:this.x+(-.5+h)*Math.random()*4,w:this.w+.3,h:this.h+.3}});return this._lastWaterY=this.y}}})}.call(this),function(){Crafty.c("Flipable",{flipX:function(){var a,b,c,d,e,f;if(!this.xFlipped){this.xFlipped=!0;try{for("function"==typeof this.flip&&this.flip("X"),e=this._children,c=0,d=e.length;d>c;c++)a=e[c],f=a.x-this.x,"function"==typeof a.attr&&a.attr({x:this.x+this.w-a.w-f}),"function"==typeof a.flip&&a.flip("X")}catch(g){b=g,console.log(b)}return this._mirrorCollision(),this._mirrorRotationPoints(),this._mirrorWeaponOrigin(),this}},unflipX:function(){var a,b,c,d,e,f;if(this.xFlipped){this.xFlipped=!1;try{for("function"==typeof this.unflip&&this.unflip("X"),e=this._children,c=0,d=e.length;d>c;c++)a=e[c],f=this.x+this.w-(a.x+a.w),"function"==typeof a.attr&&a.attr({x:this.x+f}),"function"==typeof a.unflip&&a.unflip("X")}catch(g){b=g,console.log(b)}return this._mirrorCollision(),this._mirrorRotationPoints(),this._mirrorWeaponOrigin(),this}},_mirrorCollision:function(){var a,b,c,d,e,f,g;if(this.map.points){for(f=this.map.points,g=[],b=c=0,d=f.length;d>c;b=++c)e=f[b],b%2===0?(a=e-this.x,g.push(this.map.points[b]=this.x+(this.w-a))):g.push(void 0);return g}},_mirrorRotationPoints:function(){var a,b,c,d,e;for(this._origin.x=this.w-this._origin.x,d=this._children,e=[],b=0,c=d.length;c>b;b++)a=d[b],null!=a.origin&&(a._origin.x=a.w-a._origin.x),e.push(a.rotation=(360+(360-a.rotation))%360);return e},_mirrorWeaponOrigin:function(){return null!=this.weaponOrigin?this.weaponOrigin=[this.w-this.weaponOrigin[0],this.weaponOrigin[1]]:void 0}})}.call(this),function(){Crafty.c("Hideable",{init:function(){return this.requires("ColorEffects"),this.hidden=!1},sendToBackground:function(a,b){var c,d,e,f,g;for(this._originalZ=this.z,this.attr({scale:a,z:b}),f=this._children,d=0,e=f.length;e>d;d++)c=f[d],null!=c.attr&&(g=c.z-this._originalZ,c.attr({z:b+g}));return this.hidden||this.trigger("Hiding",this),this.hidden=!0},hide:function(a,b){var c,d,e,f,g,h,i;if(this.hideMarker=a,this.hidden=!0,b.below&&this.has("Sprite")&&0===this.rotation)for(this.hideAt=b.below,h=this._children,d=0,f=h.length;f>d;d++)c=h[d],"function"==typeof c.attr&&c.attr({hideAt:b.below});else for(this.attr({alpha:0}),i=this._children,e=0,g=i.length;g>e;e++)c=i[e],"function"==typeof c.attr&&c.attr({alpha:0});return this.trigger("Hiding",this),this},reveal:function(){var a,b,c,d,e,f,g,h,i,j,k,l;for(null!=(g=this.hideMarker)&&g.destroy(),this.hidden=!1,b=null!=(h=this.scale)?h:1,k=1,i=this._children,c=0,e=i.length;e>c;c++)a=i[c],null!=a.attr&&(l=a.z-this.z,a.attr({z:this._originalZ+l}));for(this.attr({scale:k,alpha:1,z:this._originalZ,hideAt:null}),j=this._children,d=0,f=j.length;f>d;d++)a=j[d],"function"==typeof a.attr&&a.attr({alpha:1,hideAt:null});return this.trigger("Revealing",this)},remove:function(){var a;return null!=(a=this.hideMarker)?a.destroy():void 0}})}.call(this),function(){Crafty.c("Scalable",{_scale:1,_Scalable_property_definitions:{scale:{set:function(a){return this._updateScale(a)},get:function(){return this._scale},configurable:!0,enumerable:!0},_scale:{enumerable:!1}},init:function(){return this._defineScalableProperties(),this._scale=1},remove:function(){},_defineScalableProperties:function(){var a,b,c,d;c=this._Scalable_property_definitions,d=[];for(b in c)a=c[b],d.push(Object.defineProperty(this,b,a));return d},_updateScale:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;for(i=this._scale,this._scale=a,j=this.w,h=this.h,this.w=this.w/i*a,this.h=this.h/i*a,m=this._children,d=0,f=m.length;f>d;d++)b=m[d],p=b.x-this.x,q=b.y-this.y,"function"==typeof b.attr&&b.attr({x:this.x+p/i*a,y:this.y+q/i*a,w:(b.w+j-this.w)/i*a,h:(b.h+h-this.h)/i*a});if(null!=(null!=(n=this.map)?n.points:void 0)){for(o=this.map.points,r=[],c=e=0,g=o.length;g>e;c=++e)l=o[c],k=c%2===0?this.x:this.y,r.push(this.map.points[c]=k+(l-k)/i*a);return r}}})}.call(this),function(){Crafty.c("Bullet",{init:function(){return this.requires("2D, WebGL, sphere1, Collision, ColorEffects"),this.crop(6,21,18,7)},fire:function(a){var b,c,d,e,f,g,h;for(c={},b={_red:255,_green:255,_blue:255},Crafty.assignColor(a.ship.playerColor,c),h=["_red","_green","_blue"],e=0,f=h.length;f>e;e++)d=h[e],g=(c[d]+b[d]+b[d])/3,c[d]=g;return this.colorOverride(c),this.attr({damage:a.damage,speed:a.speed,rotation:a.direction,ship:a.ship}).bind("GameLoop",function(b){return function(c){var d;return d=c.dt*(b.speed/1e3),b.x+=Math.cos(a.direction/180*Math.PI)*d,b.y+=Math.sin(a.direction/180*Math.PI)*d,b.x>b._maxXforViewPort()&&b.destroy(),b._minXforViewPort()>b.x&&b.destroy(),b._minYforViewPort()>b.y&&b.destroy(),b.y>b._maxYforViewPort()?b.destroy():void 0}}(this)).onHit("Solid",function(){return Game.paused?void 0:this.destroy()}),this},_maxXforViewPort:function(){var a;return a=-Crafty.viewport._x+Crafty.viewport._width/Crafty.viewport._scale,a+10},_minXforViewPort:function(){var a;return a=-Crafty.viewport._x,a-10},_maxYforViewPort:function(){var a;return a=-Crafty.viewport._y+Crafty.viewport._height/Crafty.viewport._scale,a+10},_minYforViewPort:function(){var a;return a=-Crafty.viewport._y,a-10}})}.call(this),function(){var a=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};Crafty.c("Cheats",{init:function(){return this.addCheat("Freddie",["Up","Up","Down","Down","Left","Right","Left","Right","Fire"],function(a){return function(){var b,c;return b=!1,c=a.ship,Crafty("Freddy").each(function(){return this.ship===c?b=!0:void 0}),b?void 0:Crafty.e("Freddy").freddy({protect:a.ship})}}(this)),this._listenInput()},remove:function(){var a,b,c,d,e;for(b=["Up","Down","Left","Right","Fire"],e=[],c=0,d=b.length;d>c;c++)a=b[c],e.push(this.unbind(a));return e},addCheat:function(a,b,c){return null==this.cheats&&(this.cheats=[]),this.cheats.push({name:a,sequence:b,method:c,index:0})},_listenInput:function(){var a,b,c,d,e;for(b=["Up","Down","Left","Right","Fire"],e=[],c=0,d=b.length;d>c;c++)a=b[c],e.push(function(a){return function(b){return a.bind(b,function(){var c,d,e,f,g;for(f=a.cheats,g=[],d=0,e=f.length;e>d;d++)c=f[d],c.sequence[c.index]===b?(c.index+=1,c.index===c.sequence.length?g.push(c.method()):g.push(void 0)):g.push(c.index=0);return g})}}(this)(a));return e}}),Crafty.c("Freddy",{init:function(){return this.requires("2D, WebGL, freddie, Scalable, ColorEffects, Collision")},remove:function(){return this.unbind("GameLoop",this._move)},freddy:function(b){var c,d,e,f;return this.ship=b.protect,this.ship.scoreText("Help me Freddie!"),"function"==typeof this.colorOverride&&this.colorOverride(this.ship.playerColor,"partial"),this.attr({scale:.5,z:this.ship.z+5}),e=Math.floor(this.w/2),f=Math.floor(this.h/2),d=15,c=15,this.collision([-c,-d,e,-(2*d),this.w+c,-d,this.w+2*c,f,this.w+c,this.h+d,e,this.h+2*d,-c,this.h+d,-(2*c),f]),this.ship.addComponent("Invincible").invincibleDuration(-1),this.attr({x:-Crafty.viewport.x-100,y:-Crafty.viewport.y+.5*Crafty.viewport.height}),this.circlePos=180,this.eaten=0,this.hFlash=0,this.shooting=0,this.ship.bind("Remove",function(a){return function(){return a.destroy()}}(this)),this.bind("GameLoop",this._move),this.onHit("Hostile",function(b){return function(c){var d,e,f,g,h,i,j,k,l;if(!Game.paused){for(g=function(){var a,b,e;for(e=[],a=0,b=c.length;b>a;a++)d=c[a],e.push(d.obj[0]);return e}(),null==b.previousCols&&(b.previousCols=[]),j=function(){var b,c,d;for(d=[],b=0,c=g.length;c>b;b++)f=g[b],a.call(this.previousCols,f)<0&&d.push(f);return d}.call(b),b.previousCols=g,l=[],h=0,i=c.length;i>h;h++)d=c[h],k=d.obj[0],a.call(j,k)>=0&&(e=d.obj,e.hidden||e.invincible||(b.attr({hitFlash:{_red:255,_green:255,_blue:0}}),b.hFlash=5,null!=e.absorbDamage&&e.absorbDamage(500),e.has("Projectile")&&e.destroy(),b.eaten+=1,l.push(b.scale=Math.min(.5+.01*b.eaten,1))));return l}}}(this),function(a){return function(){return a.previousCols=[]}}(this))},_move:function(a){var b,c,d,e,f,g,h,i,j,k,l;if(c=8e3,j=this.ship._targetSpeed.x+300,h=80,i=55,c-=Math.min(800*Crafty("Enemy").length,c-1e3),g=360/c*a.dt,this.circlePos=(this.circlePos+g+360)%360,f=.0174532925*this.circlePos,k=this.ship.x+10+Math.floor(this.ship.w/2)-Math.floor(this.w/2)+h*Math.cos(f),l=this.ship.y+Math.floor(this.ship.h/2)-Math.floor(this.h/2)+i*Math.sin(f),d=j*(a.dt/1e3),this.hFlash>0&&(this.hFlash-=1,0===this.hFlash&&this.attr({hitFlash:!1})),this.eaten>50&&Crafty("Enemy").length>0){if(this.shooting+=1,this.shooting%5===0)for(b=e=0;360>e;b=e+=30)Crafty.e("Bullet").attr({w:8,h:8,x:this.x+Math.floor(this.w/2),y:this.y+Math.floor(this.h/2),z:1,rotation:b}).fire({origin:this,speed:this.ship._currentSpeed.x+400,damage:400,direction:b});this.shooting>200&&(this.eaten=0,this.scale=.5,this.shooting=0)}return this.x>k?this.x-=Math.min(d,this.x-k):this.x+=Math.min(d,k-this.x),this.y>l?this.y-=Math.min(d,this.y-l):this.y+=Math.min(d,l-this.y)}})}.call(this),function(){Crafty.c("OldWeaponLaser",{init:function(){return this.requires("2D,WebGL,Color"),this.color("#808080"),this.attr({w:30,h:5})},remove:function(){},install:function(a){return this.ship=a,this.xp=0,this.level=this.determineLevel(this.xp),this.attr({x:this.ship.x+10,y:this.ship.y+15,z:this.ship.z+1,alpha:0}),this.ship.attach(this)},uninstall:function(){return this.attr({alpha:0})},addXP:function(a){var b;return this.xp+=a,b=this.level,this.level=this.determineLevel(this.xp),b!==this.level?this.trigger("levelUp",this.level):void 0},determineLevel:function(a){var b,c,d,e,f,g,h,i;for(f=[1e3,3e3,12e3,96e3],g=0,e=0,c=0,d=f.length;d>c;c++)b=f[c],g+=b,a>=g&&(e+=1);return h=(a-(null!=(i=f[e-1])?i:0))/f[e],e},shoot:function(a){var b;if(a)return b=function(){switch(this.level){case 0:return{w:4,speed:270,h:4};case 1:return{w:8,speed:320,h:6};case 2:return{w:8,speed:320,h:6};case 3:return{w:8,speed:320,h:6};case 4:return{w:10,speed:320,h:6}}}.call(this),Crafty.e("Bullet").attr({x:this.x+this.w,y:this.y+this.h/2-b.h/2,w:b.w,h:b.h}).fire({origin:this,damage:100,speed:this.ship._currentSpeed.x+b.speed,direction:0}).bind("HitTarget",function(a){return function(b){return a.addXP(1),a.ship.trigger("BulletHit",b)}}(this)).bind("DestroyTarget",function(a){return function(b){return a.addXP(5),a.ship.trigger("BulletDestroyedTarget",b)}}(this))},_determineWeaponSettings:function(){}})}.call(this),function(){Crafty.c("RapidDiagonalLaser",{init:function(){return this.requires("2D,WebGL,Color"),this.color("#d08080"),this.attr({w:30,h:5}),this.xp=0,this.lastShot=0,this.shotsFired=0,this.burstCount=1/0,this.frontFire=!0},remove:function(){return this.unbind("GameLoop",this._autoFire)},install:function(a){return this.ship=a,this.level=this.determineLevel(this.xp),this.attr({x:this.ship.x+20,y:this.ship.y+30,z:this.ship.z+1,alpha:0}),this.ship.attach(this),this.shooting=!1,this._determineCooldown(),this.bind("GameLoop",this._autoFire)},uninstall:function(){return this.attr({alpha:0}),this.unbind("GameLoop",this._autoFire)},addXP:function(a){var b;return this.xp+=a,b=this.level,this.level=this.determineLevel(this.xp),b!==this.level?(this._determineCooldown(),this.trigger("levelUp",this.level)):void 0},_determineCooldown:function(){return this.cooldown=function(){switch(this.level){case 0:return 200;case 1:return 150;case 2:return 75;case 3:return 75}}.call(this)},determineLevel:function(a){var b,c,d,e,f,g,h,i;for(f=[1500,6e3,24e3,96e3],g=0,e=0,c=0,d=f.length;d>c;c++)b=f[c],g+=b,a>=g&&(e+=1);return h=(a-(null!=(i=f[e-1])?i:0))/f[e],e},shoot:function(a){return a?this.shooting=!0:(this.shooting=!1,this.shotsFired=0,this.lastShot=500)},_autoFire:function(a){var b,c,d,e;return this.lastShot+=a.dt,this.shooting&&(b=this.shotsFired<this.burstCount,this.ship.weaponsEnabled&&b)&&this.lastShot>this.cooldown?(c=function(){switch(this.level){case 0:return 5;case 1:return 7;case 2:return 12;case 3:return 12}}.call(this),e=this.shotsFired%2===0?1:-1,d=1.5*Math.random(),this._createAngleBullet(0+d*e),d=1.5*Math.random(),this._createAngleBullet(c+d*e),d=1.5*Math.random(),this._createAngleBullet(-c+d*e),Crafty.audio.play("shoot",1,.1),this.frontFire=!this.frontFire,this.lastShot=0,this.shotsFired+=1):void 0},_createAngleBullet:function(a){var b;return b=function(){switch(this.level){case 0:return{w:5,speed:550,h:5};case 1:return{w:6,speed:555,h:5};case 2:return{w:8,speed:560,h:5};case 3:return{w:10,speed:565,h:5}}}.call(this),Crafty.e("Bullet").attr({x:this.x+this.w,y:this.y+this.h/2-b.h/2+1,w:b.w,h:b.h,rotation:a}).fire({origin:this,damage:100,speed:this.ship._currentSpeed.x+b.speed,direction:a}).bind("HitTarget",function(a){return function(b){return a.addXP(1),a.ship.trigger("BulletHit",b)}}(this)).bind("DestroyTarget",function(a){return function(b){return a.addXP(5),a.ship.trigger("BulletDestroyedTarget",b)}}(this))}})}.call(this),function(){Crafty.c("RapidWeaponLaser",{init:function(){return this.requires("2D,WebGL,muzzleFlash,ColorEffects"),this.attr({w:30,h:16}),this.stats={rapid:0,damage:0,aim:0,speed:0},this.boosts={},this.boostTimings={},this.lastShot=0,this.shotsFired=0,this.burstCount=1/0,this.frontFire=!0},remove:function(){return this.unbind("GameLoop",this._autoFire)},install:function(a){var b,c,d,e,f,g,h;for(this.ship=a,c={},b={_red:255,_green:255,_blue:255},Crafty.assignColor(this.ship.playerColor,c),h=["_red","_green","_blue"],e=0,f=h.length;f>e;e++)d=h[e],g=(c[d]+b[d]+b[d])/3,c[d]=g;return this.colorOverride(c),this.attr({x:this.ship.x+38,y:this.ship.y+22,z:this.ship.z+1,alpha:0}),this.ship.attach(this),this.shooting=!1,this._determineWeaponSettings(),this.bind("GameLoop",this._autoFire)},uninstall:function(){return this.attr({alpha:0}),this.unbind("GameLoop",this._autoFire)},upgrade:function(a){return this.stats[a]+=1,this._determineWeaponSettings(),this.trigger("levelUp",{aspect:a,level:this.stats[a]})},boost:function(a){return this.boosts[a]=10,this.boostTimings[a]=15e3,this._determineWeaponSettings(),this.trigger("boost",{aspect:a})},_determineWeaponSettings:function(){var a,b,c;return this.cooldown=175-10*(this.boosts.rapidb||this.stats.rapid),this.damage=100+50*(this.boosts.damageb||this.stats.damage),this.aimAngle=0+6*(this.boosts.aimb||this.stats.aim),this.aimDistance=Math.min(40+50*(this.boosts.aimb||this.stats.aim),500),this.speed=650+70*(this.boosts.speedb||this.stats.speed),b=function(){var b,d;b=this.stats,d=[];for(a in b)c=b[a],"damage"!==a&&d.push(c);return d}.call(this),this.overallLevel=Math.min.apply(Math,b)},shoot:function(a){return a?(this.shooting=!0,this.attr({alpha:0})):(this.shooting=!1,this._clearPicked(),this.shotsFired=0,this.lastShot=500)},_autoFire:function(a){var b,c,d,e;this.lastShot+=a.dt,d=this.boostTimings;for(c in d)e=d[c],this.boostTimings[c]-=a.dt,0>e&&(delete this.boostTimings[c],delete this.boosts[c],this._determineWeaponSettings(),this.trigger("boostExpired",{aspect:c}));return this.lastShot>=60&&this.attr({alpha:0}),this.shooting&&(b=this.shotsFired<this.burstCount,this.ship.weaponsEnabled&&b)&&this.lastShot>this.cooldown?(this.frontFire?(this._createFrontBullet(),this.attr({alpha:1})):this._createBackBullet(),Crafty.audio.play("shoot",1,.05),this.frontFire=!this.frontFire,this.lastShot=0,this.shotsFired+=1):void 0},_createFrontBullet:function(){var a,b;return a={w:Math.floor(this.speed/25),speed:this.speed,h:8+this.overallLevel,o:this.overallLevel},b={x:this.x+this.w,y:this.y+this.h/2-a.h/2+1+a.o},Crafty.e("Bullet").attr({w:a.w,h:a.h,x:b.x,y:b.y,z:1}).fire({ship:this.ship,damage:this.damage,speed:this.ship._currentSpeed.x+a.speed,direction:this._bulletDirection(b)})},_createBackBullet:function(){var a,b;return a={w:Math.floor(this.speed/35),speed:this.speed,h:7+this.overallLevel,o:this.overallLevel},b={x:this.x+this.w,y:this.y+this.h/2-a.h/2-2-a.o},Crafty.e("Bullet").attr({w:a.w,h:a.h,x:b.x,y:b.y,z:-1}).fire({ship:this.ship,damage:this.damage,speed:this.ship._currentSpeed.x+a.speed,direction:this._bulletDirection(b)})},_bulletDirection:function(a){var b,c,d,e,f,g,h;return(g=this._targetEnemy(a))?(e=Math.sqrt(Math.pow(Math.abs(a.x-g.x),2)+Math.pow(Math.abs(a.y-g.y),2)),h=e/(this.speed+this.ship._currentSpeed.x),f={x:g.x+Math.floor(g.w/2)+g.vx*h,y:g.y+Math.floor(g.h/2)+g.vy*h},c=Math.atan2(f.y-a.y,f.x-a.x),c*=180/Math.PI,-this.aimAngle<c&&c<this.aimAngle?(null==this.currentShot&&(this.currentShot=0),d=Math.abs(this.currentShot-c),b=2,d>10&&(b=4),d>15&&(b=8),d>40&&(b=25),d>90&&(b=50),this.currentShot<c?this.currentShot+=b:this.currentShot-=b,this.currentShot):(this._clearPicked(),this.currentShot=0,0)):(this._clearPicked(),this.currentShot=0,0)},_targetEnemy:function(a){var b,c,d,e,f,g,h;if(this.pickedEntity)return this.pickedEntity;for(g=[],Crafty("Enemy").each(function(){return this.hidden?void 0:g.push({x:this.x,y:this.y+this.h/2,e:this})}),this.pickedEntity=null,h=1/0,d=0,f=g.length;f>d;d++)e=g[d],b=Math.atan2(e.y-a.y,e.x-a.x),b*=180/Math.PI,c=Math.abs(a.x-e.x)+Math.abs(a.y-e.y),-this.aimAngle<b&&b<this.aimAngle&&h>c&&(h=c,this.pickedEntity=e.e);return this.pickedEntity&&(this.pickedEntity.one("Remove",function(a){return function(){return a._clearPicked()}}(this)),this.pickedEntity.one("Hiding",function(a){return function(){return a._clearPicked()}}(this))),this.pickedEntity},_clearPicked:function(){return this.pickedEntity&&(this.pickedEntity.unbind("Remove",this._clearPicked),this.pickedEntity.unbind("Hiding",this._clearPicked)),this.pickedEntity=null}})}.call(this),function(){Crafty.c("Sphere",{init:function(){return this.requires("2D, WebGL, sphere1, SpriteAnimation"),this.crop(5,4,7,7),this.attr({w:7,h:7,speed:300}),this.reel("blink",150,[[7,3,1,1],[8,3,1,1]])},blink:function(){return this.animate("blink",-1),this},muzzle:function(){return this.sprite(8,3),this}})}.call(this),function(){Crafty.c("WeaponLaser",{init:function(){return this.requires("2D,WebGL,Color"),this.color("#808080"),this.attr({w:30,h:5})},remove:function(){},install:function(a){return this.ship=a,this.xp=0,this.level=this.determineLevel(this.xp),this.attr({x:this.ship.x+10,y:this.ship.y+15,z:this.ship.z+1}),this.ship.attach(this)},addXP:function(a){var b;return this.xp+=a,b=this.level,this.level=this.determineLevel(this.xp),b!==this.level?this.trigger("levelUp",this.level):void 0},determineLevel:function(a){var b,c,d,e,f,g,h,i;for(f=[150,600,2400,9600],g=0,e=0,c=0,d=f.length;d>c;c++)b=f[c],g+=b,a>=g&&(e+=1);return h=(a-(null!=(i=f[e-1])?i:0))/f[e],e},shoot:function(a){var b;if(a)return b=function(){switch(this.level){case 0:return{w:6,speed:350,h:3};case 1:return{w:10,speed:355,h:4};case 2:return{w:14,speed:360,h:5};case 3:return{w:18,speed:365,h:5}}}.call(this),Crafty.e("Bullet").attr({x:this.x+this.w,y:this.y+this.h/2-b.h/2,w:b.w,h:b.h}).fire({origin:this,damage:100,speed:this.ship._currentSpeed.x+b.speed,direction:0}).bind("HitTarget",function(a){return function(){return a.addXP(1),a.ship.trigger("BulletHit")}}(this)).bind("DestroyTarget",function(a){return function(){return a.addXP(5),a.ship.trigger("BulletDestroyedTarget")}}(this))}})}.call(this)}(),function(){(function(){var a,b=[].slice;a={paused:!1,firstLevel:"Game",togglePause:function(){return this.paused=!this.paused,this.paused?(Crafty("Delay").each(function(){return this.pauseDelays()}),Crafty("Tween").each(function(){return this.pauseTweens()}),Crafty("Particles").each(function(){return this.pauseParticles()}),Crafty("SpriteAnimation").each(function(){return this.pauseAnimation()}),Crafty("PlayerControlledShip").each(function(){return this.disableControls?void 0:(this.disabledThroughPause=!0,this.disableControl())}),Crafty.trigger("GamePause",this.paused)):(Crafty("Delay").each(function(){return this.resumeDelays()}),Crafty("Tween").each(function(){return this.resumeTweens()}),Crafty("Particles").each(function(){return this.resumeParticles()}),Crafty("SpriteAnimation").each(function(){return this.resumeAnimation()}),Crafty("PlayerControlledShip").each(function(){return this.disabledThroughPause?(this.disabledThroughPause=null,this.enableControl()):void 0}),Crafty.trigger("GamePause",this.paused))},start:function(){var c,d;return this.resetCredits(),d=this.settings(),d.sound===!1&&Crafty.audio.mute(),Crafty.bind("EnterFrame",function(){return a.paused?void 0:Crafty.trigger.apply(Crafty,["GameLoop"].concat(b.call(arguments)))}),Crafty.paths({audio:"audio/",images:"images/"}),Crafty.init(1024,576,$("#cr-stage")[0]),Crafty.background("#000000"),Crafty.e("Player, Color").attr({name:"Player 1",z:0,playerNumber:1}).setName("Player 1").color("#FF0000"),Crafty.e("Player, Color").attr({name:"Player 2",z:10,playerNumber:2}).setName("Player 2").color("#00FF00"),Crafty.e("KeyboardControls, PlayerAssignable").controls({fire:Crafty.keys.SPACE,switchWeapon:Crafty.keys.PERIOD,"super":Crafty.keys.ENTER,up:Crafty.keys.UP_ARROW,down:Crafty.keys.DOWN_ARROW,left:Crafty.keys.LEFT_ARROW,right:Crafty.keys.RIGHT_ARROW,pause:Crafty.keys.P}),Crafty.e("KeyboardControls, PlayerAssignable").controls({fire:Crafty.keys.G,switchWeapon:Crafty.keys.H,up:Crafty.keys.W,down:Crafty.keys.S,left:Crafty.keys.A,right:Crafty.keys.D,pause:Crafty.keys.Q}),Crafty.e("GamepadControls, PlayerAssignable").controls({gamepadIndex:0,fire:0,switchWeapon:2,"super":4,pause:9,up:12,down:13,left:14,right:15}),Crafty.e("GamepadControls, PlayerAssignable").controls({gamepadIndex:1,fire:0,switchWeapon:2,"super":4,pause:9,up:12,down:13,left:14,right:15}),c=function(a){return function(a){return a.key===Crafty.keys.N?(Crafty.unbind("KeyDown",c),Crafty.enterScene("Game",{script:"Lunch",checkpoint:0})):void 0}}(this),Crafty.bind("KeyDown",c),Crafty.enterScene("Intro")},resetCredits:function(){return this.credits=2},highscores:function(){var a,b,c,d;return c=function(){var a,b,c,d,e;return(b=localStorage.getItem("SPDLZR"))?(c=b.slice(0,20),a=b.slice(20),d=CryptoJS.AES.decrypt(a,c),e=d.toString(CryptoJS.enc.Utf8),e.length>1?JSON.parse(e):[]):[]},d=c(),a="SPL",b=[{initials:a,score:3e4},{initials:a,score:2e4},{initials:a,score:1e4},{initials:a,score:5e3},{initials:a,score:2500},{initials:a,score:1500},{initials:a,score:1e3},{initials:a,score:5e3},{initials:a,score:2e3},{initials:a,score:1500}].concat(d),_.sortBy(b,"score").reverse()},settings:function(){var a,b;return a=localStorage.getItem("SPDLZRS"),b={},a&&(b=JSON.parse(a)),_.defaults(b,{sound:!0})},changeSettings:function(a){var b,c;return null==a&&(a={}),b=_.defaults(a,this.settings()),c=JSON.stringify(b),localStorage.setItem("SPDLZRS",c)}},window.Game=a}).call(this)}(),function(){(function(){var a;a=this.Game,null==a.ScriptModule&&(a.ScriptModule={}),a.ScriptModule.Colors={backgroundColorFade:function(b,c,d){return function(e){return function(f){var g,h;return Crafty.background(c[0]),Crafty.bind("BackgroundColor",e._colorHorizon),Crafty.trigger("BackgroundColor",c[0]),g=WhenJS.defer(),Crafty("Sky").get(0).colorFade({duration:b.duration,skip:null!=(h=b.skip)?h:0},c,d).bind("ColorFadeFinished",function(){var b;return b=c[c.length-1],a.backgroundColor=b,Crafty("Horizon").each(function(){return this.colorDesaturation(b)}),Crafty.unbind("BackgroundColor",this._colorHorizon),g.resolve()}),g.promise}}(this)},_colorHorizon:function(b){return a.backgroundColor!==b?(a.backgroundColor=b,Crafty("Horizon").each(function(){return this.colorDesaturation(b)})):void 0}},Crafty.c("Horizon",{init:function(){return this.requires("ColorEffects"),this.colorDesaturation(a.backgroundColor)}})}).call(this),function(){var a,b=[].slice;a=this.Game,null==a.ScriptModule&&(a.ScriptModule={}),a.ScriptModule.Core={_verify:function(a){if(a!==this.currentSequence)throw new Error("sequence mismatch");return this.level.verify()},_skippingToCheckpoint:function(){return null!=this.startAtCheckpoint&&this.currentCheckpoint<this.startAtCheckpoint},sequence:function(){var a;return a=1<=arguments.length?b.call(arguments,0):[],function(b){return function(c){return b._verify(c),WhenJS.sequence(a,c)}}(this)},parallel:function(){var a;return a=1<=arguments.length?b.call(arguments,0):[],function(b){return function(c){return b._verify(c),WhenJS.parallel(a,c)}}(this)},"if":function(a,b,c){return function(d){return function(e){return d._verify(e),a.apply(d)?b(e):"function"==typeof c?c(e):void 0}}(this)},
"while":function(a,b){return function(c){return function(d){var e;return c._verify(d),c._skippingToCheckpoint()?WhenJS():(void 0===b&&(b=a,a=function(){var a;return a=WhenJS.defer(),a.promise}),e=!1,a(d)["catch"](function(a){if("sequence mismatch"!==a.message)throw a})["finally"](function(){return e=!0}),WhenJS.iterate(function(){return 1},function(){return e},function(){return b(d)},1))}}(this)},repeat:function(a,b){return function(c){return function(d){return c._verify(d),c._skippingToCheckpoint()?WhenJS():void 0===b?c["while"](a)(d):0!==a?WhenJS(b(d)).then(function(){return c.repeat(a-1,b)(d)}):void 0}}(this)},runScript:function(){var a,c;return c=arguments[0],a=2<=arguments.length?b.call(arguments,1):[],function(b){return function(d){var e;return b._verify(d),b._skippingToCheckpoint()?WhenJS():(e=new c(b.level)).run.apply(e,a)}}(this)},async:function(a){return function(b){return function(c){return b._verify(c),b._skippingToCheckpoint()?WhenJS():void a(c)}}(this)},wait:function(a){return function(b){return function(c){var d,e,f,g;return b._verify(c),b._skippingToCheckpoint()?WhenJS():(d=WhenJS.defer(),e=Math.max(null!=(g="function"==typeof a?a():void 0)?g:a,0),f=Math.floor(e/40),Crafty.e("Delay").delay(function(){var a;try{b._verify(c)}catch(e){a=e,d.reject(a)}},40,f,function(){return d.resolve(),this.destroy()}),d.promise)}}(this)},endSequence:function(){return function(a){return function(b){throw a._verify(b),new Error("sequence mismatch")}}(this)},checkpoint:function(a){return function(b){return function(c){return b._verify(c),b.currentCheckpoint+=1,b._skippingToCheckpoint()?WhenJS():b.currentCheckpoint===b.startAtCheckpoint&&null!=a?a(c):window.ga("send","event","Game","Checkpoint "+b.currentCheckpoint)}}(this)}}}.call(this),function(){var a,b=[].slice;a=this.Game,null==a.ScriptModule&&(a.ScriptModule={}),a.ScriptModule.Entity={bindSequence:function(a,c,d){var e;if(null!=c)return null==d&&(d=function(){return!0}),e=function(f){return function(){var g,h,i;return g=1<=arguments.length?b.call(arguments,0):[],d.apply(null,g)?(f.entity.unbind(a,e),h=function(a){return f.alternatePath=null,WhenJS(c.apply(f,g)(a))["catch"](function(){return f.alternatePath})},f.currentSequence=i=Math.random(),f.alternatePath=h(i)):void 0}}(this),this.entity.bind(a,e)},sendToBackground:function(a,b){return function(c){return function(d){return c._verify(d),c.entity.sendToBackground(a,b)}}(this)},reveal:function(){return function(a){return function(b){return a._verify(b),a.entity.reveal()}}(this)},animate:function(a,b,c){return function(d){return function(e){return d._verify(e),c?d.entity[c].animate(a,b):d.entity.animate(a,b)}}(this)},scale:function(a,b){return null==b&&(b={}),function(c){return function(d){var e,f,g,h;return c._verify(d),g=null!=(h=c.entity.scale)?h:1,b=_.defaults(b,{duration:1e3*Math.abs(a-g)}),f=WhenJS.defer(),e=function(){return defer.resolve()},c.entity.tween({scale:a},b.duration).one("TweenEnd",function(){return this.unbind("Remove",e),f.resolve()}),f.promise}}(this)},movePath:function(a,b){return null==b&&(b={}),function(c){return function(d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;return c._verify(d),c.enemy.alive||null!=c.decoyingEntity?(b=_.defaults(b,{rotate:!0,skip:0,speed:c.entity.defaultSpeed,continuePath:!1,easing:"linear",autoAccellerate:!0}),m=[].concat(a),m.unshift([Math.round(c.entity.x+Crafty.viewport.x),Math.round(c.entity.y+Crafty.viewport.y)]),o=m[0],i=0,g=function(){var a,b,c;for(c=[],a=0,b=m.length;b>a;a++)l=m[a],(r="function"==typeof l?l():void 0)?(s=r.x,t=r.y):(s=l[0],t=l[1]),s>-1&&2>s&&(s*=Crafty.viewport.width),t>-1&&2>t&&(t*=Crafty.viewport.height),n=[s,t],p=o[0],q=o[1],e=Math.abs(s-p),f=Math.abs(t-q),h=Math.sqrt(Math.pow(e,2)+Math.pow(f,2)),i+=h,o=n,s-=Crafty.viewport.x,t-=Crafty.viewport.y,c.push({x:s,y:t});return c}(),k=i/b.speed*1e3,j=WhenJS.defer(),c.entity.choreography([{type:"viewportBezier",rotation:b.rotate,continuePath:b.continuePath,path:g,duration:k,easingFn:b.easing}],{skip:b.skip}).one("ChoreographyEnd",function(){return j.resolve()}),j.promise):WhenJS.resolve()}}(this)},_isFloat:function(a){return a===+a&&a!==(0|a)},moveTo:function(a,b){return null==b&&(b={}),function(c){return function(d){var e,f,g,h,i,j,k,l,m;if(c._verify(d),!c.enemy.alive&&null==c.decoyingEntity)return WhenJS.resolve();if("string"==typeof a&&(l=Crafty(a).get(0),f=_.defaults(b,{offsetX:0,offsetY:0}),a={x:l.x+Crafty.viewport.x+f.offsetX,y:l.y+Crafty.viewport.y+f.offsetY}),k=null!=(g="function"==typeof a?a():void 0)?g:a,_.isFunction(k))return WhenJS();if(_.extend(k,b),null!=k.x&&-1<(h=k.x)&&2>h&&(k.x*=Crafty.viewport.width),null!=k.y&&-1<(i=k.y)&&2>i&&(k.y*=Crafty.viewport.height),"absoluteY"===k.positionType&&(k.y+=Crafty.viewport.y),!_.isObject(a))throw new Error("location invalid");return j=c._getSeaLevel(),"air"===c.enemy.moveState?null!=k.y&&k.y+c.entity.h>j+Crafty.viewport.y?(e=_.clone(k),e.y=j-c.entity.h,c._moveAir(e).then(function(){return c.enemy.moveState="water",c.enemy.alive?(c._setupWaterSpot(),c._moveWater(k)):void 0})):c._moveAir(k):"water"===c.enemy.moveState?null!=k.y&&k.y+c.entity.h<j+Crafty.viewport.y?(m=_.clone(k),m.y=j-c.entity.h,c._moveWater(m).then(function(){return c.enemy.moveState="air",c.enemy.alive?(c._removeWaterSpot(),c._moveAir(k)):void 0})):c._moveWater(k):void 0}}(this)},moveThrough:function(a){return function(b){return function(c){var d,e,f,g,h,i,j,k,l,m;return b._verify(c),l=Math.round(b.entity.x+Crafty.viewport.x),m=Math.round(b.entity.y+Crafty.viewport.y),(i="function"==typeof a?a():void 0)?(j=i.x,k=i.y):(j=a[0],k=a[1]),null!=j&&null!=k?(d=j-l,e=k-m):(d=-1,e=0),h=Math.atan2(e,d),f=1e3*Math.cos(h)+l,g=1e3*Math.sin(h)+m,b.moveTo({x:f,y:g,rotation:!0})(c)}}(this)},_setupWaterSpot:function(){var b;return b=null!=a.explosionMode?Crafty.e("2D, WebGL, Color, Choreography, Tween").color("#000040").attr({w:this.entity.w+10,x:this.entity.x-5,y:this.entity.y+this.entity.h,h:20,alpha:.7,z:this.entity.z-1}):Crafty.e("2D, WebGL, shadow, Choreography, Tween").attr({w:this.entity.w+10,x:this.entity.x-5,y:this._getSeaLevel()-10-Crafty.viewport.y,h:20,z:this.entity.z-1}),null!=a.explosionMode&&this._waterSplash(),this.entity.addComponent("WaterSplashes"),this.entity.setSealevel(this._getSeaLevel()-Crafty.viewport.y),this.entity.has("ViewportFixed")&&b.addComponent("ViewportFixed"),this.entity.hide(b,{below:this._getSeaLevel()})},_removeWaterSpot:function(){return this.entity.reveal(),null!=a.explosionMode?this._waterSplash():this.entity.removeComponent("WaterSplashes")},_waterSplash:function(){var a;return a=WhenJS.defer(),Crafty.e("WaterSplash").waterSplash({x:this.entity.x,y:this._getSeaLevel(),size:this.entity.w}).one("ParticleEnd",function(){return a.resolve()}),a.promise},_moveWater:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;if(b={speed:this.entity.defaultSpeed},this.entity.has("ViewportFixed")&&(b.x=this.entity.x+Crafty.viewport.x,b.y=this.entity.y+Crafty.viewport.y),p=this._getSeaLevel(),a=_.defaults(a,b),q={w:1.2*this.entity.w,h:this.entity.w/3,alpha:.6},l=700,k={w:.3*this.entity.w,h:5,alpha:.2},e=null!=a.x?Math.abs(a.x-(this.entity.hideMarker.x+Crafty.viewport.x)):0,f=null!=a.y?Math.abs(a.y-(this.entity.hideMarker.y+Crafty.viewport.y)):0,d=Math.sqrt(Math.pow(e,2)+Math.pow(f,2)),i=d/a.speed*1e3,null!=a.y){g=Math.max(0,Math.min(a.y-this.entity.h,l)-p),r=g/(l-p),h={};for(j in q)n=q[j],h[j]=(1-r)*n+r*k[j];this.entity.hideMarker.tween(h,i)}return c=WhenJS.defer(),m=null!=(o=null!=h?h.h:void 0)?o:this.entity.hideMarker.h,this.entity.hideMarker.choreography([{type:"viewport",x:a.x+this.entity.w/2-this.entity.hideMarker.w/2,y:p-m/2,maxSpeed:a.speed,duration:i}]).one("ChoreographyEnd",function(){return c.resolve()}),WhenJS.all([c.promise,this._moveAir(a)])},_getSeaLevel:function(){var a,b;return Crafty.viewport.height-240+220*(null!=(a=this.entity.scale)?a:1)+(null!=(b=this.level.sealevelOffset)?b:0)},_moveAir:function(a){var b,c,d,e,f,g,h;return b={speed:this.entity.defaultSpeed},this.entity.has("ViewportFixed")&&(b.x=this.entity.x+Crafty.viewport.x,b.y=this.entity.y+Crafty.viewport.y),a=_.defaults(a,b),e=null!=a.x?Math.abs(a.x-(this.entity.x+Crafty.viewport.x)):0,f=null!=a.y?Math.abs(a.y-(this.entity.y+Crafty.viewport.y)):0,d=Math.sqrt(Math.pow(e,2)+Math.pow(f,2)),c=WhenJS.defer(),g=null!=(h=a.easing)?h:"linear",this.entity.choreography([{type:"viewport",x:a.x,y:a.y,rotation:a.rotation,easingFn:g,maxSpeed:a.speed,duration:d/a.speed*1e3}]).one("ChoreographyEnd",function(){return c.resolve()}),c.promise},rotate:function(a,b){return function(c){return function(d){var e,f;return c._verify(d),f=WhenJS.defer(),e=function(){return f.resolve()},c.entity.one("Remove",e),c.entity.tween({rotation:a},b).one("TweenEnd",function(){return this.unbind("Remove",e),f.resolve()}),f.promise}}(this)},synchronizeOn:function(a){return function(b){return function(c){return b.synchronizer.synchronizeOn(a,b)}}(this)},squadOnce:function(a,b){return function(c){return function(d){return c._verify(d),c.synchronizer.allowOnce(a)?b(d):void 0}}(this)},setLocation:function(a){return function(b){return function(c){var d,e,f,g;return e=null!=(d="function"==typeof a?a():void 0)?d:a,f=e.x,g=e.y,(b._isFloat(f)||f>-1&&2>f)&&(f*=Crafty.viewport.width),(b._isFloat(g)||g>-1&&2>g)&&(g*=Crafty.viewport.height),b.entity.attr({x:f-Crafty.viewport.x,y:g-Crafty.viewport.y})}}(this)},location:function(a){return null==a&&(a={}),function(b){return function(){var c,d,e,f,g,h;return null!=b.decoyingEntity?{x:b.entity.x+Crafty.viewport.x+b.entity.w/2+(null!=(c=a.offsetX)?c:0),y:b.entity.y+Crafty.viewport.y+b.entity.h/2+(null!=(d=a.offsetY)?d:0)}:{x:(null!=(e=b.enemy.location.x)?e:b.entity.x+Crafty.viewport.x+b.entity.w/2)+(null!=(f=a.offsetX)?f:0),y:(null!=(g=b.enemy.location.y)?g:b.entity.y+Crafty.viewport.y+b.entity.h/2)+(null!=(h=a.offsetY)?h:0)}}}(this)},invincible:function(a){return function(b){return function(c){return b._verify(c),b.entity.invincible=a}}(this)},turnAround:function(){return function(a){return function(b){var c;return a._verify(b),null==a.turned&&(a.turned=null!=(c=a.entity.xFlipped)?c:!1),a.turned=!a.turned,a.turned?a.entity.flipX():a.entity.unflipX()}}(this)},deathDecoy:function(){return function(a){return function(b){var c,d,e;return a._verify(b),a.decoy=a.spawn(a.options),c=a.location()(),d=c.x,e=c.y,a.decoy.removeComponent("BurstShot"),a.decoy.attr({x:d-Crafty.viewport.x,y:e-Crafty.viewport.y,invincible:!0,health:1,defaultSpeed:a.entity.defaultSpeed}),a.decoy.updatedHealth(),a.entity.xFlipped?a.decoy.flipX():a.decoy.unflipX(),a.decoyingEntity=a.entity,a.entity=a.decoy}}(this)},endDecoy:function(){return function(a){return function(b){var c;return null!=(c=a.decoy)&&c.destroy(),a.decoy=null,a.entity=a.decoyingEntity,a.decoyingEntity=void 0}}(this)},leaveAnimation:function(a){return function(b){return function(c){return b._verify(c),b._skippingToCheckpoint()?WhenJS():(b.entity.addComponent("KeepAlive"),void a(c).then(function(){return b.enemy.alive?b.entity.destroy():void 0}))}}(this)},action:function(a,b){return function(c){return function(d){return c._verify(d),c._skippingToCheckpoint()?WhenJS():WhenJS(c.entity.execute(a,b,c))}}(this)}}}.call(this),function(){var a,b=[].slice;a=this.Game,null==a.ScriptModule&&(a.ScriptModule={}),a.ScriptModule.Level={placeSquad:function(b,c){return null==c&&(c={}),function(d){return function(e){var f,g,h,i,j,k;return d._verify(e),d._skippingToCheckpoint()?WhenJS():(k=new a.Synchronizer,c=_.clone(c),h=_.defaults({synchronizer:k},c.options),c=_.defaults({},c,{amount:1,delay:1e3}),null!=h.gridConfig&&(h.grid=new a.LocationGrid(h.gridConfig)),c.options=h,j=function(){var a,d,e;for(e=[],f=a=0,d=c.amount;d>=0?d>a:a>d;f=d>=0?++a:--a)e.push(k.registerEntity(new b(this.level)));return e}.call(d),g=WhenJS(!0),null!=(null!=(i=j[0])?i.assets:void 0)&&(g=j[0].assets(_.clone(c.options))(e)),g.then(function(){var a,b;return a=function(){var a,d,g;for(g=[],f=a=0,d=j.length;d>a;f=++a)b=j[f],g.push(function(a){return function(b,d){return a.wait(d*c.delay)(e).then(function(){var f;return a._verify(e),f=_.clone(c.options),f.index=d,b.run(f)})}}(this)(b,f));return g}.call(d),WhenJS.all(a).then(function(a){var b,f,g,h,i,j,k,l,m;for(d.attackWaveResults=(d.attackWaveResults||[]).concat(a),f=!0,j=null,i=null,g=0,k=a.length;k>g;g++)m=a[g],b=m.alive,h=m.killedAt,l=m.location,b?f=!1:(null==i&&(i=h),null==j&&(j=l),h.getTime()>i.getTime()&&(i=h,j=l));return f&&j&&(j.x-=Crafty.viewport.x,j.y-=Crafty.viewport.y,c.drop)?d.drop({item:c.drop,location:j})(e):void 0})}))}}(this)},attackWaves:function(a,b){return null==b&&(b={}),function(c){return function(d){return c._verify(d),c._skippingToCheckpoint()?WhenJS():(c.attackWaveResults=[],a(d).then(function(){var a,e,f,g,h,i,j,k,l,m;for(e=!0,i=null,h=null,l=c.attackWaveResults,f=0,j=l.length;j>f;f++)m=l[f],a=m.alive,g=m.killedAt,k=m.location,a?e=!1:(null==h&&(h=g),null==i&&(i=k),g.getTime()>h.getTime()&&(h=g,i=k));return e&&i&&(i.x+=Crafty.viewport.x,i.y+=Crafty.viewport.y,b.drop)?c.drop({item:b.drop,location:function(){return i}})(d):void 0}))}}(this)},say:function(b,c,d){return null==d&&(d={}),function(e){return function(f){return e._verify(f),e._skippingToCheckpoint()?WhenJS():(null==c&&(c=b,b=void 0),d=_.defaults(d,{speaker:b,noise:"none",bottom:e.level.visibleHeight}),a.say(b,c,d))}}(this)},drop:function(a){return function(b){return function(c){var d,e,f,g,h,i,j;if(b._verify(c),b._skippingToCheckpoint())return WhenJS();if(g=b.inventory(a.item),f=function(){return Crafty.e("PowerUp").powerUp(g)},!g)return console.warn("Item ",a.item," is not known"),WhenJS();if(h=a.inFrontOf)if(j=h.ship())b.level.addComponent(f().attr({z:-1}),{x:Crafty.viewport.width,y:h.ship().y+Crafty.viewport.y});else if(!h.gameOver)return e=WhenJS.defer(),h.entity.one("ShipSpawned",function(a){return b.level.addComponent(f().attr({z:-1}),{x:Crafty.viewport.width,y:a.y+Crafty.viewport.y}),e.resolve()}),e.promise;return(i=a.location)?(d="function"==typeof i?i():void 0,d?(d.x-=Crafty.viewport.x,d.y-=Crafty.viewport.y):d=i,f().attr({x:d.x,y:d.y,z:-1})):void 0}}(this)},player:function(a){var b,c,d;return d={},b=[],Crafty("Player").each(function(){return d[this.name]={name:this.name,entity:this,active:!1,gameOver:!1,has:function(a){var b;return null!=(b=this.ship())?b.hasItem(a):void 0},ship:function(){var a,b;return a=this,b=null,Crafty("Player ControlScheme").each(function(){return this.name===a.name?b=this.ship:void 0}),b}}}),Crafty("Player ControlScheme").each(function(){return d[this.name].active=!0,this.lives>0?b.push(this.name):(d[this.name].active=!1,d[this.name].gameOver=!0)}),c="anyActive"===a?_.sample(b):"Player "+a,d[c]},setScenery:function(a){return function(b){return function(c){return b._verify(c),b._skippingToCheckpoint()?WhenJS():b.level.setScenery(a)}}(this)},waitForScenery:function(a,b){return null==b&&(b={}),function(c){return function(d){var e;return c._verify(d),b=_.defaults(b,{event:"enter"}),c._skippingToCheckpoint()?WhenJS():(e=WhenJS.defer(),c.level.notifyScenery(b.event,a,function(){return e.resolve()}),e.promise)}}(this)},gainHeight:function(a,b){return function(c){return function(d){var e,f,g,h,i,j,k;return c._verify(d),f=WhenJS.defer(),e=null!=(i=null!=(j=c.level._forcedSpeed)?j.x:void 0)?i:c.level._forcedSpeed,g=b.duration,c._skippingToCheckpoint()||0===g?c.level.setHeight(-a):(k=a/g*1e3,c.level.setForcedSpeed({x:e,y:-k},{accellerate:!1}),h=c.level,Crafty.e("Delay").delay(function(){return h.setForcedSpeed(e,{accellerate:!1}),f.resolve()},g),f.promise)}}(this)},setSpeed:function(a,b){return null==b&&(b={}),function(c){return function(d){return c._verify(d),b=_.defaults(b,{accellerate:!0}),c.level.setForcedSpeed(a,b)}}(this)},disableWeapons:function(){var a;return a=1<=arguments.length?b.call(arguments,0):[],function(b){return function(c){return b._verify(c),b.level.setWeaponsEnabled(!1,a)}}(this)},enableWeapons:function(){var a;return a=1<=arguments.length?b.call(arguments,0):[],function(b){return function(c){return b._verify(c),b.level.setWeaponsEnabled(!0,a)}}(this)},blast:function(a,b,c){return null==b&&(b={}),function(d){return function(e){var f,g,h,i,j;return d._verify(e),g=a(),i=g.x,j=g.y,i-=Crafty.viewport.x,j-=Crafty.viewport.y,b=null!=(h="function"==typeof b?b():void 0)?h:b,b=_.defaults({x:i,y:j},b,{damage:0,radius:20,duration:160,z:5,topDesaturation:0,bottomDesaturation:0,lightness:1,alpha:1}),f=Crafty.e("Blast, Explosion").explode(b,c),j>d._getSeaLevel()-60&&1===b.lightness&&(f.addComponent("WaterSplashes"),f.attr({waterSplashSpeed:500,defaultWaterCooldown:450}),f.setDetectionOffset(40,0),f.setSealevel(d._getSeaLevel())),b.damage?(f.ship=d.entity.deathCause,f.addComponent("Hostile")):void 0}}(this)},loadAssets:function(){var a;return a=1<=arguments.length?b.call(arguments,0):[],function(b){return function(c){return b.level.loadAssets(a)}}(this)},updateTitle:function(a){return function(b){return function(c){return b._verify(c),Crafty("LevelTitle").text(a)}}(this)},chapterTitle:function(a,b){return function(c){return function(d){return c._verify(d),Crafty("LevelTitle").text(a+": "+b),c._skippingToCheckpoint()?WhenJS():Crafty.e("BigText").bigText(b,{"super":"Chapter "+a+":"})}}(this)},showText:function(a,b){return null==b&&(b={}),function(c){return function(d){return c._verify(d),c._skippingToCheckpoint()?WhenJS():Crafty.e("BigText").bigText(a,b)}}(this)},pickTarget:function(a,b){return null==b&&(b=null),function(c){return function(d){var e,f;return e=function(a){var c;return c=Crafty(a),0===c.length?null:null===b?c.get(Math.floor(Math.random()*c.length)):c.get(b)},f=function(b){return c.target={x:b.x,y:b.y},Crafty.one("ShipSpawned",function(b){return c.target=e(a),c.target.one("Destroyed",f)})},c.target=e(a),"PlayerControlledShip"===a&&c.target?c.target.one("Destroyed",f):void 0}}(this)},targetLocation:function(a){return null==a&&(a={}),function(b){return function(){var c,d,e,f,g,h,i,j,k,l;return null!=a.x&&-1<(e=a.x)&&2>e&&(a.x*=Crafty.viewport.width),null!=a.y&&-1<(f=a.y)&&2>f&&(a.y*=Crafty.viewport.height),c=a.x||(null!=(g=b.target)?g.x:void 0),d=a.y||(null!=(h=b.target)?h.y:void 0),c&&d?{x:(null!=(i=a.x)?i:b.target.x+Crafty.viewport.x)+(null!=(j=a.offsetX)?j:0),y:(null!=(k=a.y)?k:b.target.y+Crafty.viewport.y)+(null!=(l=a.offsetY)?l:0)}:null}}(this)},changeSeaLevel:function(a){return function(b){return function(c){var d;return b._verify(c),b.level.sealevelOffset=a,d=b.level,Crafty("WaterSplashes").each(function(){return this.setSealevel(Crafty.viewport.height-20+d.sealevelOffset)})}}(this)},screenShake:function(a,b){return null==b&&(b={}),function(c){return function(d){return c._verify(d),b=_.defaults(b,{duration:1e3}),c.level.screenShake(a,b),c.wait(b.duration)(d)}}(this)},screenFlash:function(a,b){return null==b&&(b={}),function(c){return function(d){var e,f;return c._verify(d),b=_.defaults(b,{duration:200,pauses:400,color:"#FF0000",alpha:1}),f=c._fader(),e=WhenJS.defer(),f.attr({alpha:0}).color(b.color).delay(function(){return this.attr({alpha:b.alpha}),this.delay(function(){return this.attr({alpha:0})},b.duration)},b.pauses,a,function(){return this.attr({alpha:0}),e.resolve()}),e.promise}}(this)},moveCamera:function(a){return null==a&&(a={}),function(b){return function(c){return b.level.cameraPan(a),b.wait(a.duration)(c)}}(this)},setWeapons:function(a){return function(b){return function(c){var d;return b._verify(c),d=b,Crafty("PlayerControlledShip").each(function(){var b,c,e,f,g;for(this.clearItems(),g=[],e=0,f=a.length;f>e;e++)b=a[e],c=d.inventory(b),g.push(this.installItem(c));return g}),b.level.setStartWeapons(a)}}(this)},inventory:function(a){return"pool"===a&&Crafty("Player").each(function(){return this.eligibleForExtraLife()&&"pool"===a?(a="life",this.rewardExtraLife()):void 0}),"pool"===a&&(a=(this.powerupPool||[]).pop()||"points"),this.level.inventory(a)},inventoryAdd:function(a,b,c){return this.level.inventoryAdd(a,b,c)},setPowerupPool:function(){var a;return a=1<=arguments.length?b.call(arguments,0):[],function(b){return function(c){return b._verify(c),b.powerupPool=_.shuffle(a)}}(this)},hideHud:function(a){return null==a&&(a={}),a=_.defaults(a,{visible:!1}),this.toggleHud(a)},showHud:function(a){return null==a&&(a={}),a=_.defaults(a,{visible:!0}),this.toggleHud(a)},toggleHud:function(a){return null==a&&(a={}),function(b){return function(c){return b._verify(c),a=_.defaults(a,{duration:1e3}),Crafty("UILayerDOM, UILayerWebGL").each(function(){return this.addComponent("Tween"),this.visible&&a.visible?this.tween({alpha:1},a.duration):this.tween({alpha:0},a.duration)}),b.wait(a.duration)(c).then(function(){return Crafty("PlayerInfo").each(function(){return this.setVisibility(a.visible)})})}}(this)},setShipType:function(a){return function(b){return function(c){return b._verify(c),b.level.setShipType(a)}}(this)},endGame:function(){return function(a){return function(b){return a._verify(b),a.gotoGameOver=!0}}(this)},disableControls:function(){return function(a){return function(b){return a._verify(b),Crafty("PlayerControlledShip").each(function(){return this.disableControl()})}}(this)},screenFadeOut:function(){return function(a){return function(b){var c,d;return a._verify(b),d=a._fader(),c=WhenJS.defer(),d.attr({alpha:0}).color("#000000").tween({alpha:1},4e3).bind("TweenEnd",function(){return c.resolve()}),c.promise}}(this)},screenFadeIn:function(){return function(a){return function(b){var c,d;return a._verify(b),d=a._fader(),c=WhenJS.defer(),d.attr({alpha:1}).color("#000000").tween({alpha:0},4e3).bind("TweenEnd",function(){return this.destroy(),c.resolve()}),c.promise}}(this)},cancelBullets:function(a,b){return function(c){return function(d){return c._verify(d),null==b&&(b=function(a){return!0}),Crafty(a).each(function(){return b(this)?this.destroy():void 0})}}(this)},_fader:function(){var a;return a=Crafty("ScreenFader").get(0),null==a&&(a=Crafty.e("2D, UILayerDOM, Color, Tween, ScreenFader, Delay")),a.attr({x:0,y:0,z:1e3}).attr({w:Crafty.viewport.width,h:Crafty.viewport.height}),a}}}.call(this),function(){var a;a=this.Game,null==a.ScriptTemplate&&(a.ScriptTemplate={}),a.ScriptTemplate.Level={oldExplosion:function(a,b){return null==b&&(b={}),function(c){return function(d){var e,f,g,h;return c._verify(d),f=a(),g=f.x,h=f.y,g-=Crafty.viewport.x,h-=Crafty.viewport.y,b=_.defaults({x:g,y:h},b,{damage:0,radius:20,duration:160,z:5,alpha:1}),e=Crafty.e("OldExplosion").explode(b),b.damage?e.addComponent("Hostile"):void 0}}(this)},smallExplosion:function(a){return null==a&&(a={}),a=_.defaults(a,{juice:!0,offsetX:0,offsetY:0}),a.juice===!1?this.blast(this.location()):this.parallel(this.blast(this.location({offsetX:a.offsetX,offsetY:a.offsetY}),{alpha:.85}),function(a){return function(){return Crafty.audio.play("explosion",1,.25)}}(this))},bigExplosion:function(a){return null==a&&(a={}),a=_.defaults(a,{juice:!0,offsetX:0,offsetY:0,damage:300}),a.juice===!1?this.blast(this.location(),{damage:a.damage,radius:40}):this.parallel(this.screenShake(10,{duration:200}),function(a){return function(){return Crafty.audio.play("explosion")}}(this),this.blast(this.location({offsetX:a.offsetX,offsetY:a.offsetY}),{damage:a.damage,radius:40}))}}}.call(this),function(){var a;a=this.Game,a.BezierPath=function(){function a(){}return a.prototype.scalePoints=function(a,b){var c,d,e,f,g,h,i,j;for(g=b.origin,j=b.scale,f={x:a[0].x*j.x-g.x,y:a[0].y*j.y-g.y},i=[],c=d=0,e=a.length;e>d;c=++d)h=a[c],i.push({x:h.x*j.x-f.x,y:h.y*j.y-f.y});return i},a.prototype.buildPathFrom=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;for(t={distance:0,curves:[]},p=this.getCurveControlPoints(a),j=p[0],v=p[1],u=3,k=l=0,q=a.length-1;q>=0?q>l:l>q;k=q>=0?++l:--l){for(b=a[k],c=a[k+1],d=j[k],e=v[k],g=[c,e,d,b],f=0,n=jsBezier.pointOnCurve(g,0),w=1/u,k=m=r=w,s=w;s>0?1>=m:m>=1;k=m+=s)o=jsBezier.pointOnCurve(g,k),h=Math.abs(n.x-o.x),i=Math.abs(n.y-o.y),f+=Math.sqrt(Math.pow(h,2)+Math.pow(i,2)),n=o;t.distance+=f,t.curves.push({distance:f,points:g})}return t},a.prototype.pointOnPath=function(a,b){var c,d,e,f,g;return f=this.getCurveAndLocation(a,b),d=f[0],g=f[1],c=f[2],e=jsBezier.pointOnCurve(d.points,g),e.c=c,e},a.prototype.angleOnPath=function(a,b){var c,d,e;return d=this.pointOnPath(a,Math.min(b,.99)),e=this.pointOnPath(a,Math.min(b+.01,1)),c=Math.atan2(d.y-e.y,d.x-e.x),c*=180/Math.PI,(c+360)%360},a.prototype.getCurveAndLocation=function(a,b){var c,d,e,f,g,h,i;for(e=0,c=0,d=a.curves[c],h=(e+d.distance)/a.distance;b>h;)c+=1,e+=d.distance,d=a.curves[c],h=(e+d.distance)/a.distance;return f=d.distance/a.distance,g=e/a.distance,i=(b-g)/f,[d,i,c]},a.prototype.getCurveControlPoints=function(a){var b,c,d,e,f,g,h,i,j;if(e=a.length-1,1>e)return[];if(1===e)return b=[{x:(2*a[0].x+a[1].x)/3,y:(2*a[0].y+a[1].y)/3}],h=[{x:2*b[0].x-a[0].x,y:2*b[0].y-a[0].y}],[b,h];for(g=function(){var b,d,f;for(f=[],c=b=1,d=e-1;d>=1?d>b:b>d;c=d>=1?++b:--b)f.push(4*a[c].x+2*a[c+1].x);return f}(),g.unshift(a[0].x+2*a[1].x),g.push((8*a[e-1].x+a[e].x)/2),i=this.getFirstControlPoints(g),g=function(){var b,d,f;for(f=[],c=b=1,d=e-1;d>=1?d>b:b>d;c=d>=1?++b:--b)f.push(4*a[c].y+2*a[c+1].y);return f}(),g.unshift(a[0].y+2*a[1].y),g.push((8*a[e-1].y+a[e].y)/2),j=this.getFirstControlPoints(g),b=[],h=[],c=d=0,f=e;f>=0?f>d:d>f;c=f>=0?++d:--d)b.push({x:i[c],y:j[c]}),e-1>c?h.push({x:2*a[c+1].x-i[c+1],y:2*a[c+1].y-j[c+1]}):h.push({x:(a[e].x+i[e-1])/2,y:(a[e].y+j[e-1])/2});return[b,h]},a.prototype.getFirstControlPoints=function(a){var b,c,d,e,f,g,h,i,j;for(f=a.length,j=[],i=[null],b=2,j.push(a[0]/b),c=d=1,g=f;g>=1?g>d:d>g;c=g>=1?++d:--d)i.push(1/b),b=f-1>c?4:3.5,b-=i[c],j.push((a[c]-j[c-1])/b);for(c=e=1,h=f;h>=1?h>e:e>h;c=h>=1?++e:--e)j[f-c-1]-=i[f-c]*j[f-c];return j},a}()}.call(this),function(){var a=[].slice;this.Game.say=function(b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;for(Crafty("Dialog").each(function(){return this.trigger("Abort"),this.destroy()}),n=c.split("\n"),t=60,h=WhenJS.defer(),s=.8*Crafty.viewport.width,i=n.length+1,null!=b&&(i+=1),e=function(){switch(b){case"General":return{n:"pGeneral",l:[0,0]};case"John":return{n:"pPilot",l:[0,4]}}}(),e&&(i=Math.max(4,i)),g=Crafty.e("2D, UILayerWebGL, Color, Tween, Dialog").attr({w:s,h:20*i,alpha:.7}).color("#000000").attr({x:t-10,y:d.bottom-20*i,z:100}),g.bind("Abort",function(){return h.resolve()}),f=e?100:0,null!=e&&(p=(q=Crafty.e("2D, UILayerWebGL, SpriteAnimation").addComponent(e.n)).sprite.apply(q,a.call(e.l).concat([4],[4])).attr({x:g.x+5,y:g.y-20,z:g.z+1,w:96,h:96}).reel("talk",400,[e.l,[e.l[0]+4,e.l[1]]]).animate("talk",6*n.length),g.attach(p),"none"!==d.noise&&null!=e&&(p.addComponent("Delay"),p.delay(function(){return p.attr({alpha:.6+.3*Math.random()})},150,-1))),o=15,null!=b&&(r=Crafty.e("2D, UILayerDOM, Text").attr({w:s-20,x:g.x+10+f,y:g.y+10,z:101,alpha:1}).text(b).textColor("#707070").textFont({size:"10px",weight:"bold",family:"Press Start 2P"}),g.attach(r),o=30),j=k=0,l=n.length;l>k;j=++k)m=n[j],g.attach(Crafty.e("2D, UILayerDOM, Text").attr({w:s-20,x:g.x+10+f,y:g.y+o+20*j,z:101}).text(m).textColor("#909090").textFont({size:"10px",weight:"bold",family:"Press Start 2P"}));return Crafty.e("Dialog, Delay").delay(function(){return h.resolve(),Crafty("Dialog").each(function(){return this.destroy()})},3e3*n.length,0),h.promise}}.call(this),function(){}.call(this),function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}},c=[].slice,d=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},e={}.hasOwnProperty;a=this.Game,a.LazerScript=function(){function a(a){this.level=a,this._endScriptOnGameOver=b(this._endScriptOnGameOver,this)}return a.prototype.run=function(){var a,b,d;return a=1<=arguments.length?c.call(arguments,0):[],this.currentSequence=Math.random(),this.options=null!=(d=a[0])?d:{},this.startAtCheckpoint=this.options.startAtCheckpoint,this.currentCheckpoint=0,b=WhenJS(!0),null!=this.assets&&(b=this.assets(this.options)(this.currentSequence)),b.then(function(b){return function(){return b.initialize.apply(b,a)}}(this))},a.prototype.end=function(){return this.currentSequence=null},a.prototype.initialize=function(){var a;return a=1<=arguments.length?c.call(arguments,0):[],Crafty.bind("PlayerDied",this._endScriptOnGameOver),WhenJS(this.execute.apply(this,a)(this.currentSequence))["finally"](function(a){return function(){return Crafty.unbind("PlayerDied",a._endScriptOnGameOver)}}(this))},a.prototype.execute=function(){},a.prototype._endScriptOnGameOver=function(){var a;return a=!1,Crafty("Player ControlScheme").each(function(){return this.lives>0?a=!0:void 0}),a?void 0:this.currentSequence=null},a}(),_.extend(a.LazerScript.prototype,a.ScriptModule.Core,a.ScriptModule.Level,a.ScriptModule.Colors,a.ScriptTemplate.Level),a.EntityScript=function(b){function e(){return e.__super__.constructor.apply(this,arguments)}return d(e,b),e.prototype.initialize=function(){var b,d,f;return b=1<=arguments.length?c.call(arguments,0):[],this.boundEvents=[],_.isEmpty(b)&&b.push({}),this.entity=this.spawn.apply(this,b),_.isObject(b[0])&&null!=b[0].identifier&&(d=b[0].identifier,this.entity.addComponent(d)),this.synchronizer=null!=(f=this.options.synchronizer)?f:new a.Synchronizer,this.synchronizer.registerEntity(this),null==this.entity?(this.synchronizer.unregisterEntity(this),WhenJS({alive:!1,killedAt:new Date,location:null})):(this.entity.has("PlayerControlledShip")||this.entity.attr({x:this.entity.x-Crafty.viewport.x,y:this.entity.y-Crafty.viewport.y}),this.entity.bind("Destroyed",function(a){return function(){return a.currentSequence=null,a.synchronizer.unregisterEntity(a),a.enemy.location.x=a.entity.x+Crafty.viewport.x,a.enemy.location.y=a.entity.y+Crafty.viewport.y,a.enemy.alive=!1,a.enemy.killedAt=new Date}}(this)),this.enemy={moveState:"air",alive:!0,location:{}},e.__super__.initialize.apply(this,arguments)["catch"](function(a){return function(b){if("sequence mismatch"!==b.message)throw b;return a.enemy.alive?a.alternatePath:void 0}}(this))["finally"](function(a){return function(){return a.enemy.alive&&!a.entity.has("KeepAlive")?a.entity.destroy():void 0}}(this)).then(function(a){return function(){return a.enemy}}(this)))},e.prototype.spawn=function(){},e}(a.LazerScript),_.extend(a.EntityScript.prototype,a.ScriptModule.Entity)}.call(this),function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}},c=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};a=this.Game,a.Level=function(){function a(a,c){this.generator=a,this.data=null!=c?c:{},this._waveTicks=b(this._waveTicks,this),this.blocks=[],this.bufferLength=3*Crafty.viewport.width,this.generationPosition={x:0,y:40},this.sceneryEvents=[],this.visibleHeight=Crafty.viewport.height-this.generationPosition.y,this.shipType="PlayerSpaceship",this.namespace=this.data.namespace,this.currentScenery=this.data.startScenery}return a.prototype.setScenery=function(a){return this._loadAssetsForScenery(a).then(function(b){return function(){return b.currentScenery=a,b._setupLevelScenery()}}(this))},a.prototype._loadAssetsForScenery=function(a){var b,c;return c=this.namespace+"."+a,b=this.generator.buildingBlocks[c],b.prototype.loadAssets().then(function(a){return function(){var c,d,e;return d=[],(e=b.prototype.autoPrevious)&&d.push(function(){return a._loadAssetsForScenery(e)}),(c=b.prototype.autoNext)&&d.push(function(){return a._loadAssetsForScenery(c)}),d.length>0?WhenJS.sequence(d):void 0}}(this))},a.prototype.start=function(){return this.active=!0,Crafty.viewport.x=0,Crafty.viewport.y=0,this._controlsEnabled=!0,this.setForcedSpeed(1),this.setWeaponsEnabled(!0),this._scrollWall=Crafty.e("ScrollWall").attr({x:0,y:0}),this._playersActive=!1,Crafty.bind("EnemySpawned",function(a){return function(){var b;return null==(b=a.data).enemiesSpawned&&(b.enemiesSpawned=0),a.data.enemiesSpawned+=1}}(this)),Crafty.e("2D, UILayerDOM, Text, LevelTitle").attr({w:250,h:20}).attr({x:Crafty.viewport.width-250,y:10,z:2}).textFont({size:"10px",family:"Press Start 2P"
}).textColor("#A0A0A0").text(""),this._setupLevelScenery(),Crafty.bind("PlayerDied",function(a){return function(){var b;return b=!1,Crafty("Player ControlScheme").each(function(){return this.lives>0?b=!0:void 0}),b?void 0:(a.stop(),Crafty.trigger("GameOver"))}}(this)),Crafty.bind("GameLoop",this._waveTicks)},a.prototype._waveTicks=function(a){var b,c,d,e;null==this._registeredWaveTweens&&(this._registeredWaveTweens={}),c=this._registeredWaveTweens,d=[];for(b in c)e=c[b],d.push(e.tick(a.dt));return d},a.prototype.registerWaveTween=function(a,b,c,d){var e;return null==this._registeredWaveTweens&&(this._registeredWaveTweens={}),null!=(e=this._registeredWaveTweens)[a]?e[a]:e[a]=new(function(){function a(a){var b,c;this.name=a.name,b=a.duration,c=a.easing,this.callback=a.callback,this.ease=new Crafty.easing(b,c),this.ease.repeat(3)}return a.prototype.tick=function(a){var b,c;return this.ease.tick(a),c=this.ease.value(),1===this.ease.loops&&this.ease.repeat(3),b=this.ease.loops%2===1,this.callback(c,b)},a}())({name:a,duration:b,easing:c,callback:d})},a.prototype._setupLevelScenery=function(){var a,b,c,d;if(null!=this.currentScenery&&0===this.blocks.length){for(this._placePlayerShips(),this._seedPreceedingGeometry(),this._update(),this.lastUpdate=Crafty.viewport._x+200,d=this.blocks,b=0,c=d.length;c>b;b++)a=d[b],a.x<640&&a.enter();return Crafty.bind("ViewportScroll",function(a){return function(){return a.lastUpdate-Crafty.viewport._x>=300?(a._update(),a.lastUpdate=Crafty.viewport._x):void 0}}(this)),Crafty.uniqueBind("LeaveBlock",function(a){return function(b){var c;return c=_.indexOf(a.blocks,b),c>0&&a._handleSceneryEvents(a.blocks[c-1],"leave"),a._handleSceneryEvents(b,"inScreen"),a._cleanupBuildBlocks()}}(this)),Crafty.uniqueBind("EnterBlock",function(a){return function(b){var c;return c=_.indexOf(a.blocks,b),c>0&&a._handleSceneryEvents(a.blocks[c-1],"outScreen"),a._handleSceneryEvents(b,"enter")}}(this)),Crafty.uniqueBind("PlayerEnterBlock",function(a){return function(b){var c;return c=_.indexOf(a.blocks,b),c>0&&a._handleSceneryEvents(a.blocks[c-1],"playerLeave"),a._handleSceneryEvents(b,"playerEnter")}}(this))}},a.prototype._handleSceneryEvents=function(a,b){var c,d,e,f,g;if(null!=a){for(a[b](),f=this.sceneryEvents,g=[],e=d=f.length-1;d>=0;e=d+=-1)c=f[e],a.name===this.namespace+"."+c.sceneryType&&b===c.eventType?(c.callback.apply(this),g.push(this.sceneryEvents.splice(e,1))):g.push(void 0);return g}},a.prototype.notifyScenery=function(a,b,c){return this.sceneryEvents.push({eventType:a,sceneryType:b,callback:c})},a.prototype._placePlayerShips=function(){var a,b;return a={spawnPosition:{x:100,y:200},spawnOffset:{x:-50,y:0},title:""},b=_.defaults(this.data,a),Crafty.one("ShipSpawned",function(a){return function(){return a._playersActive=!0,a._scrollWall.scrollWall(a._forcedSpeed)}}(this)),Crafty("Player").each(function(a){var c;return c=function(){var a;return a=_.clone(b.spawnPosition),Crafty("PlayerControlledShip").each(function(){return a.x=this.x+b.spawnOffset.x+Crafty.viewport.x,a.y=this.y+b.spawnOffset.y+Crafty.viewport.y}),a},this.addComponent("ShipSpawnable").spawnPosition(c),Crafty.e("PlayerInfo").playerInfo(30+a*(.3*Crafty.viewport.width),this)}),Crafty.bind("ShipSpawned",function(a){return function(b){var c,d,e,f,g,h;if(b.forcedSpeed(a._forcedSpeed,{accellerate:!1}),b.weaponsEnabled=a._weaponsEnabled[b.playerNumber],a._controlsEnabled||b.disableControl(),null!=a.playerStartWeapons){for(b.clearItems(),g=a.playerStartWeapons,h=[],c=0,f=g.length;f>c;c++)d=g[c],e=a.inventory(d),h.push(b.installItem(e));return h}}}(this)),Crafty("Player ControlScheme").each(function(){return this.spawnShip()})},a.prototype.inventory=function(a){return this.invItems||(this.invItems={}),this.invItems[a]},a.prototype.inventoryAdd=function(a,b,c){var d;return this.invItems||(this.invItems={}),(d=this.invItems)[b]||(d[b]=_.defaults(c,{type:a,contains:b}))},a.prototype.getShipType=function(){return this.shipType},a.prototype.setShipType=function(a){return this.shipType=a,Crafty("Player ControlScheme").each(function(){return null!=this.ship?this.spawnShip():void 0})},a.prototype.setForcedSpeed=function(a,b){var c,d,e;return b=_.defaults(b,{accellerate:!0}),c=this._forcedSpeed?(null!=(d=a.x)?d:a)-(null!=(e=this._forcedSpeed.x)?e:this._forcedSpeed):0,this._forcedSpeed=a,this._playersActive&&this._scrollWall.scrollWall(this._forcedSpeed,b),Crafty("Bullet").each(function(){return this.attr({speed:this.speed+c})}),Crafty("PlayerControlledShip").each(function(){return this.forcedSpeed(a,b)})},a.prototype.screenShake=function(a,b){return null==b&&(b={}),b=_.defaults(b,{duration:1e3}),this._scrollWall.screenShake(a,b.duration)},a.prototype.cameraPan=function(a){return null==a&&(a={}),a=_.defaults(a,{y:0,x:0,duration:1e3}),this._scrollWall.cameraPan(a)},a.prototype.setHeight=function(a){return this._scrollWall.setHeight(a),Crafty("PlayerControlledShip").each(function(){return this.y+=a})},a.prototype.setWeaponsEnabled=function(a,b){var d,e,f;for((null==b||_.isEmpty(b))&&(b=[1,2]),null==this._weaponsEnabled&&(this._weaponsEnabled={}),d=0,e=b.length;e>d;d++)f=b[d],this._weaponsEnabled[f]=a;return Crafty("PlayerControlledShip").each(function(){var d;return d=this.playerNumber,c.call(b,d)>=0?this.weaponsEnabled=a:void 0})},a.prototype.getComponentOffset=function(){return{x:this._scrollWall.x,y:this._scrollWall.y}},a.prototype.addComponent=function(a,b,c){var d,e,f;return null==c&&(c=null),d=this.blocks[null!=(f=this.currentBlockIndex)?f:0],null!=d?(null==c&&(c=this.getComponentOffset()),e={x:b.x+c.x-d.x,y:b.y+c.y-d.y},d.add(e.x,e.y,a)):void 0},a.prototype.stop=function(){var a,b,c,d,e;for(this.active=!1,Crafty.unbind("LeaveBlock"),Crafty.unbind("EnterBlock"),Crafty.unbind("ShipSpawned"),Crafty.unbind("ViewportScroll"),Crafty.unbind("GameLoop",this._waveTicks),d=this.blocks,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(null!=a?a.clean():void 0);return e},a.prototype.verify=function(){if(!this.active)throw new Error("sequence mismatch")},a.prototype._update=function(){var a,b,c,d,e;for(e=-Crafty.viewport._x,b=e+this.bufferLength,a=0,c=10,d=[];this.generationPosition.x<b&&c>a;)this._generateLevel(),d.push(a+=1);return d},a.prototype._generateLevel=function(){var a,b,c;return b=this.namespace+"."+this.currentScenery,this._addBlockToLevel(b,{}),a=this.generator.buildingBlocks[b],(c=a.prototype.autoNext)?this.currentScenery=c:void 0},a.prototype._addBlockToLevel=function(a,b){var c,d;return d=this.generator.buildingBlocks[a],c=new d(this,this.generator,b),this.blocks.push(c),c.build(this.generationPosition),this.generationPosition={x:c.x+c.delta.x,y:c.y+c.delta.y}},a.prototype._insertBlockToLevel=function(a,b){var c,d;if(d=this.generator.buildingBlocks[a],null==d)throw new Error(a+" not found");return c=new d(this,this.generator,b),this.blocks.unshift(c),this.generationPosition={x:this.generationPosition.x-c.delta.x,y:this.generationPosition.y-c.delta.y},c.build(this.generationPosition)},a.prototype._cleanupBuildBlocks=function(){var a,b;for(a=this.blocks[0],b=[];a.canCleanup();)this.blocks.shift().clean(),b.push(a=this.blocks[0]);return b},a.prototype._seedPreceedingGeometry=function(){var a,b,c,d,e;return b=this.namespace+"."+this.currentScenery,a=this.generator.buildingBlocks[b],(c=a.prototype.autoNext)&&(b=this.namespace+"."+c),(e=a.prototype.autoPrevious)&&(b=this.namespace+"."+e),d=_.clone(this.generationPosition),this._insertBlockToLevel(b,{}),this._insertBlockToLevel(b,{}),this._insertBlockToLevel(b,{}),this.generationPosition=d},a.prototype.loadAssets=function(a){return this.generator.loadAssets(a)},a.prototype.setStartWeapons=function(a){this.playerStartWeapons=a},a}()}.call(this),function(){var a,b=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};a=this.Game,a.LevelGenerator=function(){function c(){this.buildingBlocks={},this.elements={},this.assets={}}return c.prototype.defineBlock=function(a){return this.buildingBlocks[a.prototype.name]=a},c.prototype.defineElement=function(a,b){return this.elements[a]=b},c.prototype.defineAssets=function(a,b){return this.assets[a]=b},c.prototype.loadAssets=function(a){var b,c;return c=function(){var c,d,e;for(e=[],c=0,d=a.length;d>c;c++)b=a[c],e.push(this._loadAssetMap(b));return e}.call(this),WhenJS.all(c)},c.prototype._loadAssetMap=function(a){var c,d,e,f,g,h,i,j,k,l,m;null==this.entityAssets&&(this.entityAssets={}),c=null,e=null,l=this.assets;for(d in l)j=l[d],b.call(j.contents,a)>=0&&(c=d,e=j);if(!c)throw new Error("no asset map defined for "+a);return this.entityAssets[c]?this.entityAssets[c].promise:(f=WhenJS.defer(),this.entityAssets[c]={assets:e,promise:f.promise},m=e.spriteMap,k=function(){var a,b;a=e.sprites,b=[];for(h in a)g=a[h],i={sprites:{}},i.sprites[m]=g,b.push(i);return b}(),k[0].audio=e.audio,Crafty.load(k.pop(),function(){for(var a,b;k.length>0;)a=k.pop().sprites[m],b=Crafty.paths().images+m,Crafty.sprite(a.tile,a.tileh,b,a.map,a.paddingX,a.paddingY,a.paddingAroundBorder);return f.resolve()}),f.promise)},c.prototype.createLevel=function(b){return null==b&&(b={namespace:"City"}),new a.Level(this,b)},c}(),a.levelGenerator=new a.LevelGenerator}.call(this),function(){var a,b=[].slice;a=this.Game,a.LevelScenery=function(){function a(a,b,c){this.level=a,this.generator=b,this.settings=c,this.createdElements=[],this.createdBindings=[]}return a.prototype.screenHeight=480,a.prototype.loadAssets=function(){var a,b;return b="function"==typeof this.assets?this.assets():void 0,null==b?WhenJS():(a=WhenJS.defer(),Crafty.load(b,function(b){return function(){return a.resolve()}}(this)),a.promise)},a.prototype.build=function(a){return this.generated?void 0:(null==this.x&&(this.x=a.x),null==this.y&&(this.y=a.y),this.generated=!0,this.generate(),this._notifyEnterFunction(this.notifyOffsetX))},a.prototype._notifyEnterFunction=function(a){var b;return null==a&&(a=0),b=this,Crafty.e("2D, Collision").attr({x:this.x+a,y:this.y,w:10,h:800}).onHit("ScrollFront",function(){return this.triggeredFront?void 0:(Crafty.trigger("EnterBlock",b),this.triggeredFront=!0)}).onHit("PlayerControlledShip",function(){return this.triggeredPlayerFront?void 0:(Crafty.trigger("PlayerEnterBlock",b),this.triggeredPlayerFront=!0)}).onHit("ScrollWall",function(){return Crafty.trigger("LeaveBlock",b),this.destroy()})},a.prototype.generate=function(){var a;return null!=(a=this.settings.generate)?a.apply(this):void 0},a.prototype.enter=function(){var a;return null!=(a=this.settings.enter)?a.apply(this):void 0},a.prototype.playerEnter=function(){var a;return null!=(a=this.settings.playerEnter)?a.apply(this):void 0},a.prototype.playerLeave=function(){var a;return null!=(a=this.settings.playerLeave)?a.apply(this):void 0},a.prototype.inScreen=function(){var a;return null!=(a=this.settings.inScreen)?a.apply(this):void 0},a.prototype.outScreen=function(){var a;return null!=(a=this.settings.outScreen)?a.apply(this):void 0},a.prototype.leave=function(){var a;return null!=(a=this.settings.leave)?a.apply(this):void 0},a.prototype.clean=function(){var a,b,c,d,e,f,g,h;for(g=this.createdElements,c=0,e=g.length;e>c;c++)b=g[c],b.destroy();for(this.createdElements=[],h=this.createdBindings,d=0,f=h.length;f>d;d++)a=h[d],Crafty.unbind(a.event,a.callback);return this.createdBindings=[]},a.prototype.add=function(a,b,c){return c.attr({x:this.x+a,y:this.y+b}),this.createdElements.push(c)},a.prototype.addBackground=function(a,b,c,d){return c.addComponent("ViewportRelativeMotion").viewportRelativeMotion({x:this.x+a,y:this.y+b,speed:d}),this.createdElements.push(c)},a.prototype.addElement=function(){var a,c;return c=arguments[0],a=2<=arguments.length?b.call(arguments,1):[],this.generator.elements[c].apply(this,a)},a.prototype.bind=function(a,b,c){return _.isFunction(b)&&void 0===c&&(c=b,b={}),this.createdBindings.push({event:a,callback:c}),b.once===!0?Crafty.one(a,c):Crafty.bind(a,c)},a.prototype.unbind=function(a){var c,d,e,f,g;for(g=[],f=this.createdBindings,d=0,e=f.length;e>d;d++)c=f[d],c.event===a&&(g.push(c),Crafty.unbind(c.event,c.callback));return this.createdBindings=_.without.apply(_,[this.createdBindings].concat(b.call(g)))},a.prototype.canCleanup=function(){var a,b,c,d,e;if(a=-1*Crafty.viewport._x,this.x+this.delta.x>a)return!1;for(e=this.createdElements,c=0,d=e.length;d>c;c++)if(b=e[c],b.x+b.w>=a)return!1;return!0},a}()}.call(this),function(){var a;a=this.Game,a.LocationGrid=function(){function a(a){var b,c,d,e,f,g,h,i,j,k,l;for(a=_.defaults(a,{x:{},y:{}}),a.x=_.defaults(a.x,{start:0,steps:1,stepSize:1}),a.y=_.defaults(a.y,{start:0,steps:1,stepSize:1}),i=this._coordList(a.x),l=this._coordList(a.y),b=[],c=0,e=l.length;e>c;c++)for(j=l[c],d=0,f=i.length;f>d;d++)g=i[d],h=(g-a.x.start)/(a.x.stepSize*a.x.steps),k=(j-a.y.start)/(a.y.stepSize*a.y.steps),b.push({x:g,y:j,xPerc:h,yPerc:k});this.freeCoords=_.shuffle(b)}return a.prototype._coordList=function(a){var b,c,d,e;for(e=[],b=c=0,d=a.steps;d>=0?d>c:c>d;b=d>=0?++c:--c)e.push(a.start+b*a.stepSize);return e},a.prototype.getLocation=function(){return this.freeCoords.pop()},a}()}.call(this),function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}};a=this.Game,a.PauseMenu=function(){function c(){this._handleFire=b(this._handleFire,this),this._handleDown=b(this._handleDown,this),this._handleUp=b(this._handleUp,this),Crafty.bind("GamePause",function(a){return function(b){return b?(a.createMenu(),a.showPlayers()):a.remove()}}(this))}return c.prototype.createMenu=function(){return this._buildMenu([{text:"Resume",execute:function(){return a.togglePause()}},{text:function(){return Crafty.audio.muted?"Sound [off]":"Sound [on]"},execute:function(){return Crafty.audio.toggleMute(),a.changeSettings({sound:!Crafty.audio.muted})}},{text:"Restart",execute:function(){return a.togglePause(),a.resetCredits(),Crafty("Player").each(function(){return this.softReset()}),Crafty.enterScene(a.firstLevel)}},{text:"Quit",execute:function(){return a.togglePause(),Crafty("Player").each(function(){return this.reset()}),Crafty.enterScene("Intro")}}])},c.prototype._buildMenu=function(a){var b,c,d,e,f,g,h,i,j,k;for(this.options=a,e=Crafty.e("2D, DOM, Color, PauseMenu").attr({x:-Crafty.viewport.x+.35*Crafty.viewport.width,y:.3*Crafty.viewport.height-Crafty.viewport.y,w:.3*Crafty.viewport.width,h:32*(this.options.length+2),z:100,alpha:.5}).color("#000000"),k=Crafty.e("2D, DOM, Text").attr({x:e.x,y:e.y+20,w:e.w,z:110}).text("Game Paused").textColor("#D0D0D0").textAlign("center").textFont({size:"15px",weight:"bold",family:"Press Start 2P"}),e.attach(k),h=this.options,b=c=0,d=h.length;d>c;b=++c)g=h[b],f=Crafty.e("2D, DOM, Text").attr({x:e.x+60,y:e.y+50+35*b,w:e.w-60,z:110}).text(null!=(i="function"==typeof g.text?g.text():void 0)?i:g.text).textColor("#D0D0D0").textAlign("left").textFont({size:"15px",weight:"bold",family:"Press Start 2P"}),e.attach(f),g.entity=f;return this.selected=0,this.selectionChar=Crafty.e("2D, DOM, Text").attr({x:e.x+20,w:40,z:110}).text(">").textColor("#0000FF").textAlign("left").textFont({size:"15px",weight:"bold",family:"Press Start 2P"}),e.attach(this.selectionChar),this.updateSelection(),j=this,Crafty("Player").each(function(){return this.bind("Up",j._handleUp),this.bind("Down",j._handleDown),this.bind("Fire",j._handleFire)})},c.prototype._handleUp=function(){return this.selected=(this.options.length+this.selected-1)%this.options.length,this.updateSelection()},c.prototype._handleDown=function(){return this.selected=(this.options.length+this.selected+1)%this.options.length,this.updateSelection()},c.prototype.updateSelection=function(){return this.selectionChar.attr({y:this.options[this.selected].entity.y})},c.prototype._handleFire=function(){return setTimeout(function(a){return function(){var b,c;return c=a.options[a.selected],c.execute(),c.entity.text(null!=(b="function"==typeof c.text?c.text():void 0)?b:c.text)}}(this))},c.prototype.showPlayers=function(){return Crafty("Player").each(function(){var a,b,c,d,e,f,g,h,i,j,k,l;if(this.ship){for(l=.05,2===this.playerNumber&&(l=.7),"function"==typeof(a=Crafty.e("2D, WebGL, playerShip, ColorEffects, PauseMenu").attr({w:71,h:45,x:-Crafty.viewport.x+(l+.07)*Crafty.viewport.width,y:.3*Crafty.viewport.height-Crafty.viewport.y+20,z:101}).flip("X")).colorOverride&&a.colorOverride(this.color(),"partial"),j=["Score: "+this.points,"Lives: "+(this.lives-1),"","&nbsp;&nbsp; Speed: &nbsp;&nbsp;&nbsp;&nbsp;+"+this.ship.primaryWeapon.stats.speed,"&nbsp;&nbsp; RapidFire: +"+this.ship.primaryWeapon.stats.rapid,"&nbsp;&nbsp; AimAssist: +"+this.ship.primaryWeapon.stats.aim,"&nbsp;&nbsp; Damage: &nbsp;&nbsp;&nbsp;+"+this.ship.primaryWeapon.stats.damage],k=Crafty.e("2D, WebGL, Color, PauseMenu").attr({x:-Crafty.viewport.x+l*Crafty.viewport.width,y:.3*Crafty.viewport.height-Crafty.viewport.y,w:.25*Crafty.viewport.width,h:20*(j.length+5),z:100,alpha:.3}).color("#000"),g=[],b=d=0,e=j.length;e>d;b=++d)f=j[b],i=Crafty.e("2D, DOM, Text").attr({x:k.x+20,y:k.y+85+20*b,w:k.w-60,z:110}).text(f).textColor("#D0D0D0").textAlign("left").textFont({size:"8px",weight:"bold",family:"Press Start 2P"}),k.attach(i),b>2&&7>b?(h=["speedBoost","rapidFireBoost","aimBoost","damageBoost"],c=Crafty.e("2D, WebGL, ColorEffects, PauseMenu").addComponent(h[b-3]).attr({x:k.x+20,y:k.y+82+20*b,w:12,h:12,z:110}).colorOverride("white","partial"),g.push(k.attach(c))):g.push(void 0);return g}})},c.prototype.remove=function(){var a;return a=this,Crafty("Player").each(function(){return this.unbind("Up",a._handleUp),this.unbind("Down",a._handleDown),this.unbind("Fire",a._handleFire)}),Crafty("PauseMenu").each(function(){return this.destroy()})},c}()}.call(this),function(){var a,b=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};a=this.Game,a.Synchronizer=function(){function a(){this.entities=[],this.synchronizations={},this.onceTriggers=[]}return a.prototype.registerEntity=function(a){return b.call(this.entities,a)<0&&this.entities.push(a),a},a.prototype.unregisterEntity=function(a){var b;return b=_.indexOf(this.entities,a),b>=0&&this.entities.splice(b,1),this._verifyActiveSynchronisations(),a},a.prototype.synchronizeOn=function(a,c){var d;return d=this.synchronizations[a],d||(d={defer:WhenJS.defer(),registered:[]},this.synchronizations[a]=d),b.call(d.registered,c)<0&&d.registered.push(c),0===_.difference(this.entities,d.registered).length&&d.defer.resolve(),d.defer.promise},a.prototype.allowOnce=function(a){return-1===this.onceTriggers.indexOf(a)?(this.onceTriggers.push(a),!0):!1},a.prototype._verifyActiveSynchronisations=function(){var a,b,c,d;b=this.synchronizations,c=[];for(a in b)d=b[a],0===_.difference(this.entities,d.registered).length?c.push(d.defer.resolve()):c.push(void 0);return c},a}()}.call(this)}(),function(){(function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.Lunch=function(c){function d(){return d.__super__.constructor.apply(this,arguments)}return b(d,c),d.prototype.assets=function(){return this.loadAssets("explosion","playerShip")},d.prototype.execute=function(){return this.inventoryAdd("weapon","oldlasers",{marking:"L"}),this.inventoryAdd("weapon","lasers",{marking:"L"}),this.inventoryAdd("ship","points",{marking:"P",icon:"star"}),this.inventoryAdd("ship","xp",{marking:"XP",icon:"star"}),a.explosionMode="block",this.sequence(function(a){return function(){return Crafty.audio.mute()}}(this),this.setShipType("PlayerControlledCube"),this.setScenery("Blackness"),this.hideHud({duration:0}),this.setWeapons([]),this.enableWeapons(),this.nextSlide(),this.setWeapons(["oldlasers"]),this.nextSlide(),this.updateTitle("First enemy"),this.placeSquad(a.Scripts.Slider,{options:{gridConfig:{x:{start:1.1},y:{start:.5}}}}),this.showHud(),this.updateTitle("2 Players"),this.nextSlide(),this.updateTitle("More enemies"),this.setScenery("OpenSpace"),this.setSpeed(150,{accellerate:!1}),this.parallel(this.placeSquad(a.Scripts.Slider,{amount:15,options:{gridConfig:{x:{start:1.2,steps:4,stepSize:.2},y:{start:.2,steps:5,stepSize:.1}}}}),this.sequence(this.waitForScenery("OpenSpace"),this.setSpeed(0,{accellerate:!1}))),this.nextSlide(),this.updateTitle("Level geometry"),this.setSpeed(50,{accellerate:!1}),this.nextSlide(),this.updateTitle("Speed and collision"),this.setSpeed(250,{accellerate:!1}),this.nextSlide(),this.updateTitle("Backgrounds"),this.checkpoint(this.setScenery("OpenSpace")),this.setScenery("TunnelStart"),this.waitForScenery("TunnelStart"),this.setSpeed(50,{accellerate:!1}),this.nextSlide(),this.updateTitle("Dialog"),this.say("SpeedLazer","Hello World!"),this.say("SpeedLazer","Flavor text can add to story telling"),this.nextSlide(),this.parallel(this.sequence(this.wait(3e3),this.say("Enemies","Get them!")),this.nextSlide(this.sequence(this.placeSquad(a.Scripts.Slider,{amount:5,options:{gridConfig:{x:{start:1.2,steps:4,stepSize:.2},y:{start:.3,steps:5,stepSize:.1}}}}),this.wait(3e3)))),this.updateTitle("Enemy choreo start"),this.nextSlide(this.sequence(this.placeSquad(a.Scripts.Sine,{amount:5,delay:1e3}),this.wait(3e3))),this.updateTitle("Start stage 1"),this.setScenery("TunnelEnd"),this.setSpeed(450,{accellerate:!1}),this.waitForScenery("OceanOld",{event:"leave"}),this.setSpeed(50,{accellerate:!1}),this.checkpoint(this.setScenery("OceanOld")),this.nextSlide(),this.updateTitle("Bezier, powerups"),this.nextSlide(this.sequence(this.placeSquad(a.Scripts.PresentationSwirler,{drop:"xp",amount:4,delay:500}),this.waitForScenery("OceanOld"))),this.updateTitle("Lazerscript environment"),this.nextSlide(this.placeSquad(a.Scripts.PresentationSwirler,{drop:"xp",amount:3,delay:500})),this.nextSlide(this.parallel(this.placeSquad(a.Scripts.PresentationShooter,{drop:"xp",amount:3,delay:600}),this.placeSquad(a.Scripts.PresentationSwirler,{amount:3,delay:500}))),this.checkpoint(this.setScenery("OceanOld")),this.updateTitle("Lazerscript enemies"),this.disableWeapons(),this.placeSquad(a.Scripts.LittleDancer,{amount:5,delay:2e3,options:{gridConfig:{x:{start:.25,steps:5,stepSize:.1}}}}),this.enableWeapons(),this.updateTitle("Particle effects"),function(b){return function(){return a.explosionMode="particles"}}(this),function(b){return function(){return a.webGLMode=!1}}(this),this.checkpoint(this.setScenery("OceanOld")),this.setScenery("OceanToNew"),this.async(this.runScript(a.Scripts.PresentationSunRise,{skipTo:0,speed:10})),this.repeat(4,this.sequence(this.placeSquad(a.Scripts.PresentationSwirler,{drop:"xp",amount:6,delay:700}))),function(b){return function(){return a.explosionMode=null}}(this),this.updateTitle("Graphics!"),this.swirlAttacks(),this.swirlAttacks(),this.setScenery("CoastStart"),this.nextSlide(this.sequence(this.mineSwarm({juice:!1}))),this.checkpoint(this.sunriseCheckpoint(a.Scripts.PresentationSunRise,9e4,10,"CoastStart")),this.parallel(this.runScript(a.Scripts.PresentationSunSet,{skipTo:0,speed:50}),this.sequence(this.say("Graphics","Ok lets do the sunrise again"),this.say("Graphics","And now use WebGL Shaders"))),this.say("WebGL","Ready?"),this.say("WebGL","Really ready?"),function(b){return function(){return a.webGLMode=!0,Crafty("GoldenStripe").each(function(){return this.bottomColor("#DDDD00",0)}),Crafty("waterMiddle").each(function(){return this.attr({lightness:1})}),Crafty("waterHorizon").each(function(){return this.attr({lightness:1})})}}(this),this.chapterTitle(1,"WebGL Shaders"),this.async(this.runScript(a.Scripts.SunRise,{skipTo:0,speed:2})),this.setScenery("BayStart"),this.nextSlide(this.sequence(this.swirlAttacks2())),this.disableWeapons(1),this.say("Player 1","Help I have a weapon malfunction!!"),this.say("Player 2","No worries, I will fight for you!"),this.chapterTitle(2,"Juice"),this.nextSlide(this.sequence(this.swirlAttacks2())),this.setWeapons(["lasers"]),this.say("Player 2","Woohoo Autofire! I will save you buddy!"),this.setSpeed(100,{accellerate:!0}),this.swirlAttacks2({juice:!0}),this.enableWeapons(),this.say("Player 1","My weapon works again! I seemed I was pressing the\nwrong button all this time!"),this.say("Player 2","Sigh..."),this.setSpeed(150,{accellerate:!0}),this.nextSlide(this.mineSwarm({juice:!0})),this.chapterTitle(3,"Minimal viable audio"),this.wait(1e3),function(a){return function(){return Crafty.audio.unmute()}}(this),this.nextSlide(this.mineSwarm({juice:!0})),this.nextSlide(this.placeSquad(a.Scripts.Swirler,{amount:4,delay:500,drop:"xp",options:{juice:!0}})),this.checkpoint(this.sunriseCheckpoint(a.Scripts.SunRise,12e4,2,"Bay")),this.setScenery("UnderBridge"),this.updateTitle("Player ship"),this.setWeapons(["lasers"]),this.setShipType("PlayerSpaceship"),this.setWeapons(["lasers"]),this["while"](this.waitForScenery("UnderBridge",{event:"enter"}),this.placeSquad(a.Scripts.Swirler,{amount:4,delay:500,drop:"xp",options:{juice:!0}})),this.setSpeed(50,{accellerate:!0}),this.waitForScenery("UnderBridge",{event:"inScreen"}),this.checkpoint(this.sunriseCheckpoint(a.Scripts.SunRise,14e4,2,"UnderBridge")),this.setSpeed(0),this.nextSlide(),this.chapterTitle(4,"Bossfight!"),this.placeSquad(a.Scripts.LunchBossStage1),this.checkpoint(this.parallel(this.async(this.runScript(a.Scripts.SunRise,{skipTo:45e4,speed:2})),this.setScenery("Skyline"),this.gainHeight(600,{duration:0}),this.setSpeed(150))),this.wait(5e3),this.parallel(this.sequence(this.disableControls(),this.disableWeapons(),this.placeSquad(a.Scripts.PresentationLeaveScreen,{amount:2,delay:1e3})),this.sequence(this.say("With the evil boss destroyed\nMankind was saved again!"),this.say("And our heroes where off to another adventure!"),this.say("Thanks for playing!"))),this.screenFadeOut(),this.endGame())},d.prototype.nextSlide=function(a){return this.sequence(this["while"](this._waitForKeyPress(Crafty.keys.N),this.sequence(null!=a?a:this.wait(1e3),this._addVisibleMarker())))},d.prototype._addVisibleMarker=function(){return function(a){return function(){var a;return a="",Crafty("LevelTitle").each(function(){return a=this._text}),"-"===a[a.length-1]&&(a=a.slice(0,a.length-2)),"*"!==a[a.length-1]?Crafty("LevelTitle").text(a+" *"):void 0}}(this)},d.prototype._clearVisibleMarker=function(){var a;return a="",Crafty("LevelTitle").each(function(){return a=this._text}),"*"===a[a.length-1]?Crafty("LevelTitle").text(a.slice(0,a.length-2)+" -"):void 0},d.prototype._waitForKeyPress=function(a){return function(b){return function(){var c,d;return c=WhenJS.defer(),d=function(e){return e.key===a?(b._clearVisibleMarker(),Crafty.unbind("KeyDown",d),c.resolve()):void 0},Crafty.bind("KeyDown",d),c.promise}}(this)},d.prototype.mineSwarm=function(b){return null==b&&(b={}),b=_.defaults(b,{direction:"right",juice:!0}),this.placeSquad(a.Scripts.JumpMine,{amount:8,delay:300,options:{juice:b.juice,gridConfig:{x:{start:200,steps:10,stepSize:40},y:{start:60,steps:8,stepSize:40}},direction:b.direction}})},d.prototype.swirlAttacks=function(){return this.parallel(this.repeat(2,this.placeSquad(a.Scripts.PresentationSwirler,{amount:4,delay:500,drop:"xp"})),this.repeat(2,this.placeSquad(a.Scripts.PresentationShooter,{amount:4,delay:500,drop:"xp"})))},d.prototype.swirlAttacks2=function(b){return null==b&&(b={juice:!1}),this.parallel(this.repeat(2,this.placeSquad(a.Scripts.Swirler,{amount:4,delay:500,drop:"xp",options:b})),this.repeat(2,this.placeSquad(a.Scripts.Shooter,{amount:4,delay:500,drop:"xp",options:b})))},d.prototype.sunriseCheckpoint=function(a,b,c,d){return this.sequence(this.async(this.runScript(a,{skipTo:b,speed:c})),this.setScenery(d),this.wait(2e3))},d}(a.LazerScript)}).call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.LittleDancer=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.spawn=function(a){return this.wallTarget=a.grid.getLocation(),this.index=Math.round((this.wallTarget.x-.25)/.1),Crafty.e("OldDrone").drone({health:1900,x:Crafty.viewport.width+40,y:.56*Crafty.viewport.height,defaultSpeed:200})},c.prototype.execute=function(){return this.sequence(this["if"](function(a){return function(){return 0===a.index}}(this),this.say("Enemy squad","Welcome to our little dance!")),this.moveTo({x:this.wallTarget.x,speed:400}),this.synchronizeOn("placed"),this.moveTo({x:this.wallTarget.x+.05}),this.moveTo({y:305}),this.repeat(2,this.sequence(this.moveTo({x:this.wallTarget.x+.1}),this.wait(500),this.moveTo({x:this.wallTarget.x+.05}),this.wait(500))),this.wait(500*this.index),this.moveTo({y:.4}),this.wait(100),this.moveTo({y:1.1}),this.wait(100),this.moveTo({y:.65}),this.synchronizeOn("afterJump"),this.moveTo({x:.45}),this.movePath([[.3,.5],[.7,.43],[.3,.2]],{speed:200}),this.rotate(0,100),this["if"](function(a){return function(){return 0===a.index}}(this),this.moveTo({x:.25,y:.25,speed:400})),this["if"](function(a){return function(){return 1===a.index}}(this),this.moveTo({x:.75,y:.25,speed:400})),this["if"](function(a){return function(){return 2===a.index}}(this),this.moveTo({x:.75,y:.75,speed:400})),this["if"](function(a){return function(){return 3===a.index}}(this),this.moveTo({x:.25,y:.75,speed:400})),this["if"](function(a){return function(){return 4===a.index}}(this),this.moveTo({x:.5,y:.5,speed:400})),this.synchronizeOn("detonation"),this.wait(1e3),this.oldExplosion(this.location({offsetX:20,offsetY:20}),{radius:40}))},c}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.LunchBoss=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.assets=function(){return this.loadAssets("largeDrone")},c.prototype.smoke=function(a){var b;return null==a&&(a="heavy"),b={heavy:{alpha:.8,wait:40},medium:{alpha:.6,wait:80},light:{alpha:.4,wait:140}}[a],this.sequence(this.blast(this.location(),function(a){return function(){return{radius:10,duration:480,z:a.entity.z-3,alpha:b.alpha,lightness:1}}}(this),function(){return{rotation:this.rotation+1,alpha:Math.max(0,this.alpha-.003),lightness:function(){return Math.max(.2,this.lightness-.05)},y:this.y-2*Math.random()}}),this.wait(function(){return b.wait+50*Math.random()}))},c}(a.EntityScript),a.Scripts.LunchBossStage1=function(c){function d(){return d.__super__.constructor.apply(this,arguments)}return b(d,c),d.prototype.spawn=function(){return Crafty.e("LargeDrone, Horizon").drone({x:Crafty.viewport.width+40,y:.35*Crafty.viewport.height,defaultSpeed:100,health:45e3,pointsOnHit:10})},d.prototype.execute=function(){return this.bindSequence("Hit",this.fase2,function(a){return function(){return a.entity.healthBelow(.8)}}(this)),this.sequence(this.setScenery("UnderBridge"),this.invincible(!0),this.animate("slow",-1,"eye"),this.disableWeapons(),this.moveTo({x:.75,y:.41}),this.say("Drone Commander","We have control now! You will suffer!"),this.say("Drone Commander","Earths defences are in our hands!"),this.laugh(),this.invincible(!1),this.enableWeapons(),this.async(this.placeSquad(a.Scripts.Stage1BossRocket,{options:{location:this.location(),pointsOnDestroy:0,pointsOnHit:0}})),this.animate("emptyWing",0,"wing"),this.animate("reload",0,"wing"),this.moveTo({y:.43,speed:50}),this.repeat(this.attackCycle(25)))},d.prototype.attackCycle=function(b){return this.sequence(this.async(this.runScript(a.Scripts.Stage1BossMine,this.location())),this.moveTo({y:.36,easing:"easeInOutQuad",speed:b}),this.wait(200),this.async(this.placeSquad(a.Scripts.Stage1BossRocket,{options:{location:this.location(),pointsOnDestroy:0,pointsOnHit:0}})),this.animate("emptyWing",0,"wing"),this.animate("reload",0,"wing"),this.async(this.runScript(a.Scripts.Stage1BossMine,this.location())),this.moveTo({
y:.58,easing:"easeInOutQuad",speed:b}),this.async(this.placeSquad(a.Scripts.Stage1BossRocket,{options:{location:this.location(),pointsOnDestroy:0,pointsOnHit:0}})),this.animate("emptyWing",0,"wing"),this.wait(200),this.animate("reload",0,"wing"))},d.prototype.fase2=function(){return this.bindSequence("Hit",this.fase3,function(a){return function(){return a.entity.healthBelow(.5)}}(this)),this.sequence(this.setSpeed(75),this.bombRaid(!0),this.repeat(this.sequence(this.repeat(3,this.attackCycle(50)),this.laugh(),this.async(this.placeSquad(a.Scripts.Stage1BossDroneRaid,{amount:6,delay:300,options:{shootOnSight:!0}})),this.laugh())))},d.prototype.fase3=function(){return this.bindSequence("Hit",this.dramaDeath,function(a){return function(){return a.entity.healthBelow(.2)}}(this)),this.sequence(this.setSpeed(150),this.bombRaid(!0),this.parallel(this.sequence(this.setScenery("Skyline"),this.gainHeight(300,{duration:4e3})),this.repeat(this.sequence(this.repeat(2,this.attackCycleAir()),this.airBashAttack()))))},d.prototype.attackCycleAir=function(){return this.repeat(5,this.sequence(this.async(this.placeSquad(a.Scripts.Stage1BossHomingRocket,{options:{z:5,offsetY:100,location:this.location()}})),this.animate("emptyWing",0,"wing"),this.async(this.placeSquad(a.Scripts.Stage1BossHomingRocket,{options:{z:-5,offsetY:-100,location:this.location()}})),this.parallel(this.moveTo(this.targetLocation({offsetY:-20}),{x:.845}),this.sequence(this.animate("reload",0,"wing"),this.wait(1e3)))))},d.prototype.airBashAttack=function(){return this.sequence(this.moveTo({y:.5,x:.95,speed:100},"easeInOutQuad"),this.async(this.placeSquad(a.Scripts.LunchBossMineField,{amount:20,delay:50,options:{location:this.location(),gridConfig:{x:{start:.1,steps:12,stepSize:.075},y:{start:.1,steps:5,stepSize:.075}}}})),this.async(this.placeSquad(a.Scripts.LunchBossMineField,{amount:20,delay:50,options:{location:this.location(),gridConfig:{x:{start:.1,steps:12,stepSize:.075},y:{start:.7,steps:5,stepSize:.075}}}})),this.wait(3e3),this.invincible(!0),this["while"](this.moveTo({x:-.15,speed:500,easing:"easeInOutQuad"}),this.sequence(this.smallExplosion(),this["while"](this.wait(300),this.smoke()))),this.turnAround(),this.sendToBackground(.7,-150),this["while"](this.moveTo({x:1.1,speed:300}),this.smoke("light")),this.invincible(!1),this.turnAround(),this.scale(1,{duration:0}),this.reveal(),this.moveTo({x:.85,y:.41,speed:200}))},d.prototype.dramaDeath=function(){return this.sequence(function(a){return function(){return a.entity.colorOverride("#FF8080")}}(this),this.invincible(!0),this.parallel(this.gainHeight(300,{duration:4e3}),this.say("Drone Commander","You will never stop us!!"),this["while"](this.moveTo({x:.5,y:.4,speed:100}),this.sequence(this.smallExplosion(),this["while"](this.wait(300),this.smoke())))),this.bigExplosion(),this.wait(50),this.bigExplosion(),this.bigExplosion(),this.wait(500),function(a){return function(){return Crafty("RiggedExplosion").trigger("BigExplosion")}}(this),this.explosionBurst(100),this.bigExplosion(),this.explosionBurst(200),this.bigExplosion(),this.explosionBurst(300),this.explosionBurst(30),function(a){return function(){return a.entity.colorOverride("#403030")}}(this),this.parallel(this.moveTo({y:1.1,speed:300,easing:"easeInOutQuad"}),this.rotate(180,1e3)))},d.prototype.explosionBurst=function(a){return this.parallel(this.bigExplosion({offsetX:a,offsetY:a}),this.bigExplosion({offsetX:-a,offsetY:a}),this.bigExplosion({offsetX:a,offsetY:-a}),this.bigExplosion({offsetX:-a,offsetY:-a}))},d.prototype.laugh=function(){return this.sequence(function(a){return function(){return Crafty.audio.play("laugh")}}(this),this.repeat(5,this.sequence(this.rotate(10,200),this.rotate(-10,200))),this.rotate(0,200))},d.prototype.bombRaid=function(b){return null==b&&(b=!1),this.sequence(this.invincible(!0),this.moveTo({y:.1}),this["while"](this.moveTo({x:-100,speed:200}),this.sequence(this.async(this.placeSquad(a.Scripts.Stage1BossBombRaid,{options:{location:this.location(),armed:!1}})),this.wait(500))),this.turnAround(),this["while"](this.moveTo({x:1,speed:200}),this.sequence(this.async(this.placeSquad(a.Scripts.Stage1BossBombRaid,{options:{location:this.location(),armed:b}})),this.wait(500))),this.moveTo({x:1.2,speed:200}),this.turnAround(),this.moveTo({x:.85,y:.41,speed:200}),this.invincible(!1))},d}(a.Scripts.LunchBoss),a.Scripts.LunchBossMineField=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.assets=function(){return this.loadAssets("mine")},c.prototype.spawn=function(a){var b,c;return b=a.location(),this.target=a.grid.getLocation(),this.index=a.index,Crafty.e("Mine").mine({health:700,x:b.x,y:b.y+10,z:-4,defaultSpeed:null!=(c=a.speed)?c:300,pointsOnHit:a.points?10:0,pointsOnDestroy:a.points?50:0})},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.sequence(this.moveTo({x:this.target.x,y:this.target.y,easing:"easeOutQuad"}),this.synchronizeOn("placed"),this.sequence(this.wait(1e3*(1-this.target.xPerc)),this.animate("blink",-1),this.wait(1e3),function(a){return function(){return a.entity.absorbDamage(a.entity.health)}}(this),function(a){return function(){return 0===a.index?Crafty("RiggedExplosion").trigger("BigExplosion"):void 0}}(this),this.endSequence()))},c.prototype.onKilled=function(){return this.bigExplosion({juice:this.juice})},c}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.PresentationLeaveScreen=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.spawn=function(a){var b;return b=void 0,Crafty("PlayerControlledShip").each(function(){return this.playerNumber===a.index+1?b=this:void 0}),null!=b&&b.addComponent("Tween","Choreography","ViewportFixed","AnimationMode"),b},c.prototype.execute=function(){return this.sequence(this.rotate(0,200),this.moveTo({x:.2,y:.45+.1*this.options.index,speed:100,easing:"easeInOutQuad"}),this.synchronizeOn("waveOff"),this.wait(2e3),this.wait(300*this.options.index),this.moveTo({x:1.1,y:.45+.1*this.options.index,speed:500,easing:"easeInQuad"}))},c}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.PresentationShooter=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.spawn=function(a){var b,c;return b=Crafty.e("OldDrone").drone({x:Crafty.viewport.width+40,y:.71*Crafty.viewport.height,defaultSpeed:null!=(c=a.speed)?c:200}),a.shootOnSight&&b.addComponent("ShootOnSight").shootOnSight({cooldown:2e3,sightAngle:8,projectile:function(a){return function(a,b,c){var d;return d=Crafty.e("Projectile, Color, Enemy").attr({w:6,h:6,speed:350}).color("#FFFF00"),d.shoot(a,b,c)}}(this)}),b},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.movePath([[.5,.625],[.2,.5],[.53,.21],[.9,.54],[-20,.625]])},c.prototype.onKilled=function(){return this.oldExplosion(this.location({offsetX:20,offsetY:20}))},c}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.PresentationSunRise=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.spawn=function(a){var b,c,d,e;return d=Crafty("Sky").get(0)||Crafty.e("2D, WebGL, Gradient, Sky, HUD, ColorFade").attr({w:Crafty.viewport.width,h:.7*Crafty.viewport.height}).positionHud({x:0,y:0,z:-1e3}),e=Crafty("Sun"),e.length>0?e.attr({x:.97*Crafty.viewport.width-Crafty.viewport.x,y:.74*Crafty.viewport.height-Crafty.viewport.y,defaultSpeed:null!=(b=a.speed)?b:1}):Crafty.e("Sun, KeepAlive").sun({defaultSpeed:null!=(c=a.speed)?c:1,x:.97*Crafty.viewport.width,y:.74*Crafty.viewport.height})},c.prototype.execute=function(){var a,b,c,d;return d=null!=(c=this.options.speed)?c:1,b=4e4/d,a=5e5/d,this.sequence(this.setLocation({x:.97,y:.74}),this.wait(15e3-this.options.skipTo),this.backgroundColorFade({duration:b,skip:this.options.skipTo-15e3},["#000000","#222c50"],["#000000","#222c50"]),this.parallel(this.sequence(this.backgroundColorFade({duration:a,skip:this.options.skipTo-b-15e3},["#222c50","#7a86a2","#5dade9"],["#222c50","#7a86a2","#5dade9"])),this.sequence(this.movePath([[.75,.31],[.5,.11]],{rotate:!1,skip:this.options.skipTo-b-15e3}))),this.setLocation({x:.5,y:.11}))},c}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.PresentationSunSet=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.spawn=function(a){var b,c,d,e;return d=Crafty("Sky").get(0)||Crafty.e("2D, WebGL, Gradient, Sky, HUD, ColorFade").attr({w:Crafty.viewport.width,h:.7*Crafty.viewport.height}).positionHud({x:0,y:0,z:-1e3}),e=Crafty("Sun"),e.length>0?e.attr({x:.5*Crafty.viewport.width-Crafty.viewport.x,y:.11*Crafty.viewport.height-Crafty.viewport.y,defaultSpeed:null!=(b=a.speed)?b:1}):Crafty.e("Sun, KeepAlive").sun({x:.5*Crafty.viewport.width,y:.11*Crafty.viewport.height,defaultSpeed:null!=(c=a.speed)?c:1})},c.prototype.execute=function(){var a,b,c,d;return d=null!=(c=this.options.speed)?c:1,b=4e4/d,a=4e5/d,this.sequence(this.setLocation({x:.5,y:.11}),this.parallel(this.backgroundColorFade({duration:a,skip:this.options.skipTo-b},["#5dade9","#7a86a2","#222c50"],["#5dade9","#7a86a2","#222c50"]),this.movePath([[.35,.8]],{rotate:!1,skip:this.options.skipTo-b})),this.backgroundColorFade({duration:b,skip:this.options.skipTo},["#222c50","#000000"],["#222c50","#000000"]),this.setLocation({x:.38,y:.8}))},c}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.PresentationSwirler=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.spawn=function(a){var b,c;return b=Crafty.e("OldDrone").drone({x:Crafty.viewport.width+40,y:Crafty.viewport.height/2,defaultSpeed:null!=(c=a.speed)?c:200,health:200}),a.shootOnSight&&b.addComponent("ShootOnSight").shootOnSight({cooldown:2e3,sightAngle:8,projectile:function(a){return function(a,b,c){var d;return d=Crafty.e("Projectile, Color, Enemy").attr({w:6,h:6,speed:350}).color("#FFFF00"),d.shoot(a,b,c)}}(this)}),b},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.movePath([[.5,.21],[.156,.5],[.5,.833],[.86,.52],[-20,.21]])},c.prototype.onKilled=function(){return this.oldExplosion(this.location({offsetX:20,offsetY:20}))},c}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.Sine=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.spawn=function(){return Crafty.e("OldDrone").drone({health:200,x:Crafty.viewport.width+40,y:200,defaultSpeed:250})},c.prototype.execute=function(){return this.movePath([[.78,.315],[.625,.468],[.468,.625],[.312,.468],[.156,.315],[0,.468],[-.3,.625]],{rotate:!1})},c}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.Slider=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.spawn=function(a){var b;return b=a.grid.getLocation(),Crafty.e("OldDrone").drone({health:200,x:b.x*Crafty.viewport.width,y:b.y*Crafty.viewport.height,defaultSpeed:100})},c.prototype.execute=function(){return this.moveTo({x:-30})},c}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.SplashJumper=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.spawn=function(){return Crafty.e("Drone").drone({health:200,x:680,y:200,defaultSpeed:300})},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.sequence(this.moveTo({x:500}),this.wait(500),this.repeat(this.sequence(this.moveTo({y:600}),this.moveTo({y:50}))))},c.prototype.onKilled=function(){return this.explosion(this.location())},c}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.Stage1=function(c){function d(){return d.__super__.constructor.apply(this,arguments)}return b(d,c),d.prototype.nextScript="Stage2",d.prototype.assets=function(){return this.loadAssets("explosion","playerShip","general")},d.prototype.execute=function(){return this.inventoryAdd("weapon","lasers",{marking:"L"}),this.inventoryAdd("ship","life",{marking:"❤",icon:"heart"}),this.inventoryAdd("ship","points",{marking:"P",icon:"star"}),this.inventoryAdd("weaponUpgrade","rapid",{marking:"RF",icon:"rapidFireBoost"}),this.inventoryAdd("weaponUpgrade","damage",{marking:"D",icon:"damageBoost"}),this.inventoryAdd("weaponUpgrade","aim",{marking:"A",icon:"aimBoost"}),this.inventoryAdd("weaponUpgrade","speed",{marking:"S",icon:"speedBoost"}),this.inventoryAdd("weaponBoost","rapidb",{marking:"RF",icon:"rapidFireBoost"}),this.inventoryAdd("weaponBoost","aimb",{marking:"A",icon:"aimBoost"}),this.inventoryAdd("weaponBoost","speedb",{marking:"S",icon:"speedBoost"}),this.inventoryAdd("weaponBoost","damageb",{marking:"D",icon:"damageBoost"}),this.sequence(this.setPowerupPool("rapidb","speed","points","rapidb"),this.introText(),this.tutorial(),this.setPowerupPool("aimb","speedb","rapidb","speed","aim","rapid"),this.droneTakeover(),this.oceanFighting(),this.setPowerupPool("aim","speedb","rapidb","rapid","rapidb","aimb"),this.enteringLand(),this.cityBay(),this.setPowerupPool("speed","rapid","aim","speed","rapid","aim"),this.midstageBossfight(),this.bossfightReward(),this.skylineFighting(),this.highSkylineFighting())},d.prototype.introText=function(){return this.sequence(this.setWeapons(["lasers"]),this.setSpeed(100),this.setScenery("Intro"),this.sunRise(),this.async(this.placeSquad(a.Scripts.CameraCrew)),this.async(this.runScript(a.Scripts.IntroBarrel,{index:0})),this.async(this.runScript(a.Scripts.IntroBarrel,{index:1})),this["if"](function(){return this.player(1).active&&this.player(2).active},this.say("General","Time to get the last 2 ships to the factory\nto install the AI controlled defence systems",{noise:"low"}),this.say("General","Time to get the last ship to the factory\nto install the AI controlled defence systems",{noise:"low"})))},d.prototype.tutorial=function(){return this.sequence(this.setSpeed(200),this.setScenery("Ocean"),this.say("General","We send some drones for some last manual target practice",{noise:"low"}),this.parallel(this.showText("Get Ready",{color:"#00FF00",mode:"blink",blink_amount:3,blink_speed:300}),this.say("John","Let's go!")),this.parallel(this.gainHeight(150,{duration:4e3}),this.repeat(2,this.sequence(this.placeSquad(a.Scripts.Swirler,{amount:6,delay:250,drop:"pool"}),this.wait(1e3)))),this.say("General","Great job, now get the ship to the defence factory in the city\nWe will send some more target practice",{noise:"low"}),this.placeSquad(a.Scripts.Shooter,{amount:6,delay:500,drop:"pool"}))},d.prototype.droneTakeover=function(){return this.sequence(this.parallel(this.say("John","What are those drones doing there!?"),this.placeSquad(a.Scripts.CrewShooters,{amount:4,delay:750,drop:"pool"})),this.say("General","They do not respond to our commands anymore!\nOur defence AI has been hacked!",{noise:"low"}),this.async(this.chapterTitle(1,"Hacked")))},d.prototype.oceanFighting=function(){return this.sequence(this.checkpoint(this.checkpointStart("Ocean",45e3)),this.parallel(this.sequence(this.wait(2e3),this.say("General","We're under attack!?!",{noise:"low"})),this.swirlAttacks()),this.setScenery("CoastStart"),this.swirlAttacks(),this.parallel(this.gainHeight(-150,{duration:4e3}),this.wait(2e3),this.sequence(this.stalkerShootout(),this.droneShip(),this.stalkerShootout())))},d.prototype.enteringLand=function(){return this.sequence(this.checkpoint(this.checkpointStart("CoastStart",93e3)),this.mineSwarm(),this.droneShip(),this.mineSwarm(),this.droneShip(),this.setScenery("BayStart"),this.underWaterAttacks())},d.prototype.cityBay=function(){return this.sequence(this.checkpoint(this.checkpointStart("Bay",131e3)),this.setScenery("UnderBridge"),this.parallel(this.placeSquad(a.Scripts.Stalker,{drop:"pool"}),this.mineSwarm({direction:"left"})),this.sequence(this.stalkerShootout(),this.parallel(this.placeSquad(a.Scripts.Stalker,{drop:"pool"}),this.mineSwarm({direction:"left"}))))},d.prototype.midstageBossfight=function(){return this.sequence(this.checkpoint(this.checkpointStart("BayFull",168e3)),this.parallel(this["if"](function(){return this.player(1).active},this.drop({item:"pool",inFrontOf:this.player(1)})),this["if"](function(){return this.player(2).active},this.drop({item:"pool",inFrontOf:this.player(2)}))),this.mineSwarm({direction:"left"}),this.parallel(this["if"](function(){return this.player(1).active},this.drop({item:"pool",inFrontOf:this.player(1)})),this["if"](function(){return this.player(2).active},this.drop({item:"pool",inFrontOf:this.player(2)}))),this.parallel(this.mineSwarm(),this.sequence(this.wait(5e3),this.setScenery("UnderBridge"))),this.async(this.showText("Warning!",{color:"#FF0000",mode:"blink"})),this["while"](this.waitForScenery("UnderBridge",{event:"enter"}),this.waitingRocketStrike()),this.setSpeed(75),this.waitForScenery("UnderBridge",{event:"inScreen"}),this.setSpeed(0),this.checkpoint(this.checkpointStart("UnderBridge",203e3)),this.placeSquad(a.Scripts.Stage1BossStage1),this.parallel(this["if"](function(){return this.player(1).active},this.drop({item:"life",inFrontOf:this.player(1)})),this["if"](function(){return this.player(2).active},this.drop({item:"life",inFrontOf:this.player(2)}))),this.setSpeed(200),this.wait(500),this.parallel(this["if"](function(){return this.player(1).active},this.drop({item:"rapidb",inFrontOf:this.player(1)})),this["if"](function(){return this.player(2).active},this.drop({item:"rapidb",inFrontOf:this.player(2)}))),this.wait(500),this.parallel(this["if"](function(){return this.player(1).active},this.drop({item:"speedb",inFrontOf:this.player(1)})),this["if"](function(){return this.player(2).active},this.drop({item:"speedb",inFrontOf:this.player(2)}))))},d.prototype.waitingRocketStrike=function(){return this.sequence(this.placeSquad(a.Scripts.Stage1BossRocketStrike,{amount:6,delay:150,options:{gridConfig:{x:{start:1.1,steps:1,stepSize:.05},y:{start:.125,steps:12,stepSize:.05}}}}),this.wait(200))},d.prototype.swirlAttacks=function(){return this.attackWaves(this.parallel(this.repeat(2,this.placeSquad(a.Scripts.Swirler,{amount:8,delay:500,options:{shootOnSight:!0}})),this.repeat(2,this.placeSquad(a.Scripts.Shooter,{amount:8,delay:500,options:{shootOnSight:!0}}))),{drop:"pool"})},d.prototype.underWaterAttacks=function(){return this.sequence(this.placeSquad(a.Scripts.Stalker,{drop:"pool"}),this.repeat(2,this.stalkerShootout()))},d.prototype.underWaterAttacks2=function(){},d.prototype.sunRise=function(b){return null==b&&(b={skipTo:0}),this.async(this.runScript(a.Scripts.SunRise,_.extend({speed:2},b)))},d.prototype.mineSwarm=function(b){var c;return null==b&&(b={direction:"right"}),this.placeSquad(a.Scripts.JumpMine,{amount:10,delay:100,options:{gridConfig:{x:{start:.2,steps:8,stepSize:.1},y:{start:.125,steps:6,stepSize:.1}},points:null!=(c=b.points)?c:!0,direction:b.direction}})},d.prototype.droneShip=function(){return this.placeSquad(a.Scripts.DroneShip,{drop:"pool"})},d.prototype.stalkerShootout=function(){return this.parallel(this.placeSquad(a.Scripts.Stalker,{drop:"pool"}),this.attackWaves(this.parallel(this.placeSquad(a.Scripts.Shooter,{amount:8,delay:500,options:{shootOnSight:!0}}),this.placeSquad(a.Scripts.Swirler,{amount:8,delay:500,options:{shootOnSight:!0}})),{drop:"pool"}))},d.prototype.bossfightReward=function(){return this.sequence(this.checkpoint(this.checkpointMidStage("BayFull",4e5)),this.say("General","Hunt him down! We need that AI control back!",{noise:"low"}),this.setSpeed(200),this.setPowerupPool("rapidb","speedb","aimb","speed","rapidb"),this.parallel(this.sequence(this.wait(4e3),this.gainHeight(800,{duration:14e3})),this.sequence(this.stalkerShootout(),this.setScenery("Skyline"),this.placeSquad(a.Scripts.Shooter,{amount:8,delay:500,drop:"pool",options:{shootOnSight:!0}}),this.attackWaves(this.parallel(this.placeSquad(a.Scripts.Shooter,{amount:8,delay:500,options:{shootOnSight:!0}}),this.placeSquad(a.Scripts.Swirler,{amount:8,delay:500,options:{shootOnSight:!0}})),{drop:"pool"}))))},d.prototype.skylineFighting=function(){return this.sequence(this.setSpeed(100),this.checkpoint(this.checkpointMidStage("Skyline",45e4)),this.changeSeaLevel(500),this.setPowerupPool("damageb","damage","aimb","rapidb","damage","damageb"),this.attackWaves(this.parallel(this.placeSquad(a.Scripts.ScraperFlyer,{amount:8,delay:500}),this.placeSquad(a.Scripts.Shooter,{amount:8,delay:500,options:{shootOnSight:!0}})),{drop:"pool"}),this.parallel(this.attackWaves(this.parallel(this.placeSquad(a.Scripts.ScraperFlyer,{amount:8,delay:500}),this.placeSquad(a.Scripts.Shooter,{amount:8,delay:500,options:{shootOnSight:!0}})),{drop:"pool"}),this.cloneEncounter()),this.placeSquad(a.Scripts.Stage1BossPopup),this.setScenery("Skyline"),this.parallel(this.attackWaves(this.sequence(this.placeSquad(a.Scripts.ScraperFlyer,{amount:6,delay:500}),this.placeSquad(a.Scripts.ScraperFlyer,{amount:8,delay:500})),{drop:"pool"}),this.sequence(this.wait(3e3),this.placeSquad(a.Scripts.Shooter,{amount:4,delay:750,drop:"pool",options:{shootOnSight:!0}}),this.placeSquad(a.Scripts.HeliAttack,{drop:"pool"}))))},d.prototype.highSkylineFighting=function(){return this.sequence(this.parallel(this.placeSquad(a.Scripts.Stage1BossPopup),this.cloneEncounter()),this.gainHeight(300,{duration:4e3}),this.checkpoint(this.checkpointEndStage("Skyline",5e5)),this.parallel(this.repeat(2,this.cloneEncounter()),this.placeSquad(a.Scripts.HeliAttack,{drop:"pool",amount:2,delay:5e3})),this.async(this.showText("Warning!",{color:"#FF0000",mode:"blink"})),this.setScenery("SkylineBase"),this["while"](this.wait(3e3),this.waitingRocketStrike()),this.placeSquad(a.Scripts.Stage1BossLeaving),this.say("General","He is going to the military complex!\nBut we cant get through those shields now...",{noise:"low"}))},d.prototype.cloneEncounter=function(){return this.attackWaves(this.parallel(this.sequence(this.wait(4e3),this.placeSquad(a.Scripts.PlayerClone,{options:{from:"top"}})),this.placeSquad(a.Scripts.PlayerClone,{options:{from:"bottom"}})),{drop:"pool"})},d.prototype.checkpointStart=function(a,b){return this.sequence(this.setScenery(a),this.sunRise({skipTo:b}),this.wait(2e3))},d.prototype.checkpointMidStage=function(a,b){return this.sequence(this.setScenery(a),this.sunRise({skipTo:b}),this.wait(2e3))},d.prototype.checkpointEndStage=function(a,b){return this.sequence(this.setScenery(a),this.sunRise({skipTo:b}),this.parallel(this["if"](function(){return this.player(1).active},this.drop({item:"damage",inFrontOf:this.player(1)})),this["if"](function(){return this.player(2).active},this.drop({item:"damage",inFrontOf:this.player(2)}))),this.wait(2e3),this.parallel(this["if"](function(){return this.player(1).active},this.drop({item:"rapid",inFrontOf:this.player(1)})),this["if"](function(){return this.player(2).active},this.drop({item:"speed",inFrontOf:this.player(2)}))))},d}(a.LazerScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.ArmyDrone=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.assets=function(){return this.loadAssets("drone")},c.prototype.onKilled=function(){return this.sequence(this.deathDecoy(),this.smallExplosion({juice:this.juice,offsetX:20,offsetY:20}),this.rotate(30,60),this.endDecoy())},c}(a.EntityScript),a.Scripts.ShipDrone=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.spawn=function(a){var b,c;return b=Crafty.e("Drone").drone({x:.15*Crafty.viewport.width,y:.9*Crafty.viewport.height,defaultSpeed:null!=(c=a.speed)?c:300,juice:a.juice}),this.juice=a.juice,a.shootOnSight&&b.addComponent("ShootOnSight").shootOnSight({cooldown:1e3+8e3*Math.random(),sightAngle:250,projectile:function(a){return function(a,b,c){var d;return d=Crafty.e("Sphere, Hostile, Projectile").blink().attr({w:10,h:10,damage:1}),d.shoot(a,b,c)}}(this)}),b},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.movePath([[.15,.21],[.156,.5],[.5,.833],[.86,.52],[.5,.21],[.156,.5],[.5,.833],[.86,.52],[-20,.21]],{rotate:!1})},c}(a.Scripts.ArmyDrone),a.Scripts.Swirler=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.spawn=function(a){var b,c;return b=Crafty.e("Drone").drone({x:Crafty.viewport.width+40,y:Crafty.viewport.height/2,defaultSpeed:null!=(c=a.speed)?c:300,juice:a.juice}),this.juice=a.juice,a.shootOnSight&&b.addComponent("ShootOnSight").shootOnSight({cooldown:1e3+8e3*Math.random(),sightAngle:250,projectile:function(a){return function(a,b,c){var d;return d=Crafty.e("Sphere, Hostile, Projectile").blink().attr({w:10,h:10,damage:1}),d.shoot(a,b,c)}}(this)}),b},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.movePath([[.5,.21],[.156,.5],[.5,.833],[.86,.52],[.5,.21],[.156,.5],[.5,.833],[.86,.52],[-20,.21]],{rotate:!1})},c}(a.Scripts.ArmyDrone),a.Scripts.Stalker=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.spawn=function(){return Crafty.e("Drone").drone({health:100,x:Crafty.viewport.width+40,y:.83*Crafty.viewport.height,defaultSpeed:600,pointsOnHit:125})},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.sequence(this.pickTarget("PlayerControlledShip"),this.moveTo({x:1.1,y:1.01}),this.repeat(5,this.sequence(this.moveTo(this.targetLocation(),{y:1.01,speed:400,easing:"easeInOutQuad"}),this.wait(100))),this.moveTo({y:.7,speed:200,easing:"easeOutQuad"}),this.wait(100),this.moveTo({y:.73,speed:100,easing:"easeInOutQuad"}),this.wait(100),this.moveTo({y:.7,speed:100,easing:"easeInOutQuad"}),this.moveTo({y:-50,easing:"easeInQuad"}))},c}(a.Scripts.ArmyDrone),a.Scripts.ScraperFlyer=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.spawn=function(){return Crafty.e("Drone, ShootOnSight, ColorEffects, Horizon").drone({x:-50,y:.7*Crafty.viewport.height,defaultSpeed:300}).shootOnSight({cooldown:5e3+8e3*Math.random(),sightAngle:250,projectile:function(a){return function(a,b,c){var d;return d=Crafty.e("Sphere, Hostile, Projectile").blink().attr({w:10,h:10}),d.shoot(a,b,c)}}(this)})},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.sequence(this.sendToBackground(.5,-400),this.parallel(this.movePath([[.6,.7],[.8,.3],[.5,.1],[.2,.25],[.5,.7],[.8,.4],[.5,.21],[.156,.5],[.5,.833],[.86,.52],[-.1,.4]]),this.sequence(this.wait(2e3),this.scale(1,{duration:2e3}),this.reveal())))},c}(a.Scripts.ArmyDrone),a.Scripts.Shooter=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.spawn=function(a){var b,c;return b=Crafty.e("Drone").drone({x:Crafty.viewport.width+40,y:.71*Crafty.viewport.height,defaultSpeed:null!=(c=a.speed)?c:300,juice:a.juice}),this.juice=a.juice,a.shootOnSight&&b.addComponent("ShootOnSight").shootOnSight({cooldown:1e3+8e3*Math.random(),sightAngle:250,projectile:function(a){return function(a,b,c){var d;return d=Crafty.e("Sphere, Hostile, Projectile").blink().attr({w:10,h:10,damage:1}),d.shoot(a,b,c)}}(this)}),b},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.movePath([[.5,.625],[.2,.5],[.53,.21],[.9,.54],[.5,.625],[.2,.5],[.53,.21],[.9,.54],[-20,.625]])},c}(a.Scripts.ArmyDrone),a.Scripts.CrewShooters=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.spawn=function(){return Crafty.e("Drone, ShootOnSight, ColorEffects, Horizon").drone({x:Crafty.viewport.width+40,y:.23*Crafty.viewport.height,defaultSpeed:250}).shootOnSight({targetType:"CameraCrew",shootWhenHidden:!0,projectile:function(a){return function(a,b,c){var d;return d=Crafty.e("Projectile, Color, BackgroundBullet, ColorEffects, Horizon").attr({w:3,h:3,z:-200,speed:300,topDesaturation:.5,bottomDesaturation:.5}).color("#FFFF00"),d.shoot(a,b,c)}}(this)})},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.sequence(this.sendToBackground(.5,-200),this.parallel(this.movePath([[.96,.64],[.3,.35],[.65,.23],[.93,.43],[.33,.63],[-.33,.23]]),this.sequence(this.wait(2e3),this.scale(1,{duration:5e3}),this.reveal(),this.shootPlayer())))},c.prototype.shootPlayer=function(){return function(a){return function(){return a.entity.shootOnSight({cooldown:1e3+8e3*Math.random(),sightAngle:360,projectile:function(a,b,c){var d;return d=Crafty.e("Sphere, Hostile, Projectile").attr({w:10,h:10,damage:1}).blink(),d.shoot(a,b,c)}})}}(this)},c}(a.Scripts.ArmyDrone)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.IntroBarrel=function(c){function d(){return d.__super__.constructor.apply(this,arguments)}return b(d,c),d.prototype.spawn=function(b){return this.options=null!=b?b:{},Crafty.e("2D, WebGL, Tween, boxes, Collision, Choreography, Hideable").attr({z:23,defaultSpeed:150}).onHit("PlayerControlledShip",function(b){return a.paused?void 0:this.trigger("Knock",b[0].obj)})},d.prototype.execute=function(){return this.bindSequence("Knock",this.knockedOff),this.sequence(this.pickTarget("BoxesLocation",this.options.index),this.setLocation(this.targetLocation({offsetY:-15})),this.wait(2e4))},d.prototype.knockedOff=function(a){return a.trigger("BonusPoints",{points:25,location:this.location()}),this.parallel(function(a){return function(){return a.entity.sprite(28,38)}}(this),this.moveTo({y:1.25}),this.rotate(90,1500))},d}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,
a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.CameraCrew=function(c){function d(){return d.__super__.constructor.apply(this,arguments)}return b(d,c),d.prototype.assets=function(){return this.loadAssets("helicopter")},d.prototype.spawn=function(a){return Crafty.e("CameraCrew, Horizon").attr({x:.2*Crafty.viewport.width-Crafty.viewport.x,y:.15*Crafty.viewport.height,defaultSpeed:100,topDesaturation:.3,bottomDesaturation:.3}).cameraCrew()},d.prototype.execute=function(){return this.entity.colorDesaturation(a.backgroundColor),this.bindSequence("Hit",this.crash),this.sequence(this.sendToBackground(.85,-1),this.setLocation({x:.45,y:.4}),this.moveTo({x:-.3,speed:200}),this.turnAround(),this.wait(200),this.sendToBackground(.5,-200),this.moveTo({x:.22,y:.45}),this.repeat(this.sequence(this.parallel(this.scale(.7,{duration:4e3}),this.moveTo({x:.36,y:.47,speed:25,easing:"easeInOutQuad"})),this.parallel(this.scale(.5,{duration:4e3}),this.moveTo({x:.22,y:.5,speed:25,easing:"easeInOutQuad"})))))},d.prototype.crash=function(){return this.sequence(this.parallel(this.screenShake(5,{duration:400}),this.blast(this.location(),{duration:480,z:-199,topDesaturation:.3,bottomDesaturation:.3}),function(a){return function(){return Crafty.audio.play("explosion")}}(this)),function(a){return function(){return a.entity.flip("Y")}}(this),this.turnAround(),this["while"](this.movePath([[.62,.68]],{speed:150}),this.sequence(this.blast(this.location({offSetX:0,offsetY:10}),{radius:10,duration:480,z:-199,topDesaturation:.3,bottomDesaturation:.3,lightness:.2,alpha:.5}),this.blast(this.location({offsetX:10,offsetY:25}),{radius:5,duration:180,z:-199,topDesaturation:.3,bottomDesaturation:.3}),this.wait(100))),this.moveTo({y:1.1}))},d}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.DroneShip=function(c){function d(){return d.__super__.constructor.apply(this,arguments)}return b(d,c),d.prototype.spawn=function(a){var b;return Crafty.e("DroneShip").attr({x:Crafty.viewport.width+180,y:450,defaultSpeed:null!=(b=a.speed)?b:350}).setSealevel(this.level.visibleHeight+10)},d.prototype.execute=function(){return this.sequence(this.moveTo({x:.02}),function(a){return function(){return a.entity.open()}}(this),this.wait(1e3),this.parallel(this.placeSquad(a.Scripts.ShipDrone,{amount:5,drop:"pool",delay:500,options:{shootOnSight:!0}}),this.sequence(this.wait(3e3),function(a){return function(){return a.entity.close()}}(this),this.moveTo({x:-.5}))))},d}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.HeliAttack=function(c){function d(){return d.__super__.constructor.apply(this,arguments)}return b(d,c),d.prototype.assets=function(){return this.loadAssets("helicopter")},d.prototype.spawn=function(a){var b,c,d,e,f;return this.dir=null!=(c=a.from)?c:"top",this.ground=null!=(d=a.ground)?d:660,this.corpseKeep=null!=(e=a.corpseKeep)?e:1e4,b=Crafty.e("Helicopter").attr({x:Crafty.viewport.width+40,y:.6*Crafty.viewport.height,defaultSpeed:null!=(f=a.speed)?f:40,weaponOrigin:[0,25]}).helicopter({pointsOnHit:25,pointsOnDestroy:200}),b.addComponent("BurstShot").burstShot({burstCooldown:2500,burstAmount:4,angle:-15,angleDeviation:10,aim:45,cooldown:50,projectile:function(a){return function(a,b,c){var d;return d=Crafty.e("Projectile, sphere1, Hostile").crop(6,21,18,7).flip().attr({w:20,h:8,speed:350,damage:1}),d.shoot(a,b,c)}}(this)}),b},d.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this["while"](this.flightPath(),this.sequence(this.fireRockets(),this.wait(5e3)))},d.prototype.flightPath=function(){return"top"===this.dir?this.movePath([[.9,.4],[.7,.25],[.65,.2],[.4,.6],[.6,.7],[.8,.5],[.4,.8],[.2,.3],[-.2,.5]]):this.movePath([[.9,.6],[.7,.75],[.65,.8],[.4,.4],[.6,.3],[.8,.5],[.4,.2],[.2,.7],[-.2,.5]])},d.prototype.onKilled=function(){return this.leaveAnimation(this.sequence(this.deathDecoy(),this.bigExplosion(),this["while"](this.moveTo({x:.6,y:this.ground,speed:250,easing:"easeInQuad",positionType:"absoluteY"}),this.sequence(this.blast(this.location(),{radius:10,duration:480,z:-1,lightness:.2,alpha:.5}),this.blast(this.location({offsetX:10,offsetY:5}),{radius:5,duration:180,z:-1}),this.wait(100))),this.moveTo({x:.6,y:this.ground-20,speed:50,easing:"easeInOutQuad",positionType:"absoluteY"}),this.moveTo({x:.6,y:this.ground,speed:50,easing:"easeInOutQuad",positionType:"absoluteY"}),this.bigExplosion(),function(a){return function(){return a.entity.removeComponent("ViewportFixed"),a.entity.attr({lightness:.3})}}(this),this.wait(this.corpseKeep),this.endDecoy()))},d.prototype.fireRockets=function(b){var c;return c=a.Scripts.Stage1BossRocket,this.sequence(this.async(this.placeSquad(c,{options:{z:5,offsetX:0,offsetY:50,scale:.75,health:100,location:this.location()}})),this.async(this.placeSquad(c,{options:{z:-5,offsetX:0,offsetY:-50,scale:.75,health:100,location:this.location()}})),this.wait(500))},d}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.JumpMine=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.assets=function(){return this.loadAssets("mine")},c.prototype.spawn=function(a){var b,c,d;return d="right"===a.direction?Crafty.viewport.width+180:-180,this.target=a.grid.getLocation(),this.juice=null!=(b=a.juice)?b:!0,Crafty.e("Mine, BulletCircle").mine({x:d,y:440,defaultSpeed:null!=(c=a.speed)?c:200,pointsOnHit:a.points?10:0,pointsOnDestroy:a.points?50:0}).bulletCircle({burstAmount:8,projectile:function(a){return function(a,b,c){var d;return d=Crafty.e("Sphere, Hostile, Projectile").blink().attr({w:14,h:14,speed:200,damage:1}),d.shoot(a,b,c)}}(this)})},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.sequence(this.moveTo({y:1.05,speed:400}),this.moveTo({x:this.target.x,easing:this.juice?"easeOutQuad":"linear"}),this.moveTo({y:this.target.y,easing:this.juice?"easeOutQuad":"linear"}),this.parallel(this.sequence(this.synchronizeOn("placed"),this.animate("open"),this.wait(200),this.moveTo({x:-50,speed:35})),this.sequence(this.animate("blink",-1),this.wait(1e3),function(a){return function(){return a.entity.absorbDamage({damage:a.entity.health})}}(this),function(a){return function(){return a.entity.shootRing()}}(this),this.endSequence())))},c.prototype.onKilled=function(){return this.bigExplosion({juice:this.juice})},c}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.MineWall=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.spawn=function(a){return this.startX="left"===a.direction?-80:680,this.screenX="left"===a.direction?20:620,this.wallX="left"===a.direction?100:540,this.wallTarget=a.grid.getLocation(),Crafty.e("Mine").mine({x:this.startX,y:240,defaultSpeed:200})},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.sequence(this.movePath([[this.screenX,240],[this.wallX,this.wallTarget.y]],{rotate:!1,speed:600}),this.synchronizeOn("placed"),this.pickTarget("PlayerControlledShip"),this.repeat(this.seekAndDestroy()))},c.prototype.seekAndDestroy=function(){return this.moveTo(this.targetLocation())},c.prototype.onKilled=function(){return this.blast(this.location(),{damage:300,radius:40})},c}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.PlayerClone=function(c){function d(){return d.__super__.constructor.apply(this,arguments)}return b(d,c),d.prototype.assets=function(){return this.loadAssets("playerShip")},d.prototype.spawn=function(a){var b,c,d;return this.dir=null!=(c=a.from)?c:"top",b=Crafty.e("PlayerClone").attr({x:Crafty.viewport.width+40,y:.1*Crafty.viewport.height,defaultSpeed:null!=(d=a.speed)?d:280}).playerClone({pointsOnHit:25,pointsOnDestroy:125}),b.addComponent("ShootOnSight").shootOnSight({cooldown:150,sightAngle:20,projectile:function(a){return function(a,b,c){var d;return d=Crafty.e("Sphere, Hostile, Projectile").attr({w:9,h:9,speed:600,damage:1}).blink(),d.shoot(a,b,c)}}(this)}),b},d.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.sequence(this["while"](this.flightPathTop(),this.sequence(this.dropBombs(),this.wait(300))),this.turnAround(),this["while"](this.flightPathBack(),this.sequence(this.dropBombs(),this.wait(300))),this.turnAround(),this["while"](this.flightPathTop(),this.sequence(this.dropBombs(),this.wait(300))))},d.prototype.flightPathTop=function(){return this.moveTo({x:-.1,y:.2})},d.prototype.flightPathBack=function(){return this.moveTo({x:1.01,y:.1})},d.prototype.onKilled=function(){return this.sequence(this.deathDecoy(),this.smallExplosion({offsetX:20,offsetY:30}),this.wait(50),this.smallExplosion({offsetX:40,offsetY:20}),this.wait(50),this.smallExplosion({offsetX:-50,offsetY:-10}),this.wait(20),this.endDecoy(),this.bigExplosion({damage:0}))},d.prototype.dropBombs=function(){return this.async(this.placeSquad(a.Scripts.Stage1BossBombRaid,{options:{location:this.location(),armed:!1,scale:.75}}))},d.prototype.fireRockets=function(b){var c;return c=a.Scripts.Stage1BossAimedRocket,this.sequence(this.async(this.placeSquad(c,{options:{z:5,offsetX:0,offsetY:50,scale:.75,cooldown:20,health:100,location:this.location()}})),this.async(this.placeSquad(c,{options:{z:-5,offsetX:0,offsetY:-50,cooldown:20,scale:.75,health:100,location:this.location()}})))},d}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.Stage1Boss=function(c){function d(){return d.__super__.constructor.apply(this,arguments)}return b(d,c),d.prototype.assets=function(){return this.loadAssets("largeDrone")},d.prototype.rocketStrikeDance=function(){return this.parallel(this.movePath([[.7,.4],[.8,.3],[.9,.5],[.7,.6],[.8,.7],[.9,.4],[.7,.1],[.6,.2]]),this.repeat(2,this.sequence(this.fireRockets(4),this.wait(1500),this.fireRockets(4),this.wait(1e3),this.fireRockets(2),this.wait(300),this.fireRockets(2),this.wait(300),this.fireRockets(2),this.wait(300))))},d.prototype.rocketStrikeDanceHoming=function(){return this.parallel(this.movePath([[.7,.4],[.8,.3],[.9,.5],[.7,.6],[.8,.7],[.9,.4],[.7,.1],[.6,.2]]),this.repeat(2,this.sequence(this.fireRockets(2,!0),this.wait(600),this.fireRockets(2,!0),this.wait(600),this.fireRockets(2,!0),this.wait(900),this.fireRockets(4),this.wait(300))))},d.prototype.fireRockets=function(b,c){var d;return d=a.Scripts.Stage1BossRocket,c&&(d=a.Scripts.Stage1BossAimedRocket),this.sequence(this.async(this.placeSquad(d,{options:{z:5,offsetX:0,offsetY:50,pointsOnHit:0,pointsOnDestroy:0,location:this.location()}})),this.animate("emptyWing",0,"wing"),this.async(this.placeSquad(d,{options:{z:-5,offsetX:0,offsetY:-50,pointsOnHit:0,pointsOnDestroy:0,location:this.location()}})),this["if"](function(){return b>2},this.async(this.placeSquad(a.Scripts.Stage1BossRocket,{options:{z:-5,offsetX:30,offsetY:-100,location:this.location(),pointsOnHit:0,pointsOnDestroy:0}}))),this["if"](function(){return b>3},this.async(this.placeSquad(a.Scripts.Stage1BossRocket,{options:{z:-5,offsetX:30,offsetY:100,location:this.location(),pointsOnHit:0,pointsOnDestroy:0}}))),this.wait(500),this.animate("reload",0,"wing"))},d.prototype.smoke=function(a){var b;return null==a&&(a="heavy"),b={heavy:{alpha:.8,wait:40},medium:{alpha:.6,wait:80},light:{alpha:.4,wait:140}}[a],this.sequence(this.blast(this.location(),function(a){return function(){return{radius:10,duration:480,z:a.entity.z-3,alpha:b.alpha,lightness:1}}}(this),function(){return{rotation:this.rotation+1,alpha:Math.max(0,this.alpha-.003),lightness:function(){return Math.max(.2,this.lightness-.05)},y:this.y-2*Math.random()}}),this.wait(function(){return b.wait+50*Math.random()}))},d}(a.EntityScript),a.Scripts.Stage1BossStage1=function(c){function d(){return d.__super__.constructor.apply(this,arguments)}return b(d,c),d.prototype.spawn=function(){return Crafty.e("LargeDrone, Horizon, BulletCircle").drone({x:Crafty.viewport.width+40,y:.35*Crafty.viewport.height,defaultSpeed:100,health:23e3,pointsOnHit:10}).bulletCircle({burstAmount:16,projectile:function(a){return function(a,b,c){var d;return d=Crafty.e("Sphere, Hostile, Projectile").blink().attr({w:14,h:14,speed:200,damage:1}),d.shoot(a,b,c)}}(this)})},d.prototype.execute=function(){return this.bindSequence("Hit",this.fase2,function(a){return function(){return a.entity.healthBelow(.5)}}(this)),this.sequence(this.invincible(!0),this.animate("slow",-1,"eye"),this.disableWeapons(),this.parallel(this.moveTo({x:.75,y:.41}),this.say("Drone Commander","We have control over the AI now! You will suffer!\nEarths defences are in our hands!")),this.laugh(),this.invincible(!1),this.enableWeapons(),this.async(this.placeSquad(a.Scripts.Stage1BossRocket,{options:{location:this.location(),pointsOnDestroy:0,pointsOnHit:0}})),this.animate("emptyWing",0,"wing"),this.animate("reload",0,"wing"),this.moveTo({y:.43,speed:5}),this.repeat(this.sequence(this.rocketStrikeDance(),this.mineFieldStrike())))},d.prototype.mineFieldStrike=function(){return this.sequence(this.parallel(this.sequence(this.moveTo({x:-.2,y:.8,speed:400,easing:"easeInQuad"}),this.turnAround(),this.movePath([[.2,.2],[.9,.6],[1.2,.4]],{speed:400}),this.turnAround(),this.movePath([[.8,.2],[.5,.5],[1.2,.6]],{speed:400})),this.placeSquad(a.Scripts.Stage1BossMineField,{amount:30,delay:300,options:{location:this.location(),gridConfig:{x:{start:.1,steps:6,stepSize:.15},y:{start:.125,steps:8,stepSize:.1}}}})),this.movePath([[.7,.4]],{speed:300},"easeOutQuad"))},d.prototype.bombRaid=function(b){return null==b&&(b=!1),this.sequence(this["while"](this.moveTo({x:.8,speed:200,easing:"easeInOutQuad"}),this.sequence(this.bigExplosion(),this.wait(200))),this.repeat(5,this.sequence(function(a){return function(){return a.entity.shootRing()}}(this),this.wait(300))),this.moveTo({y:.1,speed:200,easing:"easeInOutQuad"}),this["while"](this.moveTo({x:-100,speed:400}),this.sequence(this.async(this.placeSquad(a.Scripts.Stage1BossBombRaid,{options:{location:this.location(),armed:!1}})),this.wait(300))),this.turnAround(),this["while"](this.moveTo({x:1,speed:400}),this.sequence(this.async(this.placeSquad(a.Scripts.Stage1BossBombRaid,{options:{location:this.location(),armed:b}})),this.smoke("light"),this.wait(300))),this.moveTo({x:1.2,speed:400}),this.turnAround(),this.moveTo({x:.85,y:.41,speed:400}))},d.prototype.fase2=function(){return this.bindSequence("Hit",this.endOfFight,function(a){return function(){return a.entity.healthBelow(.2)}}(this)),this.sequence(this.cancelBullets("Mine"),this.cancelBullets("shadow"),this.setSpeed(200),this.repeat(this.sequence(this.bombRaid(!0),this.repeat(2,this["while"](this.rocketStrikeDanceHoming(),this.sequence(this.async(this.runScript(a.Scripts.Stage1BossMine,this.location())),this.wait(1500)))),this.wait(1e3))))},d.prototype.laugh=function(){return this.sequence(function(a){return function(){return Crafty.audio.play("laugh")}}(this),function(a){return function(){return a.entity.invincible=!0}}(this),this.repeat(5,this.sequence(this.rotate(10,200),this.rotate(-10,200))),this.rotate(0,200),function(a){return function(){return a.entity.invincible=!1}}(this))},d.prototype.endOfFight=function(){return this.sequence(this.cancelBullets("Mine"),this.cancelBullets("shadow"),this.repeat(5,this.sequence(function(a){return function(){return a.entity.shootRing()}}(this),this.wait(300))),this.invincible(!0),this["while"](this.moveTo({x:.6,y:.9,speed:50}),this.sequence(this.smallExplosion(),this["while"](this.wait(300),this.smoke()))),this.moveTo({y:1.1,x:.4,speed:50}),this.moveTo({y:.6,x:.4,speed:350,easing:"easeOutQuad"}),this.sendToBackground(.9,-100),this.parallel(this["while"](this.moveTo({x:-.15,speed:300,easing:"easeInQuad"}),this.smoke("medium")),this.scale(.8,{duration:3e3})),this.leaveAnimation(this.sequence(this.turnAround(),this.sendToBackground(.7,-150),this["while"](this.moveTo({x:1.1,speed:500,easing:"easeInQuad"}),this.smoke("medium")))))},d}(a.Scripts.Stage1Boss),a.Scripts.Stage1BossMine=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.assets=function(){return this.loadAssets("mine")},c.prototype.spawn=function(a){return Crafty.e("Mine").mine({health:100,x:a().x,y:a().y+10,z:-4,defaultSpeed:200,pointsOnHit:0,pointsOnDestroy:0})},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.sequence(this.pickTarget("PlayerControlledShip"),this.moveTo({y:1.1,easing:"easeInQuad"}),function(a){return function(){return a.entity.attr({z:0})}}(this),this.moveTo(this.targetLocation(),{y:1.01,easing:"easeInOutQuad"}),this.moveTo(this.targetLocation({x:null})),this.animate("open"),this.wait(200),this.animate("blink",-1),this.wait(1e3),function(a){return function(){return a.entity.absorbDamage({damage:a.entity.health})}}(this),this.endSequence())},c.prototype.onKilled=function(){return this.bigExplosion()},c}(a.EntityScript),a.Scripts.Stage1BossRocketStrike=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.spawn=function(a){var b;return a=_.defaults(a,{pointsOHit:125,pointsOnDestroy:50}),b=a.grid.getLocation(),Crafty.e("Rocket").rocket({health:250,x:b.x*Crafty.viewport.width,y:b.y*Crafty.viewport.height,z:5,defaultSpeed:600,pointsOnHit:a.pointsOnHit,pointsOnDestroy:a.pointsOnDestroy})},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this["while"](this.moveTo({x:-205,easing:"easeInQuad"}),this.sequence(this.blast(this.location(),function(){return{radius:5,duration:135,z:1,alpha:.8,lightness:1,gravity:.2*Math.random(),vertical:0}},function(){return{vertical:this.vertical+Math.random()*this.gravity,rotation:this.rotation+3*Math.random(),alpha:Math.max(.1,this.alpha-.03*Math.random()),lightness:Math.max(.4,this.lightness-.05),y:this.y-this.vertical}}),this.wait(20)))},c.prototype.onKilled=function(){return this.bigExplosion()},c}(a.EntityScript),a.Scripts.Stage1BossRocket=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.spawn=function(a){var b;return a=_.defaults(a,{pointsOnHit:125,pointsOnDestroy:50,offsetY:0,offsetX:0,scale:1,health:250}),null==a.location?null:(b="function"==typeof a.location?a.location():void 0)?(this.offsetY=a.offsetY,this.offsetX=a.offsetX,Crafty.e("Rocket").rocket({health:a.health,x:b.x-30,y:b.y-8+Math.round(15*Math.random()),z:5,scale:a.scale,defaultSpeed:600,pointsOnHit:a.pointsOnHit,pointsOnDestroy:a.pointsOnDestroy})):null},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this["while"](this.sequence(this.moveTo(this.location({offsetY:this.offsetY,offsetX:this.offsetX})),this["if"](function(){return 0!==this.offsetX||0!==this.offsetY},this.wait(500)),this.moveTo({x:-205,easing:"easeInQuad"})),this.sequence(this.blast(this.location(),function(){return{radius:5,duration:135,z:1,alpha:.8,lightness:1,gravity:.2*Math.random(),vertical:0}},function(){return{vertical:this.vertical+Math.random()*this.gravity,rotation:this.rotation+3*Math.random(),alpha:Math.max(.1,this.alpha-.03*Math.random()),lightness:Math.max(.4,this.lightness-.05),y:this.y-this.vertical}}),this.wait(20)))},c.prototype.onKilled=function(){return this.bigExplosion()},c}(a.EntityScript),a.Scripts.Stage1BossAimedRocket=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.spawn=function(a){var b,c;return a=_.defaults(a,{pointsOHit:125,pointsOnDestroy:50,z:5,scale:1,offsetY:0}),null==a.location?null:(b="function"==typeof a.location?a.location():void 0)?(this.offsetY=a.offsetY,this.cooldown=null!=(c=a.cooldown)?c:500,Crafty.e("Rocket").rocket({health:250,x:b.x-30,y:b.y-8+Math.round(15*Math.random()),z:a.z,defaultSpeed:500,scale:a.scale,pointsOnHit:a.pointsOnHit,pointsOnDestroy:a.pointsOnDestroy})):null},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.sequence(this.pickTarget("PlayerControlledShip"),this.moveTo(this.location({offsetY:this.offsetY})),this.wait(this.cooldown),this["while"](this.moveThrough(this.targetLocation()),this.sequence(this.blast(this.location(),function(){return{radius:5,duration:135,z:1,alpha:.8,lightness:1,gravity:.2*Math.random(),vertical:0}},function(){return{vertical:this.vertical+Math.random()*this.gravity,rotation:this.rotation+3*Math.random(),alpha:Math.max(.1,this.alpha-.03*Math.random()),lightness:Math.max(.4,this.lightness-.05),y:this.y-this.vertical}}),this.wait(20))))},c.prototype.onKilled=function(){return this.bigExplosion()},c}(a.EntityScript),a.Scripts.Stage1BossHomingRocket=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.spawn=function(a){var b,c;return a=_.defaults(a,{pointsOHit:125,pointsOnDestroy:50,z:5,scale:1,offsetY:0}),null==a.location?null:(b="function"==typeof a.location?a.location():void 0)?(this.offsetY=a.offsetY,this.cooldown=null!=(c=a.cooldown)?c:500,Crafty.e("Rocket").rocket({health:250,x:b.x-30,y:b.y-8+Math.round(15*Math.random()),z:a.z,defaultSpeed:500,scale:a.scale,pointsOnHit:a.pointsOnHit,pointsOnDestroy:a.pointsOnDestroy})):null},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.sequence(this.pickTarget("PlayerControlledShip"),this.moveTo(this.location({offsetY:this.offsetY})),this.wait(this.cooldown),this["while"](this.movePath([this.targetLocation(),[-160,.5]]),this.sequence(this.blast(this.location(),function(){return{radius:5,duration:135,z:1,alpha:.8,lightness:1,gravity:.2*Math.random(),vertical:0}},function(){return{vertical:this.vertical+Math.random()*this.gravity,rotation:this.rotation+3*Math.random(),alpha:Math.max(.1,this.alpha-.03*Math.random()),lightness:Math.max(.4,this.lightness-.05),y:this.y-this.vertical}}),this.wait(20))))},c.prototype.onKilled=function(){return this.bigExplosion()},c}(a.EntityScript),a.Scripts.Stage1BossPopup=function(c){function d(){return d.__super__.constructor.apply(this,arguments)}return b(d,c),d.prototype.spawn=function(){return Crafty.e("LargeDrone, Horizon").drone({maxHealth:6e4,health:17e3,x:Crafty.viewport.width+40,y:.5*Crafty.viewport.height,defaultSpeed:150})},d.prototype.execute=function(){return this.bindSequence("Hit",this.leaveScreen,function(a){return function(){return a.entity.healthBelow(.1)}}(this)),this.sequence(this.animate("slow",-1,"eye"),this.moveTo({x:.9,y:.45}),this["while"](this.repeat(this.rocketStrikeDance()),this.smoke("light")))},d.prototype.leaveScreen=function(){return this.sequence(this.invincible(!0),this.moveTo({y:.5,x:.95,speed:200,easing:"easeInOutQuad"}),this.async(this.placeSquad(a.Scripts.Stage1BossPopupMineField,{amount:20,delay:50,options:{location:this.location(),gridConfig:{x:{start:.1,steps:12,stepSize:.075},y:{start:.1,steps:5,stepSize:.075}}}})),this.async(this.placeSquad(a.Scripts.Stage1BossPopupMineField,{amount:20,delay:50,options:{location:this.location(),gridConfig:{x:{start:.1,steps:12,stepSize:.075},y:{start:.7,steps:5,stepSize:.075}}}})),this.wait(3e3),this.drop({item:"pool",location:this.location()}),this["while"](this.moveTo({x:-.15,speed:500,easing:"easeInOutQuad"}),this.sequence(this.smallExplosion(),this["while"](this.wait(300),this.smoke()))),this.leaveAnimation(this.sequence(this.turnAround(),this.sendToBackground(.7,-150),this["while"](this.moveTo({x:1.1,speed:300}),this.smoke("light")))))},d}(a.Scripts.Stage1Boss),a.Scripts.Stage1BossLeaving=function(c){function d(){return d.__super__.constructor.apply(this,arguments)}return b(d,c),d.prototype.spawn=function(){return Crafty.e("LargeDrone, Horizon").drone({maxHealth:18e4,health:36e3,x:Crafty.viewport.width+40,y:.5*Crafty.viewport.height,defaultSpeed:150})},d.prototype.execute=function(){return this.entity.colorDesaturation(a.backgroundColor),this.bindSequence("Hit",this.leaveScreen,function(a){return function(){return a.entity.healthBelow(.1)}}(this)),this.sequence(this.animate("slow",-1,"eye"),this.shortRocketStrikeDance(),this.laugh(),this.leaveScreen())},d.prototype.shortRocketStrikeDance=function(a){return null==a&&(a=!1),this.parallel(this.movePath([[.7,.4],[.8,.3],[.9,.5],[.7,.6],[.8,.7],[.9,.4],[.7,.1],[.6,.2]]),this.repeat(2,this.sequence(this.fireRockets(4,a),this.wait(1500),this.fireRockets(4,a),this.wait(1e3),this.fireRockets(2,a),this.wait(300),this.fireRockets(2),this.wait(300),this.fireRockets(2,a),this.wait(300))))},d.prototype.laugh=function(){return this.sequence(function(a){return function(){return Crafty.audio.play("laugh")}}(this),this.invincible(!0),this.repeat(5,this.sequence(this.rotate(10,200),this.rotate(-10,200))),this.rotate(0,200),this.invincible(!1))},d.prototype.leaveScreen=function(){return this.leaveAnimation(this.sequence(this.animate("emptyWing",0,"wing"),this.sendToBackground(.9,-100),this.parallel(this["while"](this.moveTo({x:-.15,y:.4,speed:400}),this.smoke()),this.scale(.5,{duration:3e3})),function(a){return function(){return a.entity.flipX()}}(this),this.sendToBackground(.5,-550),this.parallel(this["while"](this.moveTo("MiliBase",{speed:150,offsetY:-160,offsetX:-40}),this.smoke("light")),this.scale(.2,{duration:4e3}))))},d.prototype.attackCycle=function(){return this.repeat(4,this.sequence(this.async(this.placeSquad(a.Scripts.Stage1BossRocket,{options:{location:this.location(),pointsOnDestroy:0,pointsOnHit:0}})),this.animate("emptyWing",0,"wing"),this.parallel(this["while"](this.moveTo(this.targetLocation({offsetY:-20}),{x:.845}),this.smoke("medium")),this.sequence(this.animate("reload",0,"wing"),this.wait(1e3)))))},d}(a.Scripts.Stage1Boss),a.Scripts.Stage1BossBombRaid=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.assets=function(){return this.loadAssets("mine")},c.prototype.spawn=function(a){var b,c;return b=a.location(),this.armed=a.armed,Crafty.e("Mine").mine({health:200,x:b.x,y:b.y+10,z:-4,defaultSpeed:400,pointsOnHit:10,pointsOnDestroy:20,scale:null!=(c=a.scale)?c:1})},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.armed?this.sequence(this.animate("blink",-1),this.moveTo({y:.3+.6*Math.random(),easing:"easeInOutQuad"}),this.wait(200),function(a){return function(){return a.entity.absorbDamage({damage:a.entity.health})}}(this)):this.sequence(this.moveTo({y:1.2,easing:"easeInQuad"}))},c.prototype.onKilled=function(){return this.bigExplosion()},c}(a.EntityScript),a.Scripts.Stage1BossDroneRaid=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.assets=function(){return this.loadAssets("drone")},c.prototype.spawn=function(a){var b;return b=Crafty.e("Drone").drone({health:200,x:Crafty.viewport.width+40,y:.1*Crafty.viewport.height,defaultSpeed:500}),a.shootOnSight&&b.addComponent("ShootOnSight").shootOnSight({cooldown:1e3,sightAngle:8,projectile:function(a){return function(a,b,c){var d;return d=Crafty.e("Projectile, Color, Hostile").attr({w:6,h:6,speed:650,damage:1}).color("#FFFF00"),d.shoot(a,b,c)}}(this)}),b},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.sequence(this.pickTarget("PlayerControlledShip"),this.movePath([this.targetLocation({offsetX:-20,offsetY:30}),[-160,.5]]))},c.prototype.onKilled=function(){return this.smallExplosion()},c}(a.EntityScript),a.Scripts.Stage1BossMineField=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.assets=function(){return this.loadAssets("mine")},c.prototype.spawn=function(a){var b,c;return b=a.location(),this.target=a.grid.getLocation(),Crafty.e("Mine").mine({x:b.x,y:b.y+36,defaultSpeed:null!=(c=a.speed)?c:250,pointsOnHit:a.points?10:0,pointsOnDestroy:a.points?50:0})},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.sequence(this.moveTo({y:1.05,speed:400}),this.moveTo({x:this.target.x,easing:"easeOutQuad"}),this.synchronizeOn("dropped"),this.moveTo({y:this.target.y,easing:"easeOutQuad"}),this.sequence(this.wait(1e3),this.animate("blink",-1),this.wait(1e3),this.squadOnce("bridge",this.sequence(this.wait(500),function(a){return function(){return Crafty.trigger("BridgeCollapse",a.level)}}(this),this.screenFlash(2,{color:"#FFFF80",alpha:.4}))),function(a){return function(){return a.entity.absorbDamage({damage:a.entity.health})}}(this),this.endSequence()))},c.prototype.onKilled=function(){return this.bigExplosion({juice:this.juice})},c}(a.EntityScript),a.Scripts.Stage1BossPopupMineField=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.assets=function(){return this.loadAssets("mine")},c.prototype.spawn=function(a){var b,c;return b=a.location(),this.target=a.grid.getLocation(),this.index=a.index,Crafty.e("Mine").mine({health:700,x:b.x,y:b.y+10,z:-4,defaultSpeed:null!=(c=a.speed)?c:300,pointsOnHit:a.points?10:0,pointsOnDestroy:a.points?50:0})},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.sequence(this.moveTo({x:this.target.x,y:this.target.y,easing:"easeOutQuad"}),this.synchronizeOn("placed"),this.sequence(this.wait(1e3*(1-this.target.xPerc)),this.animate("blink",-1),this.wait(1e3),function(a){return function(){return a.entity.absorbDamage({damage:a.entity.health})}}(this),function(a){return function(){return 0===a.index?Crafty("RiggedExplosion").trigger("BigExplosion"):void 0}}(this),this.endSequence()))},c.prototype.onKilled=function(){return this.bigExplosion({juice:this.juice})},c}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.SunRise=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.spawn=function(a){var b,c,d,e;return d=Crafty("Sky").get(0)||Crafty.e("2D, StaticBackground, Gradient, Sky, ColorFade").attr({w:Crafty.viewport.width,h:.7*Crafty.viewport.height}).attr({x:0,y:0,z:0}),e=Crafty("Sun"),e.length>0?e.attr({x:.97*Crafty.viewport.width-Crafty.viewport.x,y:.74*Crafty.viewport.height-Crafty.viewport.y,defaultSpeed:null!=(b=a.speed)?b:1}):Crafty.e("Sun, KeepAlive").sun({x:.97*Crafty.viewport.width,y:.74*Crafty.viewport.height,defaultSpeed:null!=(c=a.speed)?c:1})},c.prototype.execute=function(){var a,b,c,d,e;return e=null!=(d=this.options.speed)?d:1,null==(a=this.options).skipTo&&(a.skipTo=0),c=8e4/e,b=6e5/e,this.sequence(this.setLocation({x:.97,y:.74}),this.backgroundColorFade({duration:c,skip:this.options.skipTo},["#000000","#000020","#000020","#7e261b"],["#000000","#000000","#000020","#222c50"]),this.parallel(this.backgroundColorFade({duration:b,skip:this.options.skipTo-c},["#7e261b","#d39915","#f7e459","#d6d5d5","#d6d5d5"],["#222c50","#7a86a2","#366eab"]),this.movePath([[.75,.31],[.5,.11]],{
rotate:!1,skip:this.options.skipTo-c})))},c}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.SunSet=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.spawn=function(a){var b;return b=Crafty("Sun"),b.length>0?b.attr({x:b.x+Crafty.viewport.x,y:b.y+Crafty.viewport.y}):Crafty.e("Sun, ColorFade, KeepAlive").sun({x:620,y:340,defaultSpeed:2})},c.prototype.execute=function(){return this.sequence(this.moveTo({x:320,y:100,speed:2e3}),this.backgroundColorFade({duration:1},"#8080FF"),this.parallel(this.movePath([[220,120],[120,320],[20,420]],{rotate:!1}),this.colorFade({duration:3e5},"#DDDD80","#DDDD00","#DD8000"),this.sequence(this.wait(15e4),this.backgroundColorFade({duration:15e4},"#8080FF","#602020"))))},c}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.Stage1End=function(c){function d(){return d.__super__.constructor.apply(this,arguments)}return b(d,c),d.prototype.assets=function(){return this.loadAssets("explosion")},d.prototype.execute=function(){return this.sequence(this.parallel(this.sequence(this.disableControls(),this.disableWeapons(),this.placeSquad(a.Scripts.PresentationLeaveScreen,{amount:2,delay:1e3})),this.sequence(this.say("This is it for now!\nMore content coming soon!"),this.say("Thanks for playing!\nThe heroes will return..."))),this.screenFadeOut(),this.endGame())},d}(a.LazerScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.Stage2=function(c){function d(){return d.__super__.constructor.apply(this,arguments)}return b(d,c),d.prototype.nextScript="Stage1End",d.prototype.assets=function(){return this.loadAssets("explosion")},d.prototype.execute=function(){return this.sequence(this["if"](function(){return this.player(1).active&&!this.player(2).active},this.sequence(this.say("John","I'll try to find another way in!"),this.say("General","There are rumours about an underground entrance",{noise:"low"}),this.say("John","Ok I'll check it out"))),this["if"](function(){return!this.player(1).active&&this.player(2).active},this.sequence(this.say("Jim","I'll use the underground tunnels!"),this.say("General","How do you know about those...\nthat's classified info!",{noise:"low"}))),this["if"](function(){return this.player(1).active&&this.player(2).active},this.sequence(this.say("John","We'll try to find another way in!"),this.say("Jim","We can use the underground tunnels!"),this.say("General","How do you know about those...\nthat's classified info!",{noise:"low"}))),this.setScenery("Skyline2"),this.chapterTitle(2,"Underground"),this.showText("Get Ready",{color:"#00FF00",mode:"blink",blink_amount:3,blink_speed:300}),this.parallel(this.gainHeight(-1300,{duration:3e4}),this.placeSquad(a.Scripts.HeliAttack,{amount:3,delay:6e3})),this.checkpoint(this.checkpointStreets("Skyline2")),this.placeSquad(a.Scripts.TankAttack),this.placeSquad(a.Scripts.HeliAttack),this.wait(8e3))},d.prototype.checkpointStreets=function(b){return this.sequence(this.setScenery(b),this.async(this.runScript(a.Scripts.SunRise,{skipTo:6e5})),this.wait(6e3))},d}(a.LazerScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.TankAttack=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.spawn=function(a){var b;return b=Crafty.e("Tank").attr({x:Crafty.viewport.width+40,y:400,defaultSpeed:30,weaponOrigin:[30,0]}).tank()},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.sequence(this.moveTo({x:.2,speed:120}),this.action("searchAim"),this["while"](this.sequence(this.wait(200),this.moveTo({x:.8}),this.wait(4e3),this.moveTo({x:-.2})),this.sequence(this.action("shoot"),this.wait(1e3),this.action("searchAim"))))},c.prototype.onKilled=function(){return this.leaveAnimation(this.sequence(this.deathDecoy(),this.bigExplosion(),this.wait(200),this.bigExplosion(),function(a){return function(){return a.entity.removeComponent("ViewportFixed"),a.entity.attr({lightness:.3}),a.entity.barrel.attr({lightness:.3})}}(this),this.wait(1e4),this.endDecoy()))},c}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.Train=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.spawn=function(){var a;return a=Crafty.e("Enemy, Color").attr({x:-1200,y:160,defaultSpeed:20,health:900,w:1100,h:270}).enemy({projectile:"TrainBullet"}).color("#808080")},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.bindSequence("Progress",this.progress),this.point=-1050,this.entity.currentY=this.entity.y,this.sequence(this.moveTo({x:this.point}),this.repeat(this.sequence(this.moveTo({y:165,speed:10}),this.moveTo({y:155,speed:10}))))},c.prototype.progress=function(){var a;return this.bindSequence("Progress",this.progress),a=this.point,this.point+=200,this.sequence(this.moveTo({x:a-40,speed:50}),this.wait(500),this.moveTo({x:this.point,speed:150}),this.repeat(this.sequence(this.moveTo(function(a){return function(){return{y:a.entity.currentY}}}(this),{speed:10,positionType:"absoluteY"}),this.moveTo(function(a){return function(){return{y:a.entity.currentY+10}}}(this),{speed:10,positionType:"absoluteY"}))))},c.prototype.onKilled=function(){return this.bigExplosion()},c}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.TrainAssaulter=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.assets=function(){return this.loadAssets("playerShip")},c.prototype.spawn=function(a){var b,c,d,e,f;switch(b=null!=(d=a.from)?d:"top"){case"top":f=.3,this.endY=.6;break;case"middle":f=.5,this.endY=.5;break;default:f=.6,this.endY=.3}return c=Crafty.e("PlayerClone").attr({x:Crafty.viewport.width+40,y:f*Crafty.viewport.height,defaultSpeed:null!=(e=a.speed)?e:50,health:500}).playerClone(),c.addComponent("BurstShot").burstShot({projectile:function(a){return function(a,b,c){var d;return d=Crafty.e("Projectile, Color, Enemy, TrainBullet").attr({w:16,h:4,speed:550,damage:1}).color("#FFFF00"),d.shoot(a,b,c)}}(this)}),c},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.sequence(this.movePath([[.7,.5],[1.1,this.endY]],{rotate:!1}))},c.prototype.onKilled=function(){return this.bigExplosion()},c}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.Test=function(c){function d(){return d.__super__.constructor.apply(this,arguments)}return b(d,c),d.prototype.assets=function(){return this.loadAssets("playerShip")},d.prototype.execute=function(){return this.sequence(this.setScenery("Ocean"),this.async(this.runScript(a.Scripts.SunRise,{skipTo:2e5})),this.setSpeed(50))},d.prototype.testEnemy=function(b){return this.placeSquad(a.Scripts.EnemyTestScript,{amount:b,delay:2500,options:{entityName:"NewEnemyNameHere",assetsName:"newEnemyNameHere"}})},d.prototype.oldEnemy=function(b){return this.placeSquad(a.Scripts.Swirler,{amount:b,delay:2500})},d}(a.LazerScript),a.Scripts.EnemyTestScript=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.assets=function(a){var b;return this.loadAssets(null!=(b=a.assetsName)?b:"shadow")},c.prototype.spawn=function(a){return Crafty.e(a.entityName).initEnemy({x:Crafty.viewport.width+40,y:Crafty.viewport.height/2})},c.prototype.execute=function(){return this.sequence(this.setLocation({x:.5,y:.5}),this.wait(2e3),function(a){return function(){return a.entity.flipX()}}(this),this.wait(2e3),this.moveTo({x:1.1,y:.5,easing:"easeInQuad"}),this.movePath([[.5,.21],[.156,.5],[.5,.833]]),this.movePath([[.86,.52],[-100,.21]],{continuePath:!0,speed:400}))},c}(a.EntityScript),Crafty.c("EnemyPart",{autoAdjustSize:function(){var a,b,c;return c=Math.floor(this.w/32),a=Math.floor(this.h/32),b=16,this.attr({w:c*b,h:a*b})}}),Crafty.c("NewEnemyNameHere",{init:function(){return this.requires("Enemy, droneBody, EnemyPart"),this.parts={}},initEnemy:function(a){return null==a&&(a={}),this.attr(_.defaults(a,{health:200,defaultSpeed:200})),this.autoAdjustSize(),this.definePart("tfWing","droneTopFrontWing",30,-3,1),this.parts.tfWing.origin(5,10),this.definePart("tbWing","droneTopBackWing",15,-1,-1),this.parts.tbWing.origin(5,10),this.definePart("bfWing","droneBottomFrontWing",30,15,1),this.parts.bfWing.origin(5,5),this.definePart("bbWing","droneBottomBackWing",20,15,-1),this.parts.bbWing.origin(5,5),this.definePart("blades","droneRotorBlades",15,6,2),this.parts.blades.origin("center"),this.origin("center"),this.attr({weaponOrigin:[2,25]}),this.enemy(),this},definePart:function(a,b,c,d,e){var f;return f=Crafty.e("WebGL, EnemyPart").addComponent(b),this.parts[a]=f,f.autoAdjustSize(),f.attr({x:this.x+c,y:this.y+d,z:this.z+e}),this.attach(f)},updateMovementVisuals:function(a,b,c,d){var e;return e=Math.abs(1e3/d*b),b>0?this.flipX():this.unflipX(),null!=a&&this.updateBladeRotation(a,b),this.updateWingRotation(e,b)},updateBladeRotation:function(a,b){return b>0&&(a+=180),a=(360+a)%360,180>a?a/=2:a=(a-360)/2+360,this.parts.blades.rotation=-a},updateWingRotation:function(a,b){var c;return c=b>0?-1:1,this.rotatePart("tfWing",a,-20,25,c),this.rotatePart("tbWing",a,-20,25,c),this.rotatePart("bfWing",a,25,-20,-1*c),this.rotatePart("bbWing",a,25,-20,-1*c)},rotatePart:function(a,b,c,d,e){var f,g;return g=this.wingRotation(b,c,d)*e,g=(360+g+180)%360,f=(this.parts[a].rotation+180)%360,f>g?this.parts[a].rotation-=1:g>f?this.parts[a].rotation+=1:void 0},wingRotation:function(a,b,c){var d;return a<this.defaultSpeed?(this.defaultSpeed-a)/this.defaultSpeed*-20:(d=2*this.defaultSpeed,(d-this.defaultSpeed)/d*25)}}),a.levelGenerator.defineAssets("newAwesomeSpriteSheet",{contents:["newEnemyNameHere"],spriteMap:"high-drone.png",sprites:{newEnemyNameHere:{tile:32,tileh:32,map:{droneBody:[0,0,3,2],droneTopFrontWing:[3,0,2,1],droneBottomFrontWing:[3,1,2,1],droneBottomBackWing:[2,2,2,1],droneTopBackWing:[4,2,2,1],droneRotorBlades:[0,2,2,1]}}}})}.call(this)}(),function(){(function(){var a,b,c=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},d={}.hasOwnProperty;b=this.Game.levelGenerator,a=this.Game,b.defineElement("cloud",function(){var a,b,c,d,e,f,g,h;return f=Math.random(),a=4*Math.random(),f>.2&&(h=20*Math.random()+30,g=20*Math.random()+125,d=10*Math.random()+50,b=Crafty.e("2D, WebGL, cloud, Hideable, Horizon").attr({z:-300,w:g,h:d,topDesaturation:.6,bottomDesaturation:.6,alpha:.8*Math.random()+.2,lightness:.4,blur:a}),Math.random()<.7&&(b=b.flip("X")),this.addBackground(20+400*Math.random(),h,b,.375)),.6>f?(e=.2*Math.random()+.15,h=230-150*e,g=10*Math.random()+70-20*e,d=5*Math.random()+20-10*e,c=Crafty.e("2D, WebGL, cloud, Hideable, Horizon").attr({z:-570,w:g,h:d,topDesaturation:1-e,bottomDesaturation:1-e,alpha:.8*Math.random()+.2,lightness:.4,blur:a}),Math.random()<.2&&(c=c.flip("X")),this.addBackground(60+400*Math.random(),h,c,e)):void 0}),b.defineElement("waterHorizon",function(){var b,c;return c=Crafty.e("2D, WebGL, waterHorizon, SunBlock, Horizon").attr({z:-600,w:257}).colorDesaturation(a.backgroundColor).saturationGradient(1,.2),a.webGLMode===!1&&c.attr({lightness:.6}),this.addBackground(0,this.level.visibleHeight-225,c,.25),b=Crafty.e("2D, WebGL, Gradient, GoldenStripe").topColor("#DDDD00").bottomColor("#DDDD00",a.webGLMode!==!1?0:1).attr({z:-599,w:.25*this.delta.x,h:1,alpha:0}),this.addBackground(0,this.level.visibleHeight-225,b,.25)}),b.defineElement("water",function(){var b;return b=Crafty.e("2D, WebGL, waterMiddle, Horizon, ColorEffects").crop(1,0,511,192).attr({z:-500,w:513}).colorDesaturation(a.backgroundColor).saturationGradient(.7,-.4),a.webGLMode===!1&&b.attr({lightness:.8}),this.addBackground(0,this.level.visibleHeight-150,b,.5),this.level.registerWaveTween("OceanWavesMiddle",5500,"easeInOutQuad",function(a,b){var c,d,e;return e=5,c=20,d=192,Crafty("waterMiddle").each(function(){return b?(this.dy=a*e,this.h=d-a*c):(this.dy=e-a*e,this.h=d-c+a*c)})})}),b.defineElement("waterFront",function(){var a,b,c;return a=65,this.add(0,this.level.visibleHeight-45,Crafty.e("2D, Solid").attr({w:this.delta.x,h:45})),b=Crafty.e("2D, WebGL, waterFront1, Wave1").attr({z:-20}).crop(0,1,512,95),this.add(0,this.level.visibleHeight-a,b),b.originalY=b.y,c=Crafty.e("2D, WebGL, waterFront2, Wave2").attr({z:-20}).crop(0,1,512,95),this.add(512,this.level.visibleHeight-a,c),c.originalX=c.x,c.originalY=c.y,this.level.registerWaveTween("OceanWaves",6e3,"easeInOutQuad",function(b,c){var d,e,f,g;return d=50,e=40,f=5,g=513,a=125,Crafty("Wave1").each(function(){return c?(this.w=g+b*d,this.y=this.originalY+b*f,this.h=a-b*e):(this.w=g+d-b*d,this.y=this.originalY+f-b*f,this.h=a-e+b*e)}),Crafty("Wave2").each(function(){return c?(this.w=g-b*d,this.x=this.originalX+b*d,this.y=this.originalY+b*f,this.h=a-b*e):(this.w=g-d+b*d,this.x=this.originalX+d-b*d,this.y=this.originalY+f-b*f,this.h=a-e+b*e)}),Crafty("WaveFront").each(function(){return g=1200,d=120,a=200,e=80,c?(this.w=g+b*d,this.y=this.originalY+b*f,this.h=a-b*e):(this.w=g+d-b*d,this.y=this.originalY+f-b*f,this.h=a-e+b*e)})})}),b.defineElement("cityHorizon",function(b){var c;return this.addElement("waterHorizon"),c="start"===b?Crafty.e("2D, WebGL, ColorEffects, coastStart, SunBlock, Horizon"):Crafty.e("2D, WebGL, ColorEffects, coast, SunBlock, Horizon"),c.colorDesaturation(a.backgroundColor).saturationGradient(.9,.8).crop(1,0,255,32).attr({z:-598,w:256}),this.addBackground(0,this.level.visibleHeight-225-16,c,.25)}),b.defineElement("cityDistance",function(b){var c;return c=Crafty.e("2D, WebGL, ColorEffects, cityDistance, SunBlock, Horizon").colorDesaturation(a.backgroundColor).saturationGradient(.9,.6).crop(1,1,255,223).attr({z:-598,w:256}),this.addBackground(0,this.level.visibleHeight-225-16,c,.25)}),b.defineElement("city",function(){var b,c,d,e;return b=Crafty.e("2D, WebGL, cityLayer2, Collision, SunBlock, Horizon, Flipable").attr({z:-505}).collision([4,29,72,29,72,118,4,118]).colorDesaturation(a.backgroundColor).saturationGradient(.6,.6),this.addBackground(0,this.level.visibleHeight-350,b,.375),e=Crafty.e("2D, WebGL, city, Collision, SunBlock, Horizon").colorDesaturation(a.backgroundColor).saturationGradient(.4,.4).crop(0,0,511,288).attr({z:-305,w:513}),e.collision([35,155,35,10,130,10,160,155]),c=Crafty.e("2D, Collision, SunBlock"),c.attr({w:e.w,h:e.h}),c.collision([190,155,170,80,210,10,280,10,280,155]),d=Crafty.e("2D, Collision, SunBlock"),d.attr({w:e.w,h:e.h}),d.collision([370,155,370,40,505,40,505,155]),this.addBackground(0,this.level.visibleHeight-310,e,.5),this.addBackground(0,this.level.visibleHeight-310,c,.5),this.addBackground(0,this.level.visibleHeight-310,d,.5)}),b.defineElement("cityFrontTop",function(){var a,b,c,d;for(a=Crafty.e("2D, WebGL, bigBuildingTop, ColorEffects, RiggedExplosion").attr({z:-20}).crop(1,1,446,192),a.colorOverride("#001fff","partial"),this.add(0,this.level.visibleHeight-1200,a),c=d=0;3>d;c=++d)b=Crafty.e("2D, WebGL, bigBuildingLayer, ColorEffects").attr({z:-20}).crop(1,0,446,128),b.attr({x:a.x,y:a.y+a.h+c*b.h}),a.attach(b);return a.bind("BigExplosion",function(){var a,b,c,d;if(!this.buildingExploded&&this.x+this.w>-Crafty.viewport.x&&this.x<-Crafty.viewport.x+Crafty.viewport.width){for(Crafty.e("2D, WebGL, glass, Tween").attr({x:this.x,y:this.y+40,z:this.z+5}).bind("TweenEnd",function(){return this.destroy()}).tween({y:this.y+500},3e3,"easeInQuad"),Crafty.e("2D, WebGL, glass, Tween").attr({x:this.x+200,y:this.y+60,z:this.z+5}).bind("TweenEnd",function(){return this.destroy()}).tween({y:this.y+500},3e3,"easeInQuad"),Crafty.e("2D, WebGL, glass, Tween").attr({x:this.x,y:this.y+180,z:this.z+5}).bind("TweenEnd",function(){return this.destroy()}).tween({y:this.y+500},3e3,"easeInQuad"),Crafty.e("2D, WebGL, glass, Tween").attr({x:this.x+180,y:this.y+200,z:this.z+5}).bind("TweenEnd",function(){return this.destroy()}).tween({y:this.y+500},3e3,"easeInQuad"),this.sprite(30,13),d=this._children,b=0,c=d.length;c>b;b++)a=d[b],a.has("bigBuildingLayer")&&a.sprite(30,19);return this.buildingExploded=!0}})}),b.defineElement("cityFront",function(a,b,c){var d,e,f,g,h,i,j;for(null==a&&(a=6),null==b&&(b=0),null==c&&(c="bigBuildingBottom"),d=Crafty.e("2D, WebGL, bigBuildingTop, Collision, SunBlock, ColorEffects").attr({z:-20}).crop(1,1,446,192),d.colorOverride("#001fff","partial"),f=128*(a+2.5),d.collision([32,80,160,16,416,16,416,f,32,f]),this.add(b,this.level.visibleHeight-f-16,d),h=i=0,j=a;j>=0?j>i:i>j;h=j>=0?++i:--i)g=Crafty.e("2D, WebGL, bigBuildingLayer, ColorEffects").attr({z:-20}).crop(1,0,446,128),g.attr({x:d.x,y:d.y+d.h+h*g.h}),d.attach(g);return e=Crafty.e("2D, WebGL, "+c+", ColorEffects").attr({z:-20}).crop(1,1,446,184),e.attr({x:d.x,y:d.y+d.h+128*a}),d.attach(e)}),b.defineElement("cityFrontBlur",function(){return this.addBackground(200,this.level.visibleHeight-1350,Crafty.e("2D, WebGL, bigBuildingTop").crop(1,1,446,192).attr({w:768,h:288,z:50,lightness:.4}),1.5)}),b.defineElement("city-bridge",function(){var b,c;return b=Crafty.e("2D, WebGL, cityLayer2, Collision, SunBlock, Horizon").collision([4,29,72,29,72,118,4,118]).colorDesaturation(a.backgroundColor).saturationGradient(.6,.6).attr({z:-505}),this.addBackground(0,this.level.visibleHeight-350,b,.375),c=Crafty.e("2D, WebGL, cityBridge, Collision, Horizon").colorDesaturation(a.backgroundColor).saturationGradient(.4,.4).crop(0,0,511,160).attr({z:-305,w:513}),c.collision([35,155,35,0,130,0,130,155]),this.addBackground(0,this.level.visibleHeight-182,c,.5)}),b.defineElement("cityStart",function(){var b;return b=Crafty.e("2D, WebGL, cityStart, Collision, SunBlock, Horizon").attr({z:-305}).colorDesaturation(a.backgroundColor).saturationGradient(.4,.4),b.collision([215,155,215,60,300,60,300,10,500,10,500,155]),this.addBackground(0,this.level.visibleHeight-310,b,.5)}),a.CityScenery=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.assets=function(){return{sprites:{"city-scenery.png":{tile:32,tileh:32,map:{waterHorizon:[0,17,8,5],waterMiddle:[32,0,16,6],waterFront1:[0,29,16,3],waterFront2:[16,29,16,3],coastStart:[8,18,8,1],coast:[8,17,8,1],cityBridge:[0,24,16,5],cityStart:[0,0,16,9],city:[16,0,16,9],cityLayer2:[0,9,12,8],cityDistance:[32,6,8,7],cityDistanceBaseBottom:[32,9,8,4],cityDistanceBaseTop:[40,6,8,7],bigBuildingTop:[16,13,16,6],bigBuildingBrokenTop:[30,13,16,6],bigBuildingLayer:[16,19,16,4],bigBuildingBottom:[16,23,16,6],bigBuildingBottom2:[30,23,16,6],glass:[12,9,4,3],cloud:[16,9,8,3],shadow:[16,12,2,1],bridgeDeck:[0,32,16,6],damagedBridgeDeck:[0,48,16,6],bridgePillar:[36,29,6,17],bridgePillarBroken:[42,29,6,17],bigGlare:[0,38,7,7],sun:[0,22,2,2],directGlare:[7,38,6,6],aircraftCarrierEnd:[30,43,6,5],aircraftCarrierStart:[13,43,6,5],aircraftCarrierBottomFlat:[19,45,6,3],aircraftCarrierTopFlat:[26,43,4,2],aircraftCarrierOpenHatch:[31,40,5,1],aircraftCarrierCabinEnd:[24,38,2,7],aircraftCarrierCabin:[22,38,2,7],aircraftCarrierCabinRadar:[20,38,2,7],aircraftCarrierCabinStart:[19,38,1,7],aircraftCarrierRadar:[26,38,2,2],aircraftCarrierAntenna:[29,38,2,3],boxes:[28,39,1,1],boxesFalling:[28,38,1,1]}}}}},b}(a.LevelScenery),Crafty.c("carrierHatch",{init:function(){return this.requires("2D, WebGL, aircraftCarrierOpenHatch, SpriteAnimation"),this.attr({z:-10}),this.crop(0,2,160,32),this.reel("open",1e3,[[31,40],[31,38],[31,39]]),this.reel("close",1e3,[[31,39],[31,38],[31,40]])}}),b.defineBlock(function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.name="City.Intro",b.prototype.delta={x:1024,y:0},b.prototype.autoNext="Ocean",b.prototype.generate=function(){var a,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;for(b.__super__.generate.apply(this,arguments),this.addElement("waterFront"),c=Crafty.e("2D, BoxesLocation"),this.add(550,this.level.visibleHeight-340+224,c),c=Crafty.e("2D, BoxesLocation"),this.add(614,this.level.visibleHeight-340+224,c),c=Crafty.e("2D, WebGL, boxes").attr({z:-8}),this.add(622,this.level.visibleHeight-340+160,c),this.outside=Crafty.e("2D, WebGL").attr({w:800,h:128}),this.add(0,this.level.visibleHeight-330+224,this.outside),k=Crafty.e("2D, WebGL, aircraftCarrierEnd").attr({z:-13}),this.add(704,this.level.visibleHeight-330+160,k),v=Crafty.e("2D, WebGL, WaterSplashes").attr({z:30,w:800,h:160,alpha:.3}).setSealevel(this.level.visibleHeight+10).attr({waterRadius:8,minSplashDuration:1700,defaultWaterCooldown:800,waterSplashSpeed:700,minOffset:2,splashUpwards:!1}),this.add(0,this.level.visibleHeight-330+160,v),q=Crafty.e("carrierHatch"),this.add(260,this.level.visibleHeight-330+192,q),r=Crafty.e("carrierHatch"),this.add(60,this.level.visibleHeight-330+192,r),m=n=0;3>=n;m=++n)d=Crafty.e("2D, WebGL, aircraftCarrierBottomFlat").attr({z:20}),this.add(6*m*32-64,this.level.visibleHeight-330+224,d);for(t=[4,5],o=0,p=t.length;p>o;o++)m=t[o],u=Crafty.e("2D, WebGL, aircraftCarrierTopFlat").attr({z:-13}),this.add(4*m*32-64,this.level.visibleHeight-330+160,u);return u=Crafty.e("2D, WebGL, aircraftCarrierTopFlat").attr({z:-13}),this.add(-32,this.level.visibleHeight-330+160,u),h=Crafty.e("2D, WebGL, aircraftCarrierCabinEnd, ColorEffects").attr({z:-13}),h.colorOverride({_red:255,_green:255,_blue:255},"partial"),this.add(384,this.level.visibleHeight-330,h),g=Crafty.e("2D, WebGL, aircraftCarrierCabin, ColorEffects").attr({z:-13}),g.colorOverride({_red:255,_green:255,_blue:255},"partial"),this.add(320,this.level.visibleHeight-330,g),f=Crafty.e("2D, WebGL, aircraftCarrierCabinRadar, ColorEffects").attr({z:-13}),f.colorOverride({_red:255,_green:255,_blue:255},"partial"),this.add(256,this.level.visibleHeight-330,f),s=Crafty.e("2D, WebGL, aircraftCarrierRadar").attr({z:-11}),this.add(192,this.level.visibleHeight-330+22,s),a=Crafty.e("2D, WebGL, aircraftCarrierAntenna").attr({z:-11}),this.add(288,this.level.visibleHeight-318-32,a),e=Crafty.e("2D, WebGL, aircraftCarrierCabin, ColorEffects").attr({z:-13}),e.colorOverride({_red:255,_green:255,_blue:255},"partial"),this.add(128,this.level.visibleHeight-330,e),i=Crafty.e("2D, WebGL, aircraftCarrierCabinRadar, ColorEffects").attr({z:-13}),i.colorOverride({_red:255,_green:255,_blue:255},"partial"),this.add(192,this.level.visibleHeight-330,i),j=Crafty.e("2D, WebGL, aircraftCarrierCabinStart, ColorEffects").attr({z:-13}),j.colorOverride({_red:255,_green:255,_blue:255},"partial"),this.add(96,this.level.visibleHeight-330,j),this.addElement("water"),this.addElement("waterHorizon"),l=Crafty.e("2D, WebGL, waterFront1, WaveFront").attr({z:30,w:this.delta.x+.5*Crafty.viewport.width+1,h:200,lightness:.5}).crop(0,1,512,95),this.addBackground(0,this.level.visibleHeight-18,l,1.25),l.originalY=l.y,this.addElement("cloud")},b.prototype.enter=function(){var a,c,d,e;return b.__super__.enter.apply(this,arguments),this.speed=this.level._forcedSpeed,Crafty("ScrollWall").attr({y:120}),this.level.setForcedSpeed(0),c=[{type:"delay",duration:1e3},{type:"delay",duration:1e3,event:"openHatch"},{type:"linear",y:-80,duration:1200,easingFn:"easeInOutQuad"},{event:"lift",type:"linear",x:70,y:-10,easingFn:"easeInQuad",duration:1200},{type:"delay",duration:1,event:"unlock"},{type:"delay",duration:1,event:"go"}],a=this,e=null,d=function(a){return e&&e.has("Choreography")?(a.attr({x:e.x-200,y:e.y}),e.disableControls&&a.disableControl(),a.addComponent("Choreography"),a.synchChoreography(e),a.one("ChoreographyEnd",function(){return this.removeComponent("Choreography",!1)}),a.one("unlock",function(){return this.enableControl(),this.weaponsEnabled=!0}),a.weaponsEnabled=e.weaponsEnabled):void 0},this.bind("ShipSpawned",d),Crafty("PlayerControlledShip").each(function(b){return 0!==b?d(this):(e=this,this.addComponent("Choreography"),this.attr({x:300-200*b,y:Crafty.viewport.height-50-this.h}),this.disableControl(),this.weaponsEnabled=!1,this.choreography(c),this.one("ChoreographyEnd",function(b){return function(){return b.removeComponent("Choreography","no"),a.unbind("ShipSpawned")}}(this)),this.one("unlock",function(){return this.enableControl(),this.weaponsEnabled=!0}),this.one("openHatch",function(){return Crafty("carrierHatch").each(function(){return this.animate("open")})}),this.one("lift",function(){return a.outside.addComponent("Solid"),Crafty("carrierHatch").each(function(){return this.animate("close")}),Crafty("aircraftCarrierBottomFlat").each(function(){return this.attr({z:-13})}),Crafty("ScrollWall").each(function(){return this.addComponent("Tween"),this.tween({y:0},2500),this.one("TweenEnd",function(){return this.removeComponent("Tween",!1)})})}),this.one("go",function(){return a.level.setForcedSpeed(a.speed,{accelerate:!1})}))})},b}(a.CityScenery)),b.defineBlock(function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.name="City.Ocean",b.prototype.delta={x:1024,y:0},b.prototype.generate=function(){return b.__super__.generate.apply(this,arguments),this.addElement("cloud"),this.addElement("cloud"),this.addElement("waterHorizon"),this.addElement("water"),this.addElement("waterFront")},b}(a.CityScenery)),b.defineBlock(function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.name="City.CoastStart",b.prototype.delta={x:1024,y:0},b.prototype.autoNext="Coast",b.prototype.autoPrevious="Ocean",b.prototype.generate=function(){return b.__super__.generate.apply(this,arguments),this.addElement("cloud"),this.addElement("cityHorizon","start"),this.addElement("water"),this.addElement("waterFront")},b}(a.CityScenery)),b.defineBlock(function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.name="City.Coast",b.prototype.delta={x:1024,y:0},b.prototype.generate=function(){return b.__super__.generate.apply(this,arguments),this.addElement("waterFront"),this.addElement("cityHorizon"),this.addElement("water"),this.addElement("cloud")},b}(a.CityScenery)),b.defineBlock(function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.name="City.BayStart",b.prototype.delta={x:1024,y:0},b.prototype.autoNext="Bay",b.prototype.autoPrevious="Coast",b.prototype.generate=function(){return b.__super__.generate.apply(this,arguments),this.addElement("cloud"),this.addElement("cityHorizon"),this.addElement("water"),this.addElement("waterFront"),this.addElement("cityStart")},b}(a.CityScenery)),b.defineBlock(function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.name="City.Bay",b.prototype.delta={x:1024,y:0},b.prototype.generate=function(){return b.__super__.generate.apply(this,arguments),this.addElement("cloud"),this.addElement("waterFront"),this.addElement("water"),this.addElement("cityHorizon"),this.addElement("city")},b}(a.CityScenery)),b.defineBlock(function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.name="City.BayFull",b.prototype.delta={x:1024,y:0},b.prototype.generate=function(){return b.__super__.generate.apply(this,arguments),this.addElement("cloud"),this.addElement("waterFront"),this.addElement("water"),this.addElement("cityDistance"),this.addElement("city")},b}(a.CityScenery)),b.defineBlock(function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.name="City.UnderBridge",b.prototype.delta={x:1024,y:0},b.prototype.autoNext="BayFull",b.prototype.generate=function(){var a,c,d,e,f,g;return b.__super__.generate.apply(this,arguments),this.notifyOffsetX=-100,this.addElement("waterFront",{lightness:.8}),this.addElement("water"),this.addElement("cityDistance"),this.addElement("city-bridge"),a=Crafty.viewport.width,e=1.1*Crafty.viewport.height,this.addBackground(0,335,this.deck(.55,!1,{w:550,z:-280}),.55),this.addBackground(0,295,this.deck(.45,!0,{w:600,z:-270}),.6),this.addBackground(0,255,this.deck(.35,!1,{w:650,z:-260}),.65),this.addBackground(40,290,this.pillar(.35,{h:200,z:-261}),.65),this.addBackground(870,290,this.pillarX(.35,{h:200,z:-261}),.65),this.addBackground(0,205,this.deck(.25,!0,{w:700,z:-50}),.7),this.addBackground(0,155,this.deck(.15,!1,{w:750,z:-40}),.75),this.addBackground(10,180,this.pillar(0,{h:350,z:-31}),.8),this.addBackground(830,180,this.pillarX(0,{h:350,z:-31}),.8),this.addBackground(0,95,this.deck(.05,!0,{w:800,z:-30}),.8),this.addBackground(0,20,this.deck(0,!1,{w:900,z:-20}).addComponent("BackDeck"),.9),d=Crafty.e("2D, Solid, Collision, BridgeCeiling").attr({w:1e3,h:30}).origin("middle right"),this.addBackground(0,-60,d,1),c=this.deck(0,!0,{w:1e3,z:-10}).addComponent("MainDeck"),this.addBackground(0,-60,c,1),this.addBackground(0,-180,this.deck(0,!1,{w:1200,z:100,lightness:.6,blur:0}).addComponent("FrontDeck"),1.2),f=this.pillar(0,{h:750,z:80,lightness:.6,blur:0}).addComponent("TiltPillarLeft"),g=this.pillarX(0,{h:750,z:80,lightness:.6,blur:0}).addComponent("TiltPillarRight"),this.addBackground(-20,-60,f,1.2),this.addBackground(834,-60,g,1.2),this.bind("BridgeCollapse",{once:!0},function(a){return function(a){var b,e;return b=Crafty("FrontDeck").get(0).addComponent("TweenPromise").sprite(16,32),c=Crafty("MainDeck").get(0).addComponent("TweenPromise").sprite(16,32),e=Crafty("BackDeck").get(0).addComponent("TweenPromise").sprite(16,32),b.half.sprite(16,32),c.half.sprite(16,32),e.half.sprite(16,32),f=Crafty("TiltPillarLeft").get(0).addComponent("TweenPromise").sprite(42,29),g=Crafty("TiltPillarRight").get(0).addComponent("TweenPromise").sprite(42,29),d=Crafty("BridgeCeiling").get(0).addComponent("TweenPromise"),a.setForcedSpeed(200,{accelerate:!0}),WhenJS.sequence([function(){return WhenJS.parallel([function(){return b.tweenPromise({rotation:-12,dy:b.dy+100},4e3,"easeInQuad")},function(){return c.tweenPromise({rotation:-10,dy:c.dy+100},4e3,"easeInQuad")},function(){return d.tweenPromise({rotation:-10,dy:d.dy+100},4e3,"easeInQuad")},function(){return e.tweenPromise({rotation:-7,dy:e.dy+100},4e3,"easeInQuad")},function(){return f.tweenPromise({rotation:-7,dy:f.dy+100},3e3,"easeInQuad")},function(){return g.tweenPromise({rotation:7},3e3,"easeInQuad")}])},function(){return WhenJS.parallel([function(){return b.tweenPromise({dy:b.dy+400},4e3,"easeInQuad")},function(){return c.tweenPromise({dy:c.dy+430},4e3,"easeInQuad")},function(){return d.tweenPromise({dy:d.dy+430},4e3,"easeInQuad")},function(){return e.tweenPromise({dy:e.dy+400},4e3,"easeInQuad")},function(){return f.tweenPromise({rotation:-27,dy:f.dy+300},3e3,"easeInQuad")},function(){return g.tweenPromise({rotation:27,dy:g.dy+200},3e3,"easeInQuad")}])}])}}(this))},b.prototype.deck=function(a,b,c){
var d,e,f,g;return d=1024/180,c.h=c.w/d,e=b?"#2ba04c":"#b15a5a",g=Crafty.e("2D, WebGL, bridgeDeck, ColorEffects, Horizon, SunBlock, SpriteAnimation").crop(0,2,511,180).attr(_.extend(c,{w:c.w/2})).saturationGradient(a,a).colorOverride(e,"partial"),f=Crafty.e("2D, WebGL, bridgeDeck, ColorEffects, Horizon, SunBlock, SpriteAnimation").crop(0,2,511,180).saturationGradient(a,a).flip("X").colorOverride(e,"partial"),f.attr(_.extend(c,{x:g.x+g.w,y:g.y,z:g.z,w:g.w,h:g.h})),g.half=f,g.attach(f),g.origin(g.h/2,2*g.w),g},b.prototype.pillar=function(a,b){var c;return c=180/534,b.w=b.h*c,b.h=b.h,Crafty.e("2D, WebGL, bridgePillar, ColorEffects, Horizon, SunBlock").crop(2,0,180,534).attr(b).saturationGradient(a,a)},b.prototype.pillarX=function(a,b){return this.pillar(a,b).flip("X")},b}(a.CityScenery)),b.defineBlock(function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.name="City.Skyline",b.prototype.delta={x:1024,y:0},b.prototype.generate=function(){return b.__super__.generate.apply(this,arguments),this.addElement("cityFrontTop"),this.addElement("cityFrontBlur"),this.addElement("water"),this.addElement("cityDistance"),this.addElement("city")},b}(a.CityScenery)),b.defineBlock(function(b){function d(){return d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.name="City.SkylineBase",d.prototype.delta={x:1024,y:0},d.prototype.autoNext="Skyline2",d.prototype.generate=function(){var b,c,e;return d.__super__.generate.apply(this,arguments),this.addElement("cityFront"),e=600,b=Crafty.e("2D, WebGL, ColorEffects, cityDistanceBaseTop, SunBlock, Horizon").colorDesaturation(a.backgroundColor).saturationGradient(.9,.6).crop(1,1,255,223).attr({z:-598,w:256}),this.addBackground(0,this.level.visibleHeight-225-16-127,b,.25),c=Crafty.e("2D, WebGL, ColorEffects, cityDistanceBaseBottom, MiliBase, SunBlock, Horizon").colorDesaturation(a.backgroundColor).saturationGradient(.9,.6).crop(1,1,255,127).attr({z:-598,w:256}),this.addBackground(0,this.level.visibleHeight-225-16+96,c,.25),this.addElement("city"),e=700,this.add(0,this.level.visibleHeight-100,Crafty.e("2D, WebGL, Color, SunBlock").attr({w:this.delta.x,h:e,z:-10}).color("#505050"))},d}(a.CityScenery)),b.defineBlock(function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.name="City.Skyline2",b.prototype.delta={x:1024,y:0},b.prototype.generate=function(){var a,c,d;return b.__super__.generate.apply(this,arguments),this.addElement("cityFront"),this.addElement("cityFront",4,512,"bigBuildingBottom2"),this.addElement("water"),this.addElement("cityDistance"),this.addElement("city"),a=160,this.add(0,this.level.visibleHeight-100,Crafty.e("2D, WebGL, Color, SunBlock").attr({w:this.delta.x,h:a,z:-25}).color("#555")),c=10,this.add(0,this.level.visibleHeight-100+a,Crafty.e("2D, WebGL, Color, SunBlock").attr({w:this.delta.x,h:c,z:-25}).color("#777")),d=400,this.add(0,this.level.visibleHeight-100+a+c,Crafty.e("2D, WebGL, Color, SunBlock").attr({w:this.delta.x,h:d,z:-25}).color("#333")),d=40,this.add(0,this.level.visibleHeight+170-d,Crafty.e("2D, Solid").attr({w:this.delta.x,h:d,z:2}))},b}(a.CityScenery)),b.defineBlock(function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.name="City.TrainTunnel",b.prototype.delta={x:1024,y:0},b.prototype.generate=function(){var a,c;return b.__super__.generate.apply(this,arguments),a=150,this.add(0,this.level.visibleHeight-100,Crafty.e("2D, WebGL, Color, SunBlock, Solid").attr({w:this.delta.x,h:a,z:-10}).color("#505050")),c=400,this.add(0,this.level.visibleHeight-100+a,Crafty.e("2D, WebGL, Color, SunBlock").attr({w:this.delta.x,h:c,z:-10}).color("#202020")),a=150,this.add(0,this.level.visibleHeight-100+a+c,Crafty.e("2D, WebGL, Color, Solid, SunBlock").attr({w:this.delta.x,h:a+c,z:-10}).color("#505050"))},b}(this.Game.LevelScenery)),b.defineBlock(function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.name="City.SmallerTrainTunnel",b.prototype.delta={x:1024,y:0},b.prototype.generate=function(){var a,c,d;return b.__super__.generate.apply(this,arguments),a=250,this.add(0,this.level.visibleHeight-100,Crafty.e("2D, WebGL, Color, SunBlock, Solid").attr({w:this.delta.x,h:a,z:-10}).color("#505050")),c=300,this.add(0,this.level.visibleHeight-100+a,Crafty.e("2D, WebGL, Color, SunBlock").attr({w:this.delta.x,h:c,z:-10}).color("#202020")),d=350,this.add(0,this.level.visibleHeight-100+a+c,Crafty.e("2D, WebGL, Color, Solid, SunBlock").attr({w:this.delta.x,h:d,z:-10}).color("#505050"))},b}(this.Game.LevelScenery))}).call(this),function(){var a;a=this.Game.levelGenerator,a.defineAssets("explosion",{contents:["explosion"],spriteMap:"explosion.png",sprites:{all:{tile:96,tileh:96,map:{explosionStart:[0,0]}}},audio:{explosion:["explosion.ogg"],shoot:["laser-shot.ogg"],hit:["laser-hit.ogg"],powerup:["powerup.ogg"],laugh:["laugh.ogg"]}}),a.defineAssets("player",{contents:["playerShip","shipEngineFire","mine","drone","rocket","helicopter","largeDrone","laserTank"],spriteMap:"city-enemies.png",sprites:{all:{tile:32,tileh:32,map:{playerShip:[0,0,3,2],playerShipDamaged:[0,2,3,2],muzzleFlash:[10,0,1,1],shipEngineFire:[3,0,3,1],freddie:[3,1,3,2],standardMine:[3,3,1,1],standardDrone:[0,4,2,2],standardRocket:[4,4,2,1],helicopter:[0,6,4,2],heliDamaged:[8,6,4,2],standardLargeDrone:[0,8,3,3],eyeStart:[6,0,1,1],wingLoaded:[12,2,2,1],rapidFireBoost:[11,0,1,1],speedBoost:[12,0,1,1],damageBoost:[13,0,1,1],aimBoost:[14,0,1,1],heart:[13,1,1,1],star:[14,1,1,1],powerUpBox:[10,1,1,1],sphere1:[7,3,1,1],laserTank:[0,11,6,3],laserTankBarrel:[6,11,4,2]}}}}),a.defineAssets("portraits",{contents:["general"],spriteMap:"portraits.png",sprites:{all:{tile:32,tileh:32,map:{pGeneral:[0,0,4,4],pPilot:[0,4,4,4]}}}})}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game.levelGenerator,a.defineElement("blockcloud",function(){var a,b,c,d,e,f,g,h;return f=Math.random(),a=4*Math.random(),f>.2&&(h=20*Math.random()+100,g=20*Math.random()+125,d=10*Math.random()+50,b=Crafty.e("2D, WebGL, Color").attr({z:-300,w:g,h:d,alpha:.8*Math.random()+.2}).color("#FFFFFF"),Math.random()<.7&&(b=b.flip("X")),this.addBackground(20+400*Math.random(),h,b,.5)),.6>f?(e=.2*Math.random()+.25,h=280-150*e,g=10*Math.random()+70-20*e,d=5*Math.random()+20-10*e,c=Crafty.e("2D, WebGL, Color").attr({z:-570,w:g,h:d,alpha:.8*Math.random()+.2}).color("#FFFFFF"),Math.random()<.2&&(c=c.flip("X")),this.addBackground(30+400*Math.random(),h,c,e)):void 0}),a.defineBlock(function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.name="City.Blackness",c.prototype.delta={x:600,y:0},c.prototype.generate=function(){return c.__super__.generate.apply(this,arguments)},c}(this.Game.LevelScenery)),a.defineBlock(function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.name="City.OceanOld",c.prototype.delta={x:800,y:0},c.prototype.generate=function(){var a,b;return c.__super__.generate.apply(this,arguments),b=65,this.add(0,this.level.visibleHeight-45,Crafty.e("2D, Solid").attr({w:this.delta.x,h:45})),this.add(0,this.level.visibleHeight-b,Crafty.e("2D, WebGL, Color, SunBlock").attr({w:this.delta.x,h:b,z:-300}).color("#6262d2")),this.addBackground(0,this.level.visibleHeight-225,Crafty.e("2D, WebGL, Color, SunBlock").color("#33337e").attr({z:-600,w:.25*this.delta.x+1,h:200}),.25),a=Crafty.e("2D, WebGL, Gradient, GoldenStripe").topColor("#DDDD00").bottomColor("#DDDD00",Game.webGLMode?0:1).attr({z:-599,w:.25*this.delta.x,h:1,alpha:0}),this.addBackground(0,this.level.visibleHeight-225,a,.25),this.addElement("blockcloud"),this.addBackground(0,this.level.visibleHeight-150,Crafty.e("2D, WebGL, Color, SunBlock").color("#3030B0").attr({z:-500,w:.5*this.delta.x+1,h:105}),.5),this.addBackground(0,this.level.visibleHeight-90,Crafty.e("2D, WebGL, Color, SunBlock").color("#3030B0").attr({z:-301,w:.5*this.delta.x+1,h:70}),.5)},c}(this.Game.LevelScenery)),a.defineBlock(function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.name="City.OceanToNew",c.prototype.delta={x:1024,y:0},c.prototype.autoNext="Ocean",c.prototype.generate=function(){var a,b,d,e,f,g,h,i,j;return c.__super__.generate.apply(this,arguments),h=Crafty.e("2D, WebGL, waterHorizon, SunBlock, Horizon").attr({z:-601}).colorDesaturation(Game.backgroundColor).saturationGradient(1,.5),Game.webGLMode===!1&&h.attr({lightness:.6}),this.addBackground(0,this.level.visibleHeight-225,h,.25),i=Crafty.e("2D, WebGL, Gradient, SunBlock").topColor("#33337e").bottomColor("#33337e",0).attr({z:-600,rotation:-90,h:.25*this.delta.x+1,w:200}),this.addBackground(0,this.level.visibleHeight-25,i,.25),a=Crafty.e("2D, WebGL, Gradient, GoldenStripe").topColor("#DDDD00").bottomColor("#DDDD00",Game.webGLMode?0:1).attr({z:-599,w:.25*this.delta.x,h:1,alpha:0}),this.addBackground(0,this.level.visibleHeight-225,a,.25),j=Crafty.e("2D, WebGL, waterMiddle, SunBlock, Horizon").crop(1,0,511,192).saturationGradient(.7,0).attr({z:-501,w:513}),Game.webGLMode===!1&&j.attr({lightness:.8}),this.addBackground(0,this.level.visibleHeight-150,j,.5),g=Crafty.e("2D, WebGL, Gradient, SunBlock").topColor("#3030B0").bottomColor("#3030B0",0).attr({z:-500,rotation:-90,h:.5*this.delta.x+1,w:200}),this.addBackground(0,this.level.visibleHeight+50,g,.5),b=65,this.add(0,this.level.visibleHeight-45,Crafty.e("2D, Solid").attr({w:this.delta.x,h:45})),d=Crafty.e("2D, WebGL, waterFront1, Wave1, SunBlock").attr({z:-300}),this.add(0,this.level.visibleHeight-b,d),d.originalY=d.y,e=Crafty.e("2D, WebGL, waterFront2, Wave2, SunBlock").attr({z:-300}),this.add(512,this.level.visibleHeight-b,e),e.originalX=e.x,e.originalY=e.y,f=Crafty.e("2D, WebGL, Gradient, SunBlock").topColor("#6262d2").bottomColor("#6262d2",0).attr({z:-299,rotation:-90,h:this.delta.x,w:200}),this.add(0,this.level.visibleHeight-b+200,f)},c}(Game.CityScenery)),a.defineBlock(function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.name="City.OpenSpace",c.prototype.delta={x:700,y:0},c.prototype.generate=function(){return c.__super__.generate.apply(this,arguments),this.add(0,150,Crafty.e("2D, WebGL, Solid, Color").color("#505045").attr({w:42,h:70})),this.add(500,50,Crafty.e("2D, WebGL, Solid, Color").color("#404045").attr({w:82,h:70})),this.add(200,250,Crafty.e("2D, WebGL, Solid, Color").color("#505045").attr({w:52,h:80})),this.add(100,450,Crafty.e("2D, WebGL, Solid, Color").color("#505045").attr({w:52,h:40})),this.add(400,550,Crafty.e("2D, WebGL, Solid, Color").color("#404040").attr({w:82,h:30}))},c}(this.Game.LevelScenery)),a.defineBlock(function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.name="City.TunnelStart",c.prototype.delta={x:1e3,y:0},c.prototype.autoNext="Tunnel",c.prototype.generate=function(){return c.__super__.generate.apply(this,arguments),this.addBackground(380,this.level.visibleHeight-180,Crafty.e("2D, WebGL, Color").color("#505050").attr({z:-110,w:40,h:180}),.5),this.addBackground(380,this.level.visibleHeight-90,Crafty.e("2D, WebGL, Color").color("#606060").attr({z:-200,w:40,h:90}),.25),this.addBackground(380,this.level.visibleHeight-360,Crafty.e("2D, WebGL, Color").color("#303030").attr({z:22,w:40,h:360}),1.5),this.add(0,-40,Crafty.e("2D, WebGL, Solid, Color").color("#404040").attr({w:350,h:55})),this.add(350,-40,Crafty.e("2D, WebGL, Solid, Color").color("#404040").attr({w:100,h:110})),this.add(450,-40,Crafty.e("2D, WebGL, Solid, Color").color("#404040").attr({w:550,h:65})),this.add(380,-40,Crafty.e("2D, WebGL, Color").color("#202020").attr({z:-10,w:this.delta.x-380,h:this.level.visibleHeight+40}))},c}(this.Game.LevelScenery)),a.defineBlock(function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.name="City.TunnelEnd",c.prototype.delta={x:1e3,y:0},c.prototype.autoNext="OceanOld",c.prototype.generate=function(){var a;return c.__super__.generate.apply(this,arguments),this.addBackground(380,this.level.visibleHeight-360,Crafty.e("2D, WebGL, Color").color("#303030").attr({z:22,w:40,h:360}),1.5),this.addBackground(380,this.level.visibleHeight-180,Crafty.e("2D, WebGL, Color").color("#505050").attr({z:-110,w:40,h:180}),.5),this.addBackground(380,this.level.visibleHeight-90,Crafty.e("2D, WebGL, Color").color("#606060").attr({z:-800,w:40,h:90}),.25),a=15,this.add(0,this.level.visibleHeight-a,Crafty.e("2D, WebGL, Solid, Color").color("#404040").attr({w:350,h:a})),a=70,this.add(350,this.level.visibleHeight-a,Crafty.e("2D, WebGL, Solid, Color").color("#404040").attr({w:100,h:a})),a=25,this.add(450,this.level.visibleHeight-a,Crafty.e("2D, WebGL, Solid, Color").color("#404040").attr({w:550,h:a})),this.add(0,-40,Crafty.e("2D, WebGL, Color").color("#202020").attr({z:-10,w:380,h:this.level.visibleHeight+40}))},c}(this.Game.LevelScenery)),a.defineBlock(function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.name="City.Tunnel",c.prototype.delta={x:1e3,y:0},c.prototype.generate=function(){var a;return c.__super__.generate.apply(this,arguments),this.add(0,-40,Crafty.e("2D, WebGL, Solid, Color").color("#404040").attr({w:350,h:55})),this.add(350,-40,Crafty.e("2D, WebGL, Solid, Color").color("#404040").attr({w:100,h:110})),this.add(450,-40,Crafty.e("2D, WebGL, Solid, Color").color("#404040").attr({w:550,h:65})),a=15,this.add(0,this.level.visibleHeight-a,Crafty.e("2D, WebGL, Solid, Color").color("#404040").attr({w:350,h:a})),a=70,this.add(350,this.level.visibleHeight-a,Crafty.e("2D, WebGL, Solid, Color").color("#404040").attr({w:100,h:a})),a=25,this.add(450,this.level.visibleHeight-a,Crafty.e("2D, WebGL, Solid, Color").color("#404040").attr({w:550,h:a})),this.add(0,-40,Crafty.e("2D, WebGL, Color").color("#202020").attr({z:-1,w:this.delta.x,h:this.level.visibleHeight+40}))},c}(this.Game.LevelScenery))}.call(this)}(),function(){(function(){var a,b,c,d;b=null,c=null,d=null,a=this.Game,Crafty.defineScene("Game",function(e){var f,g,h,i,j,k,l,m;return null==e&&(e={}),a.backgroundColor=null,b=a.levelGenerator.createLevel(),Crafty.createLayer("UILayerDOM","DOM",{scaleResponse:0,yResponse:0,xResponse:0,z:40}),Crafty.createLayer("UILayerWebGL","WebGL",{scaleResponse:0,yResponse:0,xResponse:0,z:35}),Crafty.createLayer("StaticBackground","WebGL",{scaleResponse:0,yResponse:0,xResponse:0,z:0}),m=a.levelGenerator.loadAssets(["explosion"]).then(function(a){return function(){var a,b;return a=WhenJS.defer(),b=Crafty.e("WebGL, explosion"),setTimeout(function(){return b.destroy(),a.resolve()},100),a.promise}}(this)),b.start(),Crafty("Player").each(function(){return this.level=b}),i={startAtCheckpoint:null!=(j=e.checkpoint)?j:0},l=null!=(k=null!=e?e.script:void 0)?k:"Stage1",e.checkpoint?(h="Checkpoint "+e.checkpoint,"function"==typeof window.ga&&window.ga("send","event","Game","CheckpointStart",h)):(h="Begin","function"==typeof window.ga&&window.ga("send","event","Game","Start",h)),g=function(e,f){var g;return d=e,g=a.Scripts[e],null==g?void console.error("Script "+e+" is not defined"):(c=new g(b),c.run(f).then(function(){return Crafty.trigger("ScriptFinished",c)})["catch"](function(a){if("sequence mismatch"!==a.message)throw a}))},f=0,Crafty.bind("ScriptFinished",function(a){var b;return b=Math.max(0,a.startAtCheckpoint-a.currentCheckpoint),f+=a.currentCheckpoint,a.nextScript?g(a.nextScript,{startAtCheckpoint:b}):(a.gotoGameOver&&Crafty.enterScene("GameOver",{gameCompleted:!0}),console.log("End of content!"))}),m.then(function(){return g(l,i)}),Crafty.bind("GameOver",function(){return window.ga("send","event","Game","End","Checkpoint "+c.currentCheckpoint),Crafty.enterScene("GameOver",{checkpoint:f+c.currentCheckpoint,script:l})}),new a.PauseMenu},function(){return c.end(),b.stop(),Crafty("Player").each(function(){return this.removeComponent("ShipSpawnable")}),Crafty.unbind("GameOver"),Crafty.unbind("ScriptFinished"),Crafty.unbind("GamePause")})}).call(this),function(){Crafty.defineScene("GameOver",function(a){var b,c,d,e,f,g,h;return b=window.Game,Crafty.background("#000"),Crafty.viewport.x=0,Crafty.viewport.y=0,h=Crafty.viewport.width,d=Crafty.viewport.height,g="Game Over",a.gameCompleted&&(g="Congratulations"),Crafty.e("2D, DOM, Text").attr({x:0,y:.2*d,w:h}).text(g).textColor("#FF0000").textAlign("center").textFont({size:"50px",weight:"bold",family:"Press Start 2P"}),f=function(a){return function(){var b,c,f,g,i,j,k,l,m;for(b=null,c=f=0,i=e.length;i>f;c=++f)l=e[c],l.player===a.player&&(b=c);return m=a.name+": "+a.points,10>b&&(k=function(){switch(b){case 0:return"ACE";case 1:return"2nd";case 2:return"3rd";default:return b+1+"th"}}(),m+=" - "+k),Crafty.e("2D, DOM, Text").attr({x:0,y:.45*d+45*a.index,w:h}).text(m).textColor(a.color).textAlign("center").textFont({size:"20px",weight:"bold",family:"Press Start 2P"}),10>b?(j=Crafty.e("2D, DOM, Text").attr({x:.25*h,y:.45*d+45*(a.index+1),w:h}).text("Enter name: ").textColor(a.color).textAlign("left").textFont({size:"20px",weight:"bold",family:"Press Start 2P"}),g=Crafty.e("TextInput").attr({x:.6*h,y:.45*d+45*(a.index+1),w:h}).textColor(a.color).textAlign("left").textFont({size:"20px",weight:"bold",family:"Press Start 2P"}),g.textInput(a.player,3).then(function(b){var c,d,e,f,h;return h=function(){var a,b,c,d;return(b=localStorage.getItem("SPDLZR"))?(c=b.slice(0,20),a=b.slice(20),l=CryptoJS.AES.decrypt(a,c),d=l.toString(CryptoJS.enc.Utf8),d.length>1?JSON.parse(d):[]):[]},f=h(),f.push({initials:b,score:a.points,time:(new Date).getTime()}),c=JSON.stringify(f),e=CryptoJS.AES.encrypt(c,"secret").toString().slice(8,28),d=CryptoJS.AES.encrypt(c,e).toString(),localStorage.setItem("SPDLZR",e+d),j.destroy(),g.destroy()})):void 0}},c=[],e=_.clone(b.highscores()),Crafty("Player ControlScheme").each(function(a){var b;return b=null,e.push({initials:null,player:this,score:this.points}),c.push(f({index:a,name:this.name,points:this.points,player:this,color:this.color()})),window.ga("send","event","Game","Score",void 0,this.points)}),e=_.sortBy(e,"score").reverse(),WhenJS.sequence(c).then(function(c){return function(){return Crafty.e("Delay").delay(function(){var c,e,f;return b.credits>0&&!a.gameCompleted?(f=10,g=1===b.credits?"1 Credit left":b.credits+" Credits left",Crafty.e("2D, DOM, Text").attr({x:0,y:.8*d,w:h}).textColor("#FF0000").textAlign("center").textFont({size:"15px",weight:"bold",family:"Press Start 2P"}).text(g),c=Crafty.e("2D, DOM, Text").attr({x:0,y:.8*d+30,w:h}).textColor("#FF0000").textAlign("center").textFont({size:"15px",weight:"bold",family:"Press Start 2P"}),e="Press fire to continue",c.text(e+" "+("00"+f).slice(-2)),this.delay(function(){return f-=1,c.text(e+" "+("00"+f).slice(-2))},1e3,f,function(){return Crafty.enterScene("Scores")}),Crafty("Player").each(function(){return this.reset(),this.one("Activated",function(){return b.credits-=1,Crafty.enterScene(b.firstLevel,a)})})):this.delay(function(){return Crafty.enterScene("Scores")},5e3)},2e3,0)}}(this))},function(){return Crafty("Delay").each(function(){return this.destroy()}),Crafty("Player").each(function(){return this.unbind("Activated")})})}.call(this),function(){Crafty.defineScene("Intro",function(){var a,b,c,d,e;return a=window.Game,a.resetCredits(),Crafty.background("#000000"),Crafty.viewport.x=0,Crafty.viewport.y=0,e=Crafty.viewport.width,c=Crafty.viewport.height,d=.15,Crafty.e("2D, DOM, Text, Tween, Delay").attr({x:e*(.5-d),y:.4*c,w:400}).text("Speedlazer").textColor("#0000ff").textFont({size:"40px",weight:"bold",family:"Press Start 2P"}).delay(function(){return this.tween({x:e*(.5+d)-400},2e3),this.one("TweenEnd",function(){return this.tween({x:e*(.5-d)},2e3)})},4e3,-1),Crafty.e("2D, DOM, Text, Tween, Delay").attr({x:.5*e-150,y:.6*c,w:300}).text("Press fire to start!").textColor("#FF0000").textFont({size:"15px",weight:"bold",family:"Press Start 2P"}).delay(function(){return this.tween({alpha:.5},1e3),this.one("TweenEnd",function(){return this.tween({alpha:1},1e3)})},2e3,-1),b=a.highscores()[0],Crafty.e("2D, DOM, Text").attr({x:0,y:.85*c,w:e}).text("HI SCORE: "+b.score+" "+b.initials).textColor("#FFFF00").textAlign("center").textFont({size:"10px",weight:"bold",family:"Press Start 2P"}),Crafty("Player").each(function(){return this.reset(),this.one("Activated",function(){return Crafty.enterScene(a.firstLevel)})}),Crafty.e("Delay").delay(function(){return Crafty.enterScene("Scores")},2e4)},function(){return Crafty("Delay").each(function(){return this.destroy()}),Crafty("Player").each(function(){return this.unbind("Activated")})})}.call(this),function(){Crafty.defineScene("New",function(){})}.call(this),function(){Crafty.defineScene("Scores",function(){var a,b,c,d,e;return a=window.Game,a.resetCredits(),Crafty.background("#000000"),Crafty.viewport.x=0,Crafty.viewport.y=0,e=Crafty.viewport.width,b=Crafty.viewport.height,Crafty.e("2D, DOM, Text").attr({x:0,y:.1*b,w:e}).text("Highscores").textColor("#FFFF00").textAlign("center").textFont({size:"40px",weight:"bold",family:"Press Start 2P"}),d=a.highscores(),c=0,Crafty.e("Delay").delay(function(){var a,f,g;return a=d[c],a?(f=function(){switch(c){case 0:return"ACE";case 1:return"2nd";case 2:return"3rd";default:return c+1+"th"}}(),g=function(){switch(c){case 0:return"20px";case 1:case 2:return"18px";default:return"15px"}}(),Crafty.e("2D, DOM, Text").attr({x:0,y:.25*b+36*c,w:e}).text(f+"  "+a.score+" "+a.initials).textColor("#FFFF00").textAlign("center").textFont({size:g,weight:"bold",family:"Press Start 2P"}),c+=1):void 0},500,9),Crafty("Player").each(function(){return this.reset(),this.one("Activated",function(){return Crafty.enterScene(a.firstLevel)})}),Crafty.e("Delay").delay(function(){return Crafty.enterScene("Intro")},2e4)},function(){return Crafty("Delay").each(function(){return this.destroy()}),Crafty("Player").each(function(){return this.unbind("Activated")})})}.call(this)}(),function(){function a(){var a=$("#cr-stage").height(),b=$("#cr-stage").width(),c=$(window).height()-50,d=$(window).width(),e=c/a,f=d/b,g=Math.min(e,f);$("#cr-stage").css("transform","scale("+g+")"),$("footer").css({top:576*g})}window.Game.start(!1),$(window).on("resize",function(){a()}),$(document).on("click","#cr-stage",function(){screenfull.enabled&&(screenfull.request($("#theater")[0]),$("body").addClass("fullscreen"),a(),document.addEventListener(screenfull.raw.fullscreenchange,function(){screenfull.isFullscreen||($("body").removeClass("fullscreen"),a())}))}),setTimeout(function(){a()},0)}();