!function(){"use strict";Crafty.c("Bullet",{init:function(){this.addComponent("2D, Canvas, Color")},fire:function(a){this.attr({damage:a.damage}).bind("EnterFrame",function(){this.x=this.x+a.speed,this.x>1200&&this.destroy()}).bind("HitTarget",function(b){a.origin.trigger("BulletHit",{bullet:this,target:b.target})}).bind("DestroyTarget",function(b){a.origin.trigger("BulletDestroy",{bullet:this,target:b.target})})}})}(),function(){"use strict";Crafty.c("Enemy",{init:function(){this.addComponent("2D, Canvas, Color, Collision")},enemy:function(a){this.attr({x:a.x,y:a.y,w:50,h:50,health:300}).color("#00F").bind("EnterFrame",function(){this.x=this.x-2,this.x<-100&&(this.destroy(),console.log("Uhoh"))}).onHit("Bullet",function(a){var b=a[0].obj;b.trigger("HitTarget",{target:this}),this.health-=b.damage,this.health<=0&&(b.trigger("DestroyTarget",{target:this}),this.destroy()),b.destroy()})}})}(),function(){"use strict";Crafty.defineScene("GameOver",function(a){Crafty.background("#111"),Crafty.e("2D, Canvas, Text").attr({x:200,y:210,w:150}).text("Game Over").textColor("#F00").textFont({size:"80px",weight:"bold",family:"Courier new"}),Crafty.e("2D, Canvas, Text").attr({x:240,y:410,w:200}).text("Score: "+a.score).textColor("#F00").textFont({size:"50px",weight:"bold",family:"Courier new"})},function(){})}(),function(){"use strict";Crafty.defineScene("Space",function(){Crafty.background("#111");var a=Crafty.e("2D, Canvas, Color, Multiway, GamepadMultiway, Keyboard, Gamepad, Collision").attr({x:140,y:350,w:30,h:30,lives:1,points:0}).color("#F00").multiway({y:3,x:1},{UP_ARROW:-90,DOWN_ARROW:90,LEFT_ARROW:180,RIGHT_ARROW:0}).gamepadMultiway({speed:{y:3,x:1},gamepadIndex:0}).bind("Moved",function(a){this.hit("Edge")&&this.attr({x:a.x,y:a.y})}).onHit("Enemy",function(){this.loseLife()}).bind("KeyDown",function(a){a.key===Crafty.keys.M&&this.shoot()}).bind("GamepadKeyChange",function(a){0===a.button&&a.pressed&&this.shoot()}).bind("BulletHit",function(){this.addPoints(10)}).bind("BulletDestroy",function(){this.addPoints(50)});a.shoot=function(){Crafty.e("Bullet").color(this.color()).attr({x:this.x+this.w,y:this.y+this.h/2,w:5,h:5}).fire({origin:this,damage:100,speed:4,direction:0})},a.loseLife=function(){this.lives-=1,this.attr({x:140,y:350}),this.trigger("UpdateLives",{lives:this.lives}),this.lives<=0&&Crafty.enterScene("GameOver",{score:this.points})},a.addPoints=function(a){this.points+=a,this.trigger("UpdatePoints",{points:this.points})};var b=Crafty.e("2D, Canvas, Text").attr({x:10,y:10,w:150}).text("Score: "+a.points).textColor(a.color()).textFont({size:"20px",weight:"bold",family:"Courier new"});a.bind("UpdatePoints",function(a){b.text("Score: "+a.points)}),Crafty.e("2D, Canvas, Text").attr({x:180,y:10,w:150}).text("Lives: "+a.lives).textColor(a.color()).textFont({size:"20px",weight:"bold",family:"Courier new"}),a.bind("UpdateLives",function(a){b.text("Lives: "+a.lives)}),Crafty.e("2D, Canvas, Edge").attr({x:10,y:20,w:900,h:2}),Crafty.e("2D, Canvas, Edge").attr({x:10,y:750,w:900,h:2}),Crafty.e("2D, Canvas, Edge").attr({x:10,y:20,w:2,h:730}),Crafty.e("2D, Canvas, Edge").attr({x:910,y:20,w:2,h:730});var c=(new Date).getTime(),d=.4,e=5e3;Crafty.bind("EnterFrame",function(){var a=((new Date).getTime()-c)*d;if(a>e){var b=Crafty.math.randomInt(40,720);Crafty.e("Enemy").enemy({x:1200,y:b}),e+=Crafty.math.randomInt(100,2e3),console.log("Time to spawn!")}})},function(){Crafty.unbind("EnterFrame")})}(),function(){"use strict";var a={start:function(){Crafty.load([],function(){Crafty.init(1024,768),Crafty.background("#111"),Crafty.enterScene("Space")})}};$(document).on("click","button",function(){a.start(),screenfull.enabled&&screenfull.request($("#cr-stage")[0])})}(),function(){Crafty.debugBar.show()}();