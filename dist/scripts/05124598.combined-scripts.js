!function(){"use strict"}(),function(){(function(){}).call(this),function(){Crafty.c("Enemy",{init:function(){return this.requires("2D, Canvas, Collision, Choreography, ViewportFixed")},enemy:function(){return Crafty.trigger("EnemySpawned",this),this.onHit("Bullet",function(a){var b;if(!this.hidden)return b=a[0].obj,b.trigger("HitTarget",{target:this}),this.trigger("Hit",this),this.health-=b.damage,this.health<=0&&(b.trigger("DestroyTarget",{target:this}),Crafty.trigger("EnemyDestroyed",this),this.trigger("Destroyed",this),this.destroy()),b.destroy()}),this},sendToBackground:function(a,b){var c,d;return c=null!=(d=this.scale)?d:1,this.attr({scale:a,w:this.w/c*a,h:this.h/c*a,z:b}),this.hidden=!0},hide:function(a){return this.hideMarker=a,this.hidden=!0,this.attr({alpha:0})},reveal:function(){var a,b,c,d;return null!=(b=this.hideMarker)&&b.destroy(),this.hidden=!1,a=null!=(c=this.scale)?c:1,d=1,this.attr({scale:d,w:this.w/a*d,h:this.h/a*d,alpha:1,z:0})},remove:function(){var a;return null!=(a=this.hideMarker)?a.destroy():void 0}})}.call(this),function(){Crafty.c("Invincible",{init:function(){return this.requires("Delay, Color"),this.rawColor=this.color(),this.delay(this._blink,250,-1)},_blink:function(){return null==this.blinkOn&&(this.blinkOn=!0),this.blinkOn=!this.blinkOn,this.blinkOn?this.color(this.rawColor,.5):this.color(this.rawColor,100)},remove:function(){return this.color(this.rawColor),this.cancelDelay(this._blink)},invincibleDuration:function(a){return this.delay(function(){return this.removeComponent("Invincible")},a,0)}})}.call(this),function(){Crafty.c("ScrollWall",{init:function(){return this.requires("2D, Canvas, Color, Edge, Collision"),this.attr({x:0,y:0,w:2,h:Crafty.viewport.height,speed:{x:0,y:0}}),this._speed={x:0,y:0},this.wallEnd=Crafty.e("2D, Canvas, ScrollFront, Edge").attr({x:-(Crafty.viewport.x-Crafty.viewport.width)-3,y:0,h:Crafty.viewport.height,w:12}),this.attach(this.wallEnd),this.wallTop=Crafty.e("2D, Canvas, Edge, Collision").attr({x:0,y:40,h:2,w:Crafty.viewport.width}),this.attach(this.wallTop),this.wallBottom=Crafty.e("2D, Canvas, Edge, Collision").attr({x:0,y:Crafty.viewport.height-2,h:2,w:Crafty.viewport.width}),this.attach(this.wallBottom),this.bind("EnterFrame",function(a){var b,c;return b=this._speed.x,c=this._speed.y,this.allowPushing&&Crafty("PlayerControlledShip").each(function(){var a,d,e,f,g;return g=Crafty.viewport.width*(2/3),f=this.x+Crafty.viewport.x,f>g?(e=(f-g)/(Crafty.viewport.width-g),a=(5+this._forcedSpeed.x)*e,b>0&&(d=(b+a)/b,c*=d),b+=a):void 0}),this.x+=b/1e3*a.dt,this.y+=c/1e3*a.dt,Crafty.viewport.y!==-this.y&&(Crafty.viewport.y=-this.y),Crafty.viewport.x!==-this.x?Crafty.viewport.x=-this.x:void 0})},scrollWall:function(a){return null!=a.x&&null!=a.y?(this._speed.x=a.x,this._speed.y=a.y):(this._speed.x=a,this._speed.y=0),this},setAllowPushing:function(a){this.allowPushing=a},off:function(){return this.wallEnd.removeComponent("Edge"),this.unbind("EnterFrame")},remove:function(){return this.unbind("EnterFrame")}})}.call(this),function(){Crafty.c("ShipSpawnable",{init:function(){return this.requires("Listener"),this.bind("Activated",this.spawnShip)},remove:function(){return this.unbind("Activated",this.spawnShip)},spawnPosition:function(a,b){return this.spawnPosition=a,this.armed=null!=b?b:!0,null==this.spawnPosition&&(this.spawnPosition=function(){return{x:x,y:y}}),this},spawnShip:function(a){var b;return null==a&&(a=this.armed),this.has("ControlScheme")&&this.lives>0?(b=this.spawnPosition(),this.ship=Crafty.e("PlayerControlledShip").attr({x:b.x-Crafty.viewport.x,y:b.y-Crafty.viewport.y,z:this.z}),this.has("Color")&&this.ship.color(this.color()),this.has("ControlScheme")&&this.assignControls(this.ship),a&&this.ship.installItem("lasers"),this.listenTo(this.ship,"BulletHit",function(){return this.stats.shotsHit+=1,this.addPoints(10)}),this.listenTo(this.ship,"BulletDestroyedTarget",function(){return this.stats.enemiesKilled+=1,this.addPoints(50)}),this.listenTo(this.ship,"PowerUp",function(){return this.addPoints(20)}),this.listenTo(this.ship,"Shoot",function(){return this.stats.shotsFired+=1}),Crafty.trigger("ShipSpawned",this.ship),this.ship.start(),this.listenTo(this.ship,"Hit",function(){var a;return a=this.ship.hasItem("lasers"),this.ship.destroy(),this.ship=null,this.loseLife(),this.spawnShip(a)}),this):void 0}})}.call(this),function(){Crafty.c("StageEnd",{init:function(){return this.requires("2D, Canvas, HUD, Delay, Color")},stageEnd:function(a,b,c){var d;return this.lineNr=0,this.attr({w:580,h:200,alpha:.2}).positionHud({x:40,y:130,z:90}).color("#000000"),d=Crafty.e("Text, DOM").attr({x:this.x,y:this.y+10,w:this.w,z:91}).css("textAlign","center").text("Stage "+b+" Cleared: "+c).textColor("#FFFFFF").textFont({size:"12px",weight:"bold",family:"Courier new"}),this.attach(d),this.delay(function(b){switch(this.lineNr){case 0:return this.showPlayerHeaders(),this.showAccuracy(a);case 2:return this.showShotsFired(a);case 3:return this.showEnemiesKilled(a);case 4:return this.showLives(a);case 5:return this.showWeaponXP(a);case 6:return this.showTotals(a)}},2e3,6)},showPlayerHeaders:function(){var a;return a=[""],Crafty("Player").each(function(){return a.push(this.has("ControlScheme")?this.name:""),a.push("")}),this.addCelledLine(a)},showAccuracy:function(a){var b;return b=["Accuracy"],Crafty("Player").each(function(){var a,c;return this.has("ControlScheme")?(c=this.stats.shotsHit>0&&this.stats.shotsFired>0?Math.round(this.stats.shotsHit/this.stats.shotsFired*1e3)/10:0,b.push(c+"%"),a=Math.round(100*c),b.push(a),this.stats.bonus+=a):(b.push(""),b.push(""))}),this.addCelledLine(b)},showShotsFired:function(a){var b;return b=["Shots fired"],Crafty("Player").each(function(){var a,c,d;return this.has("ControlScheme")?(d=this.stats.shotsFired,b.push(""+d),a=this.stats.shotsHit>0&&this.stats.shotsFired>0?this.stats.shotsHit/this.stats.shotsFired:0,c=Math.round(d*(a+a)),b.push(c),this.stats.bonus+=c):(b.push(""),b.push(""))}),this.addCelledLine(b)},showEnemiesKilled:function(a){var b;return b=["Enemies Killed"],Crafty("Player").each(function(){var c,d,e;return this.has("ControlScheme")?(this.stats.enemiesKilled>0&&a.data.enemiesSpawned>0?(d=this.stats.enemiesKilled/a.data.enemiesSpawned,e=Math.round(1e3*d)/10):e=0,b.push(e+"%"),c=Math.round(100*e),b.push(c),this.stats.bonus+=c):(b.push(""),b.push(""))}),this.addCelledLine(b)},showLives:function(a){var b;return b=["Lives"],Crafty("Player").each(function(){var a,c;return this.has("ControlScheme")?(c=this.lives,b.push(""+c),a=Math.round(1e3*c),b.push(a),this.stats.bonus+=a):(b.push(""),b.push(""))}),this.addCelledLine(b)},showWeaponXP:function(a){var b;return b=["WeaponXP"],Crafty("Player").each(function(){var a,c,d,e,f;return this.has("ControlScheme")?(f=null!=(a=null!=(c=this.ship)&&null!=(d=c.primaryWeapon)?d.xp:void 0)?a:0,b.push(""+f),e=Math.round(10*f),b.push(e),this.stats.bonus+=e):(b.push(""),b.push(""))}),this.addCelledLine(b)},showTotals:function(a){var b;return b=["Totals"],Crafty("Player").each(function(){return this.has("ControlScheme")?(b.push(""),b.push(this.stats.bonus),this.addPoints(this.stats.bonus),this.stats.bonus=0):(b.push(""),b.push(""))}),this.addCelledLine(b)},addCelledLine:function(a){var b,c,d,e,f,g,h,i;for(this.lineNr+=1,i=this.y+20+20*this.lineNr,h=0,c=500/(a.length+.5),g=[],d=e=0,f=a.length;f>e;d=++e)b=a[d],g.push(function(a){return function(b,d){var e,f,g;return f=c,0===d&&(f+=c/2),g=0===d?a.x+h:a.x+h+c*(d+.5),e=Crafty.e("Text, DOM").attr({x:g,y:i,w:f,z:3}).css("textAlign","right").text(b).textColor("#FFFFFF").textFont({size:"12px",weight:"normal",family:"Courier new"}),2!==d&&4!==d||"number"!=typeof b||(e.attr({endScore:b,v:0}),e.text(e.v),e.bind("EnterFrame",function(a){return this.v+=3*a.dt+3,this.v>this.endScore&&(this.v=this.endScore,this.unbind("EnterFrame")),this.text(this.v)})),a.attach(e)}}(this)(b,d));return g}})}.call(this),function(){Crafty.c("StageTitle",{init:function(){return this.requires("2D, DOM, Text, Tween, Delay, HUD")},stageTitle:function(a){return this.attr({w:640,z:1}).css("textAlign","center").text(a).positionHud({x:this.x,y:240,z:-1}).textColor("#FF0000").textFont({size:"30px",weight:"bold",family:"Courier new"}).delay(function(){return this.tween({viewportY:this.viewportY+500,alpha:0},3e3),this.bind("TweenEnd",function(a){return function(){return a.destroy()}}(this))},3e3,0)}})}.call(this),function(){Crafty.c("ShootOnSight",{init:function(){return this.bind("EnterFrame",this._checkForShot)},remove:function(){return this.unbind("EnterFrame",this._checkForShot)},_checkForShot:function(a){var b;if(!(null!=this.lastShotAt&&(this.lastShotAt+=a.dt,this.lastShotAt<1e3)))return b=this,Crafty("PlayerControlledShip").each(function(){var a;return a=Math.atan2(b.y-this.y,b.x-this.x),a*=180/Math.PI,Math.abs(a-b.rotation)<.5?b._shoot(a+180):void 0})},_shoot:function(a){return this.lastShotAt=0,Crafty.e("2D, Canvas, Enemy, Color, ViewportFixed").attr({x:this.x,y:this.y,w:4,h:4,speed:250,rotation:a}).color("#FFFF00").bind("EnterFrame",function(a){var b;return b=a.dt*(this.speed/1e3),this.x+=Math.cos(this.rotation/180*Math.PI)*b,this.y+=Math.sin(this.rotation/180*Math.PI)*b,(this.x<-Crafty.viewport.x||this.x>-Crafty.viewport.x+Crafty.viewport.width)&&this.destroy(),this.y<-Crafty.viewport.y||this.y>-Crafty.viewport.y+Crafty.viewport.height?this.destroy():void 0})}})}.call(this),function(){Crafty.c("GamepadControls",{init:function(){return this.requires("Listener"),this.bind("RemoveComponent",function(a){return"ControlScheme"===a?this.removeComponent("GamepadControls"):void 0})},remove:function(){return this.unbind("GamepadKeyChange",this._keyHandling)},setupControls:function(a){return a.addComponent("GamepadControls").controls(this.controlMap).addComponent("ControlScheme")},controls:function(a){return this.controlMap=a,null!=a.gamepadIndex?(this.requires("Gamepad"),this.gamepad(a.gamepadIndex),this.bind("GamepadKeyChange",this._keyHandling),this):void 0},_keyHandling:function(a){return a.button===this.controlMap.fire&&a.pressed?this.trigger("Fire",a):void 0},assignControls:function(a){return a.addComponent("GamepadMultiway, Gamepad").gamepad(this.controlMap.gamepadIndex).gamepadMultiway({speed:{y:4,x:4},gamepadIndex:this.controlMap.gamepadIndex,analog:!0}),this.listenTo(a,"GamepadKeyChange",function(b){return function(c){return c.button===b.controlMap.fire?a.shoot(c.pressed):void 0}}(this))}})}.call(this),function(){Crafty.c("KeyboardControls",{init:function(){return this.requires("Listener"),this.bind("RemoveComponent",function(a){return"ControlScheme"===a?this.removeComponent("KeyboardControls"):void 0})},remove:function(){return this.unbind("KeyDown",this._keyHandling)},setupControls:function(a){return a.addComponent("KeyboardControls").controls(this.controlMap).addComponent("ControlScheme")},controls:function(a){return this.controlMap=a,this.bind("KeyDown",this._keyHandling),this},_keyHandling:function(a){return a.key===this.controlMap.fire?this.trigger("Fire",a):void 0},assignControls:function(a){var b,c,d,e,f,g,h,i,j;b=this.controlMap,h={},d={up:-90,down:90,left:180,right:0};for(c in d){j=d[c],g=b[c],i=Crafty.keys;for(e in i)f=i[e],f===g&&(h[e]=j)}return a.addComponent("Multiway, Keyboard").multiway({y:4,x:4},h),this.listenTo(a,"KeyDown",function(c){return c.key===b.fire?a.shoot(!0):void 0}),this.listenTo(a,"KeyUp",function(c){return c.key===b.fire?a.shoot(!1):void 0})}})}.call(this),function(){Crafty.c("Drone",{init:function(){return this.requires("Color, Enemy")},drone:function(a){return null==a&&(a={}),this.attr(_.defaults(a,{w:25,h:25,health:300})),this.origin("center"),this.color("#0000FF"),this.enemy(),this}})}.call(this),function(){Crafty.c("Explosion",{init:function(){return this.requires("Color,Tween,2D,Canvas,Delay")},explode:function(a){var b,c,d,e;return d=null!=(e=a.radius)?e:20,this.attr(a),c={maxParticles:8*a.radius,size:a.radius,sizeRandom:8,speed:a.radius/13,speedRandom:.5,lifeSpan:19,lifeSpanRandom:7,angle:0,angleRandom:360,startColour:[235,135,5,1],startColourRandom:[28,150,45,.2],endColour:[135,135,135,0],endColourRandom:[60,60,60,.1],sharpness:10,sharpnessRandom:10,spread:a.radius/2,duration:400/Crafty.timer.FPS(),fastMode:!0,gravity:{x:0,y:0},jitter:0},this.attr({w:1,h:1}),this.tween({x:this.x-d,y:this.y-d,w:this.w+2*d,h:this.h+2*d},500),this.bind("TweenEnd",function(){return this.destroy()}),b=(c.lifeSpan+c.lifeSpanRandom)*Crafty.timer.FPS(),Crafty.e("2D,Canvas,Particles,Delay").attr({x:this.x,y:this.y}).particles(c).bind("ParticleEnd",function(){return this.delay(function(){return this.destroy()},b)}),this}})}.call(this),function(){Crafty.c("LargeDrone",{init:function(){return this.requires("Color, Enemy")},drone:function(a){return null==a&&(a={}),this.attr(_.defaults(a,{w:45,h:35,health:800})),this.origin("center"),this.color("#0000DF"),this.enemy(),this}})}.call(this),function(){Crafty.c("Mine",{init:function(){return this.requires("Color, Enemy")},mine:function(a){return null==a&&(a={}),this.attr(_.defaults(a,{w:25,h:25,health:200})),this.origin("center"),this.color("#555555"),this.enemy(),this}})}.call(this),function(){Crafty.c("PowerUp",{init:function(){return this.requires("2D,Canvas,Color"),this.color("#20FF20"),this.attr({w:20,h:20})},remove:function(){},powerUp:function(a){var b;return this.settings=a,this.settings.marking&&(b=Crafty.e("2D,Canvas,Text").textColor("#000000").textFont({size:"16px",weight:"bold",family:"Bank Gothic"}).text(this.settings.marking).attr({x:4,y:1}),this.attach(b)),this}})}.call(this),function(){Crafty.c("Rocket",{init:function(){return this.requires("Color, Enemy")},rocket:function(a){var b;return null==a&&(a={}),this.attr(_.defaults(a,{w:45,h:15,health:300})),this.origin("center"),this.color("#F00000"),b={maxParticles:150,size:10,sizeRandom:8,speed:3,speedRandom:.5,lifeSpan:19,lifeSpanRandom:7,angle:90,angleRandom:10,startColour:[235,135,5,1],startColourRandom:[28,150,45,.2],endColour:[135,135,135,0],endColourRandom:[60,60,60,.1],sharpness:10,sharpnessRandom:10,spread:5,duration:-1,fastMode:!0,gravity:{x:0,y:-.12},jitter:0},this.attach(Crafty.e("2D,Canvas,Particles").attr({x:this.x+this.w-Crafty.viewport.x,y:this.y-Crafty.viewport.y}).particles(b)),this.enemy(),this}})}.call(this),function(){Crafty.c("Sun",{init:function(){var a,b,c,d;return this.requires("2D, Canvas, Color, Choreography, ViewportFixed, Collision"),this.attr({w:20,h:20,z:-1e3}).color("#DDDD00"),this.origin("center"),this.glare=[],c=Crafty.e("2D, Canvas, Color, Glare").attr({w:1.5*this.w,h:1.5*this.h,z:90,alpha:.4,originalAlpha:.4}).color("#FFFFFF").origin("center"),this.attach(c),this.glare.push(c),b=Crafty.e("2D, Canvas, Color, Glare").attr({mirrored:!0,w:80,h:80,z:91,res:.9,alpha:.7,originalAlpha:.7}).color("#B0B0FF").origin("center"),this.attach(b),this.glare.push(b),d=Crafty.e("2D, Canvas, Color, Glare").attr({mirrored:!0,w:10,h:10,z:92,res:.82,alpha:.8,originalAlpha:.8}).color("#FF9090").origin("center"),this.attach(d),this.glare.push(d),a=Crafty.e("2D, Canvas, Color, Glare").attr({mirrored:!0,w:200,h:200,z:93,alpha:.2,res:1.1,originalAlpha:.2}).color("#FF9090").origin("center"),this.attach(a),this.glare.push(a)},sun:function(a){return this.attr(a),this.bind("EnterFrame",this._updateGlare),this},remove:function(){return this.unbind("EnterFrame",this._updateGlare)},_updateGlare:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z;for(a=[0],u=this.area(),r=this.hit("2D"),i=0,k=r.length;k>i;i++)n=r[i],n.obj!==this&&(n.obj.has("Glare")||n.obj.has("HUD")||(d=n.obj,x=Math.max(this.x,d.x),w=Math.min(this.x+this.w,d.x+d.w),v=w-x,z=Math.max(this.y,d.y),y=Math.min(this.y+this.h,d.y+d.h),e=y-z,a.push(v*e)));for(m=1.7*Math.max.apply(Math,a),o=m/u,m>u&&(o=1),h=Crafty.viewport.width/2,f=Crafty.viewport.height/2,b=this.x+this.w/2-(-1*Crafty.viewport._x+h),c=this.y+this.h/2-(-1*Crafty.viewport._y+f),p=b/h,q=c/f,s=this.glare,j=0,l=s.length;l>j;j++)d=s[j],d.attr({alpha:d.originalAlpha*(1-o)}),d.attr(d.mirrored?{x:this.x+this.w/2-d.w/2-2*b*d.res,y:this.y+this.h/2-d.h/2-2*c*d.res}:{w:1.5*this.w,h:1.5*this.h,x:this.x+this.w/2-d.w/2,y:this.y+this.h/2-d.h/2});return g=325-Crafty.viewport._y-this.y,t=20+15*(Math.min(Math.max(g,0),150)/150),this.w=t,this.h=t,Crafty("GoldenStripe").each(function(){return this.attr(0>=g?{alpha:1-Math.min(Math.abs(g),10)/10,h:1}:g>0&&1>g?{alpha:1,h:1}:40>g?{alpha:1-Math.min(Math.abs(g),40)/40,h:Math.abs(Math.min(g/2,20))}:{alpha:0,h:20})})}})}.call(this),function(){Crafty.c("WaterSplash",{init:function(){return this.requires("2D,Canvas,Particles,Delay")},waterSplash:function(a){var b,c;return c={maxParticles:100,size:a.size/2,sizeRandom:4,speed:a.size/7,speedRandom:.2,lifeSpan:a.size,lifeSpanRandom:7,angle:0,angleRandom:20,startColour:[50,50,170,1],startColourRandom:[0,0,0,0],endColour:[255,255,255,.1],endColourRandom:[30,30,30,.1],sharpness:20,sharpnessRandom:10,spread:a.size,duration:900/Crafty.timer.FPS(),fastMode:!0,gravity:{x:0,y:.15},jitter:1},b=(c.lifeSpan+c.lifeSpanRandom)*Crafty.timer.FPS(),this.attr({x:a.x,y:a.y}).particles(c).bind("ParticleEnd",function(){return this.delay(function(){return this.destroy()},b)}),this}})}.call(this),function(){Crafty.c("Choreography",{init:function(){return this.bind("EnterFrame",this._choreographyTick),this._ctypes={bezier:this._executeBezier,delay:this._executeDelay,linear:this._executeLinear,viewport:this._executeMoveIntoViewport,viewportBezier:this._executeViewportBezier,tween:this._executeTween}},remove:function(){return null!=this._currentPart?(this._currentPart=null,this.trigger("ChoreographyEnd")):void 0},choreography:function(a,b){return null==b&&(b={}),this._options=_.defaults(b,{repeat:0,compensateCameraSpeed:!1}),this._options.compensateCameraSpeed&&(this.camera=Crafty(Crafty("ScrollWall")[0]),this._options.cameraLock={x:this.camera.x}),this._choreography=a,this._repeated=0,this._setupCPart(0),this},synchChoreography:function(a){return this._choreography=_.clone(a._choreography),this._options=a._options,this._repeated=a._repeated,this._currentPart=_.clone(a._currentPart),this._currentPart.x+=this.x-a.x,this._currentPart.y+=this.y-a.y,this._currentPart.easing=_.clone(a._currentPart.easing)},_setupCPart:function(a){var b;if(this._currentPart=null,!(a<this._choreography.length)){if(!(this._repeated<this._options.repeat||-1===this._options.repeats))return void this.trigger("ChoreographyEnd");this._repeated+=1,a=0}return b=this._choreography[a],null!=b.event&&this.trigger(b.event,{entity:this,data:b.data}),this._setupPart(b,a)},_choreographyTick:function(a){var b;if(null!=this._currentPart)return this._currentPart.easing.tick(a.dt),b=this._currentPart.easing.value(),this._ctypes[this._currentPart.type].apply(this,[b]),this._options.compensateCameraSpeed&&(this.x+=this.camera.x-this._options.cameraLock.x),this._currentPart.easing.complete?this._setupCPart(this._currentPart.part+1):void 0},_setupPart:function(a,b){var c,d,e,f,g;if(this._currentPart=_.extend(_.clone(a),{part:b,x:this.x,y:this.y,dx:null!=(e=a.x)?e:0,dy:null!=(f=a.y)?f:0,easing:new Crafty.easing(null!=(g=a.duration)?g:0)}),a.properties){c={};for(d in a.properties)c[d]=this[d];return this._currentPart.currentProperties=c}},_executeLinear:function(a){return this.x=this._currentPart.x+a*this._currentPart.dx,this.y=this._currentPart.y+a*this._currentPart.dy},_executeDelay:function(a){},_executeMoveIntoViewport:function(a){var b,c,d,e,f,g,h,i;return d=this._currentPart.dx,null==(b=this._currentPart).moveOriginX&&(b.moveOriginX=this._currentPart.x+Crafty.viewport.x),f=d-this._currentPart.moveOriginX,h=f*a,this.x=this._currentPart.moveOriginX+h-Crafty.viewport.x,e=this._currentPart.dy,null==(c=this._currentPart).moveOriginY&&(c.moveOriginY=this._currentPart.y+Crafty.viewport.y),g=e-this._currentPart.moveOriginY,i=g*a,this.y=this._currentPart.moveOriginY+i-Crafty.viewport.y},_executeTween:function(a){var b,c,d,e;d=this._currentPart.properties,e=[];for(b in d)c=d[b],e.push(this[b]=(1-a)*this._currentPart.currentProperties[b]+a*c);return e},_executeBezier:function(a){var b,c,d;return b=new Game.BezierPath,null==this._currentPart.bPath&&(d=b.scalePoints(this._currentPart.path,{origin:{x:this.x,y:this.y},scale:{x:Crafty.viewport.width,y:Crafty.viewport.height}}),this._currentPart.bPath=b.buildPathFrom(d)),c=b.pointOnPath(this._currentPart.bPath,a),this._currentPart.rotation&&(this.rotation=b.angleOnPath(this._currentPart.bPath,a)),this.x=c.x,this.y=c.y},_executeViewportBezier:function(a){var b,c,d;return b=new Game.BezierPath,null==this._currentPart.bPath&&(this._currentPart.bPath=b.buildPathFrom(this._currentPart.path)),null==this._currentPart.viewport&&(this._currentPart.viewport={y:Crafty.viewport.y}),this._currentPart.rotation&&(this.rotation=b.angleOnPath(this._currentPart.bPath,a)),d=this._currentPart.viewport.y-Crafty.viewport.y,c=b.pointOnPath(this._currentPart.bPath,a),this.attr({x:c.x,y:c.y+d})}})}.call(this),function(){var a=[].slice;Crafty.c("ColorFade",{init:function(){return this.requires("Color")},colorFade:function(){var b,c;return c=arguments[0],b=2<=arguments.length?a.call(arguments,1):[],this.colors=b,this.duration=c.duration,this.background=c.background,this.v=0,this.bind("EnterFrame",this._recolor)},remove:function(){return this.unbind("EnterFrame",this._recolor)},_recolor:function(a){var b,c;return this.v+=a.dt,c=this.v/this.duration,c>=1&&(this.unbind("EnterFrame",this._recolor),this.trigger("ColorFadeFinished")),b=this._buildColor(c,this.colors),this.background?Crafty.background(b):this.color(b)},_buildColor:function(a,b){var c,d,e,f,g,h;return f=1/(b.length-1),d=Math.floor(a/f),c=b[d],h=null!=(g=b[d+1])?g:c,e=(a-d*f)/f,this._mix(e,c,h)},_mix:function(a,b,c){var d,e,f,g,h;return e=this._strToColor(b),h=this._strToColor(c),d={r:Math.round(e.r*(1-a)+h.r*a),g:Math.round(e.g*(1-a)+h.g*a),b:Math.round(e.b*(1-a)+h.b*a)},"#"+function(){var a;a=[];for(g in d)f=d[g],a.push(("0"+f.toString(16)).slice(-2));return a}().join("")},_strToColor:function(a){return{r:parseInt(a.slice(1,3),16),g:parseInt(a.slice(3,5),16),b:parseInt(a.slice(5,7),16)}}})}.call(this),function(){Crafty.c("HUD",{init:function(){return this.requires("2D")},positionHud:function(a){var b,c,d;return b=a.x,c=a.y,d=a.z,this.attr({viewportX:b,viewportY:c,viewportZ:d,x:b-Crafty.viewport.x,y:c-Crafty.viewport.y,z:d}),this.hudFloat=Crafty.bind("EnterFrame",function(a){return function(){return a.attr({x:a.viewportX-Crafty.viewport.x,y:a.viewportY-Crafty.viewport.y})}}(this)),this},remove:function(){return Crafty.unbind("EnterFrame",this.hudFloat)}})}.call(this),function(){Crafty.c("Listener",{init:function(){return this.listeners=[]},remove:function(){var a,b,c,d,e,f,g,h;for(f=this.listeners,h=[],c=0,d=f.length;d>c;c++)g=f[c],e=g.object,b=g.event,a=g.callback,h.push(e.unbind(b,a));return h},listenTo:function(a,b,c,d){var e;return null==d&&(d=this),e=function(){return c.apply(d,arguments)},this.listeners.push({object:a,event:b,callback:e}),a.bind(b,e)}})}.call(this),function(){Crafty.c("ViewportFixed",{init:function(){return this._initialViewport={x:Crafty.viewport.x,y:Crafty.viewport.y},this.motion=Crafty.bind("ViewportScroll",function(a){return function(){var b,c;return b=a._initialViewport.x-Crafty.viewport.x,c=a._initialViewport.y-Crafty.viewport.y,a.attr({x:a.x+b,y:a.y+c}),a._initialViewport={x:Crafty.viewport.x,y:Crafty.viewport.y}}}(this))},remove:function(){return Crafty.unbind("ViewportScroll",this.motion)}})}.call(this),function(){Crafty.c("ViewportRelativeMotion",{init:function(){},remove:function(){},viewportRelativeMotion:function(a){var b,c,d,e,f,g,h,i,j;return i=a.x,j=a.y,h=a.speed,b=a.distanceSky,this._distanceSky=b,this._startLocation={x:i,y:j},this._speed=h,this._initialViewport={x:Crafty.viewport.width/4},this._location={sx:i+(i-this._initialViewport.x)*(this._speed-1),sy:j,dx:null!=(e=this.dx)?e:0,dy:null!=(f=this.dy)?f:0},g=(this._initialViewport.x-Crafty.viewport._x)*(this._speed-1),c=this._location.sx-g+this._location.dx,d=this._location.sy-Crafty.viewport._y*(1-this._speed)+this._location.dy,this._location.x=c,this._location.y=d,this.attr(this._location),this.motion=Crafty.bind("ViewportScroll",function(a){return function(){return g=(a._initialViewport.x-Crafty.viewport._x)*(a._speed-1),c=a._location.sx-g+a.dx,d=a._distanceSky?a._location.sy-Crafty.viewport._y*(1-a._speed)+a.dy:a._location.sy-Crafty.viewport._y*(1-1.2*(a._speed-.25))+a.dy,a.attr({x:c,y:d})}}(this)),this},remove:function(){return Crafty.unbind("ViewportScroll",this.motion)}})}.call(this),function(){Crafty.c("ControlScheme",{init:function(){return this.trigger("Activated"),Crafty.trigger("PlayerActivated")},remove:function(){return this.trigger("Deactivated"),Crafty.trigger("PlayerDeactivated")}})}.call(this),function(){Crafty.c("Player",{lives:2,points:0,init:function(){return this.stats={shotsFired:0,shotsHit:0,enemiesKilled:0,bonus:0}},reset:function(){return this.removeComponent("ControlScheme").attr({lives:2,points:0})},loseLife:function(){return this.lives>0?(this.lives-=1,this.trigger("UpdateLives",{lives:this.lives}),this.lives<=0?Crafty.trigger("PlayerDied",this):void 0):void 0},addPoints:function(a){return this.lives>0?(this.points+=a,this.trigger("UpdatePoints",{points:this.points})):void 0}})}.call(this),function(){Crafty.c("PlayerAssignable",{init:function(){return this._attachControllerAssignTrigger(),this.preferredPlayer=null},_assignControls:function(){var a;return a=this._preferredplayer()||this._firstUnassignedPlayer(),null==a?void this._attachControllerAssignTrigger():(this.preferredPlayer=a.getId(),this.setupControls(a),a.one("Deactivated",function(a){return function(){return a._attachControllerAssignTrigger()}}(this)))},_attachControllerAssignTrigger:function(){return this.one("Fire",this._assignControls)},_preferredplayer:function(a){var b;return null===this.preferredPlayer||(b=Crafty(this.preferredPlayer),b.has("ControlScheme"))?void 0:b},_firstUnassignedPlayer:function(){var a,b,c,d,e;for(e=Crafty("Player"),a=0,b=e.length;b>a;a++)if(d=e[a],c=Crafty(d),!c.has("ControlScheme"))return c}}),Crafty.c("ControlScheme",{init:function(){return this.trigger("Activated"),Crafty.trigger("PlayerActivated")},remove:function(){return this.trigger("Deactivated"),Crafty.trigger("PlayerDeactivated")}})}.call(this),function(){Crafty.c("PlayerControlledShip",{init:function(){return this.requires("2D, Canvas, Color, Collision, Listener"),this.attr({w:30,h:30}),this.bind("Moved",function(a){return this.hit("Edge")?this.attr({x:a.x,y:a.y}):void 0}),this._forcedSpeed={x:0,y:0},this.primaryWeapon=void 0,this.weaponsEnabled=!0},start:function(){return this.addComponent("Invincible").invincibleDuration(2e3),this.onHit("Enemy",function(a){var b,c,d,e;if(!this.has("Invincible")){for(c=!1,d=0,e=a.length;e>d;d++)b=a[d],b.obj.hidden||(c=!0);return c?this.trigger("Hit"):void 0}}),this.onHit("PowerUp",function(a){var b,c,d,e;for(e=[],b=0,c=a.length;c>b;b++)d=a[b],this.pickUp(d.obj),e.push(this.trigger("PowerUp",d.obj));return e}),this.bind("EnterFrame",function(a){var b,c;return b=this._forcedSpeed.x/1e3*a.dt,c=this._forcedSpeed.y/1e3*a.dt,this.x+=b,this.y+=c,this.hit("Edge")&&(this.x-=b),this.hit("Edge")&&(this.y-=c),this.hit("Edge")?this.trigger("Hit"):void 0}),this},forcedSpeed:function(a){return null!=a.x&&null!=a.y?(this._forcedSpeed.x=a.x,this._forcedSpeed.y=a.y):(this._forcedSpeed.x=a,this._forcedSpeed.y=0),this},shoot:function(a){return this.weaponsEnabled&&null!=this.primaryWeapon?(a&&this.trigger("Shoot"),this.primaryWeapon.shoot(a)):void 0},pickUp:function(a){var b;return b=a.settings.contains,this.installItem(b)?a.destroy():void 0},installItem:function(a){return this.hasItem(a)?("lasers"===a&&this.primaryWeapon.addXP(10),!0):(this.items.push(a),"lasers"===a?(this.primaryWeapon=Crafty.e("WeaponLaser"),this.primaryWeapon.install(this),this.listenTo(this.primaryWeapon,"levelUp",function(a){return function(b){return a.scoreText("+1")}}(this)),!0):void 0)},hasItem:function(a){return null==this.items&&(this.items=[]),~this.items.indexOf(a)},scoreText:function(a){return Crafty.e("Text, Canvas, 2D, Tween").textColor("#FFFFFF").text(a).attr({x:this.x,y:this.y-10,z:990}).textFont({size:"16px",weight:"bold",family:"Bank Gothic"}).tween({y:this.y-40,alpha:.5},1e3).one("TweenEnd",function(){return this.destroy()})}})}.call(this),function(){Crafty.c("PlayerInfo",{init:function(){return this.requires("2D, Listener")},playerInfo:function(a,b){return this.player=b,this.score=Crafty.e("2D, Canvas, Text, HUD").attr({w:150,h:20}).positionHud({x:a,y:10,z:2}).textFont({size:"12px",family:"Bank Gothic"}),this.player.has("Color")&&this.score.textColor(this.player.color()),this.lives=Crafty.e("2D, Canvas, Text, HUD").attr({w:250,h:20}).positionHud({x:a,y:25,z:2}).textFont({size:"12px",family:"Bank Gothic"}),this.player.has("Color")&&this.lives.textColor(b.color()),this.updatePlayerInfo(),this.listenTo(b,"UpdateLives",this.updatePlayerInfo),this.listenTo(b,"UpdatePoints",this.updatePlayerInfo),this.listenTo(b,"Activated",function(a){return function(){return a.updatePlayerInfo()}}(this)),this.listenTo(b,"Deactivated",function(a){return function(){return a.updatePlayerInfo()}}(this)),this},updatePlayerInfo:function(){return this.score.text(this.player.has("ControlScheme")?"Score: "+this.player.points:this.player.name),this.lives.text(this.player.has("ControlScheme")?0===this.player.lives?"Game Over":"Lives: "+this.player.lives:"Press fire to start!")}})}.call(this),function(){Crafty.c("Bullet",{init:function(){return this.addComponent("2D, Canvas, Color, Collision")},fire:function(a){return this.attr({damage:a.damage}).bind("EnterFrame",function(b){return function(c){return b.x+=a.speed/1e3*c.dt,b.x>b._maxXforViewPort()?b.destroy():void 0}}(this)).onHit("Edge",function(){return this.destroy()}),this},_maxXforViewPort:function(){var a;return a=-Crafty.viewport._x+Crafty.viewport._width/Crafty.viewport._scale,a+200}})}.call(this),function(){Crafty.c("WeaponLaser",{init:function(){return this.requires("2D,Canvas,Color"),this.color("#808080"),this.attr({w:30,h:5})},remove:function(){},install:function(a){return this.ship=a,this.xp=0,this.level=this.determineLevel(this.xp),this.attr({x:this.ship.x+10,y:this.ship.y+15,z:this.ship.z+1}),this.ship.attach(this)},addXP:function(a){var b;return this.xp+=a,b=this.level,this.level=this.determineLevel(this.xp),b!==this.level?this.trigger("levelUp",this.level):void 0},determineLevel:function(a){var b,c,d,e,f,g,h,i;for(f=[150,400,1e3,2500],g=0,e=0,c=0,d=f.length;d>c;c++)b=f[c],g+=b,a>=g&&(e+=1);return h=(a-(null!=(i=f[e-1])?i:0))/f[e],e},shoot:function(a){var b;if(a)return b=function(){switch(this.level){case 0:return{w:4,speed:350,h:3};case 1:return{w:6,speed:350,h:4};case 2:return{w:8,speed:350,h:5};case 3:return{w:10,speed:350,h:5};case 4:return{w:12,speed:350,h:6}}}.call(this),Crafty.e("Bullet").color("#FFFF00").attr({x:this.x+this.w,y:this.y+this.h/2-b.h/2,w:b.w,h:b.h}).fire({origin:this,damage:100,speed:this.ship._forcedSpeed.x+b.speed,direction:0}).bind("HitTarget",function(a){return function(){return a.addXP(1),a.ship.trigger("BulletHit")}}(this)).bind("DestroyTarget",function(a){return function(){return a.addXP(5),a.ship.trigger("BulletDestroyedTarget")}}(this))}})}.call(this)}(),function(){"use strict";var a={start:function(){this.firstLevel="Game",Crafty.load([],function(){Crafty.init(640,480),Crafty.pixelart(!0),Crafty.background("#000000"),Crafty.e("Player, Color").attr({name:"Player 1",z:0}).setName("Player 1").color("#FF0000"),Crafty.e("Player, Color").attr({name:"Player 2",z:10}).setName("Player 2").color("#00FF00"),Crafty.e("KeyboardControls, PlayerAssignable").controls({fire:Crafty.keys.SPACE,up:Crafty.keys.UP_ARROW,down:Crafty.keys.DOWN_ARROW,left:Crafty.keys.LEFT_ARROW,right:Crafty.keys.RIGHT_ARROW}),Crafty.e("KeyboardControls, PlayerAssignable").controls({fire:Crafty.keys.G,up:Crafty.keys.W,down:Crafty.keys.S,left:Crafty.keys.A,right:Crafty.keys.D}),Crafty.e("GamepadControls, PlayerAssignable").controls({
gamepadIndex:0,fire:0}),Crafty.e("GamepadControls, PlayerAssignable").controls({gamepadIndex:1,fire:0}),Crafty.enterScene("Intro")})}};window.Game=a}(),function(){(function(){var a,b=[].slice;a=this.Game,null==a.ScriptModule&&(a.ScriptModule={}),a.ScriptModule.Colors={colorFade:function(){var a,c;return c=arguments[0],a=2<=arguments.length?b.call(arguments,1):[],function(d){return function(e){var f,g;return f=WhenJS.defer(),(g=d.entity).colorFade.apply(g,[c].concat(b.call(a))).bind("ColorFadeFinished",function(){return f.resolve()}),f.promise}}(this)},backgroundColorFade:function(){var a,c;return c=arguments[0],a=2<=arguments.length?b.call(arguments,1):[],function(d){return function(d){var e,f;return Crafty.background(a[0]),e=WhenJS.defer(),(f=Crafty.e("ColorFade, 2D")).colorFade.apply(f,[{duration:c.duration,background:!0}].concat(b.call(a))).bind("ColorFadeFinished",function(){return e.resolve(),this.destroy()}),e.promise}}(this)}}}).call(this),function(){var a,b=[].slice;a=this.Game,null==a.ScriptModule&&(a.ScriptModule={}),a.ScriptModule.Core={_verify:function(a){if(a!==this.currentSequence)throw new Error("sequence mismatch")},sequence:function(){var a;return a=1<=arguments.length?b.call(arguments,0):[],function(b){return function(c){return b._verify(c),WhenJS.sequence(a,c)}}(this)},parallel:function(){var a;return a=1<=arguments.length?b.call(arguments,0):[],function(b){return function(c){return b._verify(c),WhenJS.parallel(a,c)}}(this)},"if":function(a,b,c){return function(d){return function(e){return d._verify(e),a.apply(d)?b(e):"function"==typeof c?c(e):void 0}}(this)},"while":function(a,b){return function(c){return function(d){return c._verify(d),void 0===b&&(b=a,a=function(){return!0}),a.apply(c)?WhenJS(b(d)).then(function(){return c["while"](a,b)(d)}):void 0}}(this)},repeat:function(a,b){return function(c){return function(d){return c._verify(d),void 0===b?c["while"](a)(d):0!==a?WhenJS(b(d)).then(function(){return c.repeat(a-1,b)(d)}):void 0}}(this)},runScript:function(){var a,c;return c=arguments[0],a=2<=arguments.length?b.call(arguments,1):[],function(b){return function(d){var e;return b._verify(d),(e=new c(b.level)).run.apply(e,a)}}(this)},async:function(a){return function(b){return function(c){b._verify(c),a(c)}}(this)},wait:function(a){return function(b){return function(c){var d;return b._verify(c),d=WhenJS.defer(),Crafty.e("Delay").delay(function(){return d.resolve(),this.destroy()},a),d.promise}}(this)},endSequence:function(){return function(a){return function(b){throw a._verify(b),new Error("sequence aborted")}}(this)}}}.call(this),function(){var a,b=[].slice;a=this.Game,null==a.ScriptModule&&(a.ScriptModule={}),a.ScriptModule.Entity={bindSequence:function(a,c,d){var e;return null==d&&(d=function(){return!0}),e=function(f){return function(){var g;return g=1<=arguments.length?b.call(arguments,0):[],d.apply(null,g)?(f.currentSequence=Math.random(),f.entity.unbind(a,e),f.alternatePath=WhenJS(c.apply(f,g)(f.currentSequence))["catch"](function(){return f.alternatePath})):void 0}}(this),this.entity.bind(a,e)},sendToBackground:function(a,b){return function(c){return function(d){return c._verify(d),c.entity.sendToBackground(a,b)}}(this)},movePath:function(a,b){return null==b&&(b={}),function(c){return function(d){var e,f,g,h,i,j,k,l,m,n,o,p,q;return c._verify(d),c.enemy.alive?(b=_.defaults(b,{rotate:!0}),a.unshift([c.entity.x+Crafty.viewport.x,c.entity.y+Crafty.viewport.y]),m=a[0],i=0,g=function(){var b,c,d;for(d=[],b=0,c=a.length;c>b;b++)l=a[b],p=l[0],q=l[1],n=m[0],o=m[1],e=Math.abs(p-n),f=Math.abs(p-o),h=Math.sqrt(Math.pow(e,2)+Math.pow(f,2)),i+=h,m=l,d.push({x:p-Crafty.viewport.x,y:q-Crafty.viewport.y});return d}(),k=i/c.entity.speed*1e3,j=WhenJS.defer(),c.entity.choreography([{type:"viewportBezier",rotation:b.rotate,path:g,duration:k}],{compensateCameraSpeed:!0}).bind("ChoreographyEnd",function(){return this.unbind("ChoreographyEnd"),j.resolve()}),j.promise):void 0}}(this)},moveTo:function(a,b){return null==b&&(b={}),function(c){return function(d){var e,f,g,h,i;return c._verify(d),c.enemy.alive?(h=null!=(f="function"==typeof a?a():void 0)?f:a,_.extend(h,b),g=c._getSeaLevel(),"air"===c.enemy.moveState?null!=h.y&&h.y>g+Crafty.viewport.y?(e=_.clone(h),e.y=g,c._moveAir(e).then(function(){return c.enemy.moveState="water",c.enemy.alive>0?(c._setupWaterSpot(),c._waterSplash(),c._moveWater(h)):void 0})):c._moveAir(h):"water"===c.enemy.moveState?null!=h.y&&h.y<g+Crafty.viewport.y?(i=_.clone(h),i.y=g,c._moveWater(i).then(function(){return c.enemy.moveState="air",c.enemy.alive?(c._removeWaterSpot(),c._waterSplash(),c._moveAir(h)):void 0})):c._moveWater(h):void 0):void 0}}(this)},_setupWaterSpot:function(){var a;return a=Crafty.e("2D, Canvas, Color, Choreography, Tween, ViewportFixed").color("#000040").attr({w:this.entity.w+10,x:this.entity.x-5,y:this.entity.y,h:20,alpha:.7,z:this.entity.z-1}),this.entity.hide(a)},_removeWaterSpot:function(){return this.entity.reveal()},_waterSplash:function(){var a;return a=WhenJS.defer(),Crafty.e("WaterSplash").waterSplash({x:this.entity.x,y:this.entity.y,size:this.entity.w}).bind("ParticleEnd",function(){return a.resolve()}),a.promise},_moveWater:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;if(b={x:this.entity.x+Crafty.viewport.x,y:this.entity.y+Crafty.viewport.y,speed:this.entity.speed},n=this._getSeaLevel(),a=_.defaults(a,b),o={w:this.entity.w+10,y:n,h:20,alpha:.7},l=700,k={w:.3*this.entity.w,y:this.entity.hideMarker.y+15,h:5,alpha:.2},e=null!=a.x?Math.abs(a.x-(this.entity.hideMarker.x+Crafty.viewport.x)):0,f=null!=a.y?Math.abs(a.y-(this.entity.hideMarker.y+Crafty.viewport.y)):0,d=Math.sqrt(Math.pow(e,2)+Math.pow(f,2)),i=d/a.speed*1e3,null!=a.y){g=Math.min(a.y,l),p=(g-n)/(l-n),h={};for(j in o)m=o[j],h[j]=(1-p)*m+p*k[j];this.entity.hideMarker.tween(h,i)}return c=WhenJS.defer(),this.entity.attr({x:a.x-Crafty.viewport.x,y:a.y-Crafty.viewport.y}),this.entity.hideMarker.choreography([{type:"viewport",x:a.x,maxSpeed:a.speed,duration:i}]).bind("ChoreographyEnd",function(){return this.unbind("ChoreographyEnd"),c.resolve()}),c.promise},_getSeaLevel:function(){var a;return 220+220*(null!=(a=this.entity.scale)?a:1)},_moveAir:function(a){var b,c,d,e,f;return b={x:this.entity.x+Crafty.viewport.x,y:this.entity.y+Crafty.viewport.y,speed:this.entity.speed},a=_.defaults(a,b),e=null!=a.x?Math.abs(a.x-(this.entity.x+Crafty.viewport.x)):0,f=null!=a.y?Math.abs(a.y-(this.entity.y+Crafty.viewport.y)):0,d=Math.sqrt(Math.pow(e,2)+Math.pow(f,2)),c=WhenJS.defer(),this.entity.choreography([{type:"viewport",x:a.x,y:a.y,maxSpeed:a.speed,duration:d/a.speed*1e3}]).bind("ChoreographyEnd",function(){return this.unbind("ChoreographyEnd"),c.resolve()}),c.promise},location:function(a){return null==a&&(a={}),function(a){return function(){var b,c;return{x:null!=(b=a.enemy.location.x)?b:a.entity.x+Crafty.viewport.x+a.entity.w/2,y:null!=(c=a.enemy.location.y)?c:a.entity.y+Crafty.viewport.y+a.entity.h/2}}}(this)},pickTarget:function(a){return function(b){return function(c){var d;return d=Crafty(a),b.target=d.get(Math.floor(Math.random()*d.length))}}(this)},targetLocation:function(a){return null==a&&(a={}),function(b){return function(){var c,d;return{x:null!=(c=a.x)?c:b.target.x+Crafty.viewport.x,y:null!=(d=a.y)?d:b.target.y+Crafty.viewport.y}}}(this)}}}.call(this),function(){var a;a=this.Game,null==a.ScriptModule&&(a.ScriptModule={}),a.ScriptModule.Level={placeSquad:function(a,b){return null==b&&(b={}),function(c){return function(d){var e,f;return c._verify(d),b=_.defaults(b,{amount:1,delay:1e3,options:{}}),f=function(){var c,f,g;for(g=[],e=c=0,f=b.amount;f>=0?f>c:c>f;e=f>=0?++c:--c)g.push(this.wait(e*b.delay)(d).then(function(c){return function(){return c.runScript(a,b.options)(d)}}(this)));return g}.call(c),WhenJS.all(f).then(function(a){var e,f,g,h,i,j,k,l,m;for(f=!0,j=null,i=null,g=0,k=a.length;k>g;g++)m=a[g],e=m.alive,h=m.killedAt,l=m.location,e?f=!1:(null==i&&(i=h),null==j&&(j=l),h.getTime()>i.getTime()&&(i=h,j=l));return f&&(j.x-=Crafty.viewport.x,j.y-=Crafty.viewport.y,b.drop)?c.drop({item:b.drop,location:j})(d):void 0})}}(this)},say:function(b,c){return function(d){return function(e){return d._verify(e),a.say(b,c,{bottom:d.level.visibleHeight})}}(this)},drop:function(a){return function(b){return function(c){var d,e,f;return b._verify(c),d=b.inventory("item",a.item),(e=a.inFrontOf)&&b.level.addComponent(d().attr({z:-1}),{x:640,y:e.ship().y}),(f=a.location)?d().attr({x:f.x,y:f.y,z:-1}):void 0}}(this)},player:function(a){var b;return b={},Crafty("Player").each(function(){return b[this.name]={name:this.name,active:!1,gameOver:!1,has:function(a){var b;return null!=(b=this.ship())?b.hasItem(a):void 0},ship:function(){var a,b;return a=this,b=null,Crafty("Player ControlScheme").each(function(){return this.name===a.name?b=this.ship:void 0}),b}}}),Crafty("Player ControlScheme").each(function(){return b[this.name].active=!0,this.lives>0?void 0:(b[this.name].active=!1,b[this.name].gameOver=!0)}),b["Player "+a]},setScenery:function(a){return function(b){return function(c){return b._verify(c),b.level.setScenery(a)}}(this)},waitForScenery:function(a,b){return null==b&&(b={event:"enter"}),function(c){return function(d){var e;return c._verify(d),e=WhenJS.defer(),c.level.notifyScenery(b.event,a,function(){return e.resolve()}),e.promise}}(this)},gainHeight:function(a,b){return function(c){return function(d){var e,f,g,h,i,j;return c._verify(d),f=WhenJS.defer(),e=(null!=(i=c.level._forcedSpeed)?i.x:void 0)||c.level._forcedSpeed,g=b.duration,j=a/g*1e3,c.level.setForcedSpeed({x:e,y:-j}),h=c.level,Crafty.e("Delay").delay(function(){return h.setForcedSpeed(e),f.resolve()},b.duration),f.promise}}(this)},setSpeed:function(a){return function(b){return function(c){return b._verify(c),b.level.setForcedSpeed(a)}}(this)},showScore:function(a,b){return function(c){return function(d){var e;return c._verify(d),e=Crafty.e("StageEnd").stageEnd(c.level,a,b),c.wait(3e4)(d).then(function(){return e.destroy()})}}(this)},disableWeapons:function(){return function(a){return function(b){return a._verify(b),a.level.setWeaponsEnabled(!1)}}(this)},enableWeapons:function(){return function(a){return function(b){return a._verify(b),a.level.setWeaponsEnabled(!0)}}(this)},explosion:function(a,b){return null==b&&(b={damage:!1,radius:20}),function(c){return function(d){var e,f,g,h;return c._verify(d),f=a(),g=f.x,h=f.y,g-=Crafty.viewport.x,h-=Crafty.viewport.y,e=Crafty.e("Explosion").explode({x:g,y:h,radius:b.radius}),b.damage?e.addComponent("Enemy"):void 0}}(this)}}}.call(this),function(){var a;a=this.Game,a.BezierPath=function(){function a(){}return a.prototype.scalePoints=function(a,b){var c,d,e,f,g,h,i,j;for(g=b.origin,j=b.scale,f={x:a[0].x*j.x-g.x,y:a[0].y*j.y-g.y},i=[],c=d=0,e=a.length;e>d;c=++d)h=a[c],i.push({x:h.x*j.x-f.x,y:h.y*j.y-f.y});return i},a.prototype.buildPathFrom=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;for(o={distance:0,curves:[]},m=this.getCurveControlPoints(a),j=m[0],p=m[1],k=l=0,n=a.length-1;n>=0?n>l:l>n;k=n>=0?++l:--l)b=a[k],c=a[k+1],d=j[k],e=p[k],h=Math.abs(b.x-c.x),i=Math.abs(b.y-c.y),f=Math.sqrt(Math.pow(h,2)+Math.pow(i,2)),g=[c,e,d,b],o.distance+=f,o.curves.push({distance:f,points:g});return o},a.prototype.pointOnPath=function(a,b){var c,d,e,f,g;return f=this.getCurveAndLocation(a,b),d=f[0],g=f[1],c=f[2],e=jsBezier.pointOnCurve(d.points,g),e.c=c,e},a.prototype.angleOnPath=function(a,b){var c,d,e;return d=this.pointOnPath(a,b),e=this.pointOnPath(a,Math.min(b+.01,1)),c=Math.atan2(d.y-e.y,d.x-e.x),c*=180/Math.PI},a.prototype.getCurveAndLocation=function(a,b){var c,d,e,f,g,h,i;for(e=0,c=0,d=a.curves[c],h=(e+d.distance)/a.distance;b>h;)c+=1,e+=d.distance,d=a.curves[c],h=(e+d.distance)/a.distance;return f=d.distance/a.distance,g=e/a.distance,i=(b-g)/f,[d,i,c]},a.prototype.getCurveControlPoints=function(a){var b,c,d,e,f,g,h,i,j;if(e=a.length-1,1>e)return[];if(1===e)return b=[{x:(2*a[0].x+a[1].x)/3,y:(2*a[0].y+a[1].y)/3}],h=[{x:2*b[0].x-a[0].x,y:2*b[0].y-a[0].y}],[b,h];for(g=function(){var b,d,f;for(f=[],c=b=1,d=e-1;d>=1?d>b:b>d;c=d>=1?++b:--b)f.push(4*a[c].x+2*a[c+1].x);return f}(),g.unshift(a[0].x+2*a[1].x),g.push((8*a[e-1].x+a[e].x)/2),i=this.getFirstControlPoints(g),g=function(){var b,d,f;for(f=[],c=b=1,d=e-1;d>=1?d>b:b>d;c=d>=1?++b:--b)f.push(4*a[c].y+2*a[c+1].y);return f}(),g.unshift(a[0].y+2*a[1].y),g.push((8*a[e-1].y+a[e].y)/2),j=this.getFirstControlPoints(g),b=[],h=[],c=d=0,f=e;f>=0?f>d:d>f;c=f>=0?++d:--d)b.push({x:i[c],y:j[c]}),h.push(e-1>c?{x:2*a[c+1].x-i[c+1],y:2*a[c+1].y-j[c+1]}:{x:(a[e].x+i[e-1])/2,y:(a[e].y+j[e-1])/2});return[b,h]},a.prototype.getFirstControlPoints=function(a){var b,c,d,e,f,g,h,i,j;for(f=a.length,j=[],i=[null],b=2,j.push(a[0]/b),c=d=1,g=f;g>=1?g>d:d>g;c=g>=1?++d:--d)i.push(1/b),b=f-1>c?4:3.5,b-=i[c],j.push((a[c]-j[c-1])/b);for(c=e=1,h=f;h>=1?h>e:e>h;c=h>=1?++e:--e)j[f-c-1]-=i[f-c]*j[f-c];return j},a}()}.call(this),function(){this.Game.say=function(a,b,c){var d,e,f,g,h,i,j,k,l;for(Crafty("Dialog").each(function(){return this.trigger("Abort"),this.destroy()}),j=b.split("\n"),l=60,e=WhenJS.defer(),d=Crafty.e("2D, Canvas, Color, Tween, HUD, Dialog").attr({w:570,h:20*(j.length+2),alpha:.5}).color("#000000").positionHud({x:l-10,y:c.bottom-20*(j.length+1),z:100}),d.bind("Abort",function(){return e.resolve()}),k=Crafty.e("2D, Canvas, Text").attr({w:550,x:d.x+10,y:d.y+10,z:101,alpha:1}).text(a).textColor("#707070").textFont({size:"16px",weight:"bold",family:"Bank Gothic"}),d.attach(k),f=g=0,h=j.length;h>g;f=++g)i=j[f],d.attach(Crafty.e("2D, Canvas, Text").attr({w:550,x:d.x+10,y:d.y+30+20*f,z:101}).text(i).textColor("#909090").textFont({size:"16px",weight:"bold",family:"Bank Gothic"}));return Crafty.e("Dialog, Delay").delay(function(){return e.resolve(),Crafty("Dialog").each(function(){return this.destroy()})},2500*j.length,0),e.promise}}.call(this),function(){}.call(this),function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}},c=[].slice,d=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},e={}.hasOwnProperty;a=this.Game,a.LazerScript=function(){function a(a){this.level=a,this._endScriptOnGameOver=b(this._endScriptOnGameOver,this)}return a.prototype.run=function(){var a;return a=1<=arguments.length?c.call(arguments,0):[],this.currentSequence=Math.random(),Crafty.bind("PlayerDied",this._endScriptOnGameOver),WhenJS(this.execute.apply(this,a)(this.currentSequence))["finally"](function(a){return function(){return Crafty.unbind("PlayerDied",a._endScriptOnGameOver)}}(this))},a.prototype.execute=function(){},a.prototype._endScriptOnGameOver=function(){var a;return a=!1,Crafty("Player ControlScheme").each(function(){return this.lives>0?a=!0:void 0}),a?void 0:this.currentSequence=null},a.prototype.inventory=function(a,b){var c;return this.invItems||(this.invItems={}),(c=this.invItems)[a]||(c[a]={}),this.invItems[a][b||"default"]},a.prototype.inventoryAdd=function(a,b,c){var d;return this.invItems||(this.invItems={}),(d=this.invItems)[a]||(d[a]={}),this.invItems[a][b]=c},a}(),_.extend(a.LazerScript.prototype,a.ScriptModule.Core,a.ScriptModule.Level,a.ScriptModule.Colors),a.EntityScript=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return d(b,a),b.prototype.run=function(){var a,d;return a=1<=arguments.length?c.call(arguments,0):[],this.boundEvents=[],this.entity=this.spawn.apply(this,a),this.options=null!=(d=a[0])?d:{},null!=this.entity?(this.entity.attr({x:this.entity.x-Crafty.viewport.x,y:this.entity.y-Crafty.viewport.y}),this.entity.bind("Destroyed",function(a){return function(){return a.currentSequence=null,a.enemy.location.x=a.entity.x+Crafty.viewport.x,a.enemy.location.y=a.entity.y+Crafty.viewport.y,a.enemy.alive=!1,a.enemy.killedAt=new Date}}(this)),this.enemy={moveState:"air",alive:!0,location:{}}):this.enemy={moveState:"air",alive:!1,location:{}},b.__super__.run.apply(this,arguments)["catch"](function(a){return function(){return a.alternatePath}}(this))["finally"](function(a){return function(){return a.enemy.alive&&a.entity.has("Enemy")?a.entity.destroy():void 0}}(this)).then(function(a){return function(){return a.enemy}}(this))},b.prototype.spawn=function(){},b}(a.LazerScript),_.extend(a.EntityScript.prototype,a.ScriptModule.Core,a.ScriptModule.Entity)}.call(this),function(){var a;a=this.Game,a.Level=function(){function a(a,b){this.generator=a,this.data=null!=b?b:{},this.blocks=[],this.bufferLength=1920,this.generationPosition={x:0,y:40},this.sceneryEvents=[],this.visibleHeight=480-this.generationPosition.y,this.namespace=this.data.namespace,this.currentScenery=this.data.startScenery}return a.prototype.setScenery=function(a){this.currentScenery=a},a.prototype.start=function(a){var b,c,d,e,f;for(null==a&&(a={}),c={armedPlayers:!0,speed:1,controlsEnabled:!0,weaponsEnabled:!0,spawnPosition:{x:100,y:200},spawnOffset:{x:-50,y:0},viewport:{x:0,y:0}},a=_.defaults(a,this.data,c),Crafty.viewport.x=0,Crafty.viewport.y=0,this._controlsEnabled=a.controlsEnabled,this.setForcedSpeed(a.speed),this.setWeaponsEnabled(a.weaponsEnabled),this._scrollWall=Crafty.e("ScrollWall").attr({x:a.viewport.x,y:a.viewport.y}),this._playersActive=!1,Crafty.bind("EnemySpawned",function(a){return function(){var b;return null==(b=a.data).enemiesSpawned&&(b.enemiesSpawned=0),a.data.enemiesSpawned+=1}}(this)),this._placePlayerShips(a),this._seedPreceedingGeometry(),this._update(),this.lastUpdate=Crafty.viewport._x+200,f=this.blocks,d=0,e=f.length;e>d;d++)b=f[d],b.x<640&&b.enter();return Crafty.bind("ViewportScroll",function(a){return function(){return a.lastUpdate-Crafty.viewport._x>=300?(a._update(),a.lastUpdate=Crafty.viewport._x):void 0}}(this)),Crafty.bind("LeaveBlock",function(a){return function(b){var c;return c=_.indexOf(a.blocks,b),c>0&&a._handleSceneryEvents(a.blocks[c-1],"leave"),a._handleSceneryEvents(b,"inScreen"),a._cleanupBuildBlocks()}}(this)),Crafty.bind("EnterBlock",function(a){return function(b){var c;return c=_.indexOf(a.blocks,b),c>0&&a._handleSceneryEvents(a.blocks[c-1],"outScreen"),a._handleSceneryEvents(b,"enter")}}(this)),Crafty.bind("PlayerEnterBlock",function(a){return function(b){var c;return c=_.indexOf(a.blocks,b),c>0&&a._handleSceneryEvents(a.blocks[c-1],"playerLeave"),a._handleSceneryEvents(b,"playerEnter")}}(this)),Crafty.bind("PlayerDied",function(a){return function(){var b;return b=!1,Crafty("Player ControlScheme").each(function(){return this.lives>0?b=!0:void 0}),b?void 0:(a.stop(),Crafty.enterScene("GameOver"))}}(this))},a.prototype._handleSceneryEvents=function(a,b){var c,d,e,f,g;if(null!=a){for(a[b](),f=this.sceneryEvents,g=[],e=d=f.length-1;d>=0;e=d+=-1)c=f[e],a.name===this.namespace+"."+c.sceneryType&&b===c.eventType?(c.callback.apply(this),g.push(this.sceneryEvents.splice(e,1))):g.push(void 0);return g}},a.prototype.notifyScenery=function(a,b,c){return this.sceneryEvents.push({eventType:a,sceneryType:b,callback:c})},a.prototype._placePlayerShips=function(a){return Crafty.one("ShipSpawned",function(a){return function(){return a._playersActive=!0,a._scrollWall.scrollWall(a._forcedSpeed)}}(this)),Crafty("Player").each(function(b){var c;return c=function(){var b;return b=_.clone(a.spawnPosition),Crafty("PlayerControlledShip").each(function(){return b.x=this.x+a.spawnOffset.x+Crafty.viewport.x,b.y=this.y+a.spawnOffset.y+Crafty.viewport.y}),b},this.addComponent("ShipSpawnable").spawnPosition(c,a.armedPlayers),Crafty.e("PlayerInfo").playerInfo(30+180*b,this)}),Crafty.bind("ShipSpawned",function(a){return function(b){return b.forcedSpeed(a._forcedSpeed),b.weaponsEnabled=a._weaponsEnabled,a._controlsEnabled?void 0:b.disableControl()}}(this)),Crafty("Player ControlScheme").each(function(){return this.spawnShip()})},a.prototype.setForcedSpeed=function(a){return this._forcedSpeed=a,this._playersActive&&this._scrollWall.scrollWall(this._forcedSpeed),Crafty("PlayerControlledShip").each(function(){return this.forcedSpeed(a)})},a.prototype.setWeaponsEnabled=function(a){return this._weaponsEnabled=a,Crafty("PlayerControlledShip").each(function(){return this.weaponsEnabled=a})},a.prototype.getComponentOffset=function(){return{x:this._scrollWall.x,y:this._scrollWall.y}},a.prototype.addComponent=function(a,b,c){var d,e,f;return null==c&&(c=null),d=this.blocks[null!=(f=this.currentBlockIndex)?f:0],null!=d?(null==c&&(c=this.getComponentOffset()),e={x:b.x+c.x-d.x,y:b.y+c.y-d.y},d.add(e.x,e.y,a)):void 0},a.prototype.stop=function(){var a,b,c,d,e;for(Crafty.unbind("LeaveBlock"),Crafty.unbind("EnterBlock"),Crafty.unbind("ShipSpawned"),Crafty.unbind("ViewportScroll"),d=this.blocks,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(null!=a?a.clean():void 0);return e},a.prototype._update=function(){var a,b,c,d,e;for(e=-Crafty.viewport._x,b=e+this.bufferLength,a=0,c=10,d=[];this.generationPosition.x<b&&c>a;)this._generateLevel(),d.push(a+=1);return d},a.prototype._generateLevel=function(){var a,b,c;return b=this.namespace+"."+this.currentScenery,this._addBlockToLevel(b,{}),a=this.generator.buildingBlocks[b],(c=a.prototype.autoNext)?this.currentScenery=c:void 0},a.prototype._addBlockToLevel=function(a,b){var c,d;return d=this.generator.buildingBlocks[a],c=new d(this,this.generator,b),this.blocks.push(c),c.build(this.generationPosition),this.generationPosition={x:c.x+c.delta.x,y:c.y+c.delta.y}},a.prototype._insertBlockToLevel=function(a,b){var c,d;if(d=this.generator.buildingBlocks[a],null==d)throw new Error(a+" not found");return c=new d(this,this.generator,b),this.blocks.unshift(c),this.generationPosition={x:this.generationPosition.x-c.delta.x,y:this.generationPosition.y-c.delta.y},c.build(this.generationPosition)},a.prototype._cleanupBuildBlocks=function(){var a,b;for(a=this.blocks[0],b=[];a.canCleanup();)this.blocks.shift().clean(),b.push(a=this.blocks[0]);return b},a.prototype._seedPreceedingGeometry=function(){var a,b,c,d;return b=this.namespace+"."+this.currentScenery,a=this.generator.buildingBlocks[b],(c=a.prototype.autoNext)&&(b=this.namespace+"."+c),d=_.clone(this.generationPosition),this._insertBlockToLevel(b,{}),this._insertBlockToLevel(b,{}),this._insertBlockToLevel(b,{}),this.generationPosition=d},a}()}.call(this),function(){var a;a=this.Game,a.LevelGenerator=function(){function b(){this.buildingBlocks={},this.elements={}}return b.prototype.defineBlock=function(a){return this.buildingBlocks[a.prototype.name]=a},b.prototype.defineElement=function(a,b){return this.elements[a]=b},b.prototype.createLevel=function(b){return new a.Level(this,b)},b}(),a.levelGenerator=new a.LevelGenerator}.call(this),function(){var a,b=[].slice;a=this.Game,a.LevelScenery=function(){function a(a,b,c){this.level=a,this.generator=b,this.settings=c,this.createdElements=[],this.createdBindings=[]}return a.prototype.screenHeight=480,a.prototype.build=function(a){return this.generated?void 0:(null==this.x&&(this.x=a.x),null==this.y&&(this.y=a.y),this.generated=!0,this.generate(),this._notifyEnterFunction())},a.prototype._notifyEnterFunction=function(){var a;return a=this,Crafty.e("2D, Canvas, Color, Collision").attr({x:this.x,y:this.y,w:10,h:800}).onHit("ScrollFront",function(){return this.triggeredFront?void 0:(Crafty.trigger("EnterBlock",a),this.triggeredFront=!0)}).onHit("PlayerControlledShip",function(){return this.triggeredPlayerFront?void 0:(Crafty.trigger("PlayerEnterBlock",a),this.triggeredPlayerFront=!0)}).onHit("ScrollWall",function(){return Crafty.trigger("LeaveBlock",a),this.destroy()})},a.prototype.generate=function(){var a;return null!=(a=this.settings.generate)?a.apply(this):void 0},a.prototype.enter=function(){var a;return null!=(a=this.settings.enter)?a.apply(this):void 0},a.prototype.playerEnter=function(){var a;return null!=(a=this.settings.playerEnter)?a.apply(this):void 0},a.prototype.playerLeave=function(){var a;return null!=(a=this.settings.playerLeave)?a.apply(this):void 0},a.prototype.inScreen=function(){var a;return null!=(a=this.settings.inScreen)?a.apply(this):void 0},a.prototype.outScreen=function(){var a;return null!=(a=this.settings.outScreen)?a.apply(this):void 0},a.prototype.leave=function(){var a;return null!=(a=this.settings.leave)?a.apply(this):void 0},a.prototype.clean=function(){var a,b,c,d,e,f,g,h;for(g=this.createdElements,c=0,e=g.length;e>c;c++)b=g[c],b.destroy();for(this.createdElements=[],h=this.createdBindings,d=0,f=h.length;f>d;d++)a=h[d],Crafty.unbind(a.event,a.callback);return this.createdBindings=[]},a.prototype.add=function(a,b,c){return c.attr({x:this.x+a,y:this.y+b}),this.createdElements.push(c)},a.prototype.addBackground=function(a,b,c,d){return c.addComponent("ViewportRelativeMotion").viewportRelativeMotion({x:this.x+a,y:this.y+b,speed:d}),this.createdElements.push(c)},a.prototype.addElement=function(){var a,c;return c=arguments[0],a=2<=arguments.length?b.call(arguments,1):[],this.generator.elements[c].apply(this,a)},a.prototype.bind=function(a,b){return this.createdBindings.push({event:a,callback:b}),Crafty.bind(a,b)},a.prototype.unbind=function(a){var c,d,e,f,g;for(g=[],f=this.createdBindings,d=0,e=f.length;e>d;d++)c=f[d],c.event===a&&(g.push(c),Crafty.unbind(c.event,c.callback));return this.createdBindings=_.without.apply(_,[this.createdBindings].concat(b.call(g)))},a.prototype.canCleanup=function(){var a,b,c,d,e;if(a=-1*Crafty.viewport._x,this.x+this.delta.x>a)return!1;for(e=this.createdElements,c=0,d=e.length;d>c;c++)if(b=e[c],b.x+b.w>=a)return!1;return!0},a}()}.call(this)}(),function(){(function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.Stage1=function(c){function d(){return d.__super__.constructor.apply(this,arguments)}return b(d,c),d.prototype.metadata={namespace:"City",startScenery:"Intro",speed:50},d.prototype.execute=function(){return this.inventoryAdd("item","lasers",function(){return Crafty.e("PowerUp").powerUp({contains:"lasers",marking:"L"})}),this.sequence(this.async(this.sunRise()),this.introText(),this.tutorial(),this.droneTakeover(),this.parallel(this.sequence(this.wait(2e3),this.say("General","Forget that museum. We're under attack!")),this.swirlAttacks()),this.setScenery("CoastStart"),this.swirlAttacks(),this.underWaterAttacks(),this.mineSwarm(),this.setScenery("Bay"),this.underWaterAttacks(),this.parallel(this.swirlAttacks(),this.mineSwarm()),this.parallel(this.placeSquad(a.Scripts.Stalker),this.mineSwarm({direction:"left"})),this.setScenery("UnderBridge"),this.parallel(this.sequence(this.stalkerShootout(),this.parallel(this.placeSquad(a.Scripts.Stalker),this.mineSwarm({direction:"left"})),this.swirlAttacks()),this.waitForScenery("UnderBridge",{event:"leave"})),this.setScenery("UnderBridge"),this.mineSwarm(),this.setSpeed(25),this.mineSwarm({direction:"left"}),this.mineSwarm(),this.waitForScenery("UnderBridge",{event:"inScreen"}),this.setSpeed(0),this.bossFightStage1(),this.say("General","Hunt him down!"),this.gainHeight(300,{duration:4e3}),this.setScenery("Skyline"),this.disableWeapons(),this.showScore(1,"City"),this.enableWeapons())},d.prototype.introText=function(){return this.sequence(this.wait(2e3),this["if"](function(){return this.player(1).active&&this.player(2).active},this.say("John","Too bad we have to bring these ships to the museum!"),this.say("John","Too bad we have to bring this ship to the museum!")),this["if"](function(){return this.player(1).active&&!this.player(2).active},this.say("General","Just give her a good last flight John,")),this["if"](function(){return!this.player(1).active&&this.player(2).active},this.say("General","Give her a good last flight Jim,")),this["if"](function(){return this.player(1).active&&this.player(2).active},this.say("General","Give her a good last flight guys,")),this.say("General","It's too bad these ships are too expensive for mass\nproduction and have to be taken out of commission"),this.wait(3e3))},d.prototype.tutorial=function(){return this.sequence(this.say("General","We send some drones for target practice"),this.repeat(2,this.sequence(this.dropWeaponsForEachPlayer(),this.wait(2e3),this.placeSquad(a.Scripts.Swirler,{amount:4,delay:500,drop:"lasers"}))))},d.prototype.dropWeaponsForEachPlayer=function(){return this.parallel(this["if"](function(){return this.player(1).active&&!this.player(1).has("lasers")},this.drop({item:"lasers",inFrontOf:this.player(1)})),this["if"](function(){return this.player(2).active&&!this.player(2).has("lasers")},this.drop({item:"lasers",inFrontOf:this.player(2)})))},d.prototype.droneTakeover=function(){return this.sequence(this.placeSquad(a.Scripts.Splasher,{amount:4,delay:750}),this.say("General","What the hell is happening with our drones?"),this.say("General","They do not respond to our commands anymore!\nThey have been taken over!"))},d.prototype.swirlAttacks=function(){return this.parallel(this.repeat(2,this.placeSquad(a.Scripts.Swirler,{amount:4,delay:500,drop:"lasers",options:{shootOnSight:!0}})),this.repeat(2,this.placeSquad(a.Scripts.Shooter,{amount:4,delay:500,drop:"lasers",options:{shootOnSight:!0}})))},d.prototype.underWaterAttacks=function(){return this.sequence(this.placeSquad(a.Scripts.Stalker),this.repeat(2,this.stalkerShootout()))},d.prototype.sunRise=function(){return this.runScript(a.Scripts.SunRise)},d.prototype.mineSwarm=function(b){return null==b&&(b={direction:"right"}),this.placeSquad(a.Scripts.JumpMine,{amount:8,delay:300,options:{x:function(){return 40*Math.round(10*Math.random())+200},y:function(){return 40*Math.round(8*Math.random())+60},direction:b.direction}})},d.prototype.stalkerShootout=function(){return this.parallel(this.placeSquad(a.Scripts.Stalker),this.placeSquad(a.Scripts.Shooter,{amount:4,delay:1e3,drop:"lasers",options:{shootOnSight:!0}}),this.placeSquad(a.Scripts.Swirler,{amount:4,delay:1e3,drop:"lasers",options:{shootOnSight:!0}}))},d.prototype.bossFightStage1=function(){return this.placeSquad(a.Scripts.Stage1BossStage1)},d}(a.LazerScript)}).call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.JumpMine=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.spawn=function(a){var b,c;return c="right"===a.direction?720:-80,Crafty.e("Mine").mine({x:c,y:340,speed:null!=(b=a.speed)?b:200})},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.sequence(this.moveTo({y:450,speed:400}),this.moveTo({x:this.options.x()}),this.moveTo({y:this.options.y()}),this.wait(2e3),this.parallel(this.moveTo({x:-50,speed:35}),this.sequence(this.wait(5e3),this.explosion(this.location(),{damage:!0,radius:40}),this.endSequence())))},c.prototype.onKilled=function(){return this.explosion(this.location(),{damage:!0,radius:40})},c}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.Shooter=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.spawn=function(a){var b,c;return b=Crafty.e("Drone").drone({health:200,x:680,y:340,speed:null!=(c=a.speed)?c:200}),a.shootOnSight&&b.addComponent("ShootOnSight"),b},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.movePath([[320,300],[130,240],[340,100],[570,260],[-10,400]])},c.prototype.onKilled=function(){return this.explosion(this.location())},c}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,
a.Scripts||(a.Scripts={}),a.Scripts.Splasher=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.spawn=function(){return Crafty.e("Drone").drone({health:200,x:680,y:400,speed:300})},c.prototype.execute=function(){return this.sequence(this.sendToBackground(.75,-200),this.movePath([[620,270],[420,350]]),this.moveTo({y:600,speed:100}))},c}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.Stage1BossStage1=function(c){function d(){return d.__super__.constructor.apply(this,arguments)}return b(d,c),d.prototype.spawn=function(){return Crafty.e("LargeDrone").drone({health:8e3,x:680,y:400,speed:100})},d.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.bindSequence("Hit",this.fase2,function(a){return function(){return a.entity.health<3e3}}(this)),this.sequence(this.disableWeapons(),this.moveTo({x:540,y:200}),this.say("Large Drone","We have control now! You will suffer!"),this.say("Large Drone","Earths defences are in our hands!"),this.wait(500),this.enableWeapons(),this.moveTo({y:205,speed:5}),this.attackCycle())},d.prototype.attackCycle=function(){return this.repeat(this.sequence(this.async(this.runScript(a.Scripts.Stage1BossMine,this.location())),this.moveTo({y:200,speed:5}),this.wait(200),this.async(this.runScript(a.Scripts.Stage1BossRocket,this.location())),this.moveTo({y:205,speed:5}),this.wait(200)))},d.prototype.fase2=function(){return this.bindSequence("Hit",this.fase3,function(a){return function(){return a.entity.health<1e3}}(this)),this.sequence(this.setSpeed(50),this.attackCycle())},d.prototype.fase3=function(){return this.sequence(this.disableWeapons(),this.moveTo({x:740,y:100,speed:100}),this.enableWeapons())},d}(a.EntityScript),a.Scripts.Stage1BossMine=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.spawn=function(a){return Crafty.e("Mine").mine({health:200,x:a().x,y:a().y+30,speed:200})},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.sequence(this.pickTarget("PlayerControlledShip"),this.moveTo({y:525}),this.moveTo(this.targetLocation(),{y:450}),this.moveTo(this.targetLocation({x:null})),this.wait(1e3),this.explosion(this.location(),{damage:!0,radius:40}))},c.prototype.onKilled=function(){return this.explosion(this.location(),{damage:!0,radius:40})},c}(a.EntityScript),a.Scripts.Stage1BossRocket=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.spawn=function(a){return Crafty.e("Rocket").rocket({health:200,x:a().x-30,y:a().y-5+Math.round(10*Math.random()),speed:400})},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.moveTo({x:-205})},c.prototype.onKilled=function(){return this.explosion(this.location(),{damage:!0,radius:40})},c}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.Stalker=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.spawn=function(){return Crafty.e("Drone").drone({health:200,x:680,y:400,speed:300})},c.prototype.execute=function(){return this.sequence(this.pickTarget("PlayerControlledShip"),this.moveTo({x:680,y:450}),this.repeat(10,this.sequence(this.moveTo(this.targetLocation(),{y:450,speed:200}),this.wait(100))),this.moveTo({y:-50}))},c}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.SunRise=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.spawn=function(a){var b;return b=Crafty("Sun, ColorFade"),b.length>0?b.attr({x:b.x+Crafty.viewport.x,y:b.y+Crafty.viewport.y}):Crafty.e("Sun, ColorFade").sun({x:620,y:340,speed:2})},c.prototype.execute=function(){return this.sequence(this.moveTo({x:620,y:340,speed:2e3}),this.parallel(this.backgroundColorFade({duration:15e4},"#602020","#8080FF"),this.movePath([[420,150],[320,100]],{rotate:!1}),this.colorFade({duration:3e5},"#DD8000","#DDDD00","#DDDD80")))},c}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.SunSet=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.spawn=function(a){var b;return b=Crafty("Sun"),b.length>0?b.attr({x:b.x+Crafty.viewport.x,y:b.y+Crafty.viewport.y}):Crafty.e("Sun, ColorFade").sun({x:620,y:340,speed:2})},c.prototype.execute=function(){return this.sequence(this.moveTo({x:320,y:100,speed:2e3}),this.backgroundColorFade({duration:1},"#8080FF"),this.parallel(this.movePath([[220,120],[120,320],[20,420]],{rotate:!1}),this.colorFade({duration:3e5},"#DDDD80","#DDDD00","#DD8000"),this.sequence(this.wait(15e4),this.backgroundColorFade({duration:15e4},"#8080FF","#602020"))))},c}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.Swirler=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.spawn=function(a){var b,c;return b=Crafty.e("Drone").drone({health:200,x:680,y:240,speed:null!=(c=a.speed)?c:200}),a.shootOnSight&&b.addComponent("ShootOnSight"),b},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.movePath([[320,100],[100,240],[320,400],[550,250],[-10,100]])},c.prototype.onKilled=function(){return this.explosion(this.location())},c}(a.EntityScript)}.call(this)}(),function(){(function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game.levelGenerator,a.defineElement("cloud",function(){var a;return a=20*Math.random()+40,this.addBackground(200,a,Crafty.e("2D, Canvas, Color").color("#FFFFFF").attr({z:-200,w:100,h:25,alpha:.5}),.5),this.addBackground(200,a+10,Crafty.e("2D, Canvas, Color").color("#DDDDDD").attr({z:-300,w:75,h:25,alpha:.5}),.45)}),a.defineElement("waterHorizon",function(){var a;return this.addBackground(0,this.level.visibleHeight-155,Crafty.e("2D, Canvas, Color").color("#6060E0").attr({z:-600,w:.25*this.delta.x+1,h:155}),.25),a=Crafty.e("2D, Canvas, Color, GoldenStripe").color("#DDDD00").attr({z:-599,w:.25*this.delta.x,h:1,alpha:0}),this.addBackground(0,this.level.visibleHeight-155,a,.25)}),a.defineElement("water",function(){return this.addBackground(0,this.level.visibleHeight-125,Crafty.e("2D, Canvas, Color").color("#3030B0").attr({z:-500,w:.5*this.delta.x+1,h:105}),.5),this.addBackground(0,this.level.visibleHeight-90,Crafty.e("2D, Canvas, Color").color("#3030B0").attr({z:-301,w:.5*this.delta.x+1,h:70}),.5)}),a.defineElement("waterFront",function(){var a;return a=65,this.add(0,this.level.visibleHeight-10,Crafty.e("2D, Canvas, Edge, Color").attr({w:this.delta.x,h:10}).color("#000080")),this.add(0,this.level.visibleHeight-a,Crafty.e("2D, Canvas, Color").attr({w:this.delta.x,h:a-10,z:-300}).color("#000080"))}),a.defineElement("cityHorizon",function(a){var b,c,d;return b="#A6A6C8",c="#8C8CAE",d="#69698B",this.addBackground(0,this.level.visibleHeight-155,Crafty.e("2D, Canvas, Color").color(d).attr({z:-600,w:.25*this.delta.x+1,h:155}),.25),"start"===a?(this.addBackground(150,this.level.visibleHeight-150,Crafty.e("2D, Canvas, Color").color(b).attr({z:-500,w:11,h:15}),.25),this.addBackground(120,this.level.visibleHeight-157,Crafty.e("2D, Canvas, Color").color(c).attr({z:-500,w:13.5,h:15}),.25),this.addBackground(230,this.level.visibleHeight-150,Crafty.e("2D, Canvas, Color").color(b).attr({z:-500,w:11,h:15}),.25),this.addBackground(190,this.level.visibleHeight-157,Crafty.e("2D, Canvas, Color").color(c).attr({z:-500,w:13.5,h:15}),.25)):(this.addBackground(90,this.level.visibleHeight-150,Crafty.e("2D, Canvas, Color").color(b).attr({z:-500,w:11,h:15}),.25),this.addBackground(60,this.level.visibleHeight-162,Crafty.e("2D, Canvas, Color").color(c).attr({z:-500,w:13.5,h:15}),.25),this.addBackground(170,this.level.visibleHeight-145,Crafty.e("2D, Canvas, Color").color(b).attr({z:-500,w:11,h:15}),.25),this.addBackground(130,this.level.visibleHeight-157,Crafty.e("2D, Canvas, Color").color(c).attr({z:-500,w:13.5,h:15}),.25),this.addBackground(230,this.level.visibleHeight-145,Crafty.e("2D, Canvas, Color").color(b).attr({z:-500,w:11,h:15}),.25),this.addBackground(330,this.level.visibleHeight-157,Crafty.e("2D, Canvas, Color").color(c).attr({z:-500,w:13.5,h:15}),.25))}),a.defineElement("city",function(){var a,b,c;return a="#A6A6C8",b="#8C8CAE",c="#66667D",this.addBackground(0,this.level.visibleHeight-140,Crafty.e("2D, Canvas, Color").color(c).attr({z:-400,w:.37*this.delta.x+1,h:83}),.37),a="#AFAFBB",b="#8F8F9A",c="#63636E",this.addBackground(0,this.level.visibleHeight-135,Crafty.e("2D, Canvas, Color").color(c).attr({z:-305,w:.5*this.delta.x+1,h:60}),.5),this.addBackground(90,this.level.visibleHeight-270,Crafty.e("2D, Canvas, Color").color(a).attr({z:-300,w:81,h:150}),.5),this.addBackground(190,this.level.visibleHeight-290,Crafty.e("2D, Canvas, Color").color(b).attr({z:-300,w:61,h:165}),.5)}),a.defineBlock(function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.name="City.Intro",c.prototype.delta={x:800,y:0},c.prototype.next=["City.Ocean"],c.prototype.autoNext="Ocean",c.prototype.generate=function(){var a,b,d;return c.__super__.generate.apply(this,arguments),d=700,a=65,this.add(0,this.level.visibleHeight-10,Crafty.e("2D, Canvas, Edge, Color").attr({w:this.delta.x,h:90}).color("#000080")),this.add(0,this.level.visibleHeight-a,Crafty.e("2D, Canvas, Color").attr({w:this.delta.x,h:a+10,z:-300}).color("#000080")),a=15,this.add(0,this.level.visibleHeight-200,Crafty.e("2D, Canvas, Color").color("#202020").attr({z:-1,w:d,h:300})),this.add(50,this.level.visibleHeight-350,Crafty.e("2D, Canvas, Color").color("#202020").attr({z:-1,w:350,h:150})),this.add(0,this.level.visibleHeight-a,Crafty.e("2D, Canvas, Color").color("#202020").attr({z:3,w:d,h:70,alpha:.3})),this.elevator=Crafty.e("2D, Canvas, Color, Tween").color("#707070").attr({z:0,w:100,h:5}),this.add(140,this.level.visibleHeight+a-85,this.elevator),this.outside=Crafty.e("2D, Canvas, Color, Tween").color("#303030").attr({z:0,w:d+10,h:195-a,alpha:0}),this.add(0,this.level.visibleHeight-this.outside.h-a,this.outside),this.barrel=Crafty.e("2D, Tween, Canvas, Color, Collision, Choreography").color("#606000").attr({z:3,w:10,h:15}),this.add(500,this.level.visibleHeight-this.outside.h-a-this.barrel.h,this.barrel),this.barrelKnock=!1,b=[{type:"linear",y:190,duration:1500},{type:"delay",event:"splash",duration:1}],this.barrel.onHit("PlayerControlledShip",function(a){return function(){return a.barrelKnock?void 0:(a.barrelKnock=!0,a.barrel.choreography(b).tween({rotation:90},1500).one("splash",function(){return a.barrel.attr({alpha:0}),Crafty.e("WaterSplash").waterSplash({x:a.barrel.x,y:a.barrel.y,size:a.barrel.h})}))}}(this)),this.addElement("water"),this.addElement("waterHorizon"),this.addBackground(0,this.level.visibleHeight+40,Crafty.e("2D, Canvas, Color").color("#000040").attr({z:3,w:this.delta.x+300+1,h:185}),1.25),this.addElement("cloud")},c.prototype.enter=function(){var a,b,d,e;return c.__super__.enter.apply(this,arguments),this.speed=this.level._forcedSpeed,Crafty("ScrollWall").attr({y:120}),this.level.setForcedSpeed(0),b=[{type:"linear",x:-160,duration:2500},{type:"linear",y:-130,duration:2500,event:"lift"},{type:"linear",x:70,y:-10,duration:2500,event:"shipExterior"},{type:"delay",duration:500,event:"unlock"},{type:"delay",duration:1,event:"go"}],a=this,e=null,d=function(a){return e&&e.has("Choreography")?(a.attr({x:e.x-50,y:e.y}),e.disableControls&&a.disableControl(),a.addComponent("Choreography"),a.synchChoreography(e),a.one("ChoreographyEnd",function(){return this.removeComponent("Choreography",!1)}),a.one("unlock",function(){return this.enableControl(),this.weaponsEnabled=!0}),a.weaponsEnabled=e.weaponsEnabled):void 0},this.bind("ShipSpawned",d),Crafty("PlayerControlledShip").each(function(c){return 0===c?(e=this,this.addComponent("Choreography"),this.attr({x:360-50*c,y:380}),this.disableControl(),this.weaponsEnabled=!1,this.choreography(b),this.one("ChoreographyEnd",function(b){return function(){return b.removeComponent("Choreography","no"),a.unbind("ShipSpawned")}}(this)),this.one("unlock",function(){return this.enableControl(),this.weaponsEnabled=!0}),this.one("lift",function(){return a.elevator.tween({y:a.elevator.y-130},2500),Crafty("ScrollWall").each(function(){return this.addComponent("Tween"),this.tween({y:0},5e3),this.one("TweenEnd",function(){return this.removeComponent("Tween",!1)})})}),this.one("shipExterior",function(){return a.outside.tween({alpha:1},1500).addComponent("Edge")}),this.one("go",function(){return a.level.setForcedSpeed(a.speed)})):void 0})},c}(this.Game.LevelScenery)),a.defineBlock(function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.name="City.Ocean",c.prototype.delta={x:400,y:0},c.prototype.next=["City.Ocean"],c.prototype.generate=function(){return c.__super__.generate.apply(this,arguments),this.addElement("waterFront"),this.addElement("waterHorizon"),this.addElement("cloud"),this.addElement("water")},c}(this.Game.LevelScenery)),a.defineBlock(function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.name="City.CoastStart",c.prototype.delta={x:400,y:0},c.prototype.next=["City.CoastStart"],c.prototype.autoNext="Coast",c.prototype.generate=function(){return c.__super__.generate.apply(this,arguments),this.addElement("waterFront"),this.addElement("water"),this.addElement("cityHorizon","start"),this.addElement("cloud")},c}(this.Game.LevelScenery)),a.defineBlock(function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.name="City.Coast",c.prototype.delta={x:400,y:0},c.prototype.next=["City.Coast"],c.prototype.generate=function(){return c.__super__.generate.apply(this,arguments),this.addElement("waterFront"),this.addElement("water"),this.addElement("cityHorizon"),this.addElement("cloud")},c}(this.Game.LevelScenery)),a.defineBlock(function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.name="City.Bay",c.prototype.delta={x:400,y:0},c.prototype.next=["City.Bay"],c.prototype.generate=function(){return c.__super__.generate.apply(this,arguments),this.addElement("waterFront"),this.addElement("water"),this.addElement("cityHorizon"),this.addElement("city")},c}(this.Game.LevelScenery)),a.defineBlock(function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.name="City.UnderBridge",c.prototype.delta={x:800,y:0},c.prototype.next=["City.Bay"],c.prototype.autoNext="Bay",c.prototype.generate=function(){var a,b,d,e,f,g,h,i,j,k;for(c.__super__.generate.apply(this,arguments),this.addElement("waterFront"),this.addElement("water"),this.addElement("cityHorizon"),this.addElement("city"),g=80,this.addBackground(0,this.level.visibleHeight-480,Crafty.e("2D, Canvas, Color").color("#000000").attr({z:3,w:1.5*g,h:480,alpha:.7}),1.5),this.addBackground(this.delta.x-g,this.level.visibleHeight-480,Crafty.e("2D, Canvas, Color").color("#000000").attr({z:3,w:1.5*g,h:480,alpha:.7}),1.5),h=[],e=f=0;11>=f;e=++f)a=["#101010","#181818","#202020","#282828","#303030","#383838","#404040","#484848","#505050","#585858","#606060","#686868"][11-Math.floor(e/2)],b=120-8*e,j=this.level.visibleHeight-(480-30*e),k=-3-1*e,i=1.2-.05*e,d=420-6*e-(b+j),this.addBackground(0,j,Crafty.e("2D, Canvas, Color").color(a).attr({z:k,w:this.delta.x*i,h:b}),i),e%5===0?(this.addBackground(0,b+j,Crafty.e("2D, Canvas, Color").color(a).attr({z:k,w:g*i,h:d}),i),h.push(this.addBackground(this.delta.x-g,b+j,Crafty.e("2D, Canvas, Color").color(a).attr({z:k,w:g*i,h:d}),i))):h.push(void 0);return h},c}(this.Game.LevelScenery)),a.defineBlock(function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.name="City.Skyline",c.prototype.delta={x:800,y:0},c.prototype.next=["City.Skyline"],c.prototype.generate=function(){var a;return c.__super__.generate.apply(this,arguments),a=600,this.add(0,this.level.visibleHeight-a,Crafty.e("2D, Canvas, Color").attr({w:300,h:a,z:-1}).color("#909090")),a=500,this.addBackground(200,this.level.visibleHeight-a,Crafty.e("2D, Canvas, Color").attr({w:400,h:a,z:5}).color("#000000"),1.5),this.addElement("water"),this.addElement("cityHorizon"),this.addElement("city")},c}(this.Game.LevelScenery))}).call(this)}(),function(){(function(){Crafty.defineScene("Game",function(a){var b,c,d;return b=window.Game,d=b.Scripts.Stage1,c=b.levelGenerator.createLevel(d.prototype.metadata),c.start(),new d(c).run().then(function(a){return function(){return console.log("end of script!")}}(this))},function(){return Crafty("Delay").each(function(){return this.destroy()}),Crafty.unbind("PlayerDied"),Crafty("Player").each(function(){return this.removeComponent("ShipSpawnable")})})}).call(this),function(){Crafty.defineScene("GameOver",function(){var a;return a=window.Game,Crafty.background("#111"),Crafty.viewport.x=0,Crafty.viewport.y=0,Crafty.e("2D, DOM, Text").attr({x:0,y:110,w:640}).text("Game Over").textColor("#FF0000").css("textAlign","center").textFont({size:"50px",weight:"bold",family:"Courier new"}),Crafty("Player ControlScheme").each(function(a){return Crafty.e("2D, DOM, Text").attr({x:0,y:200+30*a,w:640}).text(this.name+": "+this.points).textColor(this.color()).css("textAlign","center").textFont({size:"30px",weight:"bold",family:"Courier new"})}),Crafty.e("Delay").delay(function(){return Crafty.e("2D, DOM, Text").attr({x:0,y:350,w:640}).text("Press fire to start again").textColor("#FF0000").css("textAlign","center").textFont({size:"20px",weight:"bold",family:"Courier new"}),Crafty("Player").each(function(){return this.reset(),this.one("Activated",function(){return Crafty.enterScene(a.firstLevel,{stage:1})})}),this.delay(function(){return Crafty.enterScene("Intro")},6e4,0)},2e3,0)},function(){return Crafty("Delay").each(function(){return this.destroy()}),Crafty("Player").each(function(){return this.unbind("Activated")})})}.call(this),function(){Crafty.defineScene("Intro",function(){var a;return a=window.Game,Crafty.background("#000000"),Crafty.viewport.x=0,Crafty.viewport.y=0,Crafty.e("2D, Canvas, Text, Tween, Delay").attr({x:150,y:210,w:450}).text("Speedlazer").textColor("#0000ff").textFont({size:"40px",weight:"bold",family:"Courier new"}).delay(function(){return this.tween({x:250},2e3),this.one("TweenEnd",function(){return this.tween({x:150},2e3)})},2e3,-1),Crafty.e("2D, Canvas, Text, Tween, Delay").attr({x:200,y:290,w:750}).text("Press fire to start!").textColor("#FF0000").textFont({size:"20px",weight:"bold",family:"Courier new"}).delay(function(){return this.tween({alpha:0},1e3),this.one("TweenEnd",function(){return this.tween({alpha:1},1e3)})},2e3,-1),Crafty("Player").each(function(){return this.reset(),this.one("Activated",function(){return Crafty.enterScene(a.firstLevel,{stage:1})})})},function(){return Crafty("Player").each(function(){return this.unbind("Activated")})})}.call(this)}(),function(){function a(){var a=$("#cr-stage").height(),b=$(window).height(),c=b/a;$("#cr-stage").css("transform","scale("+c+")")}window.Game.start(!1),$(document).on("click",function(){screenfull.enabled&&(screenfull.request($("#cr-stage")[0]),$("body").addClass("fullscreen"),document.addEventListener(screenfull.raw.fullscreenchange,function(){screenfull.isFullscreen||$("body").removeClass("fullscreen")}))}),$(window).on("resize",function(){a()}),a()}();