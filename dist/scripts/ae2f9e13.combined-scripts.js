!function(){"use strict";Crafty.c("Bullet",{init:function(){this.addComponent("2D, Canvas, Color")},fire:function(a){return this.attr({damage:a.damage}).bind("EnterFrame",function(){this.x=this.x+a.speed,this.x>1200&&this.destroy()}),this}})}(),function(){"use strict";Crafty.c("Enemy",{init:function(){this.addComponent("2D, Canvas, Color, Collision")},enemy:function(a){this.attr({x:a.x,y:a.y,w:50,h:50,health:300}).color("#0000FF").bind("EnterFrame",function(){this.x=this.x-2,this.x<-100&&(this.destroy(),console.log("Uhoh"))}).onHit("Bullet",function(a){var b=a[0].obj;b.trigger("HitTarget",{target:this}),this.health-=b.damage,this.health<=0&&(b.trigger("DestroyTarget",{target:this}),this.destroy()),b.destroy()})}})}(),function(){"use strict";Crafty.c("GamepadControls",{init:function(){this.requires("Listener"),this.bind("RemoveComponent",function(a){"ControlScheme"===a&&this.removeComponent("GamepadControls")})},remove:function(){this.unbind("GamepadKeyChange",this._keyHandling)},setupControls:function(a){a.addComponent("GamepadControls").controls(this.controlMap).addComponent("ControlScheme")},controls:function(a){return this.controlMap=a,void 0!==a.gamepadIndex?(this.requires("Gamepad"),this.gamepad(a.gamepadIndex),this.bind("GamepadKeyChange",this._keyHandling),this):void 0},_keyHandling:function(a){a.button===this.controlMap.fire&&a.pressed&&this.trigger("Fire",a)},assignControls:function(a){var b=this.controlMap;a.addComponent("GamepadMultiway, Gamepad").gamepad(b.gamepadIndex).gamepadMultiway({speed:{y:3,x:1},gamepadIndex:b.gamepadIndex}),this.listenTo(a,"GamepadKeyChange",function(c){c.button===b.fire&&c.pressed&&a.shoot()})}})}(),function(){"use strict";Crafty.c("HUD",{init:function(){this.requires("2D, Listener")},hud:function(a,b){return this.player=b,this.score=Crafty.e("2D, DOM, Text").attr({x:a,y:10,w:150,h:20}).textFont({size:"20px",weight:"bold",family:"Courier new"}),this.player.has("Color")&&this.score.textColor(this.player.color()),this.lives=Crafty.e("2D, DOM, Text").attr({x:a,y:30,w:250,h:20}).textFont({size:"20px",weight:"bold",family:"Courier new"}),this.player.has("Color")&&this.lives.textColor(b.color()),this.updateHud(),this.listenTo(b,"UpdateLives",this.updateHud),this.listenTo(b,"UpdatePoints",this.updateHud),this.listenTo(b,"NewComponent",function(a){for(var b=0;b<a.length;b++){var c=a[b];"ControlScheme"===c&&this.updateHud()}}),this.listenTo(b,"RemoveComponent",function(a){"ControlScheme"===a&&this.updateHud()}),this},updateHud:function(){this.score.text(this.player.has("ControlScheme")?"Score: "+this.player.points:this.player.name),this.lives.text(this.player.has("ControlScheme")?0===this.player.lives?"Game Over":"Lives: "+this.player.lives:"Press fire to start!")}})}(),function(){"use strict";Crafty.c("Invincible",{init:function(){this.requires("Delay, Color"),this.rawColor=this.color(),this.delay(this._blink,250,-1)},_blink:function(){void 0===this.blinkOn&&(this.blinkOn=!0),this.blinkOn=!this.blinkOn,this.blinkOn?this.color(this.rawColor,.5):this.color(this.rawColor,100)},remove:function(){this.color(this.rawColor),this.cancelDelay(this._blink)},invincibleDuration:function(a){this.delay(function(){this.removeComponent("Invincible")},a,0)}})}(),function(){"use strict";Crafty.c("KeyboardControls",{init:function(){this.requires("Listener"),this.bind("RemoveComponent",function(a){"ControlScheme"===a&&this.removeComponent("KeyboardControls")})},remove:function(){this.unbind("KeyDown",this._keyHandling)},setupControls:function(a){a.addComponent("KeyboardControls").controls(this.controlMap).addComponent("ControlScheme")},controls:function(a){return this.controlMap=a,this.bind("KeyDown",this._keyHandling),this},_keyHandling:function(a){a.key===this.controlMap.fire&&this.trigger("Fire",a)},assignControls:function(a){var b=this.controlMap,c={},d={up:-90,down:90,left:180,right:0};for(var e in d){var f=d[e],g=b[e];for(var h in Crafty.keys)Crafty.keys[h]===g&&(c[h]=f)}a.addComponent("Multiway, Keyboard").multiway({y:3,x:1},c),this.listenTo(a,"KeyDown",function(c){c.key===b.fire&&a.shoot()})}})}(),function(){"use strict";Crafty.c("Listener",{init:function(){this.listeners=[]},remove:function(){for(var a;a<this.listeners.length;a++){var b=this.listeners[a];b.object.unbind(b.event,b.callback)}},listenTo:function(a,b,c,d){void 0===d&&(d=this);var e=function(){c.apply(d,arguments)};this.listeners.push({object:a,event:b,callback:e}),a.bind(b,e)}})}(),function(){"use strict";Crafty.c("Player",{lives:2,points:0,init:function(){},loseLife:function(){this.lives<=0||(this.lives-=1,this.trigger("UpdateLives",{lives:this.lives}),this.lives<=0&&Crafty.trigger("PlayerDied",this))},addPoints:function(a){this.lives<=0||(this.points+=a,this.trigger("UpdatePoints",{points:this.points}))}})}(),function(){"use strict";Crafty.c("PlayerAssignable",{init:function(){this.one("Fire",this._assignControls),this.preferredPlayer=null},_assignControls:function(){var a=this._playerWithoutControls(this.preferredPlayer);if(void 0===a)return void this.one("Fire",this._assignControls);this.preferredPlayer=a.getId(),this.setupControls(a);var b=this;a.one("Deactivated",function(){b.one("Fire",b._assignControls)})},_playerWithoutControls:function(a){if(null!==a){var b=Crafty(a);if(!b.has("ControlScheme"))return b}for(var c=Crafty("Player"),d=0;d<c.length;d++){var e=Crafty(c[d]);if(!e.has("ControlScheme"))return e}}}),Crafty.c("ControlScheme",{init:function(){this.trigger("Activated"),Crafty.trigger("PlayerActivated")},remove:function(){this.trigger("Deactivated"),Crafty.trigger("PlayerDeactivated")}})}(),function(){"use strict";Crafty.c("PlayerControlledShip",{init:function(){this.requires("2D, Canvas, Color, Collision, Delay"),this.attr({w:30,h:30}).bind("Moved",function(a){this.hit("Edge")&&this.attr({x:a.x,y:a.y})}),this.delay(function(){this.addComponent("Invincible").invincibleDuration(2e3),this.onHit("Enemy",function(){this.has("Invincible")||this.trigger("Hit")})},10,0)},shoot:function(){var a=this;Crafty.e("Bullet").color(this.color()).attr({x:this.x+this.w,y:this.y+this.h/2,w:5,h:5}).fire({origin:this,damage:100,speed:4,direction:0}).bind("HitTarget",function(){a.trigger("BulletHit")}).bind("DestroyTarget",function(){a.trigger("BulletDestroyedTarget")})}})}(),function(){"use strict";Crafty.c("ShipSpawnable",{init:function(){this.requires("Listener"),this.bind("Activated",this.spawnShip)},remove:function(){this.unbind("Activated",this.spawnShip)},spawnPosition:function(a,b){return this.spawnPosition={x:a,y:b},this},spawnShip:function(){if(this.has("ControlScheme")&&!(this.lives<=0)){var a=Crafty.e("PlayerControlledShip").attr(this.spawnPosition);return this.has("Color")&&a.color(this.color()),this.has("ControlScheme")&&this.assignControls(a),this.listenTo(a,"BulletHit",function(){this.addPoints(10)}),this.listenTo(a,"BulletDestroyedTarget",function(){this.addPoints(50)}),this.listenTo(a,"Hit",function(){a.destroy(),this.loseLife(),this.spawnShip()}),this}}})}(),function(){"use strict";Crafty.defineScene("GameOver",function(){Crafty.background("#111"),Crafty.e("2D, DOM, Text").attr({x:200,y:210,w:450}).text("Game Over").textColor("#FF0000").textFont({size:"80px",weight:"bold",family:"Courier new"}),Crafty("Player ControlScheme").each(function(a){Crafty.e("2D, DOM, Text").attr({x:240,y:310+50*a,w:700}).text(this.name+": "+this.points).textColor(this.color()).textFont({size:"50px",weight:"bold",family:"Courier new"})}),Crafty.e("Delay").delay(function(){Crafty.e("2D, DOM, Text").attr({x:200,y:590,w:750}).text("Press fire to start again").textColor("#FF0000").textFont({size:"30px",weight:"bold",family:"Courier new"}),Crafty("Player").each(function(){this.removeComponent("ControlScheme").attr({lives:2,points:0}),this.one("Activated",function(){Crafty.enterScene("Space")})})},2e3,0)},function(){Crafty("Player").each(function(){this.unbind("Activated")})})}(),function(){"use strict";Crafty.defineScene("Space",function(){Crafty.background("#000"),Crafty("Player").each(function(a){this.addComponent("ShipSpawnable").spawnPosition(140,300+50*a),Crafty.e("HUD").hud(30+300*a,this)}),Crafty("Player ControlScheme").each(function(){this.spawnShip()}),Crafty.e("2D, Canvas, Edge").attr({x:10,y:50,w:900,h:2}),Crafty.e("2D, Canvas, Edge").attr({x:10,y:750,w:900,h:2}),Crafty.e("2D, Canvas, Edge").attr({x:10,y:50,w:2,h:730}),Crafty.e("2D, Canvas, Edge").attr({x:910,y:50,w:2,h:730});var a=.4,b=50,c=null;Crafty.one("PlayerActivated",function(){null===c&&(c=(new Date).getTime(),Crafty.bind("EnterFrame",function(){var d=((new Date).getTime()-c)*a;if(d>b){var e=Crafty.math.randomInt(40,720);Crafty.e("Enemy").enemy({x:1200,y:e}),b+=Crafty.math.randomInt(100,2e3),console.log("Time to spawn!")}}))}),Crafty.bind("PlayerDied",function(){var a=!1;Crafty("Player ControlScheme").each(function(){this.lives>0&&(a=!0)}),a===!1&&Crafty.enterScene("GameOver")})},function(){Crafty.unbind("EnterFrame"),Crafty.unbind("PlayerDied"),Crafty("Player").each(function(){this.removeComponent("ShipSpawnable")})})}(),function(){"use strict";var a={start:function(){Crafty.load([],function(){Crafty.init(1024,768),Crafty.background("#111"),Crafty.e("Player, Color").attr({name:"Player 1"}).setName("Player 1").color("#FF0000"),Crafty.e("Player, Color").attr({name:"Player 2"}).setName("Player 2").color("#00FF00"),Crafty.e("KeyboardControls, PlayerAssignable").controls({fire:Crafty.keys.SPACE,up:Crafty.keys.UP_ARROW,down:Crafty.keys.DOWN_ARROW,left:Crafty.keys.LEFT_ARROW,right:Crafty.keys.RIGHT_ARROW}),Crafty.e("KeyboardControls, PlayerAssignable").controls({fire:Crafty.keys.G,up:Crafty.keys.W,down:Crafty.keys.S,left:Crafty.keys.A,right:Crafty.keys.D}),Crafty.e("GamepadControls, PlayerAssignable").controls({gamepadIndex:0,fire:0}),Crafty.e("GamepadControls, PlayerAssignable").controls({gamepadIndex:1,fire:0}),Crafty.enterScene("Space")})}};a.start(),$(document).on("click","button",function(){screenfull.enabled&&(screenfull.request($("#cr-stage")[0]),$(this).blur())})}(),function(){Crafty.debugBar.show()}();