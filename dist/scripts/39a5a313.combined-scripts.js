!function(){"use strict"}(),function(){(function(){Crafty.c("Choreography",{init:function(){return this.bind("EnterFrame",this._choreographyTick),this._ctypes={linear:this._executeLinear,sine:this._executeSine,delay:this._executeDelay,viewport:this._executeMoveIntoViewport,bezier:this._executeBezier}},remove:function(){},choreography:function(a,b){return null==b&&(b=0),this._choreography=a,this._repeats=b,this._repeated=0,this._setupCPart(0),this},synchChoreography:function(a){return this._choreography=_.clone(a._choreography),this._repeats=a._repeats,this._repeated=a._repeated,this._currentPart=_.clone(a._currentPart),this._currentPart.x+=this.x-a.x,this._currentPart.y+=this.y-a.y,this._currentPart.easing=_.clone(a._currentPart.easing)},_setupCPart:function(a){var b;if(this._currentPart=null,!(a<this._choreography.length)){if(!(this._repeated<this._repeats||-1===this._repeats))return void this.trigger("ChoreographyEnd");this._repeated+=1,a=0}return b=this._choreography[a],null!=b.event&&this.trigger(b.event,{entity:this,data:b.data}),this._setupPart(b,a)},_choreographyTick:function(a){var b;if(null!=this._currentPart)return this._currentPart.easing.tick(a.dt),b=this._currentPart.easing.value(),this._ctypes[this._currentPart.type].apply(this,[b]),this._currentPart.easing.complete?this._setupCPart(this._currentPart.part+1):void 0},_setupPart:function(a,b){var c,d,e;return this._currentPart=_.extend(_.clone(a),{part:b,x:this.x,y:this.y,dx:null!=(c=a.x)?c:0,dy:null!=(d=a.y)?d:0,easing:new Crafty.easing(null!=(e=a.duration)?e:0)})},_executeLinear:function(a){return this.x=this._currentPart.x+a*this._currentPart.dx,this.y=this._currentPart.y+a*this._currentPart.dy},_executeSine:function(a){var b;return b=this._currentPart.dy,this.x=this._currentPart.x+a*this._currentPart.dx,this.y=this._currentPart.y+Math.sin(-(Math.PI+Math.PI*this._currentPart.start*2)+a*this._currentPart.repeat*Math.PI*2)*b},_executeDelay:function(a){},_executeMoveIntoViewport:function(a){var b,c,d,e,f,g;return b=-Crafty.viewport.x+this._currentPart.dx,d=b-this.x,f=d*a,null!=this._currentPart.maxSpeed&&Math.abs(f)>this._currentPart.maxSpeed&&(f=this._currentPart.maxSpeed,0>d&&(f*=-1)),this.x=this.x+f,c=-Crafty.viewport.y+this._currentPart.dy,e=c-this.y,g=e*a,null!=this._currentPart.maxSpeed&&Math.abs(g)>this._currentPart.maxSpeed&&(g=this._currentPart.maxSpeed,0>d&&(g*=-1)),this.y=this.y+g},_executeBezier:function(a){var b,c,d;return b=new Game.BezierPath,null==this._currentPart.bPath&&(d=b.scalePoints(this._currentPart.path,{origin:{x:this.x,y:this.y},scale:{x:Crafty.viewport.width,y:Crafty.viewport.height}}),this._currentPart.bPath=b.buildPathFrom(d)),c=b.pointOnPath(this._currentPart.bPath,a),this._currentPart.rotation&&(this.rotation=b.angleOnPath(this._currentPart.bPath,a)),this.x=c.x,this.y=c.y}})}).call(this),function(){}.call(this),function(){Crafty.c("Enemy",{init:function(){return this.requires("2D, Canvas, Color, Collision, Choreography")},enemy:function(){return this.attr({w:25,h:25,health:100}),this.color("#0000FF"),this.onHit("Bullet",function(a){var b;return b=a[0].obj,b.trigger("HitTarget",{target:this}),this.health-=b.damage,this.health<=0&&(b.trigger("DestroyTarget",{target:this}),Crafty.trigger("EnemyDestroyed",this),this.trigger("Destroyed",this),this.destroy()),b.destroy()}),this}})}.call(this),function(){Crafty.c("Explosion",{init:function(){return this.requires("Color,Tween,2D,Canvas")},explode:function(a){return this.attr(a),this.color("#FF0000"),this.tween({x:this.x-20,y:this.y-20,w:this.w+40,h:this.h+40,alpha:0,color:"#000000"},500),this.bind("TweenEnd",function(){return this.destroy()})}})}.call(this),function(){Crafty.c("Invincible",{init:function(){return this.requires("Delay, Color"),this.rawColor=this.color(),this.delay(this._blink,250,-1)},_blink:function(){return null==this.blinkOn&&(this.blinkOn=!0),this.blinkOn=!this.blinkOn,this.blinkOn?this.color(this.rawColor,.5):this.color(this.rawColor,100)},remove:function(){return this.color(this.rawColor),this.cancelDelay(this._blink)},invincibleDuration:function(a){return this.delay(function(){return this.removeComponent("Invincible")},a,0)}})}.call(this),function(){Crafty.c("LaserTurret",{init:function(){return this.requires("2D, Canvas, Edge, Color, Tween, Delay"),this.attr({w:20,h:20}),this.detectionBeam=Crafty.e("2D, Collision").attr({x:5,w:10}),this.attach(this.detectionBeam),this.beam=Crafty.e("2D, Canvas, Color, LaserBeam").attr({x:5,w:10}).color("#FF00FF"),this.attach(this.beam)},remove:function(){return this.unbind("TweenEnd"),this.unbind("EnterFrame")},laserTurret:function(a){var b;return this._config=a,b="up"!==this._config.orientation,b||this.attr({y:this.y-this.h}),this._updateBeam(),this.bind("TweenEnd",function(a){return function(){return a._motion(a._motionFase+1)}}(this)),this.bind("EnterFrame",this._updateBeam),this._motion(0)},_updateBeam:function(){var a,b,c,d,e,f,g,h,i;for(a=500,f=this.y+this.h,e=this.y+this.h+a,c="up"!==this._config.orientation,c||(f=this.y-a,e=a),this.detectionBeam.attr({y:f,h:e}),i=this.detectionBeam.hit("Edge"),d=0,g=i.length;g>d;d++)h=i[d],h.obj!==this&&(h.obj.has("Glass")||(c?(b=h.obj.y-f,e>b&&(e=b)):(b=h.obj.y+h.obj.h,b>f&&(f=b,e=this.y-b))));return this.beam.attr({y:f,h:e}),this},_motion:function(a){switch(this._motionFase=a,a){case 0:return this.tween({x:this.x+this._config.range},this._config.duration);case 1:return this.delay(function(){return this._motion(this._motionFase+1)},this._config.pauseOnEdges,0);case 2:return this.tween({x:this.x-this._config.range},this._config.duration);case 3:return this.delay(function(){return this._motion(0)},this._config.pauseOnEdges,0)}}})}.call(this),function(){Crafty.c("PlayerAssignable",{init:function(){return this._attachControllerAssignTrigger(),this.preferredPlayer=null},_assignControls:function(){var a;return a=this._preferredplayer()||this._firstUnassignedPlayer(),null==a?void this._attachControllerAssignTrigger():(this.preferredPlayer=a.getId(),this.setupControls(a),a.one("Deactivated",function(a){return function(){return a._attachControllerAssignTrigger()}}(this)))},_attachControllerAssignTrigger:function(){return this.one("Fire",this._assignControls)},_preferredplayer:function(a){var b;return null===this.preferredPlayer||(b=Crafty(this.preferredPlayer),b.has("ControlScheme"))?void 0:b},_firstUnassignedPlayer:function(){var a,b,c,d,e;for(e=Crafty("Player"),a=0,b=e.length;b>a;a++)if(d=e[a],c=Crafty(d),!c.has("ControlScheme"))return c}}),Crafty.c("ControlScheme",{init:function(){return this.trigger("Activated"),Crafty.trigger("PlayerActivated")},remove:function(){return this.trigger("Deactivated"),Crafty.trigger("PlayerDeactivated")}})}.call(this),function(){Crafty.c("PlayerControlledShip",{init:function(){return this.requires("2D, Canvas, Color, Collision, Listener"),this.attr({w:30,h:30}),this.bind("Moved",function(a){return this.hit("Edge")?this.attr({x:a.x,y:a.y}):void 0}),this._forcedSpeed={x:0,y:0},this.primaryWeapon=void 0},start:function(){return this.addComponent("Invincible").invincibleDuration(2e3),this.onHit("Enemy",function(){return this.has("Invincible")?void 0:this.trigger("Hit")}),this.onHit("LaserBeam",function(){return this.has("Invincible")?void 0:this.trigger("Hit")}),this.onHit("PowerUp",function(a){var b,c,d,e;for(e=[],b=0,c=a.length;c>b;b++)d=a[b],this.pickUp(d.obj),e.push(this.trigger("PowerUp",d.obj));return e}),this.bind("EnterFrame",function(){return this.x+=this._forcedSpeed.x,this.y+=this._forcedSpeed.y,this.hit("Edge")&&(this.x-=this._forcedSpeed.x),this.hit("Edge")&&(this.y-=this._forcedSpeed.y),this.hit("Edge")?this.trigger("Hit"):void 0}),this},forcedSpeed:function(a){return null!=a.x&&null!=a.y?(this._forcedSpeed.x=a.x,this._forcedSpeed.y=a.y):(this._forcedSpeed.x=a,this._forcedSpeed.y=0),this},shoot:function(a){return null!=this.primaryWeapon?(a&&this.trigger("Shoot"),this.primaryWeapon.shoot(a)):void 0},pickUp:function(a){var b;return b=a.settings.contains,this.installItem(b)?a.destroy():void 0},installItem:function(a){return this.hasItem(a)?("lasers"===a&&this.primaryWeapon.addXP(10),!0):(this.items.push(a),"lasers"===a?(this.primaryWeapon=Crafty.e("WeaponLaser"),this.primaryWeapon.install(this),this.listenTo(this.primaryWeapon,"levelUp",function(a){return function(b){return a.scoreText("+1")}}(this)),!0):void 0)},hasItem:function(a){return null==this.items&&(this.items=[]),~this.items.indexOf(a)},scoreText:function(a){return Crafty.e("Text, Canvas, 2D, Tween").textColor("#FFFFFF").text(a).attr({x:this.x,y:this.y-10,z:990}).textFont({size:"16px",weight:"bold",family:"Bank Gothic"}).tween({y:this.y-40,alpha:.5},1e3).one("TweenEnd",function(){return this.destroy()})}})}.call(this),function(){Crafty.c("PlayerInfo",{init:function(){return this.requires("2D, Listener")},playerInfo:function(a,b){return this.player=b,this.score=Crafty.e("2D, Canvas, Text, HUD").attr({w:150,h:20}).positionHud({x:a,y:10,z:2}).textFont({size:"12px",family:"Bank Gothic"}),this.player.has("Color")&&this.score.textColor(this.player.color()),this.lives=Crafty.e("2D, Canvas, Text, HUD").attr({w:250,h:20}).positionHud({x:a,y:25,z:2}).textFont({size:"12px",family:"Bank Gothic"}),this.player.has("Color")&&this.lives.textColor(b.color()),this.updatePlayerInfo(),this.listenTo(b,"UpdateLives",this.updatePlayerInfo),this.listenTo(b,"UpdatePoints",this.updatePlayerInfo),this.listenTo(b,"Activated",function(a){return function(){return a.updatePlayerInfo()}}(this)),this.listenTo(b,"Deactivated",function(a){return function(){return a.updatePlayerInfo()}}(this)),this},updatePlayerInfo:function(){return this.score.text(this.player.has("ControlScheme")?"Score: "+this.player.points:this.player.name),this.lives.text(this.player.has("ControlScheme")?0===this.player.lives?"Game Over":"Lives: "+this.player.lives:"Press fire to start!")}})}.call(this),function(){Crafty.c("PowerUp",{init:function(){return this.requires("2D,Canvas,Color"),this.color("#20FF20"),this.attr({w:20,h:20})},remove:function(){},powerUp:function(a){var b;return this.settings=a,this.settings.marking&&(b=Crafty.e("2D,Canvas,Text").textColor("#000000").textFont({size:"16px",weight:"bold",family:"Bank Gothic"}).text(this.settings.marking).attr({x:4,y:1}),this.attach(b)),this}})}.call(this),function(){Crafty.c("ScrollWall",{init:function(){return this.requires("2D, Canvas, Color, Edge, Collision"),this.attr({x:0,y:0,w:2,h:Crafty.viewport.height,speed:{x:0,y:0}}),this._speed={x:0,y:0},this.wallEnd=Crafty.e("2D, Canvas, ScrollFront").attr({x:-(Crafty.viewport.x-Crafty.viewport.width)-3,y:0,h:Crafty.viewport.height,w:12}),this.attach(this.wallEnd),this.wallTop=Crafty.e("2D, Canvas, Edge, Collision").attr({x:0,y:40,h:2,w:Crafty.viewport.width}),this.attach(this.wallTop),this.wallBottom=Crafty.e("2D, Canvas, Edge, Collision").attr({x:0,y:Crafty.viewport.height-2,h:2,w:Crafty.viewport.width}),this.attach(this.wallBottom),this.bind("EnterFrame",function(){var a,b;return a=this._speed.x,b=this._speed.y,Crafty("PlayerControlledShip").each(function(){var b,c,d;return d=Crafty.viewport.width*(2/3),c=this.x+Crafty.viewport.x,c>d?(b=(c-d)/(Crafty.viewport.width-d),a+=(5+this._forcedSpeed.x)*b):void 0}),this.x+=a,this.y+=b,Crafty.viewport.y!==-this.y&&(Crafty.viewport.y=-this.y),Crafty.viewport.x!==-this.x&&(Crafty.viewport.x=-this.x),Crafty.viewport._clamp()}),this.onHit("PlayerControlledShip",function(a){var b,c,d,e,f;for(f=[],c=0,d=a.length;d>c;c++)b=a[c],e=b.obj,f.push(e.attr({x:e.x+this._speed.x}));return f}),this.wallTop.onHit("PlayerControlledShip",function(a){return function(b){var c,d,e,f,g;for(g=[],d=0,e=b.length;e>d;d++)c=b[d],f=c.obj,g.push(f.attr({y:f.y+a._speed.y}));return g}}(this)),this.wallBottom.onHit("PlayerControlledShip",function(a){return function(b){var c,d,e,f,g;for(g=[],d=0,e=b.length;e>d;d++)c=b[d],f=c.obj,g.push(f.attr({y:a.wallBottom.y-f.h}));return g}}(this))},scrollWall:function(a){return null!=a.x&&null!=a.y?(this._speed.x=a.x,this._speed.y=a.y):(this._speed.x=a,this._speed.y=0),this},off:function(){return this.unbind("EnterFrame")}})}.call(this),function(){Crafty.c("ShipSpawnable",{init:function(){return this.requires("Listener"),this.bind("Activated",this.spawnShip)},remove:function(){return this.unbind("Activated",this.spawnShip)},spawnPosition:function(a,b){return this.spawnPosition=a,this.armed=null!=b?b:!0,null==this.spawnPosition&&(this.spawnPosition=function(){return{x:x,y:y}}),this},spawnShip:function(a){var b;return null==a&&(a=this.armed),this.has("ControlScheme")&&this.lives>0?(b=this.spawnPosition(),this.ship=Crafty.e("PlayerControlledShip").attr({x:b.x-Crafty.viewport.x,y:b.y-Crafty.viewport.y}),this.has("Color")&&this.ship.color(this.color()),this.has("ControlScheme")&&this.assignControls(this.ship),a&&this.ship.installItem("lasers"),this.listenTo(this.ship,"BulletHit",function(){return this.stats.shotsHit+=1,this.addPoints(10)}),this.listenTo(this.ship,"BulletDestroyedTarget",function(){return this.stats.enemiesKilled+=1,this.addPoints(50)}),this.listenTo(this.ship,"PowerUp",function(){return this.addPoints(20)}),this.listenTo(this.ship,"Shoot",function(){return this.stats.shotsFired+=1}),Crafty.trigger("ShipSpawned",this.ship),this.ship.start(),this.listenTo(this.ship,"Hit",function(){var a;return a=this.ship.hasItem("lasers"),this.ship.destroy(),this.ship=null,this.loseLife(),this.spawnShip(a)}),this):void 0}})}.call(this),function(){Crafty.c("StageEnd",{init:function(){return this.requires("2D, DOM, Text, HUD, Delay")},stageEnd:function(a){return this.lineNr=0,this.attr({w:640,z:1}).css("textAlign","center").text("Stage "+a.data.stage+" Cleared: "+a.data.title).positionHud({x:this.x,y:60,z:-1}).textColor("#FFFFFF").textFont({size:"12px",weight:"bold",family:"Courier new"}).delay(function(b){switch(this.lineNr){case 0:return this.showPlayerHeaders(),this.showAccuracy(a);case 2:return this.showShotsFired(a);case 3:return this.showEnemiesKilled(a);case 4:return this.showLives(a);case 5:return this.showWeaponXP(a);case 6:return this.showTotals(a);case 7:return a.data.stageFinished=!0}},1e3,6)},showPlayerHeaders:function(){var a;return a=[""],Crafty("Player").each(function(){return a.push(this.has("ControlScheme")?this.name:""),a.push("")}),this.addCelledLine(a)},showAccuracy:function(a){var b;return b=["Accuracy"],Crafty("Player").each(function(){var a,c;return this.has("ControlScheme")?(c=this.stats.shotsHit>0&&this.stats.shotsFired>0?Math.round(this.stats.shotsHit/this.stats.shotsFired*1e3)/10:0,b.push(c+"%"),a=Math.round(100*c),b.push(""+a),this.stats.bonus+=a):(b.push(""),b.push(""))}),this.addCelledLine(b)},showShotsFired:function(a){var b;return b=["Shots fired"],Crafty("Player").each(function(){var a,c,d;return this.has("ControlScheme")?(d=this.stats.shotsFired,b.push(""+d),a=this.stats.shotsHit>0&&this.stats.shotsFired>0?this.stats.shotsHit/this.stats.shotsFired:0,c=Math.round(d*(a+a)),b.push(""+c),this.stats.bonus+=c):(b.push(""),b.push(""))}),this.addCelledLine(b)},showEnemiesKilled:function(a){var b;return b=["Enemies Killed"],Crafty("Player").each(function(){var c,d,e;return this.has("ControlScheme")?(this.stats.enemiesKilled>0&&a.data.enemiesSpawned>0?(d=this.stats.enemiesKilled/a.data.enemiesSpawned,e=Math.round(1e3*d)/10):e=0,b.push(e+"%"),c=Math.round(100*e),b.push(""+c),this.stats.bonus+=c):(b.push(""),b.push(""))}),this.addCelledLine(b)},showLives:function(a){var b;return b=["Lives"],Crafty("Player").each(function(){var a,c;return this.has("ControlScheme")?(c=this.lives,b.push(""+c),a=Math.round(1e3*c),b.push(""+a),this.stats.bonus+=a):(b.push(""),b.push(""))}),this.addCelledLine(b)},showWeaponXP:function(a){var b;return b=["WeaponXP"],Crafty("Player").each(function(){var a,c,d,e,f;return this.has("ControlScheme")?(f=null!=(a=null!=(c=this.ship)&&null!=(d=c.primaryWeapon)?d.xp:void 0)?a:0,b.push(""+f),e=Math.round(10*f),b.push(""+e),this.stats.bonus+=e):(b.push(""),b.push(""))}),this.addCelledLine(b)},showTotals:function(a){var b;return b=["Totals"],Crafty("Player").each(function(){return this.has("ControlScheme")?(b.push(""),b.push(this.stats.bonus),this.addPoints(this.stats.bonus),this.stats.bonus=0):(b.push(""),b.push(""))}),this.addCelledLine(b)},addCelledLine:function(a){var b,c,d,e,f,g,h,i,j,k,l,m;for(this.lineNr+=1,m=80+20*this.lineNr,l=70,e=500/(a.length+.5),j=[],g=h=0,i=a.length;i>h;g=++h)d=a[g],f=e,0===g&&(f+=e/2),k=0===g?this.x+l:this.x+l+e*(g+.5),b=Crafty.e("Text, DOM").attr({x:k,y:m,w:f,z:3}).css("textAlign","right").text(d).textColor("#FFFFFF").textFont({size:"12px",weight:"normal",family:"Courier new"}),this.attach(b),c=Crafty.e("Text, DOM").attr({x:k,y:m+2,w:f,z:2}).css("textAlign","right").text(d).textColor("#000000").textFont({size:"12px",weight:"bold",family:"Courier new"}),j.push(this.attach(c));return j}})}.call(this),function(){Crafty.c("StageTitle",{init:function(){return this.requires("2D, DOM, Text, Tween, Delay, HUD")},stageTitle:function(a){return this.attr({w:640,z:1}).css("textAlign","center").text(a).positionHud({x:this.x,y:240,z:-1}).textColor("#FF0000").textFont({size:"30px",weight:"bold",family:"Courier new"}).delay(function(){return this.tween({viewportY:this.viewportY+500,alpha:0},3e3),this.bind("TweenEnd",function(a){return function(){return a.destroy()}}(this))},3e3,0)}})}.call(this),function(){Crafty.c("Sun",{init:function(){var a,b,c,d;return this.requires("2D, Canvas, Color, ViewportRelativeMotion, Tween, Collision"),this.attr({w:60,h:60,z:-1e3}).color("#DDDD00"),this.glare=[],c=Crafty.e("2D, Canvas, Color, Glare").attr({x:-15,y:-15,w:90,h:90,z:90,alpha:.4,originalAlpha:.4}).color("#FFFFFF"),this.attach(c),this.glare.push(c),b=Crafty.e("2D, Canvas, Color, Glare").attr({mirrored:!0,w:80,h:80,z:91,res:.9,alpha:.7,originalAlpha:.7}).color("#B0B0FF"),this.attach(b),this.glare.push(b),d=Crafty.e("2D, Canvas, Color, Glare").attr({mirrored:!0,w:10,h:10,z:92,res:.82,alpha:.8,originalAlpha:.8}).color("#FF9090"),this.attach(d),this.glare.push(d),a=Crafty.e("2D, Canvas, Color, Glare").attr({mirrored:!0,w:200,h:200,z:93,alpha:.2,res:1.1,originalAlpha:.2}).color("#FF9090"),this.attach(a),this.glare.push(a)},sun:function(a){var b,c,d,e;return d=a.x,e=a.y,c=Crafty.viewport.width/2,b=d-c,this.viewportRelativeMotion({x:d,y:e,speed:0}).attr({dx:b}),this.bind("EnterFrame",this._updateGlare),this},remove:function(){return this.unbind("EnterFrame")},_updateGlare:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y;for(a=[0],t=this.area(),q=this.hit("2D"),h=0,j=q.length;j>h;h++)m=q[h],m.obj!==this&&(m.obj.has("Glare")||m.obj.has("HUD")||(d=m.obj,w=Math.max(this.x,d.x),v=Math.min(this.x+this.w,d.x+d.w),u=v-w,y=Math.max(this.y,d.y),x=Math.min(this.y+this.h,d.y+d.h),e=x-y,a.push(u*e)));for(l=1.7*Math.max.apply(Math,a),n=l/t,l>t&&(n=1),g=Crafty.viewport.width/2,f=Crafty.viewport.height/2,b=this.x+this.w/2-(-1*Crafty.viewport._x+g),c=this.y+this.h/2-(-1*Crafty.viewport._y+f),o=b/g,p=c/f,r=this.glare,s=[],i=0,k=r.length;k>i;i++)d=r[i],d.attr({alpha:d.originalAlpha*(1-n)}),s.push(d.mirrored?d.attr({x:this.x+this.w/2-d.w/2-2*b*d.res,y:this.y+this.h/2-d.h/2-2*c*d.res}):void 0);return s}})}.call(this),function(){Crafty.c("ViewportRelativeMotion",{init:function(){},remove:function(){},viewportRelativeMotion:function(a){var b,c,d,e,f,g,h,i;return h=a.x,i=a.y,g=a.speed,this._startLocation={x:h,y:i},this._speed=g,this._initialViewport={x:Crafty.viewport.width/4},this._location={sx:h+(h-this._initialViewport.x)*(this._speed-1),sy:i,dx:null!=(d=this.dx)?d:0,dy:null!=(e=this.dy)?e:0},f=(this._initialViewport.x-Crafty.viewport._x)*(this._speed-1),b=this._location.sx-f+this.dx,c=this._location.sy-Crafty.viewport._y*(1-this._speed)+this.dy,this._location.x=b,this._location.y=c,this.attr(this._location),this.motion=Crafty.bind("ViewportScroll",function(a){return function(){return f=(a._initialViewport.x-Crafty.viewport._x)*(a._speed-1),b=a._location.sx-f+a.dx,c=a._location.sy-Crafty.viewport._y*(1-a._speed)+a.dy,a.attr({x:b,y:c})}}(this)),this},remove:function(){return Crafty.unbind("CameraScroll",this.motion)}})}.call(this),function(){Crafty.c("GamepadControls",{init:function(){return this.requires("Listener"),this.bind("RemoveComponent",function(a){return"ControlScheme"===a?this.removeComponent("GamepadControls"):void 0})},remove:function(){return this.unbind("GamepadKeyChange",this._keyHandling)},setupControls:function(a){return a.addComponent("GamepadControls").controls(this.controlMap).addComponent("ControlScheme")},controls:function(a){return this.controlMap=a,null!=a.gamepadIndex?(this.requires("Gamepad"),this.gamepad(a.gamepadIndex),this.bind("GamepadKeyChange",this._keyHandling),this):void 0},_keyHandling:function(a){return a.button===this.controlMap.fire&&a.pressed?this.trigger("Fire",a):void 0},assignControls:function(a){return a.addComponent("GamepadMultiway, Gamepad").gamepad(this.controlMap.gamepadIndex).gamepadMultiway({speed:{y:4,x:3},gamepadIndex:this.controlMap.gamepadIndex,analog:!0}),this.listenTo(a,"GamepadKeyChange",function(b){return function(c){return c.button===b.controlMap.fire?a.shoot(c.pressed):void 0}}(this))}})}.call(this),function(){Crafty.c("KeyboardControls",{init:function(){return this.requires("Listener"),this.bind("RemoveComponent",function(a){return"ControlScheme"===a?this.removeComponent("KeyboardControls"):void 0})},remove:function(){return this.unbind("KeyDown",this._keyHandling)},setupControls:function(a){return a.addComponent("KeyboardControls").controls(this.controlMap).addComponent("ControlScheme")},controls:function(a){return this.controlMap=a,this.bind("KeyDown",this._keyHandling),this},_keyHandling:function(a){return a.key===this.controlMap.fire?this.trigger("Fire",a):void 0},assignControls:function(a){var b,c,d,e,f,g,h,i,j;b=this.controlMap,h={},d={up:-90,down:90,left:180,right:0};for(c in d){j=d[c],g=b[c],i=Crafty.keys;for(e in i)f=i[e],f===g&&(h[e]=j)}return a.addComponent("Multiway, Keyboard").multiway({y:4,x:3},h),this.listenTo(a,"KeyDown",function(c){return c.key===b.fire?a.shoot(!0):void 0}),this.listenTo(a,"KeyUp",function(c){return c.key===b.fire?a.shoot(!1):void 0})}})}.call(this),function(){Crafty.c("BackgroundDrone",{init:function(){return this.requires("2D, Canvas, Color, Collision, Choreography")},drone:function(){return this.attr({w:15,h:15,z:-1}),this.color("#2020FF"),this}})}.call(this),function(){Crafty.c("Drone",{init:function(){return this.requires("2D, Canvas, Color, Collision, Choreography, Enemy")},drone:function(a){return null==a&&(a={}),Crafty.trigger("EnemySpawned",this),this.attr(_.defaults(a,{w:25,h:25,health:300})),this.origin("center"),this.color("#0000FF"),this.onHit("Bullet",function(a){var b;return b=a[0].obj,b.trigger("HitTarget",{target:this}),this.health-=b.damage,this.health<=0&&(b.trigger("DestroyTarget",{target:this}),Crafty.trigger("EnemyDestroyed",this),this.trigger("Destroyed",this),Crafty.e("Explosion").explode({x:this.x,y:this.y,w:this.w,h:this.h}),this.destroy()),b.destroy()}),this.has("Weaponized")&&this.bind("Shoot",function(a){return function(){return a.shooting=Crafty.e("Delay").delay(function(){return Crafty.e("2D,Canvas,Color,Enemy,Tween").attr({x:a.x-a.w,y:a.y+a.h/2,w:6,h:6}).color("#FFFF00").tween({x:a.x-640},2e3)},1500,5)}}(this)),this},remove:function(){return null!=this.shooting?this.shooting.destroy():void 0}})}.call(this),function(){Crafty.c("HUD",{init:function(){return this.requires("2D")},positionHud:function(a){var b,c,d;return b=a.x,c=a.y,d=a.z,this.attr({viewportX:b,viewportY:c,viewportZ:d,x:b-Crafty.viewport.x,y:c-Crafty.viewport.y,z:d}),this.hudFloat=Crafty.bind("EnterFrame",function(a){return function(){return a.attr({x:a.viewportX-Crafty.viewport.x,y:a.viewportY-Crafty.viewport.y})}}(this)),this},remove:function(){return Crafty.unbind("EnterFrame",this.hudFloat)}})}.call(this),function(){Crafty.c("Listener",{init:function(){return this.listeners=[]},remove:function(){var a,b,c,d,e,f,g,h;for(f=this.listeners,h=[],c=0,d=f.length;d>c;c++)g=f[c],e=g.object,b=g.event,a=g.callback,h.push(e.unbind(b,a));return h},listenTo:function(a,b,c,d){var e;return null==d&&(d=this),e=function(){return c.apply(d,arguments)},this.listeners.push({object:a,event:b,callback:e}),a.bind(b,e)}})}.call(this),function(){Crafty.c("ControlScheme",{init:function(){return this.trigger("Activated"),Crafty.trigger("PlayerActivated")},remove:function(){return this.trigger("Deactivated"),Crafty.trigger("PlayerDeactivated")}})}.call(this),function(){Crafty.c("Player",{lives:2,points:0,stats:{shotsFired:0,shotsHit:0,enemiesKilled:0,bonus:0},init:function(){},loseLife:function(){return this.lives>0?(this.lives-=1,this.trigger("UpdateLives",{lives:this.lives}),this.lives<=0?Crafty.trigger("PlayerDied",this):void 0):void 0},addPoints:function(a){return this.lives>0?(this.points+=a,this.trigger("UpdatePoints",{points:this.points})):void 0}})}.call(this),function(){Crafty.c("Bullet",{init:function(){return this.addComponent("2D, Canvas, Color, Collision")},fire:function(a){return this.attr({damage:a.damage}).bind("EnterFrame",function(b){return function(){return b._nextPosition(a.speed),b.x>b._maxXforViewPort()?b.destroy():void 0}}(this)).onHit("Edge",function(){return this.destroy()}),this},_nextPosition:function(a){return this.x=this.x+a},_maxXforViewPort:function(){var a;return a=-Crafty.viewport._x+Crafty.viewport._width/Crafty.viewport._scale,a+200}})}.call(this),function(){Crafty.c("WeaponLaser",{init:function(){return this.requires("2D,Canvas,Color"),this.color("#808080"),this.attr({w:30,h:5})},remove:function(){},install:function(a){return this.ship=a,this.xp=0,this.level=this.determineLevel(this.xp),this.attr({x:this.ship.x+10,y:this.ship.y+15}),this.ship.attach(this)},addXP:function(a){var b;return this.xp+=a,b=this.level,this.level=this.determineLevel(this.xp),b!==this.level?this.trigger("levelUp",this.level):void 0},determineLevel:function(a){var b,c,d,e,f,g,h,i;for(f=[150,400,1e3,2500],f=[15,40,100,250],g=0,e=0,c=0,d=f.length;d>c;c++)b=f[c],g+=b,a>=g&&(e+=1);return h=(a-(null!=(i=f[e-1])?i:0))/f[e],e},shoot:function(a){var b;if(a)return b=function(){switch(this.level){case 0:return{w:4,speed:7,h:3};case 1:return{w:6,speed:7,h:4};case 2:return{w:8,speed:7,h:5};case 3:return{w:10,speed:7,h:5};case 4:return{w:12,speed:7,h:6}}}.call(this),Crafty.e("Bullet").color("#FFFF00").attr({x:this.x+this.w,y:this.y+this.h/2-b.h/2,w:b.w,h:b.h}).fire({origin:this,damage:100,speed:this.ship._forcedSpeed.x+b.speed,direction:0}).bind("HitTarget",function(a){return function(){return a.addXP(1),a.ship.trigger("BulletHit")}}(this)).bind("DestroyTarget",function(a){return function(){return a.addXP(5),a.ship.trigger("BulletDestroyedTarget")}}(this))}})}.call(this)}(),function(){(function(){Crafty.defineScene("City",function(a){var b,c,d,e,f,g,h,i;return b=window.Game,Crafty.background("#602020"),g=b.levelGenerator.createLevel({stage:a.stage,title:"City"}),g.addBlock("City.Intro",{enter:function(){var a;return a="Stage "+this.level.data.stage+": "+this.level.data.title,Crafty.e("StageTitle").stageTitle(a),this.level.showDialog(["p1,p2:John:Too bad we have to bring these ships to the museum!","p1,!p2:John:Too bad we have to bring this ship to the museum!",":General:Just give her a good last flight,\nwe document some moves on the way!"])}}),g.addBlock("City.Ocean"),g.addBlock("City.Ocean",{enter:function(){return this.level.showDialog([":general:Evade the upcoming drones!"]).on("Finished",function(a){return function(){return a.level.spawnEnemies("FlyOver",function(){return Crafty.e("Drone").drone()})}}(this))}}),g.addBlock("City.Ocean",{generate:function(){},enter:function(){return this.level.showDialog([":General:We dropped an upgrade to show the weapon systems"]).on("Finished",function(a){return function(){return a.level.addComponent(Crafty.e("PowerUp").powerUp({contains:"lasers",marking:"L"}),{x:640,y:300}),Crafty("PlayerControlledShip").length>1?a.level.addComponent(Crafty.e("PowerUp").powerUp({contains:"lasers",marking:"L"}),{x:640,y:100}):void 0}}(this))}}),g.generateBlocks({amount:2,enter:function(){return this.level.spawnEnemies("FlyOver",function(){return Crafty.e("Drone").drone()}).on("LastDestroyed",function(a){return Crafty.e("PowerUp").powerUp({contains:"lasers",marking:"L"}).attr({x:a.x,y:a.y,z:-1})})}}),g.generateBlocks({amount:1,enter:function(){return this.level.spawnEnemies("Splash",function(){return Crafty.e("BackgroundDrone").drone()}).on("LastDestroyed",function(a){return function(b){return a.level.showDialog([":General:Wtf is happening with our drones?"]).on("Finished",function(){return a.level.spawnEnemies("FlyOver",function(){return Crafty.e("Drone,Weaponized").drone()}).on("LastDestroyed",function(a){return Crafty.e("PowerUp").powerUp({contains:"lasers",marking:"L"}).attr({x:a.x,y:a.y,z:-1})})})}}(this))}}),g.generateBlocks({amount:1,enter:function(){return this.level.showDialog([":General:Their AI has been compromised by our rogue prototype!\nEliminate it!","p1:John:How?","p2,!p1:Jack:What the...",":General:It's hiding in the city! go!"])}}),g.generateBlocks({amount:8,enter:function(){return this.level.spawnEnemies(this.index%2===0?"SwirlAttack":"SwirlAttack2",function(){return Crafty.e("Drone").drone()}).on("LastDestroyed",function(a){return Crafty.e("PowerUp").powerUp({contains:"lasers",marking:"L"}).attr({x:a.x,y:a.y,z:-1})})}}),g.generateBlocks({amount:1,enter:function(){return this.level.showDialog([":Game:This is it for now.. More content coming soon!\nStarting test level..."])},inScreen:function(){return this.level.finishStage()}}),g.generateBlocks({until:function(){return this.data.stageFinished}}),g.generateBlocks({amount:5,enter:function(){var a;return Crafty("ScrollWall").each(function(){return this.off()}),a=Crafty.e("2D, Canvas, Color, Collision").attr({w:10,h:this.level.visibleHeight}).onHit("PlayerControlledShip",function(){return Crafty.trigger("EndOfLevel"),this.destroy()}),this.add(0,0,a)}}),g.start({armedPlayers:!1,speed:0,viewport:{x:0,y:120}}),i=0,d={r:96,g:32,b:32},c={r:128,g:128,b:255},h=320,e=1e3,Crafty.e("Delay").delay(function(a){return function(){var a,b,e,f,g;return i+=1,g=1*i/h,a={r:d.r*(1-g)+c.r*g,b:d.b*(1-g)+c.g*g,g:d.g*(1-g)+c.b*g},b=function(){var b;b=[];for(f in a)e=a[f],b.push(e.toString(16).slice(0,2));return b}(),Crafty.background("#"+b.join(""))}}(this),e,h-1),f=h*e*2,Crafty.e("Sun").sun({x:620,y:410}).tween({dy:-340,dx:120},f),Crafty.bind("EndOfLevel",function(){return g.stop(),Crafty.enterScene("GameplayDemo",{stage:a.stage+1})}),Crafty.bind("PlayerDied",function(){var a;return a=!1,Crafty("Player ControlScheme").each(function(){return this.lives>0?a=!0:void 0}),a?void 0:(g.stop(),Crafty.enterScene("GameOver"))})},function(){return Crafty("Delay").each(function(){return this.destroy()}),Crafty.unbind("PlayerDied"),Crafty.unbind("EndOfLevel"),Crafty("Player").each(function(){return this.removeComponent("ShipSpawnable")})})}).call(this),function(){Crafty.defineScene("GameOver",function(){var a;return a=window.Game,Crafty.background("#111"),Crafty.viewport.x=0,Crafty.viewport.y=0,Crafty.e("2D, DOM, Text").attr({x:0,y:110,w:640}).text("Game Over").textColor("#FF0000").css("textAlign","center").textFont({size:"50px",weight:"bold",family:"Courier new"}),Crafty("Player ControlScheme").each(function(a){return Crafty.e("2D, DOM, Text").attr({x:0,y:200+30*a,w:640}).text(this.name+": "+this.points).textColor(this.color()).css("textAlign","center").textFont({size:"30px",weight:"bold",family:"Courier new"})}),Crafty.e("Delay").delay(function(){return Crafty.e("2D, DOM, Text").attr({x:0,y:350,w:640}).text("Press fire to start again").textColor("#FF0000").css("textAlign","center").textFont({size:"20px",weight:"bold",family:"Courier new"}),Crafty("Player").each(function(){return this.removeComponent("ControlScheme").attr({lives:2,points:0}),this.one("Activated",function(){return Crafty.enterScene(a.firstLevel,{stage:1})})}),this.delay(function(){return Crafty.enterScene("Intro")},6e4,0)},2e3,0)},function(){return Crafty("Delay").each(function(){
return this.destroy()}),Crafty("Player").each(function(){return this.unbind("Activated")})})}.call(this),function(){Crafty.defineScene("GameplayDemo",function(a){var b,c;return b=window.Game,Crafty.background("#000"),c=b.levelGenerator.createLevel({stage:a.stage,title:"Gameplay Demo"}),c.addBlock("Generic.Start",c.addBlock("GameplayDemo.PerspectiveTest")),c.addBlock("GameplayDemo.PerspectiveTest",{enter:function(){return this.level.setForcedSpeed(1)},inScreen:function(){return this.level.showDialog(["p1:John:Welcome to the gameplay demo!\nLet's do some target practice!","p1,p2:Jim:Yeah let's shoot stuff!","!p1,p2:Jim:Whoohoo target practice!\nKill kill kill!!!"])}}),c.addBlock("GameplayDemo.Asteroids",{outScreen:function(){var a,b;return this.level.showDialog(["p1,!p2:John:Entering the tunnel!","p2:Jim:Prepare for darkness!!!"]),this.level.data.needToKill=10,a=Crafty.e("2D, DOM, Text, HUD").text("Enemies Left: "+this.level.data.needToKill).textColor("#FF0000").css("textAlign","center").textFont({size:"20px",weight:"bold",family:"Courier new"}).attr({w:640}).positionHud({x:0,y:110,z:2}),b=Crafty.bind("EnemyDestroyed",function(c){return function(){return c.level.data.needToKill-=1,a.text("Enemies Left: "+c.level.data.needToKill),c.level.data.needToKill<=0?(a.destroy(),Crafty.unbind(b),c.level.data.needToKill=0):void 0}}(this))}}),c.addBlock("GameplayDemo.TunnelStart",{only:["cleared"]}),c.generateBlocks({until:function(){return 0===this.data.needToKill}}),c.generateBlocks({stopBefore:"GameplayDemo.Tunnel"}),c.addBlock("GameplayDemo.Lasers",{enter:function(){return this.level.setForcedSpeed(0),this.level.showDialog(["p1:John:Slow down! Lasers!!","!p1,p2:Jim:Uh oh! Danger!"])}}),c.generateBlocks({amount:1,leave:function(){return this.level.showDialog(["p1:John:Let's get out of here!"]),this.level.setForcedSpeed(4)}}),c.addBlock("GameplayDemo.TunnelTwist"),c.generateBlocks({amount:2,only:["cleared"]}),c.generateBlocks({stopBefore:"GameplayDemo.TunnelEnd"}),c.addBlock("GameplayDemo.TunnelEnd",{only:["cleared"],enter:function(){return this.level.setForcedSpeed(2)}}),c.addBlock("GameplayDemo.Ocean"),c.addBlock("GameplayDemo.OceanRiser"),c.addBlock("GameplayDemo.OceanHigh"),c.addBlock("GameplayDemo.OceanHigh"),c.addBlock("GameplayDemo.OceanLower"),c.addBlock("GameplayDemo.Ocean"),c.addBlock("GameplayDemo.End"),c.start(),Crafty.bind("EndOfLevel",function(){return c.stop(),Crafty.enterScene("GameplayDemo",{stage:a.stage+1})}),Crafty.bind("PlayerDied",function(){var a;return a=!1,Crafty("Player ControlScheme").each(function(){return this.lives>0?a=!0:void 0}),a?void 0:(c.stop(),Crafty.enterScene("GameOver"))})},function(){return Crafty.unbind("PlayerDied"),Crafty.unbind("EndOfLevel"),Crafty("Player").each(function(){return this.removeComponent("ShipSpawnable")})})}.call(this),function(){Crafty.defineScene("Intro",function(){var a;return a=window.Game,Crafty.background("#000000"),Crafty.viewport.x=0,Crafty.viewport.y=0,Crafty.e("2D, Canvas, Text, Tween, Delay").attr({x:150,y:210,w:450}).text("Speedlazer").textColor("#0000ff").textFont({size:"40px",weight:"bold",family:"Courier new"}).delay(function(){return this.tween({x:250},2e3),this.one("TweenEnd",function(){return this.tween({x:150},2e3)})},2e3,-1),Crafty.e("2D, Canvas, Text, Tween, Delay").attr({x:200,y:290,w:750}).text("Press fire to start!").textColor("#FF0000").textFont({size:"20px",weight:"bold",family:"Courier new"}).delay(function(){return this.tween({alpha:0},1e3),this.one("TweenEnd",function(){return this.tween({alpha:1},1e3)})},2e3,-1),Crafty("Player").each(function(){return this.removeComponent("ControlScheme").attr({lives:2,points:0}),this.one("Activated",function(){return Crafty.enterScene(a.firstLevel,{stage:1})})})},function(){return Crafty("Player").each(function(){return this.unbind("Activated")})})}.call(this)}(),function(){"use strict";var a={start:function(a){this.firstLevel=a?"GameplayDemo":"City",Crafty.load([],function(){Crafty.init(640,480),Crafty.pixelart(!0),Crafty.background("#000000"),Crafty.e("Player, Color").attr({name:"Player 1"}).setName("Player 1").color("#FF0000"),Crafty.e("Player, Color").attr({name:"Player 2"}).setName("Player 2").color("#00FF00"),Crafty.e("KeyboardControls, PlayerAssignable").controls({fire:Crafty.keys.SPACE,up:Crafty.keys.UP_ARROW,down:Crafty.keys.DOWN_ARROW,left:Crafty.keys.LEFT_ARROW,right:Crafty.keys.RIGHT_ARROW}),Crafty.e("KeyboardControls, PlayerAssignable").controls({fire:Crafty.keys.G,up:Crafty.keys.W,down:Crafty.keys.S,left:Crafty.keys.A,right:Crafty.keys.D}),Crafty.e("GamepadControls, PlayerAssignable").controls({gamepadIndex:0,fire:0}),Crafty.e("GamepadControls, PlayerAssignable").controls({gamepadIndex:1,fire:0}),Crafty.enterScene("Intro")})}};window.Game=a}(),function(){(function(){var a;a=this.Game,a.BezierPath=function(){function a(){}return a.prototype.scalePoints=function(a,b){var c,d,e,f,g,h,i,j;for(g=b.origin,j=b.scale,f={x:a[0].x*j.x-g.x,y:a[0].y*j.y-g.y},i=[],c=d=0,e=a.length;e>d;c=++d)h=a[c],i.push({x:h.x*j.x-f.x,y:h.y*j.y-f.y});return i},a.prototype.buildPathFrom=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;for(o={distance:0,curves:[]},m=this.getCurveControlPoints(a),j=m[0],p=m[1],k=l=0,n=a.length-1;n>=0?n>l:l>n;k=n>=0?++l:--l)b=a[k],c=a[k+1],d=j[k],e=p[k],h=Math.abs(b.x-c.x),i=Math.abs(b.y-c.y),f=Math.sqrt(Math.pow(h,2)+Math.pow(i,2)),g=[c,e,d,b],o.distance+=f,o.curves.push({distance:f,points:g});return o},a.prototype.pointOnPath=function(a,b){var c,d,e,f,g;return f=this.getCurveAndLocation(a,b),d=f[0],g=f[1],c=f[2],e=jsBezier.pointOnCurve(d.points,g),e.c=c,e},a.prototype.angleOnPath=function(a,b){var c,d,e,f;return e=this.getCurveAndLocation(a,b),c=e[0],f=e[1],d=jsBezier.gradientAtPoint(c.points,f),45*d},a.prototype.getCurveAndLocation=function(a,b){var c,d,e,f,g,h,i;for(e=0,c=0,d=a.curves[c],h=(e+d.distance)/a.distance;b>h;)c+=1,e+=d.distance,d=a.curves[c],h=(e+d.distance)/a.distance;return f=d.distance/a.distance,g=e/a.distance,i=(b-g)/f,[d,i,c]},a.prototype.getCurveControlPoints=function(a){var b,c,d,e,f,g,h,i,j;if(e=a.length-1,1>e)return[];if(1===e)return b=[{x:(2*a[0].x+a[1].x)/3,y:(2*a[0].y+a[1].y)/3}],h=[{x:2*b[0].x-a[0].x,y:2*b[0].y-a[0].y}],[b,h];for(g=function(){var b,d,f;for(f=[],c=b=1,d=e-1;d>=1?d>b:b>d;c=d>=1?++b:--b)f.push(4*a[c].x+2*a[c+1].x);return f}(),g.unshift(a[0].x+2*a[1].x),g.push((8*a[e-1].x+a[e].x)/2),i=this.getFirstControlPoints(g),g=function(){var b,d,f;for(f=[],c=b=1,d=e-1;d>=1?d>b:b>d;c=d>=1?++b:--b)f.push(4*a[c].y+2*a[c+1].y);return f}(),g.unshift(a[0].y+2*a[1].y),g.push((8*a[e-1].y+a[e].y)/2),j=this.getFirstControlPoints(g),b=[],h=[],c=d=0,f=e;f>=0?f>d:d>f;c=f>=0?++d:--d)b.push({x:i[c],y:j[c]}),h.push(e-1>c?{x:2*a[c+1].x-i[c+1],y:2*a[c+1].y-j[c+1]}:{x:(a[e].x+i[e-1])/2,y:(a[e].y+j[e-1])/2});return[b,h]},a.prototype.getFirstControlPoints=function(a){var b,c,d,e,f,g,h,i,j;for(f=a.length,j=[],i=[null],b=2,j.push(a[0]/b),c=d=1,g=f;g>=1?g>d:d>g;c=g>=1?++d:--d)i.push(1/b),b=f-1>c?4:3.5,b-=i[c],j.push((a[c]-j[c-1])/b);for(c=e=1,h=f;h>=1?h>e:e>h;c=h>=1?++e:--e)j[f-c-1]-=i[f-c]*j[f-c];return j},a}()}).call(this),function(){var a,b=[].slice,c=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},d={}.hasOwnProperty,e=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};a=this.Game,a.EventHandler=function(){function a(){this.eventHandling={}}return a.prototype.on=function(a,b){var c,d;return d=null!=(c=this.eventHandling)[a]?c[a]:c[a]=[],d.push(b),this},a.prototype.handle=function(){var a,c,d,e,f,g,h,i;for(d=arguments[0],a=2<=arguments.length?b.call(arguments,1):[],h=null!=(g=this.eventHandling[d])?g:[],i=[],e=0,f=h.length;f>e;e++)c=h[e],i.push(c.apply(null,a));return i},a}(),a.Dialog=function(a){function d(a,b){this.dialog=a,this.level=b,d.__super__.constructor.apply(this,arguments),this.showDialog()}return c(d,a),d.prototype.showDialog=function(a){var c,d,e,f,g,h,i,j,k,l,m,n;if(null==a&&(a=0),Crafty("Dialog").each(function(){return this.destroy()}),f=this.determineDialog(a),null==f)return void this.handle("Finished");for(e=this.dialog[f],l=e.split(":"),d=l[0],m=l[1],k=3<=l.length?b.call(l,2):[],k=k.join(":").split("\n"),n=60,c=Crafty.e("2D, Canvas, Color, Tween, HUD, Dialog").attr({w:570,h:20*(k.length+2),alpha:.5}).color("#000000").positionHud({x:n-10,y:this.level.visibleHeight-20*(k.length+1),z:100}),m=Crafty.e("2D, Canvas, Text").attr({w:550,x:c.x+10,y:c.y+10,z:101,alpha:1}).text(m).textColor("#707070").textFont({size:"16px",weight:"bold",family:"Bank Gothic"}),c.attach(m),g=h=0,i=k.length;i>h;g=++h)j=k[g],c.attach(Crafty.e("2D, Canvas, Text").attr({w:550,x:c.x+10,y:c.y+30+20*g,z:101}).text(j).textColor("#909090").textFont({size:"16px",weight:"bold",family:"Bank Gothic"}));return Crafty.e("Dialog, Delay").delay(function(b){return function(){return b.showDialog(a+1)}}(this),2500*k.length,0)},d.prototype.determineDialog=function(a){var b,c,d,f,g,h,i,j,k,l,m,n,o,p,q,r;for(null==a&&(a=0),g=[],Crafty("Player ControlScheme").each(function(){return this.lives>0?g.push(this.name):void 0}),n=this.dialog,h=j=0,l=n.length;l>j;h=++j)if(f=n[h],h>=a){for(b=!0,o=f.split(":"),d=o[0],p=d.split(","),k=0,m=p.length;m>k;k++)c=p[k],""!==c&&(q=this.convertCondition(c),i=q[0],r=q[1],i?e.call(g,r)>=0&&(b=!1):e.call(g,r)<0&&(b=!1));if(b)return h}return null},d.prototype.convertCondition=function(a){var b,c,d,e;return b="!"===a.slice(0,1),c=a.slice(b?1:0),(d=/p(\d)/.exec(c))&&(e="Player "+d[1]),[b,e]},d}(a.EventHandler)}.call(this),function(){}.call(this),function(){var a;a=this.Game,a.Level=function(){function b(a,b){this.generator=a,this.data=null!=b?b:{},this.blocks=[],this.levelDefinition=[],this.buildedBlocks=[],this.bufferLength=2560,this.generationPosition={x:0,y:40},this.visibleHeight=480-this.generationPosition.y}return b.prototype.addBlock=function(a,b){return null==b&&(b={}),this.levelDefinition.push({type:"block",blockType:a,settings:b})},b.prototype.generateBlocks=function(a){return null==a&&(a={}),this.levelDefinition.push({type:"generation",settings:a})},b.prototype.start=function(a){var b,c,d,e,f,g,h;null==a&&(a={}),c={armedPlayers:!0,speed:1,controlsEnabled:!0,spawnPosition:{x:100,y:200},spawnOffset:{x:-50,y:0},viewport:{x:0,y:0}};for(e in c)h=c[e],null==a[e]&&(a[e]=h);for(Crafty.viewport.x=0,Crafty.viewport.y=0,this._controlsEnabled=a.controlsEnabled,this.setForcedSpeed(a.speed),this._scrollWall=Crafty.e("ScrollWall").attr({x:a.viewport.x,y:a.viewport.y}),this._playersActive=!1,Crafty.bind("EnemySpawned",function(a){return function(){var b;return null==(b=a.data).enemiesSpawned&&(b.enemiesSpawned=0),a.data.enemiesSpawned+=1}}(this)),this._placePlayerShips(a),this._update(0),g=this.blocks,d=0,f=g.length;f>d;d++)b=g[d],b.x<640&&b.enter();return Crafty.bind("LeaveBlock",function(a){return function(b){return a._update(b),b>0&&(a.blocks[b-1].leave(),a.currentBlockIndex=b,a.blocks[b].inScreen()),a._cleanupBuildBlocks()}}(this)),Crafty.bind("EnterBlock",function(a){return function(b){return b>0&&a.blocks[b-1].outScreen(),a.newBlockIndex=b,a.blocks[b].enter()}}(this)),Crafty.bind("PlayerEnterBlock",function(a){return function(b){var c,d;return b>0&&null!=(c=a.blocks[b-1])&&c.playerLeave(),null!=(d=a.blocks[b])?d.playerEnter():void 0}}(this))},b.prototype._placePlayerShips=function(a){return Crafty.one("ShipSpawned",function(a){return function(){return a._playersActive=!0,a._scrollWall.scrollWall(a._forcedSpeed)}}(this)),Crafty("Player").each(function(b){var c;return c=function(){var b;return b=_.clone(a.spawnPosition),Crafty("PlayerControlledShip").each(function(){return b.x=this.x+a.spawnOffset.x+Crafty.viewport.x,b.y=this.y+a.spawnOffset.y+Crafty.viewport.y}),b},this.addComponent("ShipSpawnable").spawnPosition(c,a.armedPlayers),Crafty.e("PlayerInfo").playerInfo(30+180*b,this)}),Crafty.bind("ShipSpawned",function(a){return function(b){return b.forcedSpeed(a._forcedSpeed),a._controlsEnabled?void 0:b.disableControl()}}(this)),Crafty("Player ControlScheme").each(function(){return this.spawnShip()})},b.prototype.setForcedSpeed=function(a){return this._forcedSpeed=a,this._playersActive&&this._scrollWall.scrollWall(this._forcedSpeed),Crafty("PlayerControlledShip").each(function(){return this.forcedSpeed(a)})},b.prototype.showDialog=function(b,c){return new a.Dialog(b,this,c)},b.prototype.spawnEnemies=function(b,c,d){var e,f;if(e=a.EnemyFormation[b],f=_.keys(a.EnemyFormation),null==e)throw new Error("Not a valid formation: "+b+". Use one of: "+f.join(","));return new e(this,c,d)},b.prototype.getComponentOffset=function(){var a,b;return a=this.blocks[null!=(b=this.currentBlockIndex)?b:0],null!=a?{x:this._scrollWall.x-a.x,y:this._scrollWall.y-a.y}:void 0},b.prototype.addComponent=function(a,b,c){var d,e,f;return null==c&&(c=null),d=this.blocks[null!=(f=this.currentBlockIndex)?f:0],null!=d?(null==c&&(c=this.getComponentOffset()),e={x:b.x+c.x,y:b.y+c.y},d.add(e.x,e.y,a)):void 0},b.prototype.finishStage=function(){return Crafty.e("StageEnd").stageEnd(this)},b.prototype.stop=function(){var a,b,c,d,e;for(Crafty.unbind("LeaveBlock"),Crafty.unbind("EnterBlock"),Crafty.unbind("ShipSpawned"),Crafty.unbind("ViewportScroll"),d=this.blocks,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.clean());return e},b.prototype._update=function(a){var b,c,d,e,f,g,h;for(null==this.generationDefinition&&(this.generationDefinition=0),h=(null!=(f=this.blocks[a])?f.x:void 0)||0,d=h+this.bufferLength,b=0,e=10,g=[];this.generationPosition.x<d&&this.generationDefinition<this.levelDefinition.length&&e>b;)c=this.levelDefinition[this.generationDefinition],this._generateLevel(c),g.push(b+=1);return g},b.prototype._generateLevel=function(a){return"block"===a.type?this._generatePredefinedBlock(a):"generation"===a.type?this._generateBlocks(a):console.log("no support yet for",a.type)},b.prototype._generatePredefinedBlock=function(a){return this._addBlockToLevel(a.blockType,a.settings),this.generationDefinition+=1},b.prototype._addBlockToLevel=function(a,b){var c,d;if(d=this.generator.buildingBlocks[a],null==d)throw new Error(a+" not found");return c=new d(this,b),this.blocks.push(c),c.build(this.generationPosition,this.blocks.length-1),this.generationPosition={x:c.x+c.delta.x,y:c.y+c.delta.y}},b.prototype._generateBlocks=function(a){var b,c,d,e,f,g,h;if(0!==this.blocks.length)return d=this.blocks[this.blocks.length-1],c=d.name,h=a.settings,b=null!=(e=h.amount)?e:30,null!=h.stopBefore&&h.stopBefore===c?void(this.generationDefinition+=1):b<=(null!=(f=a.amountGenerated)?f:0)?void(this.generationDefinition+=1):(null!=(g=h.until)?g.apply(this):void 0)?void(this.generationDefinition+=1):(c=this._determineNextTileType(c,h),null!=h.stopBefore&&h.stopBefore===c?void(this.generationDefinition+=1):(this._addBlockToLevel(c,h),null==a.amountGenerated&&(a.amountGenerated=0),a.amountGenerated+=1))},b.prototype._cleanupBuildBlocks=function(){var a,b,c,d,e;for(c=[],e=this.buildedBlocks,b=0,d=e.length;d>b;b++)a=e[b],a.canCleanup()?a.clean():c.push(a);return this.buildedBlocks=c},b.prototype._determineNextTileType=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n;if(e=this.generator.buildingBlocks[a],g=e.prototype.next,0===g.length)throw"TODO: Look back in blocks to get point for generation";if(null!=b.stopBefore&&-1!==g.indexOf(b.stopBefore))return b.stopBefore;if(k=2,d=this.blocks.length,d>=k){for(n=0,m=this.blocks,h=m.length-1;h>=0;h+=-1)if(c=m[h],c.blockType===a)n++;else if(c.delta.x>0)break;if(n>=k){for(l=[],i=0,j=g.length;j>i;i++)f=g[i],f!==a&&l.push(f);g=l}}return g[Math.floor(Math.random()*g.length)]},b}()}.call(this),function(){var a,b=[].slice;a=this.Game,a.LevelBlock=function(){function a(a,b){this.level=a,this.settings=b,this.createdElements=[],this.createdBindings=[]}return a.prototype.screenHeight=480,a.prototype.build=function(a,b){return this.generated?void 0:(null==this.x&&(this.x=a.x),null==this.y&&(this.y=a.y),this.index=b,this.generated=!0,this.generate(),this._notifyEnterFunction(b))},a.prototype._notifyEnterFunction=function(a){return Crafty.e("2D, Canvas, Color, Collision").attr({x:this.x,y:this.y,w:10,h:800}).onHit("ScrollFront",function(){return this.triggeredFront?void 0:(Crafty.trigger("EnterBlock",a),this.triggeredFront=!0)}).onHit("PlayerControlledShip",function(){return this.triggeredPlayerFront?void 0:(Crafty.trigger("PlayerEnterBlock",a),this.triggeredPlayerFront=!0)}).onHit("ScrollWall",function(){return this.destroy(),Crafty.trigger("LeaveBlock",a)})},a.prototype.generate=function(){var a;return null!=(a=this.settings.generate)?a.apply(this):void 0},a.prototype.enter=function(){var a;return null!=(a=this.settings.enter)?a.apply(this):void 0},a.prototype.playerEnter=function(){var a;return null!=(a=this.settings.playerEnter)?a.apply(this):void 0},a.prototype.playerLeave=function(){var a;return null!=(a=this.settings.playerLeave)?a.apply(this):void 0},a.prototype.inScreen=function(){var a;return null!=(a=this.settings.inScreen)?a.apply(this):void 0},a.prototype.outScreen=function(){var a;return null!=(a=this.settings.outScreen)?a.apply(this):void 0},a.prototype.leave=function(){var a;return null!=(a=this.settings.leave)?a.apply(this):void 0},a.prototype.clean=function(){var a,b,c,d,e,f,g,h;for(g=this.createdElements,c=0,e=g.length;e>c;c++)b=g[c],b.destroy();for(this.createdElements=[],h=this.createdBindings,d=0,f=h.length;f>d;d++)a=h[d],Crafty.unbind(a.event,a.callback);return this.createdBindings=[]},a.prototype.add=function(a,b,c){return c.attr({x:this.x+a,y:this.y+b}),this.createdElements.push(c)},a.prototype.addBackground=function(a,b,c,d){return c.addComponent("ViewportRelativeMotion").viewportRelativeMotion({x:this.x+a,y:this.y+b,speed:d}),this.createdElements.push(c)},a.prototype.bind=function(a,b){return this.createdBindings.push({event:a,callback:b}),Crafty.bind(a,b)},a.prototype.unbind=function(a){var c,d,e,f,g;for(g=[],f=this.createdBindings,d=0,e=f.length;e>d;d++)c=f[d],c.event===a&&(g.push(c),Crafty.unbind(c.event,c.callback));return this.createdBindings=_.without.apply(_,[this.createdBindings].concat(b.call(g)))},a.prototype.canCleanup=function(){var a,b,c,d,e;if(a=-1*Crafty.viewport._x,this.x>a)return!1;for(e=this.createdElements,c=0,d=e.length;d>c;c++)if(b=e[c],b.x+b.w>a)return!1;return!0},a}()}.call(this),function(){var a;a=this.Game,a.LevelGenerator=function(){function b(){this.buildingBlocks={}}return b.prototype.defineBlock=function(a){return this.buildingBlocks[a.prototype.name]=a},b.prototype.createLevel=function(b){return new a.Level(this,b)},b}(),a.levelGenerator=new a.LevelGenerator}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,null==a.EnemyFormation&&(a.EnemyFormation={}),a.EnemyFormation.FlyOver=function(a){function c(a,b,d){this.level=a,this.enemyConstructor=b,this.callback=d,c.__super__.constructor.apply(this,arguments),this.enemiesToSpawn=4,this.enemiesSpawned=0,this.enemiesDestroyed=0,this.startRandom=50+Math.round(200*Math.random()),Crafty.e("Delay").delay(function(a){return function(){var b,c,d,e,f;return d=a.enemyConstructor(a.enemiesSpawned),b=[{length:1,x:600,y:a.startRandom,duration:400,type:"viewport"}],e=500,c=[e+1500,e+1e3+900,e+500+300,e+600],a.enemiesSpawned%2===0?(f=50+100*Math.floor(a.enemiesSpawned/2)+Math.round(50*Math.random()),b.push({length:1,x:600,y:f,duration:c[a.enemiesSpawned],type:"viewport"}),b.push({length:1,x:20,y:f,maxSpeed:2,duration:4e3,type:"viewport",event:"Shoot"})):(f=350-100*Math.floor(a.enemiesSpawned/2)+Math.round(50*Math.random()),b.push({length:1,x:600,y:f,duration:c[a.enemiesSpawned],type:"viewport"}),b.push({length:1,x:20,y:f,maxSpeed:2,duration:4e3,type:"viewport",event:"Shoot"})),b.push({type:"linear",duration:100,x:-100}),b.push({type:"delay",duration:1,event:"Survived"}),d.bind("Survived",function(){return a.handle("Survived",d)}),d.bind("Destroyed",function(){return a.enemiesDestroyed+=1,a.handle("Destroyed",d),a.enemiesDestroyed===a.enemiesToSpawn?a.handle("LastDestroyed",d):void 0}),a.level.addComponent(d,{x:750,y:a.startRandom}),a.enemiesSpawned+=1,d.choreography(b,0)}}(this),500,3)}return b(c,a),c}(a.EventHandler)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,null==a.EnemyFormation&&(a.EnemyFormation={}),a.EnemyFormation.Splash=function(a){function c(a,b,d){this.level=a,this.enemyConstructor=b,this.callback=d,c.__super__.constructor.apply(this,arguments),this.enemiesSpawned=0,this.enemiesDestroyed=0,Crafty.e("Delay").delay(function(a){return function(){var b,c;return c=a.enemyConstructor(a.enemiesSpawned),b=[{length:1,x:660,y:300,duration:50,type:"viewport"},{start:.5,repeat:1,x:-50,y:50,duration:2500,type:"sine"},{x:-10,y:120,duration:1500,type:"linear"},{type:"delay",duration:500,event:"splash"}],c.bind("Destroyed",function(){return a.enemiesDestroyed+=1,a.handle("Destroyed",c),a.enemiesDestroyed===a.enemiesSpawned?a.handle("LastDestroyed",c):void 0}),a.level.addComponent(c,{x:750,y:150}),a.enemiesSpawned+=1,c.choreography(b,0),c.one("splash",function(){var a;return this.attr({alpha:0}),this.trigger("Destroyed",this),a=Crafty.e("2D, Tween, Canvas, Color").color("#E0E0E0").attr({z:-1,w:20,h:1,alpha:1,x:this.x,y:this.y+this.h}),a.tween({alpha:0,w:40,x:a.x-5,h:30,y:a.y-30},750).one("TweenEnd",function(){return this.destroy()})})}}(this),500,3)}return b(c,a),c}(a.EventHandler)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,null==a.EnemyFormation&&(a.EnemyFormation={}),a.EnemyFormation.SwirlAttack=function(a){function c(a,b,d){this.level=a,this.enemyConstructor=b,this.callback=d,c.__super__.constructor.apply(this,arguments),this.enemiesToSpawn=4,this.enemiesSpawned=0,this.enemiesDestroyed=0,this.offset=this.level.getComponentOffset(),Crafty.e("Delay").delay(function(a){return function(){var b,c;return b=[{type:"bezier",rotation:!1,path:[{x:.946875,y:.05},{x:.775,y:.5583333333333333},{x:.39375,y:.7625},{x:.071875,y:.4041666666666667},{x:.365625,y:.08333333333333333},{x:.628125,y:.38333333333333336},{x:.2375,y:.8583333333333333},{x:-.0125,y:.9425}],duration:1e4}],c=a.enemyConstructor(a.enemiesSpawned),c.bind("Survived",function(){return a.handle("Survived",c)}),c.bind("Destroyed",function(){return a.enemiesDestroyed+=1,a.handle("Destroyed",c),a.enemiesDestroyed===a.enemiesToSpawn?a.handle("LastDestroyed",c):void 0}),a.level.addComponent(c,{x:750,y:-20},a.offset),a.enemiesSpawned+=1,c.choreography(b,0)}}(this),500,this.enemiesToSpawn-1)}return b(c,a),c}(a.EventHandler)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,null==a.EnemyFormation&&(a.EnemyFormation={}),a.EnemyFormation.SwirlAttack2=function(a){function c(a,b,d){this.level=a,this.enemyConstructor=b,this.callback=d,c.__super__.constructor.apply(this,arguments),this.enemiesToSpawn=4,this.enemiesSpawned=0,this.enemiesDestroyed=0,this.offset=this.level.getComponentOffset(),Crafty.e("Delay").delay(function(a){return function(){var b,c;return b=[{type:"bezier",rotation:!0,path:[{x:.96875,y:.7291666666666666},{x:.46875,y:.6916666666666667},{x:.15,y:.3625},{x:.315625,y:.08333333333333333},{x:.678125,y:.225},{x:.240625,y:.725},{x:.021875,y:.6083333333333333}],duration:1e4}],c=a.enemyConstructor(a.enemiesSpawned),c.bind("Survived",function(){return a.handle("Survived",c)}),c.bind("Destroyed",function(){return a.enemiesDestroyed+=1,a.handle("Destroyed",c),a.enemiesDestroyed===a.enemiesToSpawn?a.handle("LastDestroyed",c):void 0}),a.level.addComponent(c,{x:750,y:400},a.offset),a.enemiesSpawned+=1,c.choreography(b,0)}}(this),500,this.enemiesToSpawn-1)}return b(c,a),c}(a.EventHandler)}.call(this)}(),function(){(function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game.levelGenerator,a.defineBlock(function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.name="City.Intro",c.prototype.delta={x:800,y:0},c.prototype.next=["City.Ocean"],c.prototype.generate=function(){var a,b,d;return c.__super__.generate.apply(this,arguments),d=700,a=25,this.add(0,this.level.visibleHeight-a,Crafty.e("2D, Canvas, Edge, Color").attr({w:this.delta.x,h:a+80}).color("#000080")),this.add(0,this.level.visibleHeight-200,Crafty.e("2D, Canvas, Color").color("#202020").attr({z:-1,w:d,h:300})),this.add(50,this.level.visibleHeight-350,Crafty.e("2D, Canvas, Color").color("#202020").attr({z:-1,w:350,h:150})),this.add(0,this.level.visibleHeight-a,Crafty.e("2D, Canvas, Color").color("#202020").attr({z:3,w:d,h:70,alpha:.3})),this.elevator=Crafty.e("2D, Canvas, Color, Tween").color("#707070").attr({z:0,w:100,h:5}),this.add(140,this.level.visibleHeight-a-25,this.elevator),this.outside=Crafty.e("2D, Canvas, Color, Tween").color("#303030").attr({z:0,w:d+10,h:195-a,alpha:0}),this.add(0,this.level.visibleHeight-this.outside.h-a,this.outside),this.barrel=Crafty.e("2D, Tween, Canvas, Color, Collision, Choreography").color("#606000").attr({z:3,w:10,h:15}),this.add(500,this.level.visibleHeight-this.outside.h-a-this.barrel.h,this.barrel),this.splash=Crafty.e("2D, Tween, Canvas, Color").color("#E0E0E0").attr({z:3,w:10,h:1,alpha:0}),this.add(485,this.level.visibleHeight-a+10,this.splash),this.barrelKnock=!1,b=[{type:"linear",y:190,duration:1500},{type:"delay",event:"splash",duration:1}],this.barrel.onHit("PlayerControlledShip",function(a){return function(){return a.barrelKnock?void 0:(a.barrelKnock=!0,a.barrel.choreography(b).tween({rotation:90},1500).one("splash",function(){return a.barrel.attr({alpha:0}),a.splash.attr({alpha:1}).tween({alpha:0,w:30,x:a.splash.x-10,h:30,y:a.splash.y-30},750)}))}}(this)),this.addBackground(-600,this.level.visibleHeight-65,Crafty.e("2D, Canvas, Color").color("#3030B0").attr({z:-3,w:.5*(this.delta.x+600)+1,h:65}),.5),this.addBackground(-300,this.level.visibleHeight-85,Crafty.e("2D, Canvas, Color").color("#6060E0").attr({z:-4,w:.25*(this.delta.x+300)+1,h:85}),.25),this.addBackground(0,this.level.visibleHeight+40,Crafty.e("2D, Canvas, Color").color("#000040").attr({z:3,w:this.delta.x+300+1,h:185}),1.25),this.addBackground(200,45,Crafty.e("2D, Canvas, Color").color("#FFFFFF").attr({z:-2,w:100,h:25}),.5),this.addBackground(200,55,Crafty.e("2D, Canvas, Color").color("#DDDDDD").attr({z:-3,w:75,h:25}),.45)},c.prototype.enter=function(){var a,b,d,e;return c.__super__.enter.apply(this,arguments),b=[{type:"linear",x:-160,duration:2500},{type:"linear",y:-150,duration:2500,event:"lift"},{type:"linear",x:70,y:-10,duration:1500,event:"shipExterior"},{type:"delay",duration:500,event:"unlock"},{type:"delay",duration:1,event:"go"}],a=this,e=null,d=function(a){return e&&e.has("Choreography")?(a.attr({x:e.x-50,y:e.y}),e.disableControls&&a.disableControl(),a.addComponent("Choreography"),a.synchChoreography(e),a.one("ChoreographyEnd",function(){return this.removeComponent("Choreography",!1)}),a.one("unlock",function(){return this.enableControl()})):void 0},this.bind("ShipSpawned",d),Crafty("PlayerControlledShip").each(function(c){return 0===c?(e=this,this.addComponent("Choreography"),this.attr({x:360-50*c,y:400}),this.disableControl(),this.choreography(b),this.one("ChoreographyEnd",function(b){return function(){return b.removeComponent("Choreography","no"),a.unbind("ShipSpawned")}}(this)),this.one("unlock",function(){return this.enableControl()}),this.one("lift",function(){return a.elevator.tween({y:a.elevator.y-150},2500),Crafty("ScrollWall").each(function(){return this.addComponent("Tween"),this.tween({y:0},5e3),this.one("TweenEnd",function(){return this.removeComponent("Tween",!1)})})}),this.one("shipExterior",function(){return a.outside.tween({alpha:1},1500).addComponent("Edge")}),this.one("go",function(){return a.level.setForcedSpeed(1)})):void 0})},c}(this.Game.LevelBlock)),a.defineBlock(function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.name="City.Ocean",c.prototype.delta={x:400,y:0},c.prototype.next=["City.Ocean"],c.prototype.generate=function(){var a,b;return c.__super__.generate.apply(this,arguments),a=25,this.add(0,this.level.visibleHeight-a,Crafty.e("2D, Canvas, Edge, Color").attr({w:this.delta.x,h:a}).color("#000080")),this.addBackground(0,this.level.visibleHeight-65,Crafty.e("2D, Canvas, Color").color("#3030B0").attr({z:-3,w:.5*this.delta.x+1,h:65}),.5),this.addBackground(0,this.level.visibleHeight-85,Crafty.e("2D, Canvas, Color").color("#6060E0").attr({z:-4,w:.25*this.delta.x+1,h:85}),.25),b=20*Math.random()+40,this.addBackground(200,b,Crafty.e("2D, Canvas, Color").color("#FFFFFF").attr({z:-2,w:100,h:25}),.5),this.addBackground(200,b+10,Crafty.e("2D, Canvas, Color").color("#DDDDDD").attr({z:-3,w:75,h:25}),.45)},c}(this.Game.LevelBlock))}).call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game.levelGenerator,a.defineBlock(function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.name="GameplayDemo.End",c.prototype.delta={x:800,y:0},c.prototype.next=[],c.prototype.generate=function(){var a;return a=2,this.add(0,0,Crafty.e("2D, Canvas, Edge, Color").attr({w:this.delta.x,h:a})),this.add(0,this.level.visibleHeight-a,Crafty.e("2D, Canvas, Edge, Color").attr({w:this.delta.x,h:a}))},c.prototype.inScreen=function(){var a;return Crafty("ScrollWall").each(function(){return this.off()}),a=Crafty.e("2D, Canvas, Color, Collision").attr({w:10,h:this.level.visibleHeight}).onHit("PlayerControlledShip",function(){return Crafty.trigger("EndOfLevel"),this.destroy()}),this.add(640,0,a)},c}(this.Game.LevelBlock)),a.defineBlock(function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.name="GameplayDemo.Asteroids",c.prototype.delta={x:1e3,y:0},c.prototype.next=["GameplayDemo.Asteroids","GameplayDemo.TunnelStart"],c.prototype.supports=["speed","cleared"],c.prototype.generate=function(){return this.add(400,75,Crafty.e("2D, Canvas, Edge, Color").color("#505045").attr({w:22,h:35})),this.add(900,25,Crafty.e("2D, Canvas, Edge, Color").color("#404045").attr({w:42,h:35})),this.add(600,125,Crafty.e("2D, Canvas, Edge, Color").color("#505045").attr({w:32,h:40})),this.add(500,225,Crafty.e("2D, Canvas, Edge, Color").color("#505045").attr({w:32,h:20})),this.add(800,275,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:42,h:15}))},c}(this.Game.LevelBlock)),a.defineBlock(function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.name="GameplayDemo.TunnelStart",c.prototype.delta={x:1e3,y:0},c.prototype.next=["GameplayDemo.TunnelEnd","GameplayDemo.Tunnel","GameplayDemo.TunnelTwist"],c.prototype.supports=["speed","cleared"],c.prototype.generate=function(){return this.add(0,0,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:350,h:15})),this.add(350,0,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:100,h:70})),this.add(450,0,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:550,h:25})),this.add(380,0,Crafty.e("2D, Canvas, Color").color("#202020").attr({z:-1,w:this.delta.x-380,h:this.level.visibleHeight})),this.addBackground(380,this.level.visibleHeight-360,Crafty.e("2D, Canvas, Color").color("#303030").attr({
z:2,w:40,h:360}),1.5),this.addBackground(380,this.level.visibleHeight-180,Crafty.e("2D, Canvas, Color").color("#505050").attr({z:-1,w:40,h:180}),.5),this.addBackground(380,this.level.visibleHeight-90,Crafty.e("2D, Canvas, Color").color("#606060").attr({z:-2,w:40,h:90}),.25)},c.prototype.inScreen=function(){var a,b;return b=this.settings.only||[],-1===b.indexOf("cleared")?(a=[{repeat:2,x:-400,y:50,duration:3e3,type:"sine"},{repeat:.5,x:400,y:50,duration:3e3,type:"sine",event:"retreat",data:{name:"fooo"}},{repeat:.5,start:.5,x:-300,y:200,duration:3e3,type:"sine"}],Crafty.e("Delay").delay(function(b){return function(){var c;return c=Crafty.e("Enemy"),c.bind("retreat",function(a){return console.log("Retreating! "+a.data.name)}),b.add(650,150,c),c.enemy().choreography(a,-1)}}(this),500,5)):void 0},c}(this.Game.LevelBlock)),a.defineBlock(function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.name="GameplayDemo.TunnelEnd",c.prototype.delta={x:1e3,y:0},c.prototype.next=["GameplayDemo.Asteroids","GameplayDemo.TunnelStart"],c.prototype.supports=["speed","cleared"],c.prototype.generate=function(){var a;return a=15,this.add(0,this.level.visibleHeight-a,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:350,h:a})),a=70,this.add(350,this.level.visibleHeight-a,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:100,h:a})),a=25,this.add(450,this.level.visibleHeight-a,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:550,h:a})),this.add(0,0,Crafty.e("2D, Canvas, Color").color("#202020").attr({z:-1,w:380,h:this.level.visibleHeight})),this.addBackground(380,this.level.visibleHeight-360,Crafty.e("2D, Canvas, Color").color("#303030").attr({z:2,w:40,h:360}),1.5),this.addBackground(380,this.level.visibleHeight-180,Crafty.e("2D, Canvas, Color").color("#505050").attr({z:-1,w:40,h:180}),.5),this.addBackground(380,this.level.visibleHeight-90,Crafty.e("2D, Canvas, Color").color("#606060").attr({z:-2,w:40,h:90}),.25)},c.prototype.enter=function(){var a,b;return b=this.settings.only||[],-1===b.indexOf("cleared")?(a=[{repeat:2,x:-400,y:50,duration:3e3,type:"sine"},{repeat:.5,x:400,y:50,duration:3e3,type:"sine"},{repeat:.5,start:.5,x:-300,y:200,duration:3e3,type:"sine"}],Crafty.e("Delay").delay(function(b){return function(){var c;return c=Crafty.e("Enemy"),b.add(650,150,c),c.enemy().choreography(a,-1)}}(this),500,5)):void 0},c}(this.Game.LevelBlock)),a.defineBlock(function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.name="GameplayDemo.Tunnel",c.prototype.delta={x:1e3,y:0},c.prototype.next=["GameplayDemo.TunnelEnd","GameplayDemo.Tunnel","GameplayDemo.TunnelTwist"],c.prototype.supports=["speed","cleared"],c.prototype.generate=function(){var a;return this.add(0,0,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:350,h:15})),this.add(350,0,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:100,h:70})),this.add(450,0,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:550,h:25})),a=15,this.add(0,this.level.visibleHeight-a,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:350,h:a})),a=70,this.add(350,this.level.visibleHeight-a,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:100,h:a})),a=25,this.add(450,this.level.visibleHeight-a,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:550,h:a})),this.add(0,0,Crafty.e("2D, Canvas, Color").color("#202020").attr({z:-1,w:this.delta.x,h:this.level.visibleHeight}))},c.prototype.enter=function(){var a,b;return b=this.settings.only||[],-1===b.indexOf("cleared")?(a=[{repeat:2,x:-400,y:50,duration:3e3,type:"sine"},{repeat:.5,x:400,y:50,duration:3e3,type:"sine"},{repeat:.5,start:.5,x:-300,y:200,duration:3e3,type:"sine"}],Crafty.e("Delay").delay(function(b){return function(){var c;return c=Crafty.e("Enemy"),b.add(650,150,c),c.enemy().choreography(a,-1)}}(this),500,5)):void 0},c}(this.Game.LevelBlock)),a.defineBlock(function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.name="GameplayDemo.Lasers",c.prototype.delta={x:1e3,y:0},c.prototype.next=["GameplayDemo.Lasers2","GameplayDemo.TunnelTwist"],c.prototype.generate=function(){var a,b;return a=15,this.add(0,0,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:this.delta.x,h:a})),this.add(0,this.level.visibleHeight-a,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:this.delta.x,h:a})),a=100,this.add(300,this.level.visibleHeight-a,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:10,h:a})),this.add(250,this.level.visibleHeight-a,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:50,h:10})),this.add(400,15+a,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:110,h:10})),a=100,b=200,this.add(650,15,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:10,h:a})),this.add(600,15+a,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:60,h:10})),this.add(600,25+a,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:10,h:b})),this.add(600,25+a+b,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:60,h:10})),this.add(650,25+b,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:60,h:10})),this.add(900,100,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:10,h:this.level.visibleHeight-100})),this.add(0,0,Crafty.e("2D, Canvas, Color").color("#202020").attr({z:-1,w:this.delta.x,h:this.level.visibleHeight}))},c.prototype.enter=function(){var a;return c.__super__.enter.apply(this,arguments),a=Crafty.e("LaserTurret"),this.add(150,15,a),a.color("#808020").laserTurret({orientation:"down",range:160,duration:4e3,pauseOnEdges:500}),a=Crafty.e("LaserTurret"),this.add(570,this.level.visibleHeight-15,a),a.color("#808020").laserTurret({orientation:"up",range:-200,duration:2e3,pauseOnEdges:300}),a=Crafty.e("LaserTurret"),this.add(830,this.level.visibleHeight-15,a),a.color("#808020").laserTurret({orientation:"up",range:-200,duration:2e3,pauseOnEdges:300})},c}(this.Game.LevelBlock)),a.defineBlock(function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.name="GameplayDemo.Lasers2",c.prototype.delta={x:800,y:0},c.prototype.next=["GameplayDemo.TunnelEnd","GameplayDemo.Tunnel","GameplayDemo.TunnelTwist"],c.prototype.supports=["speed","cleared"],c.prototype.generate=function(){var a;return a=15,this.add(0,0,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:this.delta.x,h:a})),this.add(0,this.level.visibleHeight-a,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:this.delta.x,h:a})),a=250,this.add(300,a,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:100,h:10})),this.add(400,a,Crafty.e("2D, Canvas, Edge, Color, Glass").color("#404040").attr({w:100,h:10,alpha:.5,z:1})),this.add(500,a,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:100,h:10})),this.add(0,0,Crafty.e("2D, Canvas, Color").color("#202020").attr({z:-1,w:this.delta.x,h:this.level.visibleHeight}))},c.prototype.enter=function(){var a;return a=Crafty.e("LaserTurret"),this.add(200,15,a),a.color("#808020").laserTurret({orientation:"down",range:350,duration:5200,pauseOnEdges:500}),a=Crafty.e("LaserTurret"),this.add(300,this.level.visibleHeight-15,a),a.color("#808020").laserTurret({orientation:"up",range:350,duration:5200,pauseOnEdges:500})},c}(this.Game.LevelBlock)),a.defineBlock(function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.name="GameplayDemo.TunnelTwist",c.prototype.delta={x:1e3,y:0},c.prototype.next=["GameplayDemo.TunnelTwist","GameplayDemo.Tunnel"],c.prototype.supports=["cleared"],c.prototype.generate=function(){var a;return this.add(0,0,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:250,h:15})),this.add(250,0,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:100,h:220})),this.add(350,0,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:650,h:25})),a=15,this.add(0,this.level.visibleHeight-a,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:650,h:a})),a=220,this.add(650,this.level.visibleHeight-a,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:100,h:a})),a=25,this.add(750,this.level.visibleHeight-a,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:250,h:a})),this.add(0,0,Crafty.e("2D, Canvas, Color").color("#202020").attr({z:-1,w:this.delta.x,h:this.level.visibleHeight}))},c}(this.Game.LevelBlock)),a.defineBlock(function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.name="GameplayDemo.PerspectiveTest",c.prototype.delta={x:640,y:0},c.prototype.next=[],c.prototype.generate=function(){return this.add(0,0,Crafty.e("2D, Canvas, Color").attr({w:this.delta.x,h:this.level.visibleHeight,alpha:.2,z:-1}).color("#FF0000")),this.add(0,0,Crafty.e("2D, Canvas, Color").attr({w:5,h:this.level.visibleHeight,z:-1}).color("#FF0000")),this.addBackground(0,.25*this.level.visibleHeight,Crafty.e("2D, Canvas, Color").attr({w:.5*this.delta.x,h:.5*this.level.visibleHeight,alpha:.2,z:-2}).color("#00FF00"),.5),this.addBackground(0,.25*this.level.visibleHeight,Crafty.e("2D, Canvas, Color").attr({w:5,h:.5*this.level.visibleHeight,z:-2}).color("#00FF00"),.5),this.addBackground(0,.375*this.level.visibleHeight,Crafty.e("2D, Canvas, Color").attr({w:.25*this.delta.x,h:.25*this.level.visibleHeight,alpha:.7,z:-3}).color("#0000FF"),.25),this.addBackground(0,.375*this.level.visibleHeight,Crafty.e("2D, Canvas, Color").attr({w:5,h:.25*this.level.visibleHeight,z:-3}).color("#0000FF"),.25)},c}(this.Game.LevelBlock)),a.defineBlock(function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.name="GameplayDemo.OceanRiser",c.prototype.delta={x:1e3,y:-180},c.prototype.next=["GameplayDemo.OceanHight"],c.prototype.generate=function(){var a;return this.yMotion=-180,a=25,this.add(0,this.level.visibleHeight-a,Crafty.e("2D, Canvas, Edge, Color").attr({w:this.delta.x,h:a}).color("#000080")),this.addBackground(0,this.level.visibleHeight-65,Crafty.e("2D, Canvas, Color").color("#3030B0").attr({z:-2,w:.5*this.delta.x,h:65}),.5),this.addBackground(0,this.level.visibleHeight-85,Crafty.e("2D, Canvas, Color").color("#6060E0").attr({z:-3,w:.25*this.delta.x,h:85}),.25),this.addBackground(200,45,Crafty.e("2D, Canvas, Color").color("#FFFFFF").attr({z:-2,w:200,h:55}),.5),this.addBackground(200,65,Crafty.e("2D, Canvas, Color").color("#DDDDDD").attr({z:-3,w:150,h:55}),.25)},c.prototype.inScreen=function(){var a,b,c;return null!=(null!=(a=this.level._forcedSpeed)?a.x:void 0)?this._speedX=null!=(b=this.level._forcedSpeed)?b.x:void 0:this._speedX=this.level._forcedSpeed,c=this.yMotion/(this.delta.x-640),this.level.setForcedSpeed({x:this._speedX,y:this._speedX*c})},c.prototype.outScreen=function(){return this.level.setForcedSpeed(this._speedX)},c}(this.Game.LevelBlock)),a.defineBlock(function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.name="GameplayDemo.OceanHigh",c.prototype.delta={x:1e3,y:0},c.prototype.next=["GameplayDemo.OceanHight","GameplayDemo.OceanLower"],c.prototype.generate=function(){var a;return a=2,this.yMotion=-180,a=25,this.addBackground(0,this.level.visibleHeight-65-this.yMotion,Crafty.e("2D, Canvas, Color").color("#3030B0").attr({z:-2,w:.5*this.delta.x,h:65}),.5),this.addBackground(0,this.level.visibleHeight-85-this.yMotion,Crafty.e("2D, Canvas, Color").color("#6060E0").attr({z:-3,w:.25*this.delta.x,h:85}),.25),this.addBackground(200,45-this.yMotion,Crafty.e("2D, Canvas, Color").color("#FFFFFF").attr({z:-2,w:200,h:55}),.5),this.addBackground(200,65-this.yMotion,Crafty.e("2D, Canvas, Color").color("#DDDDDD").attr({z:-3,w:150,h:55}),.25)},c}(this.Game.LevelBlock)),a.defineBlock(function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.name="GameplayDemo.OceanLower",c.prototype.delta={x:1e3,y:180},c.prototype.next=["GameplayDemo.Ocean","GameplayDemo.TunnelStart"],c.prototype.generate=function(){var a;return this.yMotion=180,a=25,this.add(0,this.level.visibleHeight-a+this.yMotion,Crafty.e("2D, Canvas, Edge, Color").attr({w:this.delta.x,h:a}).color("#000080")),this.addBackground(0,this.level.visibleHeight-65+this.yMotion,Crafty.e("2D, Canvas, Color").color("#3030B0").attr({z:-2,w:.5*this.delta.x,h:65}),.5),this.addBackground(0,this.level.visibleHeight-85+this.yMotion,Crafty.e("2D, Canvas, Color").color("#6060E0").attr({z:-3,w:.25*this.delta.x,h:85}),.25),this.addBackground(200,45+this.yMotion,Crafty.e("2D, Canvas, Color").color("#FFFFFF").attr({z:-2,w:200,h:55}),.5),this.addBackground(200,65+this.yMotion,Crafty.e("2D, Canvas, Color").color("#DDDDDD").attr({z:-3,w:150,h:55}),.25)},c.prototype.inScreen=function(){var a,b,c;return null!=(null!=(a=this.level._forcedSpeed)?a.x:void 0)?this._speedX=null!=(b=this.level._forcedSpeed)?b.x:void 0:this._speedX=this.level._forcedSpeed,c=this.yMotion/(this.delta.x-640),this.level.setForcedSpeed({x:this._speedX,y:this._speedX*c})},c.prototype.outScreen=function(){return this.level.setForcedSpeed(this._speedX)},c}(this.Game.LevelBlock)),a.defineBlock(function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.name="GameplayDemo.Ocean",c.prototype.delta={x:1e3,y:0},c.prototype.next=["GameplayDemo.Ocean","GameplayDemo.TunnelStart"],c.prototype.generate=function(){var a;return a=25,this.add(0,this.level.visibleHeight-a,Crafty.e("2D, Canvas, Edge, Color").attr({w:this.delta.x,h:a}).color("#000080")),this.addBackground(0,this.level.visibleHeight-65,Crafty.e("2D, Canvas, Color").color("#3030B0").attr({z:-2,w:.5*this.delta.x,h:65}),.5),this.addBackground(0,this.level.visibleHeight-85,Crafty.e("2D, Canvas, Color").color("#6060E0").attr({z:-3,w:.25*this.delta.x,h:85}),.25),this.addBackground(200,45,Crafty.e("2D, Canvas, Color").color("#FFFFFF").attr({z:-2,w:200,h:55}),.5),this.addBackground(200,65,Crafty.e("2D, Canvas, Color").color("#DDDDDD").attr({z:-3,w:150,h:55}),.25)},c}(this.Game.LevelBlock))}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game.levelGenerator,a.defineBlock(function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.name="Generic.Start",c.prototype.delta={x:0,y:0},c.prototype.next=[],c.prototype.generate=function(){},c.prototype.enter=function(){var a;return c.__super__.enter.apply(this,arguments),a="Stage "+this.level.data.stage+": "+this.level.data.title,Crafty.e("StageTitle").stageTitle(a)},c}(this.Game.LevelBlock))}.call(this)}(),function(){function a(){var a=$("#cr-stage").height(),b=$(window).height(),c=b/a;$("#cr-stage").css("transform","scale("+c+")")}window.Game.start(!1),$(document).on("click",function(){screenfull.enabled&&(screenfull.request($("#cr-stage")[0]),$("body").addClass("fullscreen"),document.addEventListener(screenfull.raw.fullscreenchange,function(){screenfull.isFullscreen||$("body").removeClass("fullscreen")}))}),$(window).on("resize",function(){a()}),a()}();