!function(){"use strict"}(),function(){(function(){}).call(this),function(){Crafty.c("Enemy",{init:function(){return this.requires("2D, WebGL, Collision, Tween, Choreography, ViewportFixed, Hideable, SunBlock"),this.attr({pointsOnHit:10,pointsOnDestroy:50}),this.invincible=!1},enemy:function(){return Crafty.trigger("EnemySpawned",this),this.onHit("Bullet",function(a){var b,c;if(!Game.paused&&!this.hidden)return c={pointsOnHit:this.pointsOnHit,pointsOnDestroy:this.pointsOnDestroy},b=a[0].obj,this.invincible||(b.trigger("HitTarget",c),this.attr({hitFlash:{_red:255,_green:255,_blue:0}}),this.absorbDamage(b.damage),this.health<=0&&b.trigger("DestroyTarget",c),this.trigger("Hit",{entity:this,projectile:b})),b.destroy()},function(){return this.attr({hitFlash:!1})}),this.onHit("Explosion",function(a){var b,c,d,e,f;if(!Game.paused&&!this.hidden&&!this.invincible){for(e=[],c=0,d=a.length;d>c;c++)b=a[c],f=b.obj,f.damage>0?(this.trigger("Hit",{entity:this,projectile:f}),this.attr({hitFlash:{_red:255,_green:255,_blue:128}}),this.absorbDamage(f.damage),e.push(f.damage=0)):e.push(void 0);return e}},function(){return this.attr({hitFlash:!1})}),this},absorbDamage:function(a){return null!=a?(this.health-=a,"function"==typeof this.updatedHealth&&this.updatedHealth(),this.health<=0?(Crafty.trigger("EnemyDestroyed",this),this.trigger("Destroyed",this),this.destroy()):void 0):void 0},flipX:function(){var a,b,c,d,e,f,g;try{for(this.flip("X"),e=this._children,g=[],c=0,d=e.length;d>c;c++)a=e[c],f=a.x-this.x,"function"==typeof a.attr&&a.attr({x:this.x+this.w-a.w-f}),g.push("function"==typeof a.flip?a.flip("X"):void 0);return g}catch(h){return b=h,console.log(b)}},unflipX:function(){var a,b,c,d,e,f,g;try{for(this.unflip("X"),e=this._children,g=[],c=0,d=e.length;d>c;c++)a=e[c],f=this.x+this.w-(a.x+a.w),"function"==typeof a.attr&&a.attr({x:this.x+f}),g.push("function"==typeof a.unflip?a.unflip("X"):void 0);return g}catch(h){return b=h,console.log(b)}}})}.call(this),function(){Crafty.c("Invincible",{init:function(){return this.requires("Delay, Color"),this.rawColor=this.color(),this.delay(this._blink,250,-1)},_blink:function(){return null==this.blinkOn&&(this.blinkOn=!0),this.blinkOn=!this.blinkOn,this.blinkOn?this.color(this.rawColor,.5):this.color(this.rawColor,100)},remove:function(){return this.color(this.rawColor),this.cancelDelay(this._blink)},invincibleDuration:function(a){return this.delay(function(){return this.removeComponent("Invincible")},a,0)}})}.call(this),function(){Crafty.c("ScrollWall",{init:function(){return this.requires("2D, Edge, Collision"),this.shakes=[],this.attr({x:0,y:0,w:2,h:Crafty.viewport.height,speed:{x:0,y:0}}),this._speed={x:0,y:0},this.wallEnd=Crafty.e("2D, ScrollFront, Edge").attr({x:-(Crafty.viewport.x-Crafty.viewport.width)-3,y:0,h:Crafty.viewport.height,w:12}),this.attach(this.wallEnd),this.wallTop=Crafty.e("2D, Edge, Collision").attr({x:0,y:40,h:2,w:Crafty.viewport.width}),this.attach(this.wallTop),this.wallBottom=Crafty.e("2D, Edge, Collision").attr({x:0,y:Crafty.viewport.height-2,h:2,w:Crafty.viewport.width}),this.attach(this.wallBottom),this.bind("GameLoop",function(a){var b,c,d,e,f,g,h,i,j;for(g=this._speed.x,h=this._speed.y,this.allowPushing&&Crafty("PlayerControlledShip").each(function(){var a,b,c,d,e;return e=Crafty.viewport.width*(2/3),d=this.x+Crafty.viewport.x,d>e?(c=(d-e)/(Crafty.viewport.width-e),a=(5+this._forcedSpeed.x)*c,g>0&&(b=(g+a)/g,h*=b),g+=a):void 0}),this.x+=g/1e3*a.dt,this.y+=h/1e3*a.dt,i=this.x,j=this.y,e=this.shakes,d=c=e.length-1;c>=0;d=c+=-1)f=e[d],f.easing.tick(a.dt),b=f.coords(f.easing.value()),i+=b[0],j+=b[1],f.easing.complete&&this.shakes.splice(d,1);return Crafty.viewport.y!==-j&&(Crafty.viewport.y=-j),Crafty.viewport.x!==-i&&(Crafty.viewport.x=-i),Crafty.trigger("ViewportMove",{x:Math.round(i),y:Math.round(j)})})},screenShake:function(a,b){return this.shakes.push({amount:a,duration:b,shakes:Math.ceil(b/100),easing:new Crafty.easing(b,"linear"),startX:Math.random()>.5?-1:1,startY:Math.random()>.5?-1:1,coords:function(b){var c;return c=Math.cos(Math.PI/2+b*this.shakes*(Math.PI/2)),[c*a*this.startX,c*a*this.startY]}})},scrollWall:function(a){return null!=a.x&&null!=a.y?(this._speed.x=a.x,this._speed.y=a.y):(this._speed.x=a,this._speed.y=0),this},setHeight:function(a){return this.y+=a,Crafty.viewport.y=-this.y},setAllowPushing:function(a){this.allowPushing=a},off:function(){return this.wallEnd.removeComponent("Edge"),this.unbind("GameLoop")},remove:function(){return this.unbind("GameLoop")}})}.call(this),function(){Crafty.c("ShipSpawnable",{init:function(){return this.requires("Listener"),this.bind("Activated",this.spawnShip)},remove:function(){return this.unbind("Activated",this.spawnShip)},spawnPosition:function(a,b){return this.spawnPosition=a,this.armed=null!=b?b:"lasers",null==this.spawnPosition&&(this.spawnPosition=function(){return{x:x,y:y}}),this},spawnShip:function(a){var b,c,d,e;if(null==a&&(a=this.armed),this.has("ControlScheme")&&this.lives>0){for(a=_.flatten([a]),e=this.spawnPosition(),e.x<10&&(e.x=10),this.ship=Crafty.e("PlayerControlledShip").attr({x:e.x-Crafty.viewport.x,y:e.y-Crafty.viewport.y,z:this.z}),this.has("Color")&&this.ship.color(this.color()),this.has("ControlScheme")&&this.assignControls(this.ship),b=0,d=a.length;d>b;b++)c=a[b],this.ship.installItem(c);return this.listenTo(this.ship,"BulletHit",function(a){var b;return this.stats.shotsHit+=1,this.addPoints(null!=(b=null!=a?a.pointsOnHit:void 0)?b:0)}),this.listenTo(this.ship,"BulletDestroyedTarget",function(a){var b;return this.stats.enemiesKilled+=1,this.addPoints(null!=(b=null!=a?a.pointsOnDestroy:void 0)?b:0)}),this.listenTo(this.ship,"BonusPoints",function(a){return this.addPoints(a)}),this.listenTo(this.ship,"PowerUp",function(){return this.addPoints(20)}),this.listenTo(this.ship,"Shoot",function(){return this.stats.shotsFired+=1}),Crafty.trigger("ShipSpawned",this.ship),this.ship.start(),this.listenTo(this.ship,"Hit",function(){return Crafty.e("Explosion").explode({x:this.ship.x+this.ship.w/2,y:this.ship.y+this.ship.h/2,radius:this.ship.w}),this.ship.trigger("Destroyed",this.ship),this.ship.destroy(),a=this.ship.items,this.ship=null,Crafty.e("Delay").delay(function(b){return function(){return b.loseLife(),b.spawnShip(a)}}(this),2e3,0)}),this}}})}.call(this),function(){Crafty.c("StageEnd",{init:function(){return this.requires("2D, WebGL, HUD, Delay, Color")},stageEnd:function(a,b,c){var d;return this.lineNr=0,this.attr({w:580,h:200,alpha:.2}).positionHud({x:40,y:130,z:90}).color("#000000"),d=Crafty.e("Text, DOM").attr({x:this.x,y:this.y+10,w:this.w,z:91}).css("textAlign","center").text("Stage "+b+" Cleared: "+c).textColor("#FFFFFF").textFont({size:"12px",weight:"bold",family:"Press Start 2P"}),this.attach(d),this.delay(function(b){switch(this.lineNr){case 0:return this.showPlayerHeaders(),this.showAccuracy(a);case 2:return this.showShotsFired(a);case 3:return this.showEnemiesKilled(a);case 4:return this.showLives(a);case 5:return this.showWeaponXP(a);case 6:return this.showTotals(a)}},2e3,6)},showPlayerHeaders:function(){var a;return a=[""],Crafty("Player").each(function(){return this.has("ControlScheme")?a.push(this.name):a.push(""),a.push("")}),this.addCelledLine(a)},showAccuracy:function(a){var b;return b=["Accuracy"],Crafty("Player").each(function(){var a,c;return this.has("ControlScheme")?(c=this.stats.shotsHit>0&&this.stats.shotsFired>0?Math.round(this.stats.shotsHit/this.stats.shotsFired*1e3)/10:0,b.push(c+"%"),a=Math.round(100*c),b.push(a),this.stats.bonus+=a):(b.push(""),b.push(""))}),this.addCelledLine(b)},showShotsFired:function(a){var b;return b=["Shots fired"],Crafty("Player").each(function(){var a,c,d;return this.has("ControlScheme")?(d=this.stats.shotsFired,b.push(""+d),a=this.stats.shotsHit>0&&this.stats.shotsFired>0?this.stats.shotsHit/this.stats.shotsFired:0,c=Math.round(d*(a+a)),b.push(c),this.stats.bonus+=c):(b.push(""),b.push(""))}),this.addCelledLine(b)},showEnemiesKilled:function(a){var b;return b=["Enemies Killed"],Crafty("Player").each(function(){var c,d,e;return this.has("ControlScheme")?(this.stats.enemiesKilled>0&&a.data.enemiesSpawned>0?(d=this.stats.enemiesKilled/a.data.enemiesSpawned,e=Math.round(1e3*d)/10):e=0,b.push(e+"%"),c=Math.round(100*e),b.push(c),this.stats.bonus+=c):(b.push(""),b.push(""))}),this.addCelledLine(b)},showLives:function(a){var b;return b=["Lives"],Crafty("Player").each(function(){var a,c;return this.has("ControlScheme")?(c=this.lives,b.push(""+c),a=Math.round(1e3*c),b.push(a),this.stats.bonus+=a):(b.push(""),b.push(""))}),this.addCelledLine(b)},showWeaponXP:function(a){var b;return b=["WeaponXP"],Crafty("Player").each(function(){var a,c,d,e,f;return this.has("ControlScheme")?(f=null!=(a=null!=(c=this.ship)&&null!=(d=c.primaryWeapon)?d.xp:void 0)?a:0,b.push(""+f),e=Math.round(10*f),b.push(e),this.stats.bonus+=e):(b.push(""),b.push(""))}),this.addCelledLine(b)},showTotals:function(a){var b;return b=["Totals"],Crafty("Player").each(function(){return this.has("ControlScheme")?(b.push(""),b.push(this.stats.bonus),this.addPoints(this.stats.bonus),this.stats.bonus=0):(b.push(""),b.push(""))}),this.addCelledLine(b)},addCelledLine:function(a){var b,c,d,e,f,g,h,i;for(this.lineNr+=1,i=this.y+20+20*this.lineNr,h=0,c=500/(a.length+.5),g=[],d=e=0,f=a.length;f>e;d=++e)b=a[d],g.push(function(a){return function(b,d){var e,f,g;return f=c,0===d&&(f+=c/2),g=0===d?a.x+h:a.x+h+c*(d+.5),e=Crafty.e("Text, DOM").attr({x:g,y:i,w:f,z:3}).css("textAlign","right").text(b).textColor("#FFFFFF").textFont({size:"8px",weight:"normal",family:"Press Start 2P"}),2!==d&&4!==d||"number"!=typeof b||(e.attr({endScore:b,v:0}),e.text(e.v),e.bind("GameLoop",function(a){return this.v+=3*a.dt+3,this.v>this.endScore&&(this.v=this.endScore,this.unbind("GameLoop")),this.text(this.v)})),a.attach(e)}}(this)(b,d));return g}})}.call(this),function(){Crafty.c("StageTitle",{init:function(){return this.requires("2D, DOM, Text, Tween, Delay, HUD")},stageTitle:function(a){return this.attr({w:Crafty.viewport.width,z:1,alpha:0}).css("textAlign","center").text(a).positionHud({x:this.x,y:240,z:-1}).textColor("#FF0000").textFont({size:"30px",weight:"bold",family:"Press Start 2P"}).tween({alpha:1},3e3).bind("TweenEnd",function(a){return function(){return a.delay(function(){return this.tween({viewportY:this.viewportY+100,alpha:0},1500),this.bind("TweenEnd",function(a){return function(){return a.destroy()}}(this))},3e3,0)}}(this))}})}.call(this),function(){Crafty.c("TextInput",{init:function(){return this.requires("2D, DOM, Text")},remove:function(){},textInput:function(a,b){var c,d;return this.defer=WhenJS.defer(),d="A  ",c=0,this.text(d),a.bind("Up",function(a){return function(){return d=a._updateText(d,c,1),a.text(d)}}(this)),a.bind("Down",function(a){return function(){return d=a._updateText(d,c,-1),a.text(d)}}(this)),a.bind("Left",function(a){return function(){return c=Math.max(c-1,0),a._updateCursor(c)}}(this)),a.bind("Right",function(a){return function(){return c=Math.min(c+1,b-1),a._updateCursor(c)}}(this)),a.bind("Fire",function(e){return function(){var f;return f=c,c=Math.min(c+1,b-1),e._updateCursor(c),c===f&&c===b-1?(a.unbind("Up"),a.unbind("Down"),a.unbind("Left"),a.unbind("Right"),a.unbind("Fire"),e.defer.resolve(d)):void 0}}(this)),this.cursor=Crafty.e("2D, DOM, Text").attr({x:this.x,y:this.y,w:this.w}).text("_  ").textColor("#0000FF").css("textAlign","left").textFont({size:"20px",weight:"bold",family:"Press Start 2P"}),this.attach(this.cursor),this.defer.promise},_updateCursor:function(a){var b;return b=Array(a+1).join("&nbsp;")+"_",this.cursor.text(b)},_updateText:function(a,b,c){var d,e,f,g;return d="ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890-_.=!$& ",e=a[b],f=d.indexOf(e)+d.length,g=d[(f+c)%d.length],a.slice(0,b)+g+a.slice(b+1)}})}.call(this),function(){Crafty.c("Hideable",{init:function(){return this.requires("ColorEffects"),this.hidden=!1},sendToBackground:function(a,b){var c,d;return c=null!=(d=this.scale)?d:1,this.attr({scale:a,w:this.w/c*a,h:this.h/c*a,z:b}),this.hidden=!0},hide:function(a){return this.hideMarker=a,this.hidden=!0,this.attr({alpha:0})},reveal:function(){var a,b,c,d;return null!=(b=this.hideMarker)&&b.destroy(),this.hidden=!1,a=null!=(c=this.scale)?c:1,d=1,this.attr({scale:d,w:this.w/a*d,h:this.h/a*d,alpha:1,z:0})},remove:function(){var a;return null!=(a=this.hideMarker)?a.destroy():void 0}})}.call(this),function(){Crafty.c("ShootOnSight",{remove:function(){return this.unbind("GameLoop",this._checkForShot)},shootOnSight:function(a){return this.shootConfig=_.defaults(a,{targetType:"PlayerControlledShip",sightAngle:10,shootWhenHidden:!1,cooldown:800}),this.bind("GameLoop",this._checkForShot)},_checkForShot:function(a){var b;if(!(null!=this.lastShotAt&&(this.lastShotAt+=a.dt,this.lastShotAt<this.shootConfig.cooldown)))return b=this,Crafty(this.shootConfig.targetType).each(function(){var a;return a=Math.atan2(b.y-this.y,b.x-this.x),a*=180/Math.PI,a=(a+360)%360,Math.abs(a-b.rotation)<b.shootConfig.sightAngle?b._shoot(a):void 0})},_shoot:function(a){var b,c,d,e;if(!this.hidden||this.shootConfig.shootWhenHidden)return this.lastShotAt=0,e=null!=(b=this.weaponOrigin)?b:[0,0],e[0]*=null!=(c=this.scale)?c:1,e[1]*=null!=(d=this.scale)?d:1,this.shootConfig.projectile(e[0]+this.x,e[1]+this.y,a)}})}.call(this),function(){Crafty.c("GamepadControls",{init:function(){return this.requires("Listener"),this.bind("RemoveComponent",function(a){return"ControlScheme"===a?this.removeComponent("GamepadControls"):void 0}),this.emits={}},remove:function(){return this.unbind("GamepadKeyChange",this._keyHandling)},setupControls:function(a){return a.addComponent("GamepadControls").controls(this.controlMap).addComponent("ControlScheme")},controls:function(a){return this.controlMap=a,null!=a.gamepadIndex?(this.requires("Gamepad"),this.gamepad(a.gamepadIndex),this.bind("GamepadKeyChange",this._keyHandling),this.bind("GamepadAxisChange",this._stickHandling),this):void 0},_stickHandling:function(a){var b;return 1===a.axis&&(b="vertical",a.value<-.5?this._startEmit(b,"Up"):a.value>.5?this._startEmit(b,"Down"):this._stopEmit(b)),0===a.axis?(b="horizontal",a.value<-.5?this._startEmit(b,"Left"):a.value>.5?this._startEmit(b,"Right"):this._stopEmit(b)):void 0},_startEmit:function(a,b){var c;if((null!=(c=this.emits[a])?c.value:void 0)!==b)return this._stopEmit(a),this.trigger(b),this.emits[a]={interval:setInterval(function(a){return function(){return a.trigger(b)}}(this),200),value:b}},_stopEmit:function(a){var b;return clearInterval(null!=(b=this.emits[a])?b.interval:void 0),delete this.emits[a]},_keyHandling:function(a){return this.lastPressed&&this.lastPressed.getTime()>(new Date).getTime()-200?void 0:(this.lastPressed=new Date,a.button===this.controlMap.fire&&a.pressed&&this.trigger("Fire",a),a.button===this.controlMap.up&&a.pressed&&this.trigger("Up",a),a.button===this.controlMap.down&&a.pressed&&this.trigger("Down",a),a.button===this.controlMap.left&&a.pressed&&this.trigger("Left",a),a.button===this.controlMap.right&&a.pressed?this.trigger("Right",a):void 0)},assignControls:function(a){return a.addComponent("GamepadMultiway").gamepad(this.controlMap.gamepadIndex).gamepadMultiway({speed:{y:250,x:250},gamepadIndex:this.controlMap.gamepadIndex,analog:!0}),this.listenTo(a,"GamepadKeyChange",function(b){return function(c){return c.button===b.controlMap.fire&&a.shoot(c.pressed),c.button===b.controlMap.switchWeapon&&a.switchWeapon(c.pressed),c.button===b.controlMap["super"]&&a.superWeapon(c.pressed),c.button===b.controlMap.pause&&c.pressed?Game.togglePause():void 0}}(this))}})}.call(this),function(){Crafty.c("KeyboardControls",{init:function(){return this.requires("Listener"),this.bind("RemoveComponent",function(a){return"ControlScheme"===a?this.removeComponent("KeyboardControls"):void 0})},remove:function(){return this.unbind("KeyDown",this._keyHandling)},setupControls:function(a){return a.addComponent("KeyboardControls").controls(this.controlMap).addComponent("ControlScheme")},controls:function(a){return this.controlMap=a,this.bind("KeyDown",this._keyHandling),this},_keyHandling:function(a){return a.key===this.controlMap.fire&&this.trigger("Fire",a),a.key===this.controlMap.up&&this.trigger("Up",a),a.key===this.controlMap.down&&this.trigger("Down",a),a.key===this.controlMap.left&&this.trigger("Left",a),a.key===this.controlMap.right?this.trigger("Right",a):void 0},assignControls:function(a){var b,c,d,e,f,g,h,i,j;b=this.controlMap,h={},d={up:-90,down:90,left:180,right:0};for(c in d){j=d[c],g=b[c],i=Crafty.keys;for(e in i)f=i[e],f===g&&(h[e]=j)}return a.addComponent("Multiway, Keyboard").multiway({y:250,x:250},h).bind("GamePause",function(a){return a?(this.disabledBeforePause=this.disableControls,this.disableControl()):this.disabledBeforePause?void 0:this.enableControl()}),this.listenTo(a,"KeyDown",function(c){return c.key===b.fire&&a.shoot(!0),c.key===b.switchWeapon&&a.switchWeapon(!0),c.key===b["super"]&&a.superWeapon(!0),c.key===b.pause?Game.togglePause():void 0}),this.listenTo(a,"KeyUp",function(c){return c.key===b.fire&&a.shoot(!1),c.key===b.switchWeapon&&a.switchWeapon(!1),c.key===b["super"]?a.superWeapon(!1):void 0})}})}.call(this),function(){Crafty.c("CameraCrew",{init:function(){return this.requires("2D, WebGL, Choreography, ViewportFixed, Collision, Hideable, cameraHelicopter, SpriteAnimation"),this.reel("fly",200,[[0,0],[1,0]]),this.attr({w:60,h:25}),this.origin("center")},cameraCrew:function(){return this.animate("fly",-1),this.onHit("BackgroundBullet",function(a){var b;if(!Game.paused)return b=a[0].obj,this.trigger("Hit",this),b.destroy()}),this}})}.call(this),function(){Crafty.c("Drone",{init:function(){return this.requires("Enemy, standardDrone")},drone:function(a){return null==a&&(a={}),this.attr(_.defaults(a,{w:40,h:40,health:300})),this.origin("center"),this.collision([2,25,8,18,20,13,30,15,33,28,14,34,4,30]),this.attr({weaponOrigin:[2,25]}),this.enemy(),this.bind("Hit",function(a){return function(b){return a.shiftedX+=10,b.projectile.has("Bullet")?Crafty.e("LaserHit").explode({x:b.projectile.x,y:b.projectile.y,radius:4,duration:50}):void 0}}(this)),this},updatedHealth:function(){var a;return a=0,this.health<200&&(a=1),this.sprite(a,0)}})}.call(this),function(){Crafty.c("OldExplosion",{init:function(){return this.requires("2D,Tween,Delay"),this.explosionMode=window.Game.explosionMode,"block"===this.explosionMode?this.requires("WebGL, Color"):void 0},explode:function(a){var b,c,d,e,f,g;return e=null!=(f=a.radius)?f:20,c=(null!=(g=a.duration)?g:160)/1e3,this.attr(a),d={maxParticles:3*a.radius,size:a.radius,sizeRandom:8,speed:a.radius/13,speedRandom:.5,lifeSpan:19,lifeSpanRandom:7,angle:0,angleRandom:360,startColour:[235,135,5,1],startColourRandom:[28,150,45,.2],endColour:[135,135,135,0],endColourRandom:[60,60,60,.1],sharpness:10,sharpnessRandom:10,spread:a.radius/2,duration:c*Crafty.timer.FPS(),fastMode:!1,gravity:{x:0,y:0},jitter:0},this.attr({w:1,h:1}),"block"===this.explosionMode&&this.color("#FF0000"),this.tween({x:this.x-e,y:this.y-e,w:this.w+2*e,h:this.h+2*e,alpha:.2},500),this.bind("TweenEnd",function(){return this.destroy()}),"particles"===this.explosionMode&&(d.fastMode=!0),"particles"===this.explosionMode&&(b=(d.lifeSpan+d.lifeSpanRandom)*Crafty.timer.FPS(),Crafty.e("2D,Particles,Delay").attr({x:this.x-a.radius/2,y:this.y-a.radius/2}).particles(d).bind("ParticleEnd",function(){return this.delay(function(){return this.destroy()},b)})),this}}),Crafty.c("Explosion",{init:function(){return this.requires("2D, WebGL, explosionStart, SpriteAnimation, Horizon, Collision")},explode:function(a){var b,c,d,e;return c=null!=(d=a.radius)?d:20,b=(null!=(e=a.duration)?e:160)/1e3,this.attr(a),this.attr({w:4*a.radius,h:4*a.radius}),this.attr({x:this.x-this.w/2,y:this.y-this.h/2}),this.collision([.2*this.w,.2*this.h,.8*this.w,.2*this.h,.8*this.w,.8*this.h,.2*this.w,.8*this.h]),this.reel("explode",3e3*b,[[0,0],[1,0],[2,0],[3,0],[4,0],[0,1],[1,1],[2,1],[3,1],[4,1],[0,2],[1,2],[2,2],[3,2],[4,2],[0,3],[1,3]]),this.bind("AnimationEnd",function(a){return function(){return a.destroy()}}(this)),this.animate("explode"),this}}),Crafty.c("LaserHit",{init:function(){return this.requires("2D, WebGL, explosionStart, SpriteAnimation, Horizon, Collision")},explode:function(a){var b,c,d,e;return c=null!=(d=a.radius)?d:20,b=(null!=(e=a.duration)?e:160)/1e3,this.attr(a),this.attr({w:4*a.radius,h:4*a.radius}),this.attr({x:this.x-this.w/2,y:this.y-this.h/2}),this.collision([.2*this.w,.2*this.h,.8*this.w,.2*this.h,.8*this.w,.8*this.h,.2*this.w,.8*this.h]),this.reel("explode",3e3*b,[[0,0],[1,0],[2,0],[3,0],[4,0],[0,1],[1,1],[2,1],[3,1],[4,1],[0,2],[1,2],[2,2],[3,2],[4,2],[0,3],[1,3]]),this.bind("AnimationEnd",function(a){return function(){return a.destroy()}}(this)),this.animate("explode"),this}})}.call(this),function(){Crafty.c("LargeDrone",{init:function(){return this.requires("Enemy, standardLargeDrone, SpriteAnimation")},drone:function(a){return null==a&&(a={}),this.attr(_.defaults(a,{w:90,h:70,health:36e4,z:-1})),this.origin("center"),this.collision([2,36,16,15,86,2,88,4,62,15,57,46,46,66,18,66,3,47]),this.eye=Crafty.e("2D, WebGL, eyeStart, SpriteAnimation"),this.attach(this.eye),this.eye.attr({x:2+this.x,y:18+this.y,z:1}),this.eye.reel("slow",1500,[[0,3],[1,3],[2,3],[3,3],[0,4],[1,4],[2,4],[3,4]]),this.wing=Crafty.e("2D, WebGL, wingLoaded, SpriteAnimation"),this.attach(this.wing),this.wing.attr({x:22+this.x,y:33+this.y,z:1,h:21,w:46}),this.wing.reel("emptyWing",30,[[6,4]]),this.wing.reel("reload",500,[[2,4],[3,4],[4,4],[5,4]]),this.enemy(),this.onHit("Mine",function(a){var b,c,d,e;if(!Game.paused&&!this.hidden)for(c=0,d=a.length;d>c;c++){if(b=a[c],e=b.obj,e.hidden)return;if(e.z<0)return;e.absorbDamage(300)}}),this.updatedHealth(),this.bind("Hit",function(a){return function(b){return b.projectile.has("Bullet")?(a.shiftedX+=2,Crafty.e("LaserHit").explode({x:b.projectile.x,y:b.projectile.y,z:a.z+2,radius:4,duration:50})):void 0}}(this)),this},updatedHealth:function(){var a;return a=0,this.health<35e4&&(a=1),this.health<325e3&&(a=2),this.health<315e3&&(a=3),this.sprite(a,0)}})}.call(this),function(){Crafty.c("Mine",{init:function(){return this.requires("Enemy, standardMine, SpriteAnimation"),this.reel("open",200,[[1,3],[2,3]]),this.reel("close",200,[[1,3],[0,3]]),this.reel("blink",100,[[2,3],[3,3]]),this.bind("GameLoop",function(a){var b;return b=.09*a.dt,this.attr({rotation:this.rotation+b})})},mine:function(a){return null==a&&(a={}),this.attr(_.defaults(a,{h:25,w:25,health:100})),this.origin("center"),this.enemy(),this}})}.call(this),function(){Crafty.c("PowerUp",{init:function(){return this.requires("2D,WebGL,Color"),this.color("#20FF20"),this.attr({w:20,h:20})},remove:function(){},powerUp:function(a){var b;return this.settings=a,this.settings.marking&&(b=Crafty.e("2D,DOM,Text").textColor("#000000").textFont({size:"12px",family:"Press Start 2P"}).text(this.settings.marking).attr({x:4,y:4}),this.attach(b)),this}})}.call(this),function(){Crafty.c("Projectile",{init:function(){return this.requires("2D, WebGL, ViewportFixed")},shoot:function(a,b,c){return this.attr({x:a,y:b,rotation:c}),this.bind("GameLoop",function(a){var b;return b=a.dt*(this.speed/1e3),this.x-=Math.cos(this.rotation/180*Math.PI)*b,this.y-=Math.sin(this.rotation/180*Math.PI)*b,(this.x<-Crafty.viewport.x||this.x>-Crafty.viewport.x+Crafty.viewport.width)&&this.destroy(),this.y<-Crafty.viewport.y||this.y>-Crafty.viewport.y+Crafty.viewport.height?this.destroy():void 0}),this}})}.call(this),function(){Crafty.c("Rocket",{init:function(){return this.requires("Enemy, standardRocket")},rocket:function(a){var b;return null==a&&(a={}),this.attr(_.defaults(a,{health:300})),this.origin("center"),b={maxParticles:150,size:8,sizeRandom:6,speed:2,speedRandom:.5,lifeSpan:16,lifeSpanRandom:4,angle:90,angleRandom:10,startColour:[235,135,5,1],startColourRandom:[28,150,45,.2],endColour:[135,135,135,0],endColourRandom:[60,60,60,.1],sharpness:10,sharpnessRandom:10,spread:2,duration:-1,fastMode:!1,gravity:{x:0,y:-.12},jitter:0},this.attach(Crafty.e("2D,Particles").attr({x:this.x+this.w,y:this.y+3}).particles(b)),this.enemy(),this}})}.call(this),function(){Crafty.c("Sun",{init:function(){var a,b,c,d;return this.requires("2D, WebGL, Collision, Choreography, ViewportFixed, sun"),this.attr({w:20,h:20,z:-1e3}),this.origin("center"),this.glare=[],c=Crafty.e("2D, WebGL, Glare, directGlare").attr({w:3*this.w,h:3*this.h,z:90,alpha:.8,originalAlpha:.8}).origin("center"),this.attach(c),this.glare.push(c),b=Crafty.e("2D, WebGL, Glare, blueGlare, Horizon").attr({mirrored:!0,w:80,h:80,z:91,res:.9,alpha:.4,originalAlpha:.4,blur:2}).origin("center").saturationGradient(1,1),this.attach(b),this.glare.push(b),d=Crafty.e("2D, WebGL, Glare, redGlare").attr({mirrored:!0,w:10,h:10,z:92,res:.8,alpha:.6,originalAlpha:.6}).origin("center"),this.attach(d),this.glare.push(d),a=Crafty.e("2D, WebGL, Glare, bigGlare").attr({mirrored:!0,w:200,h:200,z:93,alpha:.2,res:1.1,originalAlpha:.2}).origin("center"),this.attach(a),this.glare.push(a)},sun:function(a){return this.attr(a),this.bind("GameLoop",this._updateGlare),this},remove:function(){return this.unbind("GameLoop",this._updateGlare)},_updateGlare:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A;for(b=[0],v=this.area(),s=this.hit("SunBlock"),j=0,l=s.length;l>j;j++)o=s[j],e=o.obj,"SAT"===o.type?b.push(-1*o.overlap/50*v):(y=Math.max(this.x,e.x),x=Math.min(this.x+this.w,e.x+e.w),w=x-y,A=Math.max(this.y,e.y),z=Math.min(this.y+this.h,e.y+e.h),f=z-A,b.push(w*f));for(n=1.7*Math.max.apply(Math,b),p=n/v,n>v&&(p=1),i=Crafty.viewport.width/2,g=Crafty.viewport.height/2,c=this.x+this.w/2-(-1*Crafty.viewport.x+i),d=this.y+this.h/2-(-1*Crafty.viewport.y+g),q=c/i,r=d/g,t=this.glare,k=0,m=t.length;m>k;k++)e=t[k],e.attr({alpha:e.originalAlpha*(1-p)}),e.mirrored?e.attr({x:this.x+this.w/2-e.w/2-2*c*e.res,y:this.y+this.h/2-e.h/2-2*d*e.res}):e.attr({w:5*this.w,h:5*this.h,x:this.x-2*this.w,y:this.y-2*this.h});return h=Crafty.viewport.height-175-Crafty.viewport._y-this.y,u=65-30*(Math.min(Math.max(h,0),200)/200),a=2-2*(Math.min(Math.max(h,0),200)/200),this.attr({blur:a}),this.w=u,this.h=u,Crafty("GoldenStripe").each(function(){return 0>=h?this.attr({alpha:1-Math.min(Math.abs(h),20)/20,h:3}):h>0&&1>h?this.attr({alpha:1,h:3}):60>h?this.attr({alpha:1,h:Math.abs(Math.max(Math.min(h/2,40),3))}):120>h?this.attr({alpha:1-Math.min(Math.abs(h-60),60)/60,h:Math.abs(Math.max(Math.min(h/2,40),1))}):this.attr({alpha:0,h:10})})}})}.call(this),function(){Crafty.c("WaterSplash",{init:function(){return this.requires("2D,Particles,Delay"),this.explosionMode=window.Game.explosionMode,"block"===this.explosionMode?this.requires("WebGL, Color, Tween"):void 0},waterSplash:function(a){var b,c,d;return c={maxParticles:2*a.size,size:a.size/1.5,sizeRandom:4,speed:a.size/20,speedRandom:.2,lifeSpan:a.size/3,lifeSpanRandom:7,angle:350,angleRandom:20,startColour:[40,40,170,1],startColourRandom:[0,0,0,0],endColour:[205,205,205,.1],endColourRandom:[30,30,30,.1],sharpness:10,sharpnessRandom:5,spread:a.size/3,duration:900/Crafty.timer.FPS(),fastMode:!1,gravity:{x:0,y:.25},jitter:0},b=(c.lifeSpan+c.lifeSpanRandom)*Crafty.timer.FPS(),"particles"===this.explosionMode&&(c.fastMode=!0),"block"!==this.explosionMode?this.attr({x:a.x,y:a.y}).particles(c).bind("ParticleEnd",function(){return this.delay(function(){return this.destroy()},b)}):(d=60,this.attr({x:a.x,y:a.y,w:30,h:0}),this.color("#FFFFFF"),this.tween({y:this.y-d,h:this.h+d,alpha:.2},500),this.bind("TweenEnd",function(){return this.destroy()})),this}})}.call(this),function(){Crafty.c("Choreography",{init:function(){return this.bind("GameLoop",this._choreographyTick),this._ctypes={bezier:this._executeBezier,delay:this._executeDelay,linear:this._executeLinear,viewport:this._executeMoveIntoViewport,viewportBezier:this._executeViewportBezier,tween:this._executeTween}},remove:function(){return null!=this._currentPart?(this._currentPart=null,this.trigger("ChoreographyEnd")):void 0},choreography:function(a,b){var c,d;if(null==b&&(b={}),this._options=_.defaults(b,{repeat:0,compensateCameraSpeed:!1,skip:0}),this._options.compensateCameraSpeed&&(this.camera=Crafty(Crafty("ScrollWall")[0]),this._options.cameraLock={x:this.camera.x}),this._choreography=a,this._repeated=0,c=0,this._setupCPart(c),d=b.skip,d>0){for(;d>this._currentPart.duration;)d-=this._currentPart.duration,c+=1,this._setupCPart(c);this._currentPart.easing.tick(d)}return this},synchChoreography:function(a){return this._choreography=_.clone(a._choreography),this._options=a._options,this._repeated=a._repeated,this._currentPart=_.clone(a._currentPart),this._currentPart.x+=this.x-a.x,this._currentPart.y+=this.y-a.y,this._currentPart.easing=_.clone(a._currentPart.easing)},_setupCPart:function(a){var b;if(this._currentPart=null,!(a<this._choreography.length)){if(!(this._repeated<this._options.repeat||-1===this._options.repeats))return void this.trigger("ChoreographyEnd");this._repeated+=1,a=0}return b=this._choreography[a],null!=b.event&&this.trigger(b.event,{entity:this,data:b.data}),this._setupPart(b,a)},_choreographyTick:function(a){var b;if(null!=this._currentPart)return this._currentPart.easing.tick(a.dt),b=this._currentPart.easing.value(),this._ctypes[this._currentPart.type].apply(this,[b]),this._options.compensateCameraSpeed&&(this.x+=this.camera.x-this._options.cameraLock.x),this._currentPart.easing.complete?this._setupCPart(this._currentPart.part+1):void 0},_setupPart:function(a,b){var c,d,e,f,g;if(d=null!=(f=a.easingFn)?f:"linear",this._currentPart=_.extend(_.clone(a),{part:b,x:this.x,y:this.y,dx:a.x,dy:a.y,easing:new Crafty.easing(null!=(g=a.duration)?g:0,d)}),a.properties){c={};for(e in a.properties)c[e]=this[e];return this._currentPart.currentProperties=c}},_executeLinear:function(a){var b,c;return this.x=this._currentPart.x+a*(null!=(b=this._currentPart.dx)?b:0),this.y=this._currentPart.y+a*(null!=(c=this._currentPart.dy)?c:0)},_executeDelay:function(a){},_executeMoveIntoViewport:function(a){var b,c,d,e,f,g,h,i;return d=this._currentPart.dx,d&&(null==(b=this._currentPart).moveOriginX&&(b.moveOriginX=this._currentPart.x+Crafty.viewport.x),f=d-this._currentPart.moveOriginX,h=f*a,null==this.shiftedX&&(this.shiftedX=0),this.shiftedX=Math.max(0,this.shiftedX-.5),this.x=this._currentPart.moveOriginX+h-Crafty.viewport.x+this.shiftedX),e=this._currentPart.dy,e?(null==(c=this._currentPart).moveOriginY&&(c.moveOriginY=this._currentPart.y+Crafty.viewport.y),g=e-this._currentPart.moveOriginY,i=g*a,this.y=this._currentPart.moveOriginY+i-Crafty.viewport.y):void 0},_executeTween:function(a){var b,c,d,e;d=this._currentPart.properties,e=[];for(b in d)c=d[b],e.push(this[b]=(1-a)*this._currentPart.currentProperties[b]+a*c);return e},_executeBezier:function(a){var b,c,d;return b=new Game.BezierPath,null==this._currentPart.bPath&&(d=b.scalePoints(this._currentPart.path,{origin:{x:this.x,y:this.y},scale:{x:Crafty.viewport.width,y:Crafty.viewport.height}}),this._currentPart.bPath=b.buildPathFrom(d)),c=b.pointOnPath(this._currentPart.bPath,a),this._currentPart.rotation&&(this.rotation=b.angleOnPath(this._currentPart.bPath,a)),this.x=c.x,this.y=c.y},_executeViewportBezier:function(a){var b,c,d;return b=new Game.BezierPath,null==this._currentPart.bPath&&(this._currentPart.bPath=b.buildPathFrom(this._currentPart.path)),null==this._currentPart.viewport&&(this._currentPart.viewport={y:Crafty.viewport.y}),this._currentPart.rotation&&(this.rotation=b.angleOnPath(this._currentPart.bPath,a)),d=this._currentPart.viewport.y-Crafty.viewport.y,c=b.pointOnPath(this._currentPart.bPath,a),null==this.shiftedX&&(this.shiftedX=0),this.shiftedX=Math.max(0,this.shiftedX-.5),this.attr({x:c.x+this.shiftedX,y:c.y+d})}})}.call(this),function(){Crafty.c("ColorFade",{colorFade:function(a,b,c){var d,e;return this.bottomColors=b,this.topColors=c,this.duration=a.duration,e=a.skip,this.v=0,this.v+=null!=(d=Math.max(e,0))?d:0,this.bind("GameLoop",this._recolor)},remove:function(){return this.unbind("GameLoop",this._recolor);
},_recolor:function(a){var b,c,d;return this.v+=a.dt,c=this.v/this.duration,0>c&&(c=0),c>=1&&(this.unbind("GameLoop",this._recolor),this.trigger("ColorFadeFinished"),c=1),b=this._buildColor(c,this.bottomColors),d=this._buildColor(c,this.topColors),Crafty.trigger("BackgroundColor",b),Crafty.background(b),this.bottomColor(b),this.topColor(d)},_buildColor:function(a,b){var c,d,e,f,g,h;return f=1/(b.length-1),d=Math.floor(a/f),c=b[d],h=null!=(g=b[d+1])?g:c,e=(a-d*f)/f,this._mix(e,c,h)},_mix:function(a,b,c){var d,e,f,g,h;return e=this._strToColor(b),h=this._strToColor(c),d={r:Math.round(e.r*(1-a)+h.r*a),g:Math.round(e.g*(1-a)+h.g*a),b:Math.round(e.b*(1-a)+h.b*a)},"#"+function(){var a;a=[];for(g in d)f=d[g],a.push(("0"+f.toString(16)).slice(-2));return a}().join("")},_strToColor:function(a){return{r:parseInt(a.slice(1,3),16),g:parseInt(a.slice(3,5),16),b:parseInt(a.slice(5,7),16)}}})}.call(this),function(){Crafty.c("HUD",{init:function(){return this.requires("2D")},positionHud:function(a){var b,c,d;return b=a.x,c=a.y,d=a.z,this.attr({viewportX:b,viewportY:c,viewportZ:d,x:b-Crafty.viewport.x,y:c-Crafty.viewport.y,z:d}),this.hudFloat=Crafty.bind("ViewportMove",function(a){return function(b){return a.attr({x:a.viewportX+b.x,y:a.viewportY+b.y})}}(this)),this},remove:function(){return Crafty.unbind("GameLoop",this.hudFloat)}})}.call(this),function(){Crafty.c("Listener",{init:function(){return this.listeners=[]},remove:function(){var a,b,c,d,e,f,g,h;for(f=this.listeners,h=[],c=0,d=f.length;d>c;c++)g=f[c],e=g.object,b=g.event,a=g.callback,h.push(e.unbind(b,a));return h},listenTo:function(a,b,c,d){var e;return null==d&&(d=this),e=function(){return c.apply(d,arguments)},this.listeners.push({object:a,event:b,callback:e}),a.bind(b,e)}})}.call(this),function(){Crafty.c("ViewportFixed",{init:function(){return this._initialViewport={x:Crafty.viewport.x,y:Crafty.viewport.y},this.motion=Crafty.bind("ViewportScroll",function(a){return function(){var b,c;return b=a._initialViewport.x-Crafty.viewport.x,c=a._initialViewport.y-Crafty.viewport.y,null==a.shiftedX&&(a.shiftedX=0),a.shiftedX=Math.max(0,a.shiftedX-.5),a.attr({x:a.x+b+a.shiftedX,y:a.y+c}),a._initialViewport={x:Crafty.viewport.x,y:Crafty.viewport.y}}}(this))},remove:function(){return Crafty.unbind("ViewportScroll",this.motion)}})}.call(this),function(){Crafty.c("ViewportRelativeMotion",{init:function(){},remove:function(){},viewportRelativeMotion:function(a){var b,c,d,e,f,g,h,i,j;return i=a.x,j=a.y,h=a.speed,b=a.distanceSky,this._distanceSky=b,this._startLocation={x:i,y:j},this._speed=h,this._initialViewport={x:Crafty.viewport.width/4},this._location={sx:i+(i-this._initialViewport.x)*(this._speed-1),sy:j,dx:null!=(e=this.dx)?e:0,dy:null!=(f=this.dy)?f:0},g=(this._initialViewport.x-Crafty.viewport._x)*(this._speed-1),c=this._location.sx-g+this._location.dx,d=this._location.sy-Crafty.viewport._y*(1-this._speed)+this._location.dy,this._location.x=c,this._location.y=d,this.attr(this._location),this.motion=Crafty.bind("ViewportScroll",function(a){return function(){return g=(a._initialViewport.x-Crafty.viewport._x)*(a._speed-1),c=a._location.sx-g+a.dx,d=a._distanceSky?a._location.sy-Crafty.viewport._y*(1-a._speed)+a.dy:a._location.sy-Crafty.viewport._y*(1-1.2*(a._speed-.225))+a.dy,a.attr({x:c,y:d})}}(this)),this},remove:function(){return Crafty.unbind("ViewportScroll",this.motion)}})}.call(this),function(){Crafty.c("ControlScheme",{init:function(){return this.trigger("Activated"),Crafty.trigger("PlayerActivated")},remove:function(){return this.trigger("Deactivated"),Crafty.trigger("PlayerDeactivated")}})}.call(this),function(){Crafty.c("Player",{init:function(){return this.reset()},reset:function(){return this.softReset(),this.removeComponent("ControlScheme")},softReset:function(){return this.stats={shotsFired:0,shotsHit:0,enemiesKilled:0,bonus:0},this.attr({lives:2,points:0})},loseLife:function(){return this.lives>0?(this.lives-=1,this.trigger("UpdateLives",{lives:this.lives}),this.lives<=0?Crafty.trigger("PlayerDied",this):void 0):void 0},addPoints:function(a){return this.lives>0?(this.points+=a,this.trigger("UpdatePoints",{points:this.points})):void 0}})}.call(this),function(){Crafty.c("PlayerAssignable",{init:function(){return this._attachControllerAssignTrigger(),this.preferredPlayer=null},_assignControls:function(){var a;return a=this._preferredplayer()||this._firstUnassignedPlayer(),null==a?void this._attachControllerAssignTrigger():(this.preferredPlayer=a.getId(),this.setupControls(a),a.one("Deactivated",function(a){return function(){return a._attachControllerAssignTrigger()}}(this)))},_attachControllerAssignTrigger:function(){return this.one("Fire",this._assignControls)},_preferredplayer:function(a){var b;return null===this.preferredPlayer||(b=Crafty(this.preferredPlayer),b.has("ControlScheme"))?void 0:b},_firstUnassignedPlayer:function(){var a,b,c,d,e;for(e=Crafty("Player"),a=0,b=e.length;b>a;a++)if(d=e[a],c=Crafty(d),!c.has("ControlScheme"))return c}})}.call(this),function(){Crafty.c("PlayerControlledShip",{init:function(){return this.requires("2D, WebGL, Color, Collision, Listener, SunBlock"),this.attr({w:30,h:30}),this.bind("Moved",function(a){var b;return this.hit("Edge")||this.hit("Solid")?(b={},b[a.axis]=a.oldValue,this.attr(b)):void 0}),this._forcedSpeed={x:0,y:0},this.primaryWeapon=void 0,this.primaryWeapons=[],this.secondaryWeapon=void 0,this.superUsed=0,this.weaponsEnabled=!0},start:function(){return this.addComponent("Invincible").invincibleDuration(2e3),this.onHit("Enemy",function(a){var b,c,d,e;if(!Game.paused&&!this.has("Invincible")){for(c=!1,d=0,e=a.length;e>d;d++)b=a[d],b.obj.hidden||(c=!0);return c?this.trigger("Hit"):void 0}}),this.onHit("PowerUp",function(a){var b,c,d,e;if(!Game.paused){for(e=[],b=0,c=a.length;c>b;b++)d=a[b],this.pickUp(d.obj),e.push(this.trigger("PowerUp",d.obj));return e}}),this.bind("GameLoop",function(a){var b,c;return b=this._forcedSpeed.x/1e3*a.dt,c=this._forcedSpeed.y/1e3*a.dt,this.x+=b,this.y+=c,(this.hit("Edge")||this.hit("Solid"))&&(this.x-=b,this.y-=c),this.hit("Edge")||this.hit("Solid")?this.trigger("Hit"):void 0}),this},forcedSpeed:function(a){return null!=a.x&&null!=a.y?(this._forcedSpeed.x=a.x,this._forcedSpeed.y=a.y):(this._forcedSpeed.x=a,this._forcedSpeed.y=0),this},shoot:function(a){return this.weaponsEnabled?(null!=this.primaryWeapon&&this.primaryWeapon.shoot(a),null!=this.secondaryWeapon?this.secondaryWeapon.shoot(a):void 0):void 0},switchWeapon:function(a){var b,c;if(a)return b=(this.currentPrimary+1)%this.primaryWeapons.length,null!=(c=this.primaryWeapon)&&c.uninstall(),this.primaryWeapon=this.primaryWeapons[b],this.primaryWeapon.install(this),this.currentPrimary=b},superWeapon:function(a){return a?this.superUsed+=1:void 0},pickUp:function(a){var b;return b=a.settings.contains,this.installItem(b)?a.destroy():void 0},installItem:function(a){if("xp"===a)return this.primaryWeapon.addXP(1e3),!0;if(!this.hasItem(a))return this.items.push(a),"lasers"===a?(this._installPrimary("RapidWeaponLaser"),!0):"oldlasers"===a?(this._installPrimary("OldWeaponLaser"),!0):"diagonals"===a?(this._installPrimary("RapidDiagonalLaser"),!0):void 0},_installPrimary:function(a){var b,c;return c=Crafty.e(a),c.install(this),null!=(b=this.primaryWeapon)&&b.uninstall(),this.primaryWeapon=c,this.listenTo(c,"levelUp",function(a){return function(b){return a.scoreText("L +"+b)}}(this)),this.primaryWeapons.push(c),this.currentPrimary=this.primaryWeapons.length-1},hasItem:function(a){return null==this.items&&(this.items=[]),~this.items.indexOf(a)},scoreText:function(a){return Crafty.e("Text, DOM, 2D, Tween").textColor("#FFFFFF").text(a).attr({x:this.x,y:this.y-10,z:990,w:100}).textFont({size:"10px",weight:"bold",family:"Press Start 2P"}).tween({y:this.y-40,alpha:.5},1e3).one("TweenEnd",function(){return this.destroy()})}})}.call(this),function(){Crafty.c("PlayerInfo",{init:function(){return this.requires("2D, Listener")},playerInfo:function(a,b){return this.player=b,this.score=Crafty.e("2D, DOM, Text, HUD").attr({w:220,h:20}).positionHud({x:a,y:10,z:2}).textFont({size:"10px",family:"Press Start 2P"}),this.player.has("Color")&&this.score.textColor(this.player.color()),this.lives=Crafty.e("2D, DOM, Text, HUD").attr({w:220,h:20}).positionHud({x:a,y:30,z:2}).textFont({size:"10px",family:"Press Start 2P"}),this.player.has("Color")&&this.lives.textColor(b.color()),this.updatePlayerInfo(),this.listenTo(b,"UpdateLives",this.updatePlayerInfo),this.listenTo(b,"UpdatePoints",this.updatePlayerInfo),this.listenTo(b,"Activated",function(a){return function(){return a.updatePlayerInfo()}}(this)),this.listenTo(b,"Deactivated",function(a){return function(){return a.updatePlayerInfo()}}(this)),this},updatePlayerInfo:function(){return this.player.has("ControlScheme")?this.score.text("Score: "+this.player.points):this.score.text(this.player.name),this.player.has("ControlScheme")?0===this.player.lives?this.lives.text("Game Over"):this.lives.text("Lives: "+this.player.lives):this.lives.text("Press fire to start!")}})}.call(this),function(){var a,b,c;c="attribute vec2 aPosition;\nattribute vec3 aOrientation;\nattribute vec2 aLayer;\nattribute vec4 aColor;\nattribute vec4 aDesaturation;\nattribute vec2 aGradient;\n\nvarying lowp vec4 vColor;\nvarying lowp vec4 vDesaturation;\nvarying lowp vec2 vGradient;\nvarying lowp vec2 vLayer;\nuniform  vec4 uViewport;\n\nmat4 viewportScale = mat4(2.0 / uViewport.z, 0, 0, 0,    0, -2.0 / uViewport.w, 0,0,    0, 0,1,0,    -1,+1,0,1);\nvec4 viewportTranslation = vec4(uViewport.xy, 0, 0);\n\nvoid main() {\n  vec2 pos = aPosition;\n  vec2 entityOrigin = aOrientation.xy;\n  mat2 entityRotationMatrix = mat2(cos(aOrientation.z), sin(aOrientation.z), -sin(aOrientation.z), cos(aOrientation.z));\n\n  pos = entityRotationMatrix * (pos - entityOrigin) + entityOrigin;\n  gl_Position = viewportScale * (viewportTranslation + vec4(pos, 1.0/(1.0+exp(aLayer.x) ), 1) );\n\n  vColor = aColor;\n  vDesaturation = aDesaturation;\n  vGradient = aGradient;\n  vLayer = aLayer;\n}",b="precision mediump float;\nvarying lowp vec4 vColor;\nvarying lowp vec2 vGradient;\nvarying lowp vec4 vDesaturation;\nvarying lowp vec2 vLayer;\nvoid main(void) {\n\n  //gl_FragColor = vec4(vColor.rgb*vColor.a*vLayer.y, vColor.a*vLayer.y);\n\n  mediump float mixFactor = vGradient.x;\n\n  mediump float lightness = (0.2126*vColor.r + 0.7152*vColor.g + 0.0722*vColor.b);\n  mediump float lightnessBase = (0.2126*vDesaturation.r + 0.7152*vDesaturation.g + 0.0722*vDesaturation.b);\n  mediump vec4 baseColor = vec4(vDesaturation.rgb, vColor.a) * (1.0 + (lightness - lightnessBase));\n  mediump vec4 mixColor = vec4(\n    (baseColor.rgba * mixFactor) + (vColor.rgba * (1.0 - mixFactor))\n  );\n\n  gl_FragColor = vec4(\n    mixColor.rgb * vColor.a * vLayer.y,\n    vColor.a * vLayer.y\n  );\n}",a=[{name:"aPosition",width:2},{name:"aOrientation",width:3},{name:"aLayer",width:2},{name:"aColor",width:4},{name:"aDesaturation",width:4},{name:"aGradient",width:2}],Crafty.defaultShader("Color",new Crafty.WebGLShader(c,b,a,function(a,b){var c,d,e,f,g,h,i,j;return d=null!=(e=b.desaturationColor)?e:{_red:0,_green:0,_blue:0},a.program.writeVector("aDesaturation",d._red/255,d._green/255,d._blue/255,1),a.program.writeVector("aColor",b._red/255,b._green/255,b._blue/255,b._strength),i=null!=(f=b.scale)?f:1,j=null!=(g=b.topDesaturation)?g:0,c=null!=(h=b.bottomDesaturation)?h:0,a.program.writeVector("aGradient",j+1.15*(1-i),c+1.15*(1-i))})),Crafty.c("ColorEffects",{colorDesaturation:function(a){var b;return null==a?this:(b={},Crafty.assignColor(a,b),this.attr({desaturationColor:b}),this.trigger("Invalidate"),this)},saturationGradient:function(a,b){return this.attr({topDesaturation:a,bottomDesaturation:b}),this}})}.call(this),function(){var a,b,c,d=[].slice;c="attribute vec2 aPosition;\nattribute vec3 aOrientation;\nattribute vec2 aLayer;\nattribute vec4 aColor;\n\nvarying lowp vec4 vColor;\nvarying lowp vec2 vLayer;\nuniform  vec4 uViewport;\n\nmat4 viewportScale = mat4(2.0 / uViewport.z, 0, 0, 0,    0, -2.0 / uViewport.w, 0,0,    0, 0,1,0,    -1,+1,0,1);\nvec4 viewportTranslation = vec4(uViewport.xy, 0, 0);\n\nvoid main() {\n  vec2 pos = aPosition;\n  vec2 entityOrigin = aOrientation.xy;\n  mat2 entityRotationMatrix = mat2(cos(aOrientation.z), sin(aOrientation.z), -sin(aOrientation.z), cos(aOrientation.z));\n\n  pos = entityRotationMatrix * (pos - entityOrigin) + entityOrigin;\n  gl_Position = viewportScale * (viewportTranslation + vec4(pos, 1.0/(1.0+exp(aLayer.x) ), 1) );\n\n  vColor = aColor;\n  vLayer = aLayer;\n}",b="precision mediump float;\nvarying lowp vec4 vColor;\nvarying lowp vec2 vLayer;\nvoid main(void) {\n  gl_FragColor = vec4(vColor.rgb*vColor.a*vLayer.y, vColor.a*vLayer.y);\n}",a=[{name:"aPosition",width:2},{name:"aOrientation",width:3},{name:"aLayer",width:2},{name:"aColor",width:4}],Crafty.extend({defaultGradientShader:function(d){return 0===arguments.length?(void 0===this._defaultGradientShader&&(this._defaultGradientShader=new Crafty.WebGLShader(c,b,a,function(a){})),this._defaultGradientShader):this._defaultGradientShader=d}}),Crafty.c("Gradient",{init:function(){return this._topColor={_red:0,_green:0,_blue:0,_strength:1},this._bottomColor={_red:0,_green:0,_blue:0,_strength:1},this.ready=!0,this.bind("Draw",this._drawGradient),this.has("WebGL")&&this._establishShader("Gradient",Crafty.defaultGradientShader()),this.trigger("Invalidate")},remove:function(){return this.unbind("Draw",this._drawGradient),this.has("DOM")&&(this._element.style.backgroundColor="transparent"),this.trigger("Invalidate")},_drawGradient:function(a){return"webgl"===a.type?a.program.writeVector("aColor",this._topColor._red/255,this._topColor._green/255,this._topColor._blue/255,this._topColor._strength,this._bottomColor._red/255,this._bottomColor._green/255,this._bottomColor._blue/255,this._bottomColor._strength):void 0},topColor:function(a){return 0===arguments.length?this._topColor:this._setColor.apply(this,[this._topColor].concat(d.call(arguments)))},bottomColor:function(a){return 0===arguments.length?this._bottomColor:this._setColor.apply(this,[this._bottomColor].concat(d.call(arguments)))},_setColor:function(a,b){return arguments.length>=4?(a._red=arguments[1],a._green=arguments[2],a._blue=arguments[3],"number"==typeof arguments[4]&&(a._strength=arguments[4])):(Crafty.assignColor(b,a),"number"==typeof arguments[2]&&(a._strength=arguments[2])),this.trigger("Invalidate"),this}})}.call(this),function(){var a,b,c;c="attribute vec2 aPosition;\nattribute vec3 aOrientation;\nattribute vec2 aLayer;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute vec2 aGradient;\n\nvarying mediump vec3 vTextureCoord;\nvarying lowp vec4 vColor;\nvarying lowp vec2 vGradient;\nvarying lowp float vMix;\n\nuniform vec4 uViewport;\nuniform mediump vec2 uTextureDimensions;\n\nmat4 viewportScale = mat4(2.0 / uViewport.z, 0, 0, 0,    0, -2.0 / uViewport.w, 0,0,    0, 0,1,0,    -1,+1,0,1);\nvec4 viewportTranslation = vec4(uViewport.xy, 0, 0);\n\nvoid main() {\n  vec2 pos = aPosition;\n  vec2 entityOrigin = aOrientation.xy;\n  mat2 entityRotationMatrix = mat2(cos(aOrientation.z), sin(aOrientation.z), -sin(aOrientation.z), cos(aOrientation.z));\n\n  pos = entityRotationMatrix * (pos - entityOrigin) + entityOrigin ;\n  gl_Position = viewportScale * (viewportTranslation + vec4(pos, 1.0/(1.0+exp(aLayer.x) ), 1) );\n  vTextureCoord = vec3(aTextureCoord, aLayer.y);\n  vColor = aColor;\n  vGradient = aGradient;\n}",b="precision mediump float;\nvarying mediump vec3 vTextureCoord;\nvarying mediump vec4 vColor;\nvarying mediump vec2 vGradient;\n\nuniform sampler2D uSampler;\nuniform mediump vec2 uTextureDimensions;\n\nvoid main(void) {\n  highp vec2 coord = vTextureCoord.xy / uTextureDimensions;\n  mediump vec4 texelColor = texture2D(uSampler, coord);\n\n  mediump float mixFactor = (vGradient.x * (1.0 - coord.y)) + (vGradient.y * coord.y);\n\n  mediump float lightness = (0.2126*texelColor.r + 0.7152*texelColor.g + 0.0722*texelColor.b);\n  mediump float lightnessBase = (0.2126*vColor.r + 0.7152*vColor.g + 0.0722*vColor.b);\n  mediump vec4 baseColor = vec4(vColor.rgb, texelColor.a) * (1.0 + (lightness - lightnessBase));\n  mediump vec4 mixColor = vec4(\n    (baseColor.rgba * mixFactor) + (texelColor.rgba * (1.0 - mixFactor))\n  );\n\n  gl_FragColor = vec4(\n    mixColor.rgb * texelColor.a * vTextureCoord.z,\n    texelColor.a * vTextureCoord.z\n  );\n}",a=[{name:"aPosition",width:2},{name:"aOrientation",width:3},{name:"aLayer",width:2},{name:"aTextureCoord",width:2},{name:"aColor",width:4},{name:"aGradient",width:2}],Crafty.extend({defaultImageWithEffectsShader:function(d){return 0===arguments.length?(void 0===this._defaultImageEffectsShader&&(this._defaultImageEffectsShader=new Crafty.WebGLShader(c,b,a,function(a){})),this._defaultImageEffectsShader):this._defaultImageEffectsShader=d}}),Crafty.c("ImageWithEffects",{_repeat:"repeat",ready:!1,init:function(){return this.bind("Draw",this._drawImage),this._red=0,this._green=0,this._blue=0,this._strength=0,this._strength2=0},remove:function(){return this.unbind("Draw",this._drawImage)},saturationGradient:function(a,b){return this._strength=a,this._strength2=b,this},colorDesaturation:function(a){return null==a?this:(arguments.length>=3?(this._red=arguments[0],this._green=arguments[1],this._blue=arguments[2],"number"==typeof arguments[3]&&(this._strength=arguments[3]),"number"==typeof arguments[4]&&(this._strength2=arguments[4])):(Crafty.assignColor(a,this),"number"==typeof arguments[1]&&(this._strength=arguments[1]),"number"==typeof arguments[2]&&(this._strength2=arguments[2])),this.trigger("Invalidate"),this)},image:function(a,b){return this.__image=a,this._repeat=b||"no-repeat",this.img=Crafty.asset(a),this.img?(this._onImageLoad(),this.trigger("Invalidate")):(this.img=new Image,Crafty.asset(a,this.img),this.img.src=a,this.img.onload=function(a){return function(){return a._onImageLoad()}}(this)),this},_onImageLoad:function(){return this.has("WebGL")&&(this._establishShader("imageFx:"+this.__image,Crafty.defaultImageWithEffectsShader()),this.program.setTexture(this.webgl.makeTexture(this.__image,this.img,"no-repeat"!==this._repeat))),"no-repeat"===this._repeat&&(this.w=this.w||this.img.width,this.h=this.h||this.img.height),this.ready=!0,this.trigger("Invalidate")},_drawImage:function(a){var b;return"webgl"===a.type?(b=a.pos,a.program.writeVector("aTextureCoord",0,0,0,b._h,b._w,0,b._w,b._h),a.program.writeVector("aColor",this._red/255,this._green/255,this._blue/255,1),a.program.writeVector("aGradient",this._strength,this._strength2)):void 0}})}.call(this),function(){var a,b,c;c="attribute vec2 aPosition;\nattribute vec3 aOrientation;\nattribute vec2 aLayer;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute vec3 aGradient;\n\nvarying mediump vec3 vTextureCoord;\nvarying lowp vec4 vColor;\nvarying lowp vec3 vGradient;\n\nuniform vec4 uViewport;\nuniform mediump vec2 uTextureDimensions;\n\nmat4 viewportScale = mat4(2.0 / uViewport.z, 0, 0, 0,    0, -2.0 / uViewport.w, 0,0,    0, 0,1,0,    -1,+1,0,1);\nvec4 viewportTranslation = vec4(uViewport.xy, 0, 0);\n\nvoid main() {\n  vec2 pos = aPosition;\n  vec2 entityOrigin = aOrientation.xy;\n  mat2 entityRotationMatrix = mat2(cos(aOrientation.z), sin(aOrientation.z), -sin(aOrientation.z), cos(aOrientation.z));\n\n  pos = entityRotationMatrix * (pos - entityOrigin) + entityOrigin ;\n  gl_Position = viewportScale * (viewportTranslation + vec4(pos, 1.0/(1.0+exp(aLayer.x) ), 1) );\n  vTextureCoord = vec3(aTextureCoord, aLayer.y);\n  vColor = aColor;\n  vGradient = aGradient;\n}",b="precision mediump float;\nvarying mediump vec3 vTextureCoord;\nvarying mediump vec4 vColor;\nvarying mediump vec3 vGradient;\n\nuniform sampler2D uSampler;\nuniform mediump vec2 uTextureDimensions;\n\nfloat random(vec3 scale, float seed) {\n  // use the fragment position for a different seed per-pixel\n  return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n}\n\nvoid main() {\n  highp vec2 coord =   vTextureCoord.xy / uTextureDimensions;\n  float blur = vGradient.z;\n\n  mediump vec4 texelColor = texture2D(uSampler, coord);\n\n  if (blur > 0.0) {\n    vec4 color = vec4(0.0);\n    float total = 0.0;\n\n    // randomize the lookup values to hide the fixed number of samples\n    float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n\n    for (float t = -30.0; t <= 30.0; t++) {\n      float percent = (t + offset - 0.5) / 30.0;\n      float weight = 1.0 - abs(percent);\n      vec4 sample = texture2D(uSampler, coord + (blur * percent) / uTextureDimensions);\n      // switch to pre-multiplied alpha to correctly blur transparent images\n      sample.rgb *= sample.a;\n\n      color += sample * weight;\n      total += weight;\n    }\n\n    texelColor = color / total;\n    texelColor.rgb /= texelColor.a + 0.00001;\n  }\n\n  mediump float mixFactor = (vGradient.x * (1.0 - coord.y)) + (vGradient.y * coord.y);\n\n  mediump float lightness = (0.2126*texelColor.r + 0.7152*texelColor.g + 0.0722*texelColor.b);\n  mediump float lightnessBase = (0.2126*vColor.r + 0.7152*vColor.g + 0.0722*vColor.b);\n  mediump vec4 baseColor = vec4(vColor.rgb, texelColor.a) * (1.0 + (lightness - lightnessBase));\n  mediump vec4 mixColor = vec4(\n    (baseColor.rgba * mixFactor) + (texelColor.rgba * (1.0 - mixFactor))\n  );\n\n  if (vColor.a > 1.0) {\n    mixColor.rgb = vColor.rgb;\n  }\n\n  gl_FragColor = vec4(\n    mixColor.rgb * vColor.a * texelColor.a * vTextureCoord.z,\n    texelColor.a * vTextureCoord.z\n  );\n}",a=[{name:"aPosition",width:2},{name:"aOrientation",width:3},{name:"aLayer",width:2},{name:"aTextureCoord",width:2},{name:"aColor",width:4},{name:"aGradient",width:3}],Crafty.defaultShader("Sprite",new Crafty.WebGLShader(c,b,a,function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;return f=a.co,a.program.writeVector("aTextureCoord",f.x,f.y,f.x,f.y+f.h,f.x+f.w,f.y,f.x+f.w,f.y+f.h),g=null!=(i=b.desaturationColor)?i:{_red:0,_green:0,_blue:0},h=null!=(j=b.lightness)?j:1,o=null!=(k=b.scale)?k:1,d=null!=(l=b.blur)?l:0,p=null!=(m=b.topDesaturation)?m:0,c=null!=(n=b.bottomDesaturation)?n:0,q=p+1.15*(1-o),e=c+1.15*(1-o),b.hitFlash&&(g=b.hitFlash,q=3,e=3),a.program.writeVector("aColor",g._red/255,g._green/255,g._blue/255,h),a.program.writeVector("aGradient",q,e,d)}))}.call(this),function(){Crafty.c("Bullet",{init:function(){return this.requires("2D, WebGL, Color, Collision"),this.color("#FFFF00")},fire:function(a){return this.attr({damage:a.damage}).bind("GameLoop",function(b){return function(c){var d;return d=c.dt*(a.speed/1e3),b.x+=Math.cos(a.direction/180*Math.PI)*d,b.y+=Math.sin(a.direction/180*Math.PI)*d,b.x>b._maxXforViewPort()?b.destroy():void 0}}(this)).onHit("Solid",function(){return Game.paused?void 0:this.destroy()}),this},_maxXforViewPort:function(){var a;return a=-Crafty.viewport._x+Crafty.viewport._width/Crafty.viewport._scale,a+10}})}.call(this),function(){Crafty.c("MiniRocket",{init:function(){return this.requires("2D, WebGL, Color, Collision"),this.color("#FF0000")},fire:function(a){var b;return null==a&&(a={}),this.attr(_.defaults(a,{w:35,h:10})),this.bind("GameLoop",function(a){return function(b){return a.x+=a.speed/1e3*b.dt,a.x>a._maxXforViewPort()?a.destroy():void 0}}(this)).onHit("Solid",this._impact).onHit("Enemy",this._impact),b={maxParticles:100,size:5,sizeRandom:4,speed:2,speedRandom:.25,lifeSpan:13,lifeSpanRandom:5,angle:-90,angleRandom:10,startColour:[235,135,5,1],startColourRandom:[28,150,45,.2],endColour:[135,135,135,0],endColourRandom:[60,60,60,.1],sharpness:10,sharpnessRandom:10,spread:3,duration:-1,fastMode:!1,gravity:{x:0,y:-.12},jitter:0},this.attach(Crafty.e("2D,Particles").attr({x:this.x,y:this.y}).particles(b)),this},_impact:function(){return Game.paused?void 0:(Crafty.e("Explosion").explode({x:this.x+this.w,y:this.y+this.h/2,radius:this.radius,damage:this.damage}),this.destroy())},_maxXforViewPort:function(){var a;return a=-Crafty.viewport._x+Crafty.viewport._width/Crafty.viewport._scale,a+700}})}.call(this),function(){Crafty.c("OldWeaponLaser",{init:function(){return this.requires("2D,WebGL,Color"),this.color("#808080"),this.attr({w:30,h:5})},remove:function(){},install:function(a){return this.ship=a,this.xp=0,this.level=this.determineLevel(this.xp),this.attr({x:this.ship.x+10,y:this.ship.y+15,z:this.ship.z+1,alpha:0}),this.ship.attach(this)},addXP:function(a){var b;return this.xp+=a,b=this.level,this.level=this.determineLevel(this.xp),b!==this.level?this.trigger("levelUp",this.level):void 0},determineLevel:function(a){var b,c,d,e,f,g,h,i;for(f=[150,400,1e3,2500],g=0,e=0,c=0,d=f.length;d>c;c++)b=f[c],g+=b,a>=g&&(e+=1);return h=(a-(null!=(i=f[e-1])?i:0))/f[e],e},shoot:function(a){var b;if(a)return b=function(){switch(this.level){case 0:return{w:3,speed:250,h:3};case 1:return{w:4,speed:300,h:2};case 2:return{w:6,speed:300,h:2};case 3:return{w:8,speed:300,h:5};case 4:return{w:10,speed:300,h:6}}}.call(this),Crafty.e("Bullet").attr({x:this.x+this.w,y:this.y+this.h/2-b.h/2,w:b.w,h:b.h}).fire({origin:this,damage:100,speed:this.ship._forcedSpeed.x+b.speed,direction:0}).bind("HitTarget",function(a){return function(){return a.addXP(1),a.ship.trigger("BulletHit")}}(this)).bind("DestroyTarget",function(a){return function(){return a.addXP(5),a.ship.trigger("BulletDestroyedTarget")}}(this))}})}.call(this),function(){Crafty.c("RapidDiagonalLaser",{init:function(){return this.requires("2D,WebGL,Color"),this.color("#d08080"),this.attr({w:30,h:5}),this.xp=0,this.lastShot=0,this.shotsFired=0,this.burstCount=1/0,this.frontFire=!0},remove:function(){return this.unbind("GameLoop",this._autoFire)},install:function(a){return this.ship=a,this.level=this.determineLevel(this.xp),this.attr({x:this.ship.x+10,y:this.ship.y+15,z:this.ship.z+1,alpha:1}),this.ship.attach(this),this.shooting=!1,this._determineCooldown(),this.bind("GameLoop",this._autoFire)},uninstall:function(){return this.attr({alpha:0}),this.unbind("GameLoop",this._autoFire)},addXP:function(a){var b;return this.xp+=a,b=this.level,this.level=this.determineLevel(this.xp),b!==this.level?(this._determineCooldown(),this.trigger("levelUp",this.level)):void 0},_determineCooldown:function(){return this.cooldown=function(){switch(this.level){case 0:return 200;case 1:return 150;case 2:return 75;case 3:return 75}}.call(this)},determineLevel:function(a){var b,c,d,e,f,g,h,i;for(f=[1500,6e3,24e3,96e3],g=0,e=0,c=0,d=f.length;d>c;c++)b=f[c],g+=b,a>=g&&(e+=1);return h=(a-(null!=(i=f[e-1])?i:0))/f[e],e},shoot:function(a){return a?this.shooting=!0:(this.shooting=!1,this.shotsFired=0,this.lastShot=500)},_autoFire:function(a){var b,c,d,e;return this.lastShot+=a.dt,this.shooting&&(b=this.shotsFired<this.burstCount,this.ship.weaponsEnabled&&b)&&this.lastShot>this.cooldown?(c=function(){switch(this.level){case 0:return 5;case 1:return 7;case 2:return 12;case 3:return 12}}.call(this),e=this.shotsFired%2===0?1:-1,d=1.5*Math.random(),this._createAngleBullet(0+d*e),d=1.5*Math.random(),this._createAngleBullet(c+d*e),d=1.5*Math.random(),this._createAngleBullet(-c+d*e),this.frontFire=!this.frontFire,this.lastShot=0,this.shotsFired+=1):void 0},_createAngleBullet:function(a){var b;return b=function(){switch(this.level){case 0:return{w:5,speed:550,h:5};case 1:return{w:6,speed:555,h:5};case 2:return{w:8,speed:560,h:5};case 3:return{w:10,speed:565,h:5}}}.call(this),Crafty.e("Bullet").attr({x:this.x+this.w,y:this.y+this.h/2-b.h/2+1,w:b.w,h:b.h,rotation:a}).fire({origin:this,damage:100,speed:this.ship._forcedSpeed.x+b.speed,direction:a}).bind("HitTarget",function(a){return function(b){return a.addXP(1),a.ship.trigger("BulletHit",b)}}(this)).bind("DestroyTarget",function(a){return function(b){return a.addXP(5),a.ship.trigger("BulletDestroyedTarget",b)}}(this))}})}.call(this),function(){Crafty.c("RapidWeaponLaser",{init:function(){return this.requires("2D,WebGL,Color"),this.color("#808080"),this.attr({w:30,h:5}),this.xp=0,this.lastShot=0,this.shotsFired=0,this.burstCount=1/0,this.frontFire=!0},remove:function(){return this.unbind("GameLoop",this._autoFire)},install:function(a){return this.ship=a,this.level=this.determineLevel(this.xp),this.attr({x:this.ship.x+10,y:this.ship.y+15,z:this.ship.z+1,alpha:1}),this.ship.attach(this),this.shooting=!1,this._determineCooldown(),this.bind("GameLoop",this._autoFire)},uninstall:function(){return this.attr({alpha:0}),this.unbind("GameLoop",this._autoFire)},addXP:function(a){var b;return this.xp+=a,b=this.level,this.level=this.determineLevel(this.xp),b!==this.level?(this._determineCooldown(),this.trigger("levelUp",this.level)):void 0},_determineCooldown:function(){return this.cooldown=function(){switch(this.level){case 0:return 135;case 1:return 110;case 2:return 95;case 3:return 75}}.call(this)},determineLevel:function(a){var b,c,d,e,f,g,h,i;for(f=[1500,6e3,24e3,96e3],g=0,e=0,c=0,d=f.length;d>c;c++)b=f[c],g+=b,a>=g&&(e+=1);return h=(a-(null!=(i=f[e-1])?i:0))/f[e],e},shoot:function(a){return a?this.shooting=!0:(this.shooting=!1,this.shotsFired=0,this.lastShot=500)},_autoFire:function(a){var b;return this.lastShot+=a.dt,this.shooting&&(b=this.shotsFired<this.burstCount,this.ship.weaponsEnabled&&b)&&this.lastShot>this.cooldown?(this.frontFire?this._createFrontBullet():this._createBackBullet(),this.frontFire=!this.frontFire,this.lastShot=0,this.shotsFired+=1):void 0},_createFrontBullet:function(){var a;return a=function(){switch(this.level){case 0:return{w:6,speed:650,h:4,o:0};case 1:return{w:10,speed:655,h:5,o:1};case 2:return{w:14,speed:660,h:6,o:2};case 3:return{w:18,speed:665,h:6,o:3}}}.call(this),Crafty.e("Bullet").attr({x:this.x+this.w,y:this.y+this.h/2-a.h/2+1+a.o,w:a.w,h:a.h}).fire({origin:this,damage:100,speed:this.ship._forcedSpeed.x+a.speed,direction:0}).bind("HitTarget",function(a){return function(b){return a.addXP(1),a.ship.trigger("BulletHit",b)}}(this)).bind("DestroyTarget",function(a){return function(b){return a.addXP(5),a.ship.trigger("BulletDestroyedTarget",b)}}(this))},_createBackBullet:function(){var a;return a=function(){switch(this.level){case 0:return{w:5,speed:650,h:3,o:0};case 1:return{w:8,speed:655,h:4,o:1};case 2:return{w:10,speed:660,h:5,o:2};case 3:return{w:14,speed:665,h:5,o:3}}}.call(this),Crafty.e("Bullet").attr({x:this.x+this.w,y:this.y+this.h/2-a.h/2-2-a.o,w:a.w,h:a.h}).fire({origin:this,damage:100,speed:this.ship._forcedSpeed.x+a.speed,direction:0}).bind("HitTarget",function(a){return function(b){return a.addXP(1),a.ship.trigger("BulletHit",b)}}(this)).bind("DestroyTarget",function(a){return function(b){return a.addXP(5),a.ship.trigger("BulletDestroyedTarget",b)}}(this))}})}.call(this),function(){Crafty.c("WeaponLaser",{init:function(){return this.requires("2D,WebGL,Color"),this.color("#808080"),this.attr({w:30,h:5})},remove:function(){},install:function(a){return this.ship=a,this.xp=0,this.level=this.determineLevel(this.xp),this.attr({x:this.ship.x+10,y:this.ship.y+15,z:this.ship.z+1}),this.ship.attach(this)},addXP:function(a){var b;return this.xp+=a,b=this.level,this.level=this.determineLevel(this.xp),b!==this.level?this.trigger("levelUp",this.level):void 0},determineLevel:function(a){var b,c,d,e,f,g,h,i;for(f=[150,600,2400,9600],g=0,e=0,c=0,d=f.length;d>c;c++)b=f[c],g+=b,a>=g&&(e+=1);return h=(a-(null!=(i=f[e-1])?i:0))/f[e],e},shoot:function(a){var b;if(a)return b=function(){switch(this.level){case 0:return{w:6,speed:350,h:3};case 1:return{w:10,speed:355,h:4};case 2:return{w:14,speed:360,h:5};case 3:return{w:18,speed:365,h:5}}}.call(this),Crafty.e("Bullet").attr({x:this.x+this.w,y:this.y+this.h/2-b.h/2,w:b.w,h:b.h}).fire({origin:this,damage:100,speed:this.ship._forcedSpeed.x+b.speed,direction:0}).bind("HitTarget",function(a){return function(){return a.addXP(1),a.ship.trigger("BulletHit")}}(this)).bind("DestroyTarget",function(a){return function(){return a.addXP(5),a.ship.trigger("BulletDestroyedTarget")}}(this))}})}.call(this),function(){Crafty.c("WeaponRocket",{init:function(){return this.requires("2D,WebGL,Color"),this.color("#404040"),this.attr({w:30,
h:8})},remove:function(){return this.unbind("GameLoop",this._coolDown)},install:function(a){return this.ship=a,this.xp=0,this.level=this.determineLevel(this.xp),this.attr({x:this.ship.x+5,y:this.ship.y+25,z:this.ship.z+1}),this.ship.attach(this),this.heat=0,this.bind("GameLoop",this._coolDown)},_coolDown:function(a){return this.heat-=a.dt,this.heat<0?this.heat=0:void 0},addXP:function(a){var b;return this.xp+=a,b=this.level,this.level=this.determineLevel(this.xp),b!==this.level?this.trigger("levelUp",this.level):void 0},determineLevel:function(a){var b,c,d,e,f,g,h,i;for(f=[150,400,1e3,2500],g=0,e=0,c=0,d=f.length;d>c;c++)b=f[c],g+=b,a>=g&&(e+=1);return h=(a-(null!=(i=f[e-1])?i:0))/f[e],e},shoot:function(a){var b;if(a&&!(this.heat>0))return this.heat=2e3,b=function(){switch(this.level){case 0:return{w:4,speed:350,h:3};case 1:return{w:6,speed:350,h:4};case 2:return{w:8,speed:350,h:5};case 3:return{w:10,speed:350,h:5};case 4:return{w:12,speed:350,h:6}}}.call(this),Crafty.e("MiniRocket").attr({x:this.x+this.w,y:this.y+this.h/2-b.h/2,w:b.w,h:b.h}).fire({origin:this,damage:400,radius:20,speed:this.ship._forcedSpeed.x+b.speed,direction:0}).bind("HitTarget",function(a){return function(){return a.addXP(1),a.ship.trigger("BulletHit")}}(this)).bind("DestroyTarget",function(a){return function(){return a.addXP(5),a.ship.trigger("BulletDestroyedTarget")}}(this))}})}.call(this)}(),function(){(function(){var a,b=[].slice;a={paused:!1,togglePause:function(){return this.paused=!this.paused,this.paused?(Crafty("Delay").each(function(){return this.pauseDelays()}),Crafty("Tween").each(function(){return this.pauseTweens()}),Crafty("Particles").each(function(){return this.pauseParticles()}),Crafty("SpriteAnimation").each(function(){return this.pauseAnimation()}),Crafty("PlayerControlledShip").each(function(){return this.disableControls?void 0:(this.disabledThroughPause=!0,this.disableControl())}),Crafty.trigger("GamePause",this.paused)):(Crafty("Delay").each(function(){return this.resumeDelays()}),Crafty("Tween").each(function(){return this.resumeTweens()}),Crafty("Particles").each(function(){return this.resumeParticles()}),Crafty("SpriteAnimation").each(function(){return this.resumeAnimation()}),Crafty("PlayerControlledShip").each(function(){return this.disabledThroughPause?(this.disabledThroughPause=null,this.enableControl()):void 0}),Crafty.trigger("GamePause",this.paused))},start:function(){return this.firstLevel="Game",this.resetCredits(),Crafty.bind("EnterFrame",function(){return a.paused?void 0:Crafty.trigger.apply(Crafty,["GameLoop"].concat(b.call(arguments)))}),Crafty.paths({audio:"audio/",images:"images/"}),Crafty.init(1024,576,$("#cr-stage")[0]),Crafty.background("#000000"),Crafty.e("Player, Color").attr({name:"Player 1",z:0}).setName("Player 1").color("#FF0000"),Crafty.e("Player, Color").attr({name:"Player 2",z:10}).setName("Player 2").color("#00FF00"),Crafty.e("KeyboardControls, PlayerAssignable").controls({fire:Crafty.keys.SPACE,switchWeapon:Crafty.keys.PERIOD,"super":Crafty.keys.ENTER,up:Crafty.keys.UP_ARROW,down:Crafty.keys.DOWN_ARROW,left:Crafty.keys.LEFT_ARROW,right:Crafty.keys.RIGHT_ARROW,pause:Crafty.keys.P}),Crafty.e("KeyboardControls, PlayerAssignable").controls({fire:Crafty.keys.G,switchWeapon:Crafty.keys.H,up:Crafty.keys.W,down:Crafty.keys.S,left:Crafty.keys.A,right:Crafty.keys.D,pause:Crafty.keys.Q}),Crafty.e("GamepadControls, PlayerAssignable").controls({gamepadIndex:0,fire:0,switchWeapon:2,"super":4,pause:9,up:12,down:13,left:14,right:15}),Crafty.e("GamepadControls, PlayerAssignable").controls({gamepadIndex:1,fire:0,switchWeapon:2,"super":4,pause:9,up:12,down:13,left:14,right:15}),Crafty.enterScene("Intro")},resetCredits:function(){return this.credits=2},highscores:function(){var a,b,c,d;return c=function(){var a,b,c,d,e;return(b=localStorage.getItem("SPDLZR"))?(c=b.slice(0,20),a=b.slice(20),d=CryptoJS.AES.decrypt(a,c),e=d.toString(CryptoJS.enc.Utf8),e.length>1?JSON.parse(e):[]):[]},d=c(),a="SPL",b=[{initials:a,score:15e3},{initials:a,score:1e4},{initials:a,score:5e3},{initials:a,score:3e3},{initials:a,score:2e3},{initials:a,score:1500},{initials:a,score:1e3},{initials:a,score:500},{initials:a,score:200},{initials:a,score:100}].concat(d),_.sortBy(b,"score").reverse()}},window.Game=a}).call(this)}(),function(){(function(){var a;a=this.Game,null==a.ScriptModule&&(a.ScriptModule={}),a.ScriptModule.Colors={backgroundColorFade:function(b,c,d){return function(e){return function(f){var g,h;return Crafty.background(c[0]),Crafty.bind("BackgroundColor",e._colorHorizon),Crafty.trigger("BackgroundColor",c[0]),g=WhenJS.defer(),Crafty("Sky").get(0).colorFade({duration:b.duration,skip:null!=(h=b.skip)?h:0},c,d).bind("ColorFadeFinished",function(){var b;return b=c[c.length-1],a.backgroundColor=b,Crafty("Horizon").each(function(){return this.colorDesaturation(b)}),Crafty.unbind("BackgroundColor",this._colorHorizon),g.resolve()}),g.promise}}(this)},_colorHorizon:function(b){return a.backgroundColor!==b?(a.backgroundColor=b,Crafty("Horizon").each(function(){return this.colorDesaturation(b)})):void 0}},Crafty.c("Horizon",{init:function(){return this.requires("ColorEffects"),this.colorDesaturation(a.backgroundColor)}})}).call(this),function(){var a,b=[].slice;a=this.Game,null==a.ScriptModule&&(a.ScriptModule={}),a.ScriptModule.Core={_verify:function(a){if(a!==this.currentSequence)throw new Error("sequence mismatch")},_skippingToCheckpoint:function(){return null!=this.startAtCheckpoint&&this.currentCheckpoint<this.startAtCheckpoint},sequence:function(){var a;return a=1<=arguments.length?b.call(arguments,0):[],function(b){return function(c){return b._verify(c),WhenJS.sequence(a,c)}}(this)},parallel:function(){var a;return a=1<=arguments.length?b.call(arguments,0):[],function(b){return function(c){return b._verify(c),WhenJS.parallel(a,c)}}(this)},"if":function(a,b,c){return function(d){return function(e){return d._verify(e),a.apply(d)?b(e):"function"==typeof c?c(e):void 0}}(this)},"while":function(a,b){return function(c){return function(d){var e;return c._verify(d),c._skippingToCheckpoint()?WhenJS():(void 0===b&&(b=a,a=function(){var a;return a=WhenJS.defer(),a.promise}),e=!1,a(d)["finally"](function(){return e=!0}),WhenJS.iterate(function(){return 1},function(){return e},function(){return b(d)},1))}}(this)},repeat:function(a,b){return function(c){return function(d){return c._verify(d),c._skippingToCheckpoint()?WhenJS():void 0===b?c["while"](a)(d):0!==a?WhenJS(b(d)).then(function(){return c.repeat(a-1,b)(d)}):void 0}}(this)},runScript:function(){var a,c;return c=arguments[0],a=2<=arguments.length?b.call(arguments,1):[],function(b){return function(d){var e;return b._verify(d),b._skippingToCheckpoint()?WhenJS():(e=new c(b.level)).run.apply(e,a)}}(this)},async:function(a){return function(b){return function(c){return b._verify(c),b._skippingToCheckpoint()?WhenJS():void a(c)}}(this)},wait:function(a){return function(b){return function(c){var d;return b._verify(c),b._skippingToCheckpoint()?WhenJS():(d=WhenJS.defer(),Crafty.e("Delay").delay(function(){return d.resolve(),this.destroy()},a),d.promise)}}(this)},endSequence:function(){return function(a){return function(b){throw a._verify(b),new Error("sequence aborted")}}(this)},checkpoint:function(a){return function(b){return function(c){return b._verify(c),b.currentCheckpoint+=1,b._skippingToCheckpoint()?WhenJS():b.currentCheckpoint===b.startAtCheckpoint&&null!=a?a(c):window.ga("send","event","Game","Checkpoint "+b.currentCheckpoint)}}(this)}}}.call(this),function(){var a,b=[].slice;a=this.Game,null==a.ScriptModule&&(a.ScriptModule={}),a.ScriptModule.Entity={bindSequence:function(a,c,d){var e;if(null!=c)return null==d&&(d=function(){return!0}),e=function(f){return function(){var g,h,i;return g=1<=arguments.length?b.call(arguments,0):[],d.apply(null,g)?(f.entity.unbind(a,e),h=function(a){return f.alternatePath=null,WhenJS(c.apply(f,g)(a))["catch"](function(){return f.alternatePath})},f.currentSequence=i=Math.random(),f.alternatePath=h(i)):void 0}}(this),this.entity.bind(a,e)},sendToBackground:function(a,b){return function(c){return function(d){return c._verify(d),c.entity.sendToBackground(a,b)}}(this)},reveal:function(){return function(a){return function(b){return a._verify(b),a.entity.reveal()}}(this)},animate:function(a,b,c){return function(d){return function(e){return d._verify(e),c?d.entity[c].animate(a,b):d.entity.animate(a,b)}}(this)},scale:function(a,b){return null==b&&(b={}),function(c){return function(d){var e,f,g,h,i;return c._verify(d),g=c.entity.scale,b=_.defaults(b,{duration:1e3*Math.abs(a-g)}),f=WhenJS.defer(),i=c.entity.w/g*a,h=c.entity.h/g*a,e=function(){return defer.resolve()},c.entity.tween({w:i,h:h,scale:a},b.duration).one("TweenEnd",function(){return this.unbind("Remove",e),f.resolve()}),f.promise}}(this)},movePath:function(a,b){return null==b&&(b={}),function(c){return function(d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;return c._verify(d),c.enemy.alive?(b=_.defaults(b,{rotate:!0,skip:0,speed:c.entity.speed}),a.unshift([Math.round(c.entity.x+Crafty.viewport.x),Math.round(c.entity.y+Crafty.viewport.y)]),n=a[0],i=0,g=function(){var b,c,d;for(d=[],b=0,c=a.length;c>b;b++)l=a[b],(q="function"==typeof l?l():void 0)?(r=q.x,s=q.y,console.log(r,s)):(r=l[0],s=l[1]),r>-1&&2>r&&(r*=Crafty.viewport.width),s>-1&&2>s&&(s*=Crafty.viewport.height),m=[r,s],o=n[0],p=n[1],e=Math.abs(r-o),f=Math.abs(s-p),h=Math.sqrt(Math.pow(e,2)+Math.pow(f,2)),i+=h,n=m,d.push({x:r-Crafty.viewport.x,y:s-Crafty.viewport.y});return d}(),k=i/b.speed*1e3,j=WhenJS.defer(),c.entity.choreography([{type:"viewportBezier",rotation:b.rotate,path:g,duration:k}],{compensateCameraSpeed:!0,skip:b.skip}).one("ChoreographyEnd",function(){return j.resolve()}),j.promise):void 0}}(this)},_isFloat:function(a){return a===+a&&a!==(0|a)},moveTo:function(a,b){return null==b&&(b={}),function(c){return function(d){var e,f,g,h,i,j,k,l;return c._verify(d),c.enemy.alive?("string"==typeof a&&(k=Crafty(a).get(0),a={x:k.x+Crafty.viewport.x,y:k.y+Crafty.viewport.y}),j=null!=(f="function"==typeof a?a():void 0)?f:a,_.extend(j,b),null!=j.x&&-1<(g=j.x)&&2>g&&(j.x*=Crafty.viewport.width),null!=j.y&&-1<(h=j.y)&&2>h&&(j.y*=Crafty.viewport.height),i=c._getSeaLevel(),"air"===c.enemy.moveState?null!=j.y&&j.y>i+Crafty.viewport.y?(e=_.clone(j),e.y=i,c._moveAir(e).then(function(){return c.enemy.moveState="water",c.enemy.alive?(c._setupWaterSpot(),c._waterSplash(),c._moveWater(j)):void 0})):c._moveAir(j):"water"===c.enemy.moveState?null!=j.y&&j.y<i+Crafty.viewport.y?(l=_.clone(j),l.y=i,c._moveWater(l).then(function(){return c.enemy.moveState="air",c.enemy.alive?(c._removeWaterSpot(),c._waterSplash(),c._moveAir(j)):void 0})):c._moveWater(j):void 0):void 0}}(this)},_setupWaterSpot:function(){var b;return b=null!=a.explosionMode?Crafty.e("2D, WebGL, Color, Choreography, Tween").color("#000040").attr({w:this.entity.w+10,x:this.entity.x-5,y:this.entity.y,h:20,alpha:.7,z:this.entity.z-1}):Crafty.e("2D, WebGL, shadow, Choreography, Tween").attr({w:this.entity.w+10,x:this.entity.x-5,y:this.entity.y,h:20,z:this.entity.z-1}),this.entity.has("ViewportFixed")&&b.addComponent("ViewportFixed"),this.entity.hide(b)},_removeWaterSpot:function(){return this.entity.reveal()},_waterSplash:function(){var a;return a=WhenJS.defer(),Crafty.e("WaterSplash").waterSplash({x:this.entity.x,y:this.entity.y,size:this.entity.w}).one("ParticleEnd",function(){return a.resolve()}),a.promise},_moveWater:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;if(b={speed:this.entity.speed},this.entity.has("ViewportFixed")&&(b.x=this.entity.x+Crafty.viewport.x,b.y=this.entity.y+Crafty.viewport.y),n=this._getSeaLevel(),a=_.defaults(a,b),o={w:this.entity.w+10,y:n,h:20,alpha:.7},l=700,k={w:.3*this.entity.w,y:this.entity.hideMarker.y+15,h:5,alpha:.2},e=null!=a.x?Math.abs(a.x-(this.entity.hideMarker.x+Crafty.viewport.x)):0,f=null!=a.y?Math.abs(a.y-(this.entity.hideMarker.y+Crafty.viewport.y)):0,d=Math.sqrt(Math.pow(e,2)+Math.pow(f,2)),i=d/a.speed*1e3,null!=a.y){g=Math.min(a.y,l),q=(g-n)/(l-n),h={};for(j in o)m=o[j],h[j]=(1-q)*m+q*k[j];this.entity.hideMarker.tween(h,i)}return c=WhenJS.defer(),this.entity.attr({x:a.x-Crafty.viewport.x,y:a.y-Crafty.viewport.y}),p=this.entity.has("ViewportFixed")?"viewport":(a.x=e,a.y=f,"linear"),this.entity.hideMarker.choreography([{type:p,x:a.x,maxSpeed:a.speed,duration:i}]).one("ChoreographyEnd",function(){return c.resolve()}),c.promise},_getSeaLevel:function(){var a,b;return Crafty.viewport.height-260+220*(null!=(a=this.entity.scale)?a:1)+(null!=(b=this.level.sealevelOffset)?b:0)},_moveAir:function(a){var b,c,d,e,f,g,h,i;return b={speed:this.entity.speed},this.entity.has("ViewportFixed")&&(b.x=this.entity.x+Crafty.viewport.x,b.y=this.entity.y+Crafty.viewport.y),a=_.defaults(a,b),e=null!=a.x?Math.abs(a.x-(this.entity.x+Crafty.viewport.x)):0,f=null!=a.y?Math.abs(a.y-(this.entity.y+Crafty.viewport.y)):0,d=Math.sqrt(Math.pow(e,2)+Math.pow(f,2)),c=WhenJS.defer(),i=this.entity.has("ViewportFixed")?"viewport":(a.x=e,a.y=f,"linear"),g=null!=(h=a.easing)?h:"linear",this.entity.choreography([{type:i,x:a.x,y:a.y,easingFn:g,maxSpeed:a.speed,duration:d/a.speed*1e3}]).one("ChoreographyEnd",function(){return c.resolve()}),c.promise},rotate:function(a,b){return function(c){return function(d){var e,f;return c._verify(d),f=WhenJS.defer(),e=function(){return f.resolve()},c.entity.one("Remove",e),c.entity.tween({rotation:a},b).one("TweenEnd",function(){return this.unbind("Remove",e),f.resolve()}),f.promise}}(this)},synchronizeOn:function(a){return function(b){return function(c){return b.synchronizer.synchronizeOn(a,b)}}(this)},setLocation:function(a){return function(b){return function(c){var d,e,f,g;return e=null!=(d="function"==typeof a?a():void 0)?d:a,f=e.x,g=e.y,(b._isFloat(f)||f>-1&&2>f)&&(f*=Crafty.viewport.width),(b._isFloat(g)||g>-1&&2>g)&&(g*=Crafty.viewport.height),b.entity.attr({x:f-Crafty.viewport.x,y:g-Crafty.viewport.y})}}(this)},location:function(a){return null==a&&(a={}),function(b){return function(){var c,d,e,f;return{x:(null!=(c=b.enemy.location.x)?c:b.entity.x+Crafty.viewport.x+b.entity.w/2)+(null!=(d=a.offsetX)?d:0),y:(null!=(e=b.enemy.location.y)?e:b.entity.y+Crafty.viewport.y+b.entity.h/2)+(null!=(f=a.offsetY)?f:0)}}}(this)}}}.call(this),function(){var a,b=[].slice;a=this.Game,null==a.ScriptModule&&(a.ScriptModule={}),a.ScriptModule.Level={placeSquad:function(b,c){return null==c&&(c={}),function(d){return function(e){var f,g,h,i,j,k;return d._verify(e),d._skippingToCheckpoint()?WhenJS():(k=new a.Synchronizer,h=_.defaults({},c.options,{synchronizer:k}),c=_.defaults(c,{amount:1,delay:1e3}),c.options=h,j=function(){var a,d,e;for(e=[],f=a=0,d=c.amount;d>=0?d>a:a>d;f=d>=0?++a:--a)e.push(k.registerEntity(new b(this.level)));return e}.call(d),g=WhenJS(!0),null!=(null!=(i=j[0])?i.assets:void 0)&&(g=j[0].assets()(e)),g.then(function(){var a,b;return a=function(){var a,d,g;for(g=[],f=a=0,d=j.length;d>a;f=++a)b=j[f],g.push(function(a){return function(b,d){return a.wait(d*c.delay)(e).then(function(){return a._verify(e),b.run(c.options)})}}(this)(b,f));return g}.call(d),WhenJS.all(a).then(function(a){var b,f,g,h,i,j,k,l,m;for(f=!0,j=null,i=null,g=0,k=a.length;k>g;g++)m=a[g],b=m.alive,h=m.killedAt,l=m.location,b?f=!1:(null==i&&(i=h),null==j&&(j=l),h.getTime()>i.getTime()&&(i=h,j=l));return f&&j&&(j.x-=Crafty.viewport.x,j.y-=Crafty.viewport.y,c.drop)?d.drop({item:c.drop,location:j})(e):void 0})}))}}(this)},say:function(b,c){return function(d){return function(e){return d._verify(e),d._skippingToCheckpoint()?WhenJS():a.say(b,c,{bottom:d.level.visibleHeight})}}(this)},drop:function(a){return function(b){return function(c){var d,e,f,g;return b._verify(c),b._skippingToCheckpoint()?WhenJS():(e=b.inventory("item",a.item),(f=a.inFrontOf)&&b.level.addComponent(e().attr({z:-1}),{x:Crafty.viewport.width,y:f.ship().y+Crafty.viewport.y}),(g=a.location)?(d="function"==typeof g?g():void 0,d?(d.x-=Crafty.viewport.x,d.y-=Crafty.viewport.y):d=g,e().attr({x:d.x,y:d.y,z:-1})):void 0)}}(this)},player:function(a){var b;return b={},Crafty("Player").each(function(){return b[this.name]={name:this.name,active:!1,gameOver:!1,has:function(a){var b;return null!=(b=this.ship())?b.hasItem(a):void 0},ship:function(){var a,b;return a=this,b=null,Crafty("Player ControlScheme").each(function(){return this.name===a.name?b=this.ship:void 0}),b}}}),Crafty("Player ControlScheme").each(function(){return b[this.name].active=!0,this.lives>0?void 0:(b[this.name].active=!1,b[this.name].gameOver=!0)}),b["Player "+a]},setScenery:function(a){return function(b){return function(c){return b._verify(c),b._skippingToCheckpoint()?WhenJS():b.level.setScenery(a)}}(this)},waitForScenery:function(a,b){return null==b&&(b={event:"enter"}),function(c){return function(d){var e;return c._verify(d),c._skippingToCheckpoint()?WhenJS():(e=WhenJS.defer(),c.level.notifyScenery(b.event,a,function(){return e.resolve()}),e.promise)}}(this)},gainHeight:function(a,b){return function(c){return function(d){var e,f,g,h,i,j;return c._verify(d),f=WhenJS.defer(),e=(null!=(i=c.level._forcedSpeed)?i.x:void 0)||c.level._forcedSpeed,g=b.duration,c._skippingToCheckpoint()?c.level.setHeight(-a):(j=a/g*1e3,c.level.setForcedSpeed({x:e,y:-j}),h=c.level,Crafty.e("Delay").delay(function(){return h.setForcedSpeed(e),f.resolve()},g),f.promise)}}(this)},setSpeed:function(a){return function(b){return function(c){return b._verify(c),b.level.setForcedSpeed(a)}}(this)},showScore:function(a,b){return function(c){return function(d){var e;return c._verify(d),e=Crafty.e("StageEnd").stageEnd(c.level,a,b),c.wait(3e4)(d).then(function(){return e.destroy()})}}(this)},disableWeapons:function(){return function(a){return function(b){return a._verify(b),a.level.setWeaponsEnabled(!1)}}(this)},enableWeapons:function(){return function(a){return function(b){return a._verify(b),a.level.setWeaponsEnabled(!0)}}(this)},explosion:function(a,b){return null==b&&(b={}),function(c){return function(d){var e,f,g,h;return c._verify(d),f=a(),g=f.x,h=f.y,g-=Crafty.viewport.x,h-=Crafty.viewport.y,b=_.defaults(b,{damage:0,radius:20,duration:160,z:5,topDesaturation:0,bottomDesaturation:0}),e=Crafty.e("Explosion").explode({x:g,y:h,z:b.z,topDesaturation:b.topDesaturation,bottomDesaturation:b.bottomDesaturation,radius:b.radius,damage:b.damage,duration:b.duration}),b.damage?e.addComponent("Enemy"):void 0}}(this)},loadAssets:function(){var a;return a=1<=arguments.length?b.call(arguments,0):[],function(b){return function(c){return b.level.loadAssets(a)}}(this)},updateTitle:function(a){return function(b){return function(c){return b._verify(c),b.level.updateTitle(a)}}(this)},chapterTitle:function(a){return function(b){return function(c){return b._verify(c),b._skippingToCheckpoint()?WhenJS():b.level.showTitle(a)}}(this)},pickTarget:function(a){return function(b){return function(c){var d,e;return d=function(a){var b;return b=Crafty(a),0===b.length?null:b.get(Math.floor(Math.random()*b.length))},e=function(c){return b.target={x:c.x,y:c.y},Crafty.one("ShipSpawned",function(c){return b.target=d(a),b.target.one("Destroyed",e)})},b.target=d(a),"PlayerControlledShip"===a&&b.target?b.target.one("Destroyed",e):void 0}}(this)},targetLocation:function(a){return null==a&&(a={}),function(b){return function(){var c,d,e,f,g,h,i,j,k,l;return null!=a.x&&-1<(e=a.x)&&2>e&&(a.x*=Crafty.viewport.width),null!=a.y&&-1<(f=a.y)&&2>f&&(a.y*=Crafty.viewport.height),c=a.x||(null!=(g=b.target)?g.x:void 0),d=a.y||(null!=(h=b.target)?h.y:void 0),c&&d?{x:(null!=(i=a.x)?i:b.target.x+Crafty.viewport.x)+(null!=(j=a.offsetX)?j:0),y:(null!=(k=a.y)?k:b.target.y+Crafty.viewport.y)+(null!=(l=a.offsetY)?l:0)}:null}}(this)},changeSeaLevel:function(a){return function(b){return function(c){return b._verify(c),b.level.sealevelOffset=a}}(this)},screenShake:function(a,b){return null==b&&(b={}),function(c){return function(d){return c._verify(d),b=_.defaults(b,{duration:1e3}),c.level.screenShake(a,b),c.wait(b.duration)(d)}}(this)}}}.call(this),function(){var a;a=this.Game,a.BezierPath=function(){function a(){}return a.prototype.scalePoints=function(a,b){var c,d,e,f,g,h,i,j;for(g=b.origin,j=b.scale,f={x:a[0].x*j.x-g.x,y:a[0].y*j.y-g.y},i=[],c=d=0,e=a.length;e>d;c=++d)h=a[c],i.push({x:h.x*j.x-f.x,y:h.y*j.y-f.y});return i},a.prototype.buildPathFrom=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;for(o={distance:0,curves:[]},m=this.getCurveControlPoints(a),j=m[0],p=m[1],k=l=0,n=a.length-1;n>=0?n>l:l>n;k=n>=0?++l:--l)b=a[k],c=a[k+1],d=j[k],e=p[k],h=Math.abs(b.x-c.x),i=Math.abs(b.y-c.y),f=Math.sqrt(Math.pow(h,2)+Math.pow(i,2)),g=[c,e,d,b],o.distance+=f,o.curves.push({distance:f,points:g});return o},a.prototype.pointOnPath=function(a,b){var c,d,e,f,g;return f=this.getCurveAndLocation(a,b),d=f[0],g=f[1],c=f[2],e=jsBezier.pointOnCurve(d.points,g),e.c=c,e},a.prototype.angleOnPath=function(a,b){var c,d,e;return d=this.pointOnPath(a,Math.min(b,.99)),e=this.pointOnPath(a,Math.min(b+.01,1)),c=Math.atan2(d.y-e.y,d.x-e.x),c*=180/Math.PI,(c+360)%360},a.prototype.getCurveAndLocation=function(a,b){var c,d,e,f,g,h,i;for(e=0,c=0,d=a.curves[c],h=(e+d.distance)/a.distance;b>h;)c+=1,e+=d.distance,d=a.curves[c],h=(e+d.distance)/a.distance;return f=d.distance/a.distance,g=e/a.distance,i=(b-g)/f,[d,i,c]},a.prototype.getCurveControlPoints=function(a){var b,c,d,e,f,g,h,i,j;if(e=a.length-1,1>e)return[];if(1===e)return b=[{x:(2*a[0].x+a[1].x)/3,y:(2*a[0].y+a[1].y)/3}],h=[{x:2*b[0].x-a[0].x,y:2*b[0].y-a[0].y}],[b,h];for(g=function(){var b,d,f;for(f=[],c=b=1,d=e-1;d>=1?d>b:b>d;c=d>=1?++b:--b)f.push(4*a[c].x+2*a[c+1].x);return f}(),g.unshift(a[0].x+2*a[1].x),g.push((8*a[e-1].x+a[e].x)/2),i=this.getFirstControlPoints(g),g=function(){var b,d,f;for(f=[],c=b=1,d=e-1;d>=1?d>b:b>d;c=d>=1?++b:--b)f.push(4*a[c].y+2*a[c+1].y);return f}(),g.unshift(a[0].y+2*a[1].y),g.push((8*a[e-1].y+a[e].y)/2),j=this.getFirstControlPoints(g),b=[],h=[],c=d=0,f=e;f>=0?f>d:d>f;c=f>=0?++d:--d)b.push({x:i[c],y:j[c]}),e-1>c?h.push({x:2*a[c+1].x-i[c+1],y:2*a[c+1].y-j[c+1]}):h.push({x:(a[e].x+i[e-1])/2,y:(a[e].y+j[e-1])/2});return[b,h]},a.prototype.getFirstControlPoints=function(a){var b,c,d,e,f,g,h,i,j;for(f=a.length,j=[],i=[null],b=2,j.push(a[0]/b),c=d=1,g=f;g>=1?g>d:d>g;c=g>=1?++d:--d)i.push(1/b),b=f-1>c?4:3.5,b-=i[c],j.push((a[c]-j[c-1])/b);for(c=e=1,h=f;h>=1?h>e:e>h;c=h>=1?++e:--e)j[f-c-1]-=i[f-c]*j[f-c];return j},a}()}.call(this),function(){this.Game.say=function(a,b,c){var d,e,f,g,h,i,j,k,l,m;for(Crafty("Dialog").each(function(){return this.trigger("Abort"),this.destroy()}),j=b.split("\n"),m=60,e=WhenJS.defer(),l=.8*Crafty.viewport.width,d=Crafty.e("2D, WebGL, Color, Tween, HUD, Dialog").attr({w:l,h:20*(j.length+2),alpha:.5}).color("#000000").positionHud({x:m-10,y:c.bottom-20*(j.length+1),z:100}),d.bind("Abort",function(){return e.resolve()}),k=Crafty.e("2D, DOM, Text").attr({w:l-20,x:d.x+10,y:d.y+10,z:101,alpha:1}).text(a).textColor("#707070").textFont({size:"10px",weight:"bold",family:"Press Start 2P"}),d.attach(k),f=g=0,h=j.length;h>g;f=++g)i=j[f],d.attach(Crafty.e("2D, DOM, Text").attr({w:l-20,x:d.x+10,y:d.y+30+20*f,z:101}).text(i).textColor("#909090").textFont({size:"10px",weight:"bold",family:"Press Start 2P"}));return Crafty.e("Dialog, Delay").delay(function(){return e.resolve(),Crafty("Dialog").each(function(){return this.destroy()})},2500*j.length,0),e.promise}}.call(this),function(){}.call(this),function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}},c=[].slice,d=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},e={}.hasOwnProperty;a=this.Game,a.LazerScript=function(){function a(a){this.level=a,this._endScriptOnGameOver=b(this._endScriptOnGameOver,this)}return a.prototype.run=function(){var a,b,d;return a=1<=arguments.length?c.call(arguments,0):[],this.currentSequence=Math.random(),this.options=null!=(d=a[0])?d:{},this.startAtCheckpoint=this.options.startAtCheckpoint,this.currentCheckpoint=0,b=WhenJS(!0),null!=("undefined"!=typeof this&&null!==this?this.assets:void 0)&&(b=this.assets()(this.currentSequence)),b.then(function(b){return function(){return b.initialize.apply(b,a)}}(this))},a.prototype.end=function(){return this.currentSequence=null},a.prototype.initialize=function(){var a;return a=1<=arguments.length?c.call(arguments,0):[],Crafty.bind("PlayerDied",this._endScriptOnGameOver),WhenJS(this.execute.apply(this,a)(this.currentSequence))["finally"](function(a){return function(){return Crafty.unbind("PlayerDied",a._endScriptOnGameOver)}}(this))},a.prototype.execute=function(){},a.prototype._endScriptOnGameOver=function(){var a;return a=!1,Crafty("Player ControlScheme").each(function(){return this.lives>0?a=!0:void 0}),a?void 0:this.currentSequence=null},a.prototype.inventory=function(a,b){var c;return this.invItems||(this.invItems={}),(c=this.invItems)[a]||(c[a]={}),this.invItems[a][b||"default"]},a.prototype.inventoryAdd=function(a,b,c){var d;return this.invItems||(this.invItems={}),(d=this.invItems)[a]||(d[a]={}),this.invItems[a][b]=c},a}(),_.extend(a.LazerScript.prototype,a.ScriptModule.Core,a.ScriptModule.Level,a.ScriptModule.Colors),a.EntityScript=function(b){function e(){return e.__super__.constructor.apply(this,arguments)}return d(e,b),e.prototype.initialize=function(){var b,d;return b=1<=arguments.length?c.call(arguments,0):[],this.boundEvents=[],this.entity=this.spawn.apply(this,b),null==this.entity?WhenJS({alive:!1,killedAt:new Date,location:null}):(this.synchronizer=null!=(d=this.options.synchronizer)?d:new a.Synchronizer,this.synchronizer.registerEntity(this),null!=this.entity?(this.entity.attr({x:this.entity.x-Crafty.viewport.x,y:this.entity.y-Crafty.viewport.y}),this.entity.bind("Destroyed",function(a){return function(){return a.currentSequence=null,a.synchronizer.unregisterEntity(a),a.enemy.location.x=a.entity.x+Crafty.viewport.x,a.enemy.location.y=a.entity.y+Crafty.viewport.y,a.enemy.alive=!1,a.enemy.killedAt=new Date}}(this)),this.enemy={moveState:"air",alive:!0,location:{}}):this.enemy={moveState:"air",alive:!1,location:{}},e.__super__.initialize.apply(this,arguments)["catch"](function(a){return function(){return a.alternatePath}}(this))["finally"](function(a){return function(){return a.enemy.alive&&!a.entity.has("KeepAlive")?a.entity.destroy():void 0}}(this)).then(function(a){return function(){return a.enemy}}(this)))},e.prototype.spawn=function(){},e}(a.LazerScript),_.extend(a.EntityScript.prototype,a.ScriptModule.Core,a.ScriptModule.Entity)}.call(this),function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}};a=this.Game,a.Level=function(){function a(a,c){this.generator=a,this.data=null!=c?c:{},this._waveTicks=b(this._waveTicks,this),this.blocks=[],this.bufferLength=3*Crafty.viewport.width,this.generationPosition={x:0,y:40},this.sceneryEvents=[],this.visibleHeight=Crafty.viewport.height-this.generationPosition.y,this.namespace=this.data.namespace,this.currentScenery=this.data.startScenery}return a.prototype.setScenery=function(a){return this._loadAssetsForScenery(a).then(function(b){return function(){return b.currentScenery=a,b._setupLevelScenery()}}(this))},a.prototype._loadAssetsForScenery=function(a){var b,c;return c=this.namespace+"."+a,b=this.generator.buildingBlocks[c],b.prototype.loadAssets().then(function(a){return function(){var c,d,e;return d=[],(e=b.prototype.autoPrevious)&&d.push(function(){return a._loadAssetsForScenery(e)}),(c=b.prototype.autoNext)&&d.push(function(){return a._loadAssetsForScenery(c)}),d.length>0?WhenJS.sequence(d):void 0}}(this))},a.prototype.start=function(a){var b;return null==a&&(a={}),b={armedPlayers:"lasers",speed:1,controlsEnabled:!0,weaponsEnabled:!0,spawnPosition:{x:100,y:200},spawnOffset:{x:-50,y:0},viewport:{x:0,y:0},title:""},a=_.defaults(a,this.data,b),Crafty.viewport.x=0,Crafty.viewport.y=0,this._controlsEnabled=a.controlsEnabled,this.setForcedSpeed(a.speed),this.setWeaponsEnabled(a.weaponsEnabled),this._scrollWall=Crafty.e("ScrollWall").attr({x:a.viewport.x,y:a.viewport.y}),this._playersActive=!1,Crafty.bind("EnemySpawned",function(a){return function(){var b;return null==(b=a.data).enemiesSpawned&&(b.enemiesSpawned=0),a.data.enemiesSpawned+=1}}(this)),this._placePlayerShips(a),Crafty.e("2D, DOM, Text, HUD, LevelTitle").attr({w:150,h:20}).positionHud({x:Crafty.viewport.width-150,y:10,z:2}).textFont({size:"10px",family:"Press Start 2P"}).textColor("#A0A0A0").text(a.title),this._setupLevelScenery(),Crafty.bind("PlayerDied",function(a){return function(){var b;return b=!1,Crafty("Player ControlScheme").each(function(){return this.lives>0?b=!0:void 0}),b?void 0:(a.stop(),Crafty.trigger("GameOver"))}}(this)),Crafty.bind("GameLoop",this._waveTicks)},a.prototype._waveTicks=function(a){var b,c,d,e;null==this._registeredWaveTweens&&(this._registeredWaveTweens={}),c=this._registeredWaveTweens,d=[];for(b in c)e=c[b],d.push(e.tick(a.dt));return d},a.prototype.registerWaveTween=function(a,b,c,d){var e;return null==this._registeredWaveTweens&&(this._registeredWaveTweens={}),null!=(e=this._registeredWaveTweens)[a]?e[a]:e[a]=new(function(){function a(a){var b,c;this.name=a.name,b=a.duration,c=a.easing,this.callback=a.callback,this.ease=new Crafty.easing(b,c),this.ease.repeat(3)}return a.prototype.tick=function(a){var b,c;return this.ease.tick(a),c=this.ease.value(),1===this.ease.loops&&this.ease.repeat(3),b=this.ease.loops%2===1,this.callback(c,b)},a}())({name:a,duration:b,easing:c,callback:d})},a.prototype._setupLevelScenery=function(){var a,b,c,d;if(null!=this.currentScenery&&0===this.blocks.length){for(this._seedPreceedingGeometry(),this._update(),this.lastUpdate=Crafty.viewport._x+200,d=this.blocks,b=0,c=d.length;c>b;b++)a=d[b],a.x<640&&a.enter();return Crafty.bind("ViewportScroll",function(a){return function(){return a.lastUpdate-Crafty.viewport._x>=300?(a._update(),a.lastUpdate=Crafty.viewport._x):void 0}}(this)),Crafty.uniqueBind("LeaveBlock",function(a){return function(b){var c;return c=_.indexOf(a.blocks,b),c>0&&a._handleSceneryEvents(a.blocks[c-1],"leave"),a._handleSceneryEvents(b,"inScreen"),a._cleanupBuildBlocks()}}(this)),Crafty.uniqueBind("EnterBlock",function(a){return function(b){var c;return c=_.indexOf(a.blocks,b),c>0&&a._handleSceneryEvents(a.blocks[c-1],"outScreen"),a._handleSceneryEvents(b,"enter")}}(this)),Crafty.uniqueBind("PlayerEnterBlock",function(a){return function(b){var c;return c=_.indexOf(a.blocks,b),c>0&&a._handleSceneryEvents(a.blocks[c-1],"playerLeave"),a._handleSceneryEvents(b,"playerEnter")}}(this))}},a.prototype._handleSceneryEvents=function(a,b){var c,d,e,f,g;if(null!=a){for(a[b](),f=this.sceneryEvents,g=[],e=d=f.length-1;d>=0;e=d+=-1)c=f[e],a.name===this.namespace+"."+c.sceneryType&&b===c.eventType?(c.callback.apply(this),g.push(this.sceneryEvents.splice(e,1))):g.push(void 0);return g}},a.prototype.notifyScenery=function(a,b,c){return this.sceneryEvents.push({eventType:a,sceneryType:b,callback:c})},a.prototype._placePlayerShips=function(a){return Crafty.one("ShipSpawned",function(a){return function(){return a._playersActive=!0,a._scrollWall.scrollWall(a._forcedSpeed)}}(this)),Crafty("Player").each(function(b){var c;return c=function(){var b;return b=_.clone(a.spawnPosition),Crafty("PlayerControlledShip").each(function(){return b.x=this.x+a.spawnOffset.x+Crafty.viewport.x,b.y=this.y+a.spawnOffset.y+Crafty.viewport.y}),b},this.addComponent("ShipSpawnable").spawnPosition(c,a.armedPlayers),Crafty.e("PlayerInfo").playerInfo(30+b*(.3*Crafty.viewport.width),this)}),Crafty.bind("ShipSpawned",function(a){return function(b){return b.forcedSpeed(a._forcedSpeed),b.weaponsEnabled=a._weaponsEnabled,a._controlsEnabled?void 0:b.disableControl()}}(this)),Crafty("Player ControlScheme").each(function(){return this.spawnShip()})},a.prototype.setForcedSpeed=function(a){return this._forcedSpeed=a,this._playersActive&&this._scrollWall.scrollWall(this._forcedSpeed),Crafty("PlayerControlledShip").each(function(){return this.forcedSpeed(a)})},a.prototype.screenShake=function(a,b){
return null==b&&(b={}),b=_.defaults(b,{duration:1e3}),this._scrollWall.screenShake(a,b.duration)},a.prototype.setHeight=function(a){return this._scrollWall.setHeight(a),Crafty("PlayerControlledShip").each(function(){return this.y+=a})},a.prototype.setWeaponsEnabled=function(a){return this._weaponsEnabled=a,Crafty("PlayerControlledShip").each(function(){return this.weaponsEnabled=a})},a.prototype.getComponentOffset=function(){return{x:this._scrollWall.x,y:this._scrollWall.y}},a.prototype.addComponent=function(a,b,c){var d,e,f;return null==c&&(c=null),d=this.blocks[null!=(f=this.currentBlockIndex)?f:0],null!=d?(null==c&&(c=this.getComponentOffset()),e={x:b.x+c.x-d.x,y:b.y+c.y-d.y},d.add(e.x,e.y,a)):void 0},a.prototype.stop=function(){var a,b,c,d,e;for(Crafty.unbind("LeaveBlock"),Crafty.unbind("EnterBlock"),Crafty.unbind("ShipSpawned"),Crafty.unbind("ViewportScroll"),Crafty.unbind("GameLoop",this._waveTicks),d=this.blocks,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(null!=a?a.clean():void 0);return e},a.prototype._update=function(){var a,b,c,d,e;for(e=-Crafty.viewport._x,b=e+this.bufferLength,a=0,c=10,d=[];this.generationPosition.x<b&&c>a;)this._generateLevel(),d.push(a+=1);return d},a.prototype._generateLevel=function(){var a,b,c;return b=this.namespace+"."+this.currentScenery,this._addBlockToLevel(b,{}),a=this.generator.buildingBlocks[b],(c=a.prototype.autoNext)?this.currentScenery=c:void 0},a.prototype._addBlockToLevel=function(a,b){var c,d;return d=this.generator.buildingBlocks[a],c=new d(this,this.generator,b),this.blocks.push(c),c.build(this.generationPosition),this.generationPosition={x:c.x+c.delta.x,y:c.y+c.delta.y}},a.prototype._insertBlockToLevel=function(a,b){var c,d;if(d=this.generator.buildingBlocks[a],null==d)throw new Error(a+" not found");return c=new d(this,this.generator,b),this.blocks.unshift(c),this.generationPosition={x:this.generationPosition.x-c.delta.x,y:this.generationPosition.y-c.delta.y},c.build(this.generationPosition)},a.prototype._cleanupBuildBlocks=function(){var a,b;for(a=this.blocks[0],b=[];a.canCleanup();)this.blocks.shift().clean(),b.push(a=this.blocks[0]);return b},a.prototype._seedPreceedingGeometry=function(){var a,b,c,d,e;return b=this.namespace+"."+this.currentScenery,a=this.generator.buildingBlocks[b],(c=a.prototype.autoNext)&&(b=this.namespace+"."+c),(e=a.prototype.autoPrevious)&&(b=this.namespace+"."+e),d=_.clone(this.generationPosition),this._insertBlockToLevel(b,{}),this._insertBlockToLevel(b,{}),this._insertBlockToLevel(b,{}),this.generationPosition=d},a.prototype.updateTitle=function(a){return Crafty("LevelTitle").text(a)},a.prototype.showTitle=function(a){return Crafty.e("StageTitle").stageTitle(a)},a.prototype.loadAssets=function(a){return this.generator.loadAssets(a)},a}()}.call(this),function(){var a,b=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};a=this.Game,a.LevelGenerator=function(){function c(){this.buildingBlocks={},this.elements={},this.assets={}}return c.prototype.defineBlock=function(a){return this.buildingBlocks[a.prototype.name]=a},c.prototype.defineElement=function(a,b){return this.elements[a]=b},c.prototype.defineAssets=function(a,b){return this.assets[a]=b},c.prototype.loadAssets=function(a){var b,c;return c=function(){var c,d,e;for(e=[],c=0,d=a.length;d>c;c++)b=a[c],e.push(this._loadAssetMap(b));return e}.call(this),WhenJS.all(c)},c.prototype._loadAssetMap=function(a){var c,d,e,f,g,h,i,j,k,l,m;null==this.entityAssets&&(this.entityAssets={}),c=null,e=null,l=this.assets;for(d in l)j=l[d],b.call(j.contents,a)>=0&&(c=d,e=j);if(!c)throw new Error("no asset map defined for "+a);return this.entityAssets[c]?this.entityAssets[c].promise:(f=WhenJS.defer(),this.entityAssets[c]={assets:e,promise:f.promise},m=e.spriteMap,k=function(){var a,b;a=e.sprites,b=[];for(h in a)g=a[h],i={sprites:{}},i.sprites[m]=g,b.push(i);return b}(),Crafty.load(k.pop(),function(){for(var a,b;k.length>0;)a=k.pop().sprites[m],b=Crafty.paths().images+m,Crafty.sprite(a.tile,a.tileh,b,a.map,a.paddingX,a.paddingY,a.paddingAroundBorder);return f.resolve()}),f.promise)},c.prototype.createLevel=function(b){return new a.Level(this,b)},c}(),a.levelGenerator=new a.LevelGenerator}.call(this),function(){var a,b=[].slice;a=this.Game,a.LevelScenery=function(){function a(a,b,c){this.level=a,this.generator=b,this.settings=c,this.createdElements=[],this.createdBindings=[]}return a.prototype.screenHeight=480,a.prototype.loadAssets=function(){var a,b;return b="function"==typeof this.assets?this.assets():void 0,null==b?WhenJS():(a=WhenJS.defer(),Crafty.load(b,function(b){return function(){return a.resolve()}}(this)),a.promise)},a.prototype.build=function(a){return this.generated?void 0:(null==this.x&&(this.x=a.x),null==this.y&&(this.y=a.y),this.generated=!0,this.generate(),this._notifyEnterFunction(this.notifyOffsetX))},a.prototype._notifyEnterFunction=function(a){var b;return null==a&&(a=0),b=this,Crafty.e("2D, Collision").attr({x:this.x+a,y:this.y,w:10,h:800}).onHit("ScrollFront",function(){return this.triggeredFront?void 0:(Crafty.trigger("EnterBlock",b),this.triggeredFront=!0)}).onHit("PlayerControlledShip",function(){return this.triggeredPlayerFront?void 0:(Crafty.trigger("PlayerEnterBlock",b),this.triggeredPlayerFront=!0)}).onHit("ScrollWall",function(){return Crafty.trigger("LeaveBlock",b),this.destroy()})},a.prototype.generate=function(){var a;return null!=(a=this.settings.generate)?a.apply(this):void 0},a.prototype.enter=function(){var a;return null!=(a=this.settings.enter)?a.apply(this):void 0},a.prototype.playerEnter=function(){var a;return null!=(a=this.settings.playerEnter)?a.apply(this):void 0},a.prototype.playerLeave=function(){var a;return null!=(a=this.settings.playerLeave)?a.apply(this):void 0},a.prototype.inScreen=function(){var a;return null!=(a=this.settings.inScreen)?a.apply(this):void 0},a.prototype.outScreen=function(){var a;return null!=(a=this.settings.outScreen)?a.apply(this):void 0},a.prototype.leave=function(){var a;return null!=(a=this.settings.leave)?a.apply(this):void 0},a.prototype.clean=function(){var a,b,c,d,e,f,g,h;for(g=this.createdElements,c=0,e=g.length;e>c;c++)b=g[c],b.destroy();for(this.createdElements=[],h=this.createdBindings,d=0,f=h.length;f>d;d++)a=h[d],Crafty.unbind(a.event,a.callback);return this.createdBindings=[]},a.prototype.add=function(a,b,c){return c.attr({x:this.x+a,y:this.y+b}),this.createdElements.push(c)},a.prototype.addBackground=function(a,b,c,d){return c.addComponent("ViewportRelativeMotion").viewportRelativeMotion({x:this.x+a,y:this.y+b,speed:d}),this.createdElements.push(c)},a.prototype.addElement=function(){var a,c;return c=arguments[0],a=2<=arguments.length?b.call(arguments,1):[],this.generator.elements[c].apply(this,a)},a.prototype.bind=function(a,b){return this.createdBindings.push({event:a,callback:b}),Crafty.bind(a,b)},a.prototype.unbind=function(a){var c,d,e,f,g;for(g=[],f=this.createdBindings,d=0,e=f.length;e>d;d++)c=f[d],c.event===a&&(g.push(c),Crafty.unbind(c.event,c.callback));return this.createdBindings=_.without.apply(_,[this.createdBindings].concat(b.call(g)))},a.prototype.canCleanup=function(){var a,b,c,d,e;if(a=-1*Crafty.viewport._x,this.x+this.delta.x>a)return!1;for(e=this.createdElements,c=0,d=e.length;d>c;c++)if(b=e[c],b.x+b.w>=a)return!1;return!0},a}()}.call(this),function(){var a;a=this.Game,a.LocationGrid=function(){function a(a){var b,c,d,e,f,g,h,i,j;for(a=_.defaults(a,{x:{},y:{}}),a.x=_.defaults(a.x,{start:0,steps:1,stepSize:1}),a.y=_.defaults(a.y,{start:0,steps:1,stepSize:1}),h=this._coordList(a.x),j=this._coordList(a.y),b=[],c=0,e=j.length;e>c;c++)for(i=j[c],d=0,f=h.length;f>d;d++)g=h[d],b.push({x:g,y:i});this.freeCoords=_.shuffle(b)}return a.prototype._coordList=function(a){var b,c,d,e;for(e=[],b=c=0,d=a.steps;d>=0?d>c:c>d;b=d>=0?++c:--c)e.push(a.start+b*a.stepSize);return e},a.prototype.getLocation=function(){return this.freeCoords.pop()},a}()}.call(this),function(){var a,b=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};a=this.Game,a.Synchronizer=function(){function a(){this.entities=[],this.synchronizations={}}return a.prototype.registerEntity=function(a){return b.call(this.entities,a)<0&&this.entities.push(a),a},a.prototype.unregisterEntity=function(a){var b;return b=_.indexOf(this.entities,a),b>=0&&this.entities.splice(b,1),a},a.prototype.synchronizeOn=function(a,c){var d;return d=this.synchronizations[a],d||(d={defer:WhenJS.defer(),registered:[]},this.synchronizations[a]=d),b.call(d.registered,c)<0&&d.registered.push(c),0===_.difference(this.entities,d.registered).length&&d.defer.resolve(),d.defer.promise},a}()}.call(this)}(),function(){(function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.Lunch=function(c){function d(){return d.__super__.constructor.apply(this,arguments)}return b(d,c),d.prototype.metadata={namespace:"City",speed:0,armedPlayers:"oldlasers",title:"In the beginning...",weaponsEnabled:!1},d.prototype.assets=function(){return this.loadAssets("general")},d.prototype.execute=function(){return this.inventoryAdd("item","lasers",function(){return Crafty.e("PowerUp").powerUp({contains:"lasers",marking:"L"})}),a.explosionMode="block",this.sequence(this.setScenery("Blackness"),this.enableWeapons(),this.nextSlide(),this.updateTitle("First enemy"),this.placeSquad(a.Scripts.Slider,{options:{grid:new a.LocationGrid({x:{start:680},y:{start:250}})}}),this.nextSlide(),this.updateTitle("More enemies"),this.setScenery("OpenSpace"),this.setSpeed(150),this.parallel(this.placeSquad(a.Scripts.Slider,{amount:15,options:{grid:new a.LocationGrid({x:{start:680,steps:4,stepSize:40},y:{start:100,steps:5,stepSize:50}})}}),this.sequence(this.waitForScenery("OpenSpace"),this.setSpeed(0))),this.nextSlide(),this.updateTitle("Level geometry"),this.setSpeed(50),this.nextSlide(),this.updateTitle("Speed and collision"),this.setSpeed(250),this.nextSlide(),this.updateTitle("Backgrounds"),this.checkpoint(this.setScenery("OpenSpace")),this.setScenery("TunnelStart"),this.waitForScenery("TunnelStart"),this.setSpeed(50),this.nextSlide(),this.updateTitle("Dialog"),this.say("SpeedLazer","Hello World!"),this.say("SpeedLazer","Flavor text can add to story telling"),this.nextSlide(),this.say("Enemies","Get him!"),this.nextSlide(this.sequence(this.placeSquad(a.Scripts.Slider,{amount:5,options:{grid:new a.LocationGrid({x:{start:680,steps:4,stepSize:40},y:{start:100,steps:5,stepSize:50}})}}),this.wait(3e3))),this.updateTitle("Enemy choreo start"),this.nextSlide(this.sequence(this.placeSquad(a.Scripts.Sine,{amount:5,delay:1e3}),this.wait(3e3))),this.updateTitle("Start stage 1"),this.setScenery("TunnelEnd"),this.setSpeed(350),this.waitForScenery("OceanOld",{event:"inScreen"}),this.setSpeed(50),this.checkpoint(this.setScenery("OceanOld")),this.nextSlide(),this.updateTitle("Vertical motion"),this.parallel(this.gainHeight(600,{duration:15e3}),this.placeSquad(a.Scripts.Sine,{amount:8,delay:1e3})),this.nextSlide(),this.updateTitle("Bezier, powerups"),this.parallel(this.gainHeight(-600,{duration:15e3}),this.nextSlide(this.sequence(this.placeSquad(a.Scripts.Swirler,{drop:"lasers",amount:4,delay:500}),this.waitForScenery("OceanOld")))),this.nextSlide(this.sequence(this.updateTitle("Lazerscript environment"),this.placeSquad(a.Scripts.Swirler,{drop:"lasers",amount:4,delay:500}))),this.checkpoint(this.setScenery("OceanOld")),this.updateTitle("Lazerscript enemies"),this.disableWeapons(),this.placeSquad(a.Scripts.LittleDancer,{amount:4,delay:2e3,options:{grid:new a.LocationGrid({x:{start:150,steps:4,stepSize:100}})}}),this.enableWeapons(),this.nextSlide(),this.updateTitle("Particle effects"),function(b){return function(){return a.explosionMode="particles"}}(this),this.checkpoint(this.setScenery("OceanOld")),this.async(this.runScript(a.Scripts.SunRise,{skipTo:0,speed:4})),this.setScenery("OceanToNew"),this.repeat(3,this.sequence(this.placeSquad(a.Scripts.Swirler,{drop:"lasers",amount:4,delay:500}),this.placeSquad(a.Scripts.Stalker,{drop:"lasers"}))),this.setScenery("CoastStart"),function(b){return function(){return a.explosionMode=null}}(this),this.updateTitle("Graphics!"),this.swirlAttacks(),this.swirlAttacks(),this.setScenery("BayStart"),this.mineSwarm(),this.mineSwarm({direction:"left"}),this.placeSquad(a.Scripts.Stage1BossStage1),this.gainHeight(200,{duration:5e3}),this.showScore(1,"Lunch and learn"),this.repeat(this.sequence(this.placeSquad(a.Scripts.Stage1BossPopup),this.wait(2e3))))},d.prototype.nextSlide=function(a){return this.sequence(function(a){return function(){var b;return null!=(b=a.player(1).ship())?b.superUsed=0:void 0}}(this),this["while"](this._waitForSuperWeapon(),null!=a?a:this.wait(1e3)),function(a){return function(){return a.player(1).ship().superUsed=0}}(this))},d._waitForSuperWeapon=function(){var a,b,c;return a=WhenJS.defer(),c=!1,b=setInterval(function(d){return function(){return null!=d.player(1).ship()&&(c=0!==d.player(1).ship().superUsed),c?(clearInterval(b),a.resolve()):void 0}}(this),300),a.promise},d.prototype.mineSwarm=function(b){return null==b&&(b={direction:"right"}),this.placeSquad(a.Scripts.JumpMine,{amount:8,delay:300,options:{grid:new a.LocationGrid({x:{start:200,steps:10,stepSize:40},y:{start:60,steps:8,stepSize:40}}),direction:b.direction}})},d.prototype.swirlAttacks=function(){return this.parallel(this.repeat(2,this.placeSquad(a.Scripts.Swirler,{amount:4,delay:500,drop:"lasers",options:{shootOnSight:!0}})),this.repeat(2,this.placeSquad(a.Scripts.Shooter,{amount:4,delay:500,drop:"lasers",options:{shootOnSight:!0}})))},d}(a.LazerScript)}).call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.LittleDancer=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.spawn=function(a){return this.wallTarget=a.grid.getLocation(),this.index=(this.wallTarget.x-150)/100,Crafty.e("Drone").drone({health:1900,x:680,y:270,speed:100})},c.prototype.execute=function(){return this.sequence(this["if"](function(a){return function(){return 0===a.index}}(this),this.say("Enemy squad","Welcome to our little dance!")),this.moveTo({x:this.wallTarget.x}),this.synchronizeOn("placed"),this.moveTo({x:this.wallTarget.x+20}),this.moveTo({y:305}),this.repeat(2,this.sequence(this.moveTo({x:this.wallTarget.x+30}),this.wait(500),this.moveTo({x:this.wallTarget.x+20}),this.wait(500))),this.wait(500*this.index),this.moveTo({y:290}),this.wait(100),this.moveTo({y:500}),this.wait(100),this.moveTo({y:310}),this.synchronizeOn("afterJump"),this.moveTo({x:100}),this.movePath([[30,240],[450,210]],{speed:200}),this.explosion(this.location()))},c}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.Sine=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.spawn=function(){return Crafty.e("Drone").drone({health:200,x:680,y:200,speed:250})},c.prototype.execute=function(){return this.movePath([[500,150],[400,225],[300,300],[200,225],[100,150],[0,225],[-100,300]],{rotate:!1})},c}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.Slider=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.spawn=function(a){var b;return b=a.grid.getLocation(),Crafty.e("Drone").drone({health:200,x:b.x,y:b.y,speed:100})},c.prototype.execute=function(){return this.moveTo({x:-30})},c}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.SplashJumper=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.spawn=function(){return Crafty.e("Drone").drone({health:200,x:680,y:200,speed:300})},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.sequence(this.moveTo({x:500}),this.wait(500),this.repeat(this.sequence(this.moveTo({y:600}),this.moveTo({y:50}))))},c.prototype.onKilled=function(){return this.explosion(this.location())},c}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.Stage1=function(c){function d(){return d.__super__.constructor.apply(this,arguments)}return b(d,c),d.prototype.metadata={namespace:"City",armedPlayers:"lasers",speed:50,title:"Hacked"},d.prototype.assets=function(){return this.loadAssets("shadow","explosion")},d.prototype.execute=function(){return this.inventoryAdd("item","lasers",function(){return Crafty.e("PowerUp").powerUp({contains:"lasers",marking:"L"}).color("#2020FF")}),this.inventoryAdd("item","xp",function(){return Crafty.e("PowerUp").powerUp({contains:"xp",marking:"X"})}),this.inventoryAdd("item","diagonals",function(){return Crafty.e("PowerUp").powerUp({contains:"diagonals",marking:"D"}).color("#8080FF")}),this.sequence(this.introText(),this.tutorial(),this.droneTakeover(),this.oceanFighting(),this.enteringLand(),this.cityBay(),this.midstageBossfight(),this.checkpoint(this.checkpointMidStage("Bay",355e3)),this.say("General","Hunt him down!"),this.setSpeed(100),this.placeSquad(a.Scripts.Shooter,{amount:4,delay:1e3,drop:"xp",options:{shootOnSight:!0}}),this.repeat(3,this.stalkerShootout()),this.parallel(this.sequence(this.wait(3e3),this.gainHeight(300,{duration:4e3}),this.placeSquad(a.Scripts.Shooter,{amount:4,delay:1e3,drop:"xp",options:{shootOnSight:!0}})),this.placeSquad(a.Scripts.Stage1BossPopup)),this.cityFighting(),this.repeat(2,this.dummyFights()),this.gainHeight(280,{duration:4e3}),this.checkpoint(this.checkpointMidStage("Skyline",4e5)),this.dummyFights(),this.setScenery("SkylineBase"),this["while"](this.wait(4e3),this.sequence(this.pickTarget("PlayerControlledShip"),this.placeSquad(a.Scripts.Stage1BossRocket,{options:{location:this.targetLocation({x:1.3})}}),this.wait(200))),this.placeSquad(a.Scripts.Stage1BossLeaving),this.say("General","He went to the military complex!\nBut we cant get through those shields now..."),this.wait(3e3),this["if"](function(){return this.player(1).active&&!this.player(2).active},this.sequence(this.say("John","I'll try to find another way in!"),this.say("General","There are rumours about an underground entrance"),this.say("John","Ok I'll check it out"))),this["if"](function(){return!this.player(1).active&&this.player(2).active},this.sequence(this.say("Jim","I'll use the underground tunnels!"),this.say("General","How do you know about those...\nthat's classified info!"))),this["if"](function(){return this.player(1).active&&this.player(2).active},this.sequence(this.say("John","We'll try to find another way in!"),this.say("Jim","We can use the underground tunnels!"),this.say("General","How do you know about those...\nthat's classified info!"))),this.changeSeaLevel(500),this.gainHeight(-580,{duration:6e3}),this.say("Game","End of gameplay for now... \nStarting endless enemies"),this.repeat(this.mineSwarm({points:!1})))},d.prototype.introText=function(){return this.sequence(this.setScenery("Intro"),this.chapterTitle("Hacked"),this.sunRise(),this.cameraCrew(),this.async(this.runScript(a.Scripts.IntroBarrel)),this.wait(2e3),this["if"](function(){return this.player(1).active&&!this.player(2).active},this.sequence(this.say("General","Time to get the last ship to the factory\nto install the automated defence systems"),this.say("John","I hate that we pilots will be without jobs soon"))),this["if"](function(){return!this.player(1).active&&this.player(2).active},this.sequence(this.say("General","Time to get the last ship to the factory\nto install the automated defence systems"),this.say("Jim","Man I don't trust that AI stuff for one bit"))),this["if"](function(){return this.player(1).active&&this.player(2).active},this.sequence(this.say("General","Time to get the last 2 ships to the factory\nto install the automated defence systems"),this.say("John","I hate that we pilots will be without jobs soon"))),this.say("General","It saves lives when you no longer need soldiers,\nAI technology is the future after all."),this.wait(3e3))},d.prototype.tutorial=function(){return this.sequence(this.setScenery("Ocean"),this.say("General","We send some drones for some last manual target practice"),this.repeat(2,this.sequence(this.dropWeaponsForEachPlayer(),this.wait(2e3),this.placeSquad(a.Scripts.Swirler,{amount:4,delay:500,drop:"xp"}))))},d.prototype.dropWeaponsForEachPlayer=function(){return this.parallel(this["if"](function(){return this.player(1).active&&!this.player(1).has("lasers")},this.drop({item:"lasers",inFrontOf:this.player(1)})),this["if"](function(){return this.player(2).active&&!this.player(2).has("lasers")},this.drop({item:"lasers",inFrontOf:this.player(2)})))},d.prototype.dropDiagonalsForEachPlayer=function(){return this.parallel(this["if"](function(){return this.player(1).active&&!this.player(1).has("diagonals")},this.drop({item:"diagonals",inFrontOf:this.player(1)})),this["if"](function(){return this.player(2).active&&!this.player(2).has("diagonals")},this.drop({item:"diagonals",inFrontOf:this.player(2)})))},d.prototype.droneTakeover=function(){return this.parallel(this.placeSquad(a.Scripts.CrewShooters,{amount:4,delay:750,drop:"xp"}),this.sequence(this.say("General","What the hell is happening with our drones?"),this.say("General","They do not respond to our commands anymore!\nThe defence AI has been compromised!")))},d.prototype.cameraCrew=function(){return this.async(this.placeSquad(a.Scripts.CameraCrew))},d.prototype.oceanFighting=function(){return this.sequence(this.checkpoint(this.checkpointStart("Ocean",42e3)),this.parallel(this.sequence(this.wait(2e3),this.say("General","We're under attack!")),this.swirlAttacks()),this.setScenery("CoastStart"),this.swirlAttacks(),this.underWaterAttacks())},d.prototype.enteringLand=function(){return this.sequence(this.checkpoint(this.checkpointStart("CoastStart",11e4)),this.setScenery("BayStart"),this.mineSwarm(),this.underWaterAttacks(),this.parallel(this.swirlAttacks(),this.mineSwarm()))},d.prototype.cityBay=function(){return this.sequence(this.checkpoint(this.checkpointStart("Bay",173e3)),this.setScenery("UnderBridge"),this.parallel(this.placeSquad(a.Scripts.Stalker),this.mineSwarm({direction:"left"})),this.parallel(this.sequence(this.stalkerShootout(),this.parallel(this.placeSquad(a.Scripts.Stalker),this.mineSwarm({direction:"left"})),this.swirlAttacks())))},d.prototype.midstageBossfight=function(){return this.sequence(this.checkpoint(this.checkpointStart("Bay",226e3)),this.setScenery("UnderBridge"),this.parallel(this["if"](function(){return this.player(1).active},this.drop({item:"xp",inFrontOf:this.player(1)})),this["if"](function(){return this.player(2).active},this.drop({item:"xp",inFrontOf:this.player(2)}))),this.mineSwarm(),this.parallel(this["if"](function(){return this.player(1).active},this.drop({item:"xp",inFrontOf:this.player(1)})),this["if"](function(){return this.player(2).active},this.drop({item:"xp",inFrontOf:this.player(2)}))),this.mineSwarm({direction:"left"}),this.parallel(this["if"](function(){return this.player(1).active},this.drop({item:"xp",inFrontOf:this.player(1)})),this["if"](function(){return this.player(2).active},this.drop({item:"xp",inFrontOf:this.player(2)}))),this.mineSwarm(),this["while"](this.waitForScenery("UnderBridge",{event:"inScreen"}),this.sequence(this.pickTarget("PlayerControlledShip"),this.placeSquad(a.Scripts.Stage1BossRocket,{options:{location:this.targetLocation({x:1.3})}}),this.wait(200))),this.setSpeed(0),this.placeSquad(a.Scripts.Stage1BossStage1),this.setSpeed(50))},d.prototype.swirlAttacks=function(){return this.parallel(this.repeat(2,this.placeSquad(a.Scripts.Swirler,{amount:4,delay:500,drop:"xp",options:{shootOnSight:!0}})),this.repeat(2,this.placeSquad(a.Scripts.Shooter,{amount:4,delay:500,drop:"xp",options:{shootOnSight:!0}})))},d.prototype.underWaterAttacks=function(){return this.sequence(this.placeSquad(a.Scripts.Stalker),this.repeat(2,this.stalkerShootout()))},d.prototype.sunRise=function(b){return null==b&&(b={skipTo:0}),this.async(this.runScript(a.Scripts.SunRise,b))},d.prototype.mineSwarm=function(b){var c;return null==b&&(b={direction:"right"}),this.placeSquad(a.Scripts.JumpMine,{amount:14,delay:300,options:{grid:new a.LocationGrid({x:{start:.3,steps:12,stepSize:.05},y:{start:.125,steps:12,stepSize:.05}}),points:null!=(c=b.points)?c:!0,direction:b.direction}})},d.prototype.stalkerShootout=function(){return this.parallel(this.placeSquad(a.Scripts.Stalker),this.placeSquad(a.Scripts.Shooter,{amount:4,delay:1e3,drop:"xp",options:{shootOnSight:!0}}),this.placeSquad(a.Scripts.Swirler,{amount:4,delay:1e3,drop:"xp",options:{shootOnSight:!0}}))},d.prototype.cityFighting=function(){return this.sequence(this.setScenery("Skyline"),this.parallel(this.sequence(this.placeSquad(a.Scripts.ScraperFlyer,{amount:8,delay:750,drop:"xp"}),this.placeSquad(a.Scripts.Stage1BossPopup)),this.sequence(this.wait(3e3),this.placeSquad(a.Scripts.Swirler,{amount:8,delay:750,drop:"xp",options:{shootOnSight:!0}}))))},d.prototype.dummyFights=function(){return this["while"](this.parallel(this.placeSquad(a.Scripts.ScraperFlyer,{amount:8,delay:750,drop:"xp"}),this.placeSquad(a.Scripts.Swirler,{amount:8,delay:500,drop:"xp",options:{shootOnSight:!0,speed:300}}),this.placeSquad(a.Scripts.Shooter,{amount:8,delay:1e3,drop:"xp",options:{shootOnSight:!0,speed:300}})),this.sequence(this.pickTarget("PlayerControlledShip"),this.placeSquad(a.Scripts.Stage1BossRocket,{options:{location:this.targetLocation({x:1.3})}}),this.wait(500)))},d.prototype.checkpointStart=function(a,b){return this.sequence(this.parallel(this.setScenery(a),this.sunRise({skipTo:b})),this.wait(2e3))},d.prototype.checkpointMidStage=function(a,b){return this.sequence(this.parallel(this.sunRise({skipTo:b}),this.setScenery(a)),this.dropDiagonalsForEachPlayer(),this.wait(2e3))},d}(a.LazerScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.IntroBarrel=function(c){function d(){return d.__super__.constructor.apply(this,arguments)}return b(d,c),d.prototype.spawn=function(){return Crafty.e("2D, WebGL, Tween, Color, Collision, Choreography, Hideable").color("#606000").attr({z:3,w:10,h:15,speed:150}).onHit("PlayerControlledShip",function(b){return a.paused?void 0:this.trigger("Knock",b[0].obj)})},d.prototype.execute=function(){return this.bindSequence("Knock",this.knockedOff),this.sequence(this.pickTarget("BarrelLocation"),this.setLocation(this.targetLocation({offsetY:-15})),this.wait(2e4))},d.prototype.knockedOff=function(a){return a.trigger("BonusPoints",25),this.parallel(this.moveTo({y:1.25}),this.rotate(90,1500))},d}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.CameraCrew=function(c){function d(){return d.__super__.constructor.apply(this,arguments)}return b(d,c),d.prototype.assets=function(){return this.loadAssets("helicopter")},d.prototype.spawn=function(a){return Crafty.e("CameraCrew, Horizon").attr({x:.2*Crafty.viewport.width-Crafty.viewport.x,y:.2*Crafty.viewport.height,speed:100,topDesaturation:.3,bottomDesaturation:.3}).cameraCrew()},d.prototype.execute=function(){return this.entity.colorDesaturation(a.backgroundColor),this.bindSequence("Hit",this.crash),this.sequence(this.sendToBackground(.85,-100),this.setLocation({x:.45,y:.4}),this.moveTo({x:-.1}),function(a){return function(){return a.entity.flip("X")}}(this),this.wait(200),this.sendToBackground(.75,-200),this.moveTo({x:.22,y:.45}),this.repeat(this.sequence(this.moveTo({x:.36,y:.47,speed:25,easing:"easeInOutQuad"}),this.moveTo({x:.25,y:.5,speed:25,easing:"easeInOutQuad"}))))},d.prototype.crash=function(){return this.sequence(function(a){return function(){return a.entity.flip("Y"),a.entity.unflip("X")}}(this),this["while"](this.movePath([[.6,.82]],{speed:150}),this.sequence(this.explosion(this.location(),{radius:10,duration:480,z:-199,topDesaturation:.3,bottomDesaturation:.3}),this.wait(100))),this.moveTo({y:1.1}))},d}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.CrewShooters=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.assets=function(){return this.loadAssets("drone")},c.prototype.spawn=function(){return Crafty.e("Drone, ShootOnSight, ColorEffects, Horizon").drone({x:Crafty.viewport.width+40,y:.23*Crafty.viewport.height,speed:250}).shootOnSight({targetType:"CameraCrew",shootWhenHidden:!0,projectile:function(a){return function(a,b,c){var d;return d=Crafty.e("Projectile, Color, BackgroundBullet, ColorEffects, Horizon").attr({w:3,h:3,z:-200,speed:300,topDesaturation:.5,bottomDesaturation:.5}).color("#FFFF00"),d.shoot(a,b,c)}}(this)})},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.sequence(this.sendToBackground(.5,-200),this.parallel(this.movePath([[.96,.64],[.3,.35],[.65,.23],[.93,.43],[.33,.63],[-.33,.23]]),this.sequence(this.wait(2e3),this.scale(1,{duration:3e3}),this.reveal(),this.shootPlayer())))},c.prototype.onKilled=function(){return this.explosion(this.location())},c.prototype.shootPlayer=function(){return function(a){return function(){return a.entity.shootOnSight({cooldown:1e3,sightAngle:8,projectile:function(a,b,c){var d;return d=Crafty.e("Projectile, Color, Enemy").attr({w:6,h:6,speed:350}).color("#FFFF00"),d.shoot(a,b,c)}})}}(this)},c}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.JumpMine=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.assets=function(){return this.loadAssets("mine")},c.prototype.spawn=function(a){var b,c;return c="right"===a.direction?Crafty.viewport.width+80:-80,this.target=a.grid.getLocation(),Crafty.e("Mine").mine({x:c,y:340,speed:null!=(b=a.speed)?b:200,pointsOnHit:a.points?10:0,pointsOnDestroy:a.points?50:0})},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.sequence(this.moveTo({y:1.05,speed:400}),this.moveTo({x:this.target.x}),this.moveTo({y:this.target.y}),this.parallel(this.sequence(this.synchronizeOn("placed"),this.animate("open"),this.wait(200),this.moveTo({x:-50,speed:35})),this.sequence(this.wait(4e3),this.animate("blink",-1),this.wait(1e3),this.parallel(this.screenShake(10,{
duration:200}),this.explosion(this.location(),{damage:300,radius:40})),this.endSequence())))},c.prototype.onKilled=function(){return this.parallel(this.screenShake(10,{duration:200}),this.explosion(this.location(),{damage:300,radius:40}))},c}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.MineWall=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.spawn=function(a){return this.startX="left"===a.direction?-80:680,this.screenX="left"===a.direction?20:620,this.wallX="left"===a.direction?100:540,this.wallTarget=a.grid.getLocation(),Crafty.e("Mine").mine({x:this.startX,y:240,speed:200})},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.sequence(this.movePath([[this.screenX,240],[this.wallX,this.wallTarget.y]],{rotate:!1,speed:600}),this.synchronizeOn("placed"),this.pickTarget("PlayerControlledShip"),this.repeat(this.seekAndDestroy()))},c.prototype.seekAndDestroy=function(){return this.moveTo(this.targetLocation())},c.prototype.onKilled=function(){return this.explosion(this.location(),{damage:300,radius:40})},c}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.ScraperFlyer=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.assets=function(){return this.loadAssets("drone")},c.prototype.spawn=function(){return Crafty.e("Drone, ShootOnSight, ColorEffects, Horizon").drone({x:-50,y:.7*Crafty.viewport.height,speed:300}).shootOnSight({cooldown:800,sightAngle:15,projectile:function(a){return function(a,b,c){var d;return d=Crafty.e("Projectile, Color, Enemy").attr({w:6,h:6,speed:450}).color("#FFFF00"),d.shoot(a,b,c)}}(this)})},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.sequence(this.sendToBackground(.5,-400),this.parallel(this.movePath([[.6,.8],[.8,.3],[.5,.1],[.2,.25],[.5,.7],[.8,.4],[.4,.2],[-.1,.4]]),this.sequence(this.wait(2e3),this.scale(1,{duration:2e3}),this.reveal())))},c.prototype.onKilled=function(){return this.explosion(this.location())},c}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.Shooter=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.assets=function(){return this.loadAssets("drone")},c.prototype.spawn=function(a){var b,c;return b=Crafty.e("Drone").drone({x:Crafty.viewport.width+40,y:.71*Crafty.viewport.height,speed:null!=(c=a.speed)?c:200}),a.shootOnSight&&b.addComponent("ShootOnSight").shootOnSight({cooldown:1e3,sightAngle:8,projectile:function(a){return function(a,b,c){var d;return d=Crafty.e("Projectile, Color, Enemy").attr({w:6,h:6,speed:350}).color("#FFFF00"),d.shoot(a,b,c)}}(this)}),b},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.movePath([[.5,.625],[.2,.5],[.53,.21],[.9,.54],[-20,.625]])},c.prototype.onKilled=function(){return this.explosion(this.location())},c}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.Stage1BossStage1=function(c){function d(){return d.__super__.constructor.apply(this,arguments)}return b(d,c),d.prototype.assets=function(){return this.loadAssets("largeDrone")},d.prototype.spawn=function(){return Crafty.e("LargeDrone").drone({x:Crafty.viewport.width+40,y:.35*Crafty.viewport.height,speed:100,pointsOnHit:10})},d.prototype.execute=function(){return this.bindSequence("Hit",this.fase2,function(a){return function(){return a.entity.health<345e3}}(this)),this.inventoryAdd("item","lasers",function(){return Crafty.e("PowerUp").powerUp({contains:"lasers",marking:"L"}).color("#8080FF")}),this.inventoryAdd("item","diagonals",function(){return Crafty.e("PowerUp").powerUp({contains:"diagonals",marking:"D"}).color("#8080FF")}),this.sequence(function(a){return function(){return a.entity.invincible=!0}}(this),this.animate("slow",-1,"eye"),this.disableWeapons(),this.parallel(this.moveTo({x:.85,y:.41}),this.sequence(this.say("Large Drone","We have control now! You will suffer!"),this.say("Large Drone","Earths defences are in our hands!"),this.wait(500))),function(a){return function(){return a.entity.invincible=!1}}(this),this.enableWeapons(),this.async(this.placeSquad(a.Scripts.Stage1BossRocket,{options:{location:this.location(),pointsOnDestroy:0,pointsOnHit:0}})),this.animate("emptyWing",0,"wing"),this.animate("reload",0,"wing"),this.moveTo({y:.43,speed:5}),this.repeat(this.attackCycle(5)))},d.prototype.attackCycle=function(b){return this.sequence(this.async(this.runScript(a.Scripts.Stage1BossMine,this.location())),this.moveTo({y:.41,speed:b}),this.wait(200),this.async(this.placeSquad(a.Scripts.Stage1BossRocket,{options:{location:this.location(),pointsOnDestroy:0,pointsOnHit:0}})),this.animate("emptyWing",0,"wing"),this.animate("reload",0,"wing"),this.async(this.runScript(a.Scripts.Stage1BossMine,this.location())),this.moveTo({y:.43,speed:b}),this.async(this.placeSquad(a.Scripts.Stage1BossRocket,{options:{location:this.location(),pointsOnDestroy:0,pointsOnHit:0}})),this.animate("emptyWing",0,"wing"),this.wait(200),this.animate("reload",0,"wing"))},d.prototype.attackCycle3=function(b){return this.repeat(this.sequence(this.repeat(5,this.sequence(this.pickTarget("PlayerControlledShip"),this["while"](this.moveTo(this.targetLocation({offsetY:-20,x:.85})),this.sequence(this.async(this.runScript(a.Scripts.Stage1BossMine,this.location())),this.wait(800),this.async(this.placeSquad(a.Scripts.Stage1BossHomingRocket,{options:{location:this.location(),pointsOnDestroy:0,pointsOnHit:0}})),this.animate("emptyWing",0,"wing"),this.animate("reload",0,"wing"),this.async(this.runScript(a.Scripts.Stage1BossMine,this.location())),this.wait(800),this.async(this.placeSquad(a.Scripts.Stage1BossHomingRocket,{options:{location:this.location(),pointsOnDestroy:0,pointsOnHit:0}})),this.animate("emptyWing",0,"wing"),this.wait(800),this.animate("reload",0,"wing"))),this.wait(1e3))),this.rocketRaid()))},d.prototype.rocketRaid=function(){return this.sequence(function(a){return function(){return a.entity.invincible=!0}}(this),this.moveTo({y:.1}),this.repeat(10,this.sequence(this.async(this.placeSquad(a.Scripts.Stage1BossHomingRocket,{options:{location:this.location(),pointsOnDestroy:0,pointsOnHit:0}})),this.animate("emptyWing",0,"wing"),this.animate("reload",0,"wing"),this.wait(300))),this.pickTarget("PlayerControlledShip"),this.moveTo(this.targetLocation({offsetY:-20}),{x:.85}),function(a){return function(){return a.entity.invincible=!1}}(this))},d.prototype.bombRaid=function(b){return null==b&&(b=!1),this.sequence(function(a){return function(){return a.entity.invincible=!0}}(this),this.moveTo({y:.1}),this["while"](this.moveTo({x:-100,speed:200}),this.sequence(this.async(this.placeSquad(a.Scripts.Stage1BossBombRaid,{options:{location:this.location(),armed:!1}})),this.wait(500))),function(a){return function(){return a.entity.flipX()}}(this),this["while"](this.moveTo({x:1,speed:200}),this.sequence(this.async(this.placeSquad(a.Scripts.Stage1BossBombRaid,{options:{location:this.location(),armed:b}})),this.wait(500))),this.moveTo({x:1.2,speed:200}),function(a){return function(){return a.entity.unflipX()}}(this),this.moveTo({x:.85,y:.41,speed:200}),function(a){return function(){return a.entity.invincible=!1}}(this))},d.prototype.fase2=function(){return this.bindSequence("Hit",this.fase3,function(a){return function(){return a.entity.health<33e4}}(this)),this.sequence(this.setSpeed(50),this.bombRaid(!0),this.repeat(this.sequence(this.repeat(3,this.attackCycle(7)),this.laugh(),this.async(this.placeSquad(a.Scripts.Stage1BossDroneRaid,{amount:4,delay:300,options:{shootOnSight:!0}})),this.laugh())))},d.prototype.laugh=function(){return this.sequence(function(a){return function(){return a.entity.invincible=!0}}(this),this.repeat(5,this.sequence(this.rotate(10,200),this.rotate(-10,200))),this.rotate(0,200),function(a){return function(){return a.entity.invincible=!1}}(this))},d.prototype.fase3=function(){return this.bindSequence("Hit",this.fase4,function(a){return function(){return a.entity.health<305e3}}(this)),this.sequence(this.setSpeed(50),this.bombRaid(!0),this.attackCycle3(6))},d.prototype.fase4=function(){return this.sequence(this.drop({location:this.location(),item:"diagonals"}),this["while"](this.moveTo({x:1.15,y:.21,speed:50}),this.sequence(this.explosion(this.location()),this.wait(700))))},d}(a.EntityScript),a.Scripts.Stage1BossMine=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.assets=function(){return this.loadAssets("mine")},c.prototype.spawn=function(a){return Crafty.e("Mine").mine({health:100,x:a().x,y:a().y+10,z:-4,speed:200,pointsOnHit:0,pointsOnDestroy:0})},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.sequence(this.pickTarget("PlayerControlledShip"),this.moveTo({y:1.1}),function(a){return function(){return a.entity.attr({z:0})}}(this),this.moveTo(this.targetLocation(),{y:1.01}),this.moveTo(this.targetLocation({x:null})),this.animate("open"),this.wait(200),this.animate("blink",-1),this.wait(1e3),this.parallel(this.screenShake(10,{duration:200}),this.explosion(this.location(),{damage:200,radius:40})))},c.prototype.onKilled=function(){return this.parallel(this.screenShake(10,{duration:200}),this.explosion(this.location(),{damage:200,radius:40}))},c}(a.EntityScript),a.Scripts.Stage1BossRocket=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.spawn=function(a){var b;return a=_.defaults(a,{pointsOHit:125,pointsOnDestroy:50}),null==a.location?null:(b="function"==typeof a.location?a.location():void 0,b?Crafty.e("Rocket").rocket({health:250,x:b.x-30,y:b.y-8+Math.round(15*Math.random()),z:0,speed:600,pointsOnHit:a.pointsOnHit,pointsOnDestroy:a.pointsOnDestroy}):null)},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.moveTo({x:-205})},c.prototype.onKilled=function(){return this.parallel(this.screenShake(10,{duration:200}),this.explosion(this.location(),{damage:200,radius:40}))},c}(a.EntityScript),a.Scripts.Stage1BossHomingRocket=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.spawn=function(a){var b;return a=_.defaults(a,{pointsOHit:125,pointsOnDestroy:50}),null==a.location?null:(b="function"==typeof a.location?a.location():void 0,b?Crafty.e("Rocket").rocket({health:250,x:b.x-30,y:b.y-8+Math.round(15*Math.random()),z:0,speed:600,pointsOnHit:a.pointsOnHit,pointsOnDestroy:a.pointsOnDestroy}):null)},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.sequence(this.pickTarget("PlayerControlledShip"),this.movePath([this.targetLocation(),[-160,.5]]))},c.prototype.onKilled=function(){return this.parallel(this.screenShake(10,{duration:200}),this.explosion(this.location(),{damage:200,radius:40}))},c}(a.EntityScript),a.Scripts.Stage1BossPopup=function(c){function d(){return d.__super__.constructor.apply(this,arguments)}return b(d,c),d.prototype.assets=function(){return this.loadAssets("largeDrone")},d.prototype.spawn=function(){return Crafty.e("LargeDrone").drone({health:264e3,x:Crafty.viewport.width+40,y:.5*Crafty.viewport.height,speed:150})},d.prototype.execute=function(){return this.bindSequence("Hit",this.leaveScreen,function(a){return function(){return a.entity.health<255e3}}(this)),this.inventoryAdd("item","xp",function(){return Crafty.e("PowerUp").powerUp({contains:"xp",marking:"X"})}),this.sequence(this.animate("slow",-1,"eye"),this.pickTarget("PlayerControlledShip"),this.moveTo(this.targetLocation(),{x:.845},200),this.attackCycle())},d.prototype.leaveScreen=function(){return this.sequence(this.drop({location:this.location(),item:"xp"}),this["while"](this.moveTo({x:1.15,speed:100}),this.sequence(this.explosion(this.location()),this.wait(700))))},d.prototype.attackCycle=function(){return this.repeat(this.sequence(this.async(this.placeSquad(a.Scripts.Stage1BossHomingRocket,{options:{location:this.location()}})),this.animate("emptyWing",0,"wing"),this.parallel(this.moveTo(this.targetLocation({offsetY:-20}),{x:.845}),this.sequence(this.animate("reload",0,"wing"),this.wait(1e3)))))},d}(a.EntityScript),a.Scripts.Stage1BossLeaving=function(c){function d(){return d.__super__.constructor.apply(this,arguments)}return b(d,c),d.prototype.assets=function(){return this.loadAssets("largeDrone")},d.prototype.spawn=function(){return Crafty.e("LargeDrone, Horizon").drone({health:264e3,x:Crafty.viewport.width+40,y:.5*Crafty.viewport.height,speed:150})},d.prototype.execute=function(){return this.inventoryAdd("item","lasers",function(){return Crafty.e("PowerUp").powerUp({contains:"lasers",marking:"L"}).color("#8080FF")}),this.entity.colorDesaturation(a.backgroundColor),this.sequence(this.animate("slow",-1,"eye"),this.pickTarget("PlayerControlledShip"),this.moveTo(this.targetLocation(),{x:.845,speed:200}),this.attackCycle(),this.laugh(),this.leaveScreen())},d.prototype.laugh=function(){return this.sequence(function(a){return function(){return a.entity.invincible=!0}}(this),this.repeat(5,this.sequence(this.rotate(10,200),this.rotate(-10,200))),this.rotate(0,200),function(a){return function(){return a.entity.invincible=!1}}(this))},d.prototype.leaveScreen=function(){return this.sequence(this.animate("emptyWing",0,"wing"),function(a){return function(){return a.entity.eye.destroy()}}(this),this.sendToBackground(.9,-100),this.parallel(this.moveTo({x:-.15,speed:400}),this.scale(.7,{duration:3e3})),function(a){return function(){return a.entity.flip("X")}}(this),this.sendToBackground(.7,-550),this.parallel(this.moveTo("MiliBase",{speed:150}),this.scale(.3,{duration:4e3})))},d.prototype.attackCycle=function(){return this.repeat(4,this.sequence(this.async(this.placeSquad(a.Scripts.Stage1BossRocket,{options:{location:this.location(),pointsOnDestroy:0,pointsOnHit:0}})),this.animate("emptyWing",0,"wing"),this.parallel(this.moveTo(this.targetLocation({offsetY:-20}),{x:.845}),this.sequence(this.animate("reload",0,"wing"),this.wait(1e3)))))},d}(a.EntityScript),a.Scripts.Stage1BossBombRaid=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.assets=function(){return this.loadAssets("mine")},c.prototype.spawn=function(a){var b;return b=a.location(),this.armed=a.armed,Crafty.e("Mine").mine({health:200,x:b.x,y:b.y+10,z:-4,speed:400,pointsOnHit:10,pointsOnDestroy:20})},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.armed?this.sequence(this.animate("blink",-1),this.moveTo({y:.3+.6*Math.random()}),this.wait(150),this.onKilled()):this.sequence(this.moveTo({y:1.2}))},c.prototype.onKilled=function(){return this.parallel(this.screenShake(10,{duration:200}),this.explosion(this.location(),{damage:300,radius:40}))},c}(a.EntityScript),a.Scripts.Stage1BossDroneRaid=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.assets=function(){return this.loadAssets("drone")},c.prototype.spawn=function(a){var b;return b=Crafty.e("Drone").drone({health:200,x:Crafty.viewport.width+40,y:.1*Crafty.viewport.height,speed:500}),a.shootOnSight&&b.addComponent("ShootOnSight").shootOnSight({cooldown:1e3,sightAngle:8,projectile:function(a){return function(a,b,c){var d;return d=Crafty.e("Projectile, Color, Enemy").attr({w:6,h:6,speed:650}).color("#FFFF00"),d.shoot(a,b,c)}}(this)}),b},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.sequence(this.pickTarget("PlayerControlledShip"),this.movePath([this.targetLocation(),[-160,.5]]))},c.prototype.onKilled=function(){return this.explosion(this.location())},c}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.Stalker=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.assets=function(){return this.loadAssets("drone")},c.prototype.spawn=function(){return Crafty.e("Drone").drone({health:100,x:Crafty.viewport.width+40,y:.83*Crafty.viewport.height,speed:600,pointsOnHit:125})},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.sequence(this.pickTarget("PlayerControlledShip"),this.moveTo({x:1.1,y:1.01}),this.repeat(5,this.sequence(this.moveTo(this.targetLocation(),{y:1.01,speed:200,easing:"easeInOutQuad"}),this.wait(100))),this.moveTo({y:.7,speed:200}),this.wait(100),this.moveTo({y:.73,speed:100}),this.wait(100),this.moveTo({y:.7,speed:100}),this.moveTo({y:-50}))},c.prototype.onKilled=function(){return this.explosion(this.location())},c}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.StalkerChain=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.spawn=function(a){return this.target=a.grid.getLocation(),Crafty.e("Drone,Tween,ShootOnSight").drone({health:100,x:680,y:400,speed:300})},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.sequence(this.moveTo({x:680,y:550}),this.moveTo({x:600}),this.moveTo({y:this.target.y}),this.synchronizeOn("placed"),this.rotate(90,500),this.moveTo({x:600,y:110,speed:200}),this.movePath([[600,100],[500,50],[300,350],[-50,250]]))},c.prototype.onKilled=function(){return this.explosion(this.location())},c}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.SunRise=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.assets=function(){return this.loadAssets("sun")},c.prototype.spawn=function(a){var b,c,d;return d=Crafty("Sun"),c=Crafty("Sky").get(0)||Crafty.e("2D, WebGL, Gradient, Sky, HUD, ColorFade").attr({w:Crafty.viewport.width,h:.7*Crafty.viewport.height}).positionHud({x:0,y:0,z:-1e3}),d.length>0?d.attr({x:d.x+Crafty.viewport.x,y:d.y+Crafty.viewport.y}):Crafty.e("Sun, KeepAlive").sun({x:.97*Crafty.viewport.width,y:.85*Crafty.viewport.height,speed:null!=(b=a.speed)?b:1})},c.prototype.execute=function(){var a,b,c,d;return d=null!=(c=this.options.speed)?c:1,b=4e4/d,a=9e5/d,this.sequence(this.setLocation({x:.97,y:.74}),this.backgroundColorFade({duration:b,skip:this.options.skipTo},["#000020","#000020","#ca4331"],["#000000","#222c50"]),this.parallel(this.backgroundColorFade({duration:a,skip:this.options.skipTo-b},["#ca4331","#fcaf01","#f7e459","#5dade9","#5ba5ec","#5ba5ec","#5ba5ec"],["#222c50","#7a86a2","#5dade9","#366eab"]),this.movePath([[.75,.31],[.5,.21]],{rotate:!1,skip:this.options.skipTo-b})))},c}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.SunSet=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.spawn=function(a){var b;return b=Crafty("Sun"),b.length>0?b.attr({x:b.x+Crafty.viewport.x,y:b.y+Crafty.viewport.y}):Crafty.e("Sun, ColorFade, KeepAlive").sun({x:620,y:340,speed:2})},c.prototype.execute=function(){return this.sequence(this.moveTo({x:320,y:100,speed:2e3}),this.backgroundColorFade({duration:1},"#8080FF"),this.parallel(this.movePath([[220,120],[120,320],[20,420]],{rotate:!1}),this.colorFade({duration:3e5},"#DDDD80","#DDDD00","#DD8000"),this.sequence(this.wait(15e4),this.backgroundColorFade({duration:15e4},"#8080FF","#602020"))))},c}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.Swirler=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.assets=function(){return this.loadAssets("drone")},c.prototype.spawn=function(a){var b,c;return b=Crafty.e("Drone").drone({x:Crafty.viewport.width+40,y:Crafty.viewport.height/2,speed:null!=(c=a.speed)?c:200}),a.shootOnSight&&b.addComponent("ShootOnSight").shootOnSight({cooldown:1e3,sightAngle:8,projectile:function(a){return function(a,b,c){var d;return d=Crafty.e("Projectile, Color, Enemy").attr({w:6,h:6,speed:350}).color("#FFFF00"),d.shoot(a,b,c)}}(this)}),b},c.prototype.execute=function(){return this.bindSequence("Destroyed",this.onKilled),this.movePath([[.5,.21],[.156,.5],[.5,.833],[.86,.52],[-20,.21]])},c.prototype.onKilled=function(){return this.explosion(this.location())},c}(a.EntityScript)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game,a.Scripts||(a.Scripts={}),a.Scripts.Test=function(c){function d(){return d.__super__.constructor.apply(this,arguments)}return b(d,c),d.prototype.metadata={namespace:"City",armedPlayers:"lasers",speed:0,title:"WebGL-Shaders"},d.prototype.assets=function(){return this.loadAssets("general")},d.prototype.execute=function(){return this.sequence(this.setScenery("Bay"),this.async(this.runScript(a.Scripts.SunRise,{skipTo:0,speed:4})),this.setSpeed(100),this.wait(1e3),this.setScenery("UnderBridge"),this.waitForScenery("UnderBridge",{event:"inScreen"}),this.setSpeed(0),this.placeSquad(a.Scripts.Stage1BossStage1),this.setScenery("UnderBridge"))},d}(a.LazerScript)}.call(this)}(),function(){(function(){var a,b,c=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},d={}.hasOwnProperty;b=this.Game.levelGenerator,a=this.Game,b.defineElement("cloud",function(){var a,b,c,d,e,f,g,h;return f=Math.random(),a=4*Math.random(),f>.2&&(h=20*Math.random()+100,g=20*Math.random()+125,d=10*Math.random()+50,b=Crafty.e("2D, WebGL, cloud, Hideable, Horizon").attr({z:-200,w:g,h:d,topDesaturation:.6,bottomDesaturation:.6,alpha:.8*Math.random()+.2,blur:a}),Math.random()<.7&&(b=b.flip("X")),this.addBackground(200,h,b,.5)),.6>f?(e=.2*Math.random()+.25,h=230-50*e,g=10*Math.random()+70-20*e,d=5*Math.random()+20-10*e,c=Crafty.e("2D, WebGL, cloud, Hideable, Horizon").attr({z:-250+20*e,w:g,h:d,topDesaturation:1-e,bottomDesaturation:1-e,alpha:.8*Math.random()+.2,blur:a}),Math.random()<.2&&(c=c.flip("X")),this.addBackground(300,h,c,e)):void 0}),b.defineElement("waterHorizon",function(){var b,c;return c=Crafty.e("2D, WebGL, waterHorizon, SunBlock, Horizon").attr({z:-600}).colorDesaturation(a.backgroundColor).saturationGradient(1,0),this.addBackground(0,this.level.visibleHeight-175,c,.25),b=Crafty.e("2D, WebGL, Gradient, GoldenStripe").topColor("#DDDD00").bottomColor("#DDDD00",0).attr({z:-599,w:.25*this.delta.x,h:1,alpha:0}),this.addBackground(0,this.level.visibleHeight-175,b,.25)}),b.defineElement("water",function(){var b;return b=Crafty.e("2D, WebGL, waterMiddle, Horizon, ColorEffects").attr({z:-500}).colorDesaturation(a.backgroundColor).saturationGradient(.7,0),this.addBackground(0,this.level.visibleHeight-125,b,.5),this.level.registerWaveTween("OceanWavesMiddle",5500,"easeInOutQuad",function(a,b){var c,d,e;return e=5,c=15,d=105,Crafty("waterMiddle").each(function(){return b?(this.dy=a*e,this.h=d-a*c):(this.dy=e-a*e,this.h=d-c+a*c)})})}),b.defineElement("waterFront",function(a){var b,c,d;return null==a&&(a={}),b=65,this.add(0,this.level.visibleHeight-10,Crafty.e("2D, Solid").attr({w:this.delta.x,h:10})),c=Crafty.e("2D, WebGL, waterFront1, Wave1").attr({z:-20}).attr(a),this.add(0,this.level.visibleHeight-b,c),c.originalY=c.y,d=Crafty.e("2D, WebGL, waterFront2, Wave2").attr({z:-20}).attr(a),this.add(400,this.level.visibleHeight-b,d),d.originalX=d.x,d.originalY=d.y,this.level.registerWaveTween("OceanWaves",6e3,"easeInOutQuad",function(a,c){var d,e,f,g;return d=50,e=40,f=5,g=400,b=125,Crafty("Wave1").each(function(){return c?(this.w=g+a*d,this.y=this.originalY+a*f,this.h=b-a*e):(this.w=g+d-a*d,this.y=this.originalY+f-a*f,this.h=b-e+a*e)}),Crafty("Wave2").each(function(){return c?(this.w=g-a*d,this.x=this.originalX+a*d,this.y=this.originalY+a*f,this.h=b-a*e):(this.w=g-d+a*d,this.x=this.originalX+d-a*d,this.y=this.originalY+f-a*f,this.h=b-e+a*e)}),Crafty("WaveFront").each(function(){return g=1200,d=120,b=200,e=80,c?(this.w=g+a*d,this.y=this.originalY+a*f,this.h=b-a*e):(this.w=g+d-a*d,this.y=this.originalY+f-a*f,this.h=b-e+a*e)})})}),b.defineElement("cityHorizon",function(b){var c;return this.addElement("waterHorizon"),c="start"===b?Crafty.e("2D, WebGL, ColorEffects, coastStart, SunBlock, Horizon"):Crafty.e("2D, WebGL, ColorEffects, coast, SunBlock, Horizon"),c.attr({z:-598}).colorDesaturation(a.backgroundColor).saturationGradient(.9,.8),this.addBackground(0,this.level.visibleHeight-177,c,.25)}),b.defineElement("city",function(){var b,c,d;return b=Crafty.e("2D, WebGL, cityLayer2, Collision, SunBlock, Horizon").attr({z:-505,blur:1.2}).collision([4,29,72,29,72,118,4,118]).colorDesaturation(a.backgroundColor).saturationGradient(.6,.6),this.addBackground(0,this.level.visibleHeight-57-240,b,.37),d=Crafty.e("2D, WebGL, city, Collision, SunBlock, Horizon").attr({z:-305}).colorDesaturation(a.backgroundColor).saturationGradient(.4,.4),d.collision([35,155,35,0,130,0,130,155]),c=Crafty.e("2D, Collision, SunBlock"),c.attr({w:d.w,h:d.h}),c.collision([20,155,0,80,20,20,70,20,70,155]),this.addBackground(0,this.level.visibleHeight-290,d,.5),this.addBackground(400,this.level.visibleHeight-290,c,.5)}),b.defineElement("city-bridge",function(){var b,c;return b=Crafty.e("2D, WebGL, cityLayer2, Collision, SunBlock, Horizon").attr({z:-505,blur:1.2}).collision([4,29,72,29,72,118,4,118]).colorDesaturation(a.backgroundColor).saturationGradient(.6,.6),this.addBackground(0,this.level.visibleHeight-57-240,b,.37),c=Crafty.e("2D, WebGL, cityBridge, Collision, Horizon").attr({z:-305}).colorDesaturation(a.backgroundColor).saturationGradient(.4,.4),c.collision([35,155,35,0,130,0,130,155]),this.addBackground(0,this.level.visibleHeight-290,c,.5)}),b.defineElement("cityStart",function(){var b;return b=Crafty.e("2D, WebGL, cityStart, Collision, SunBlock, Horizon").attr({z:-305}).colorDesaturation(a.backgroundColor).saturationGradient(.4,.4),b.collision([220,155,220,20,270,20,270,0,330,0,330,155]),this.addBackground(0,this.level.visibleHeight-290,b,.5)}),b.defineBlock(function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.name="City.Intro",b.prototype.delta={x:800,y:0},b.prototype.autoNext="Ocean",b.prototype.generate=function(){var a,c,d,e,f,g;return b.__super__.generate.apply(this,arguments),g=700,this.addElement("waterFront"),e=45,f=155,c=150,this.add(0,this.level.visibleHeight-e-f,Crafty.e("2D, WebGL, Color").color("#202020").attr({z:-23,w:g,h:f})),this.add(50,this.level.visibleHeight-e-f-c,Crafty.e("2D, WebGL, Color").color("#202020").attr({z:-23,w:350,h:c})),this.elevator=Crafty.e("2D, WebGL, Color, Tween").color("#707070").attr({z:-22,w:100,h:5}),this.add(140,this.level.visibleHeight-70,this.elevator),this.outside=Crafty.e("2D, WebGL, Color, Tween").color("#303030").attr({z:-21,w:g+10,h:f-5,alpha:0}),this.add(0,this.level.visibleHeight-this.outside.h-e,this.outside),a=Crafty.e("2D, BarrelLocation"),this.add(500,this.level.visibleHeight-this.outside.h-e,a),this.addElement("water"),this.addElement("waterHorizon"),d=Crafty.e("2D, WebGL, waterFront1, WaveFront").attr({z:3,w:this.delta.x+.5*Crafty.viewport.width+1,h:200,lightness:.5,blur:6}),this.addBackground(0,this.level.visibleHeight-18,d,1.25),d.originalY=d.y,this.addElement("cloud")},b.prototype.enter=function(){var a,c,d,e;return b.__super__.enter.apply(this,arguments),this.speed=this.level._forcedSpeed,Crafty("ScrollWall").attr({y:120}),this.level.setForcedSpeed(0),c=[{type:"linear",x:-160,duration:2500},{type:"linear",y:-130,duration:2500,event:"lift"},{type:"linear",x:70,y:-10,duration:2500,event:"shipExterior"},{type:"delay",duration:500,event:"unlock"},{type:"delay",duration:1,event:"go"}],a=this,e=null,d=function(a){return e&&e.has("Choreography")?(a.attr({x:e.x-50,y:e.y}),e.disableControls&&a.disableControl(),a.addComponent("Choreography"),a.synchChoreography(e),a.one("ChoreographyEnd",function(){return this.removeComponent("Choreography",!1)}),a.one("unlock",function(){return this.enableControl(),this.weaponsEnabled=!0}),a.weaponsEnabled=e.weaponsEnabled):void 0},this.bind("ShipSpawned",d),Crafty("PlayerControlledShip").each(function(b){return 0!==b?d(this):(e=this,this.addComponent("Choreography"),this.attr({x:360-50*b,y:Crafty.viewport.height-100}),this.disableControl(),this.weaponsEnabled=!1,this.choreography(c),this.one("ChoreographyEnd",function(b){return function(){return b.removeComponent("Choreography","no"),a.unbind("ShipSpawned")}}(this)),this.one("unlock",function(){return this.enableControl(),this.weaponsEnabled=!0}),this.one("lift",function(){return a.elevator.tween({y:a.elevator.y-130},2500),Crafty("ScrollWall").each(function(){return this.addComponent("Tween"),this.tween({y:0},5e3),this.one("TweenEnd",function(){return this.removeComponent("Tween",!1)})})}),this.one("shipExterior",function(){return a.outside.tween({alpha:1},1500).addComponent("Solid")}),this.one("go",function(){return a.level.setForcedSpeed(a.speed)}))})},b}(this.Game.LevelScenery)),b.defineBlock(function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.name="City.Ocean",b.prototype.delta={x:800,y:0},b.prototype.assets=function(){return{sprites:{"water-horizon.png":{tile:201,tileh:155,map:{waterHorizon:[0,0]}},"water.png":{tile:400,tileh:105,map:{waterMiddle:[0,0]}},"water-front.png":{tile:400,tileh:90,map:{waterFront1:[0,0],waterFront2:[1,0]}}}}},b.prototype.generate=function(){return b.__super__.generate.apply(this,arguments),this.addElement("cloud"),this.addElement("waterHorizon"),this.addElement("water"),this.addElement("waterFront")},b}(this.Game.LevelScenery)),b.defineBlock(function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.name="City.CoastStart",b.prototype.delta={x:800,y:0},b.prototype.autoNext="Coast",b.prototype.autoPrevious="Ocean",b.prototype.assets=function(){return{sprites:{"horizon-city.png":{tile:200,tileh:30,paddingY:1,map:{coastStart:[0,0],coast:[0,1]}}}}},b.prototype.generate=function(){return b.__super__.generate.apply(this,arguments),this.addElement("cloud"),this.addElement("cityHorizon","start"),this.addElement("water"),this.addElement("waterFront");
},b}(this.Game.LevelScenery)),b.defineBlock(function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.name="City.Coast",b.prototype.delta={x:800,y:0},b.prototype.assets=function(){return{sprites:{"water-horizon.png":{tile:201,tileh:155,map:{waterHorizon:[0,0]}},"water.png":{tile:400,tileh:105,map:{waterMiddle:[0,0]}},"water-front.png":{tile:400,tileh:90,map:{waterFront1:[0,0],waterFront2:[1,0]}},"horizon-city.png":{tile:200,tileh:30,paddingY:1,map:{coastStart:[0,0],coast:[0,1]}}}}},b.prototype.generate=function(){return b.__super__.generate.apply(this,arguments),this.addElement("waterFront"),this.addElement("cityHorizon"),this.addElement("water"),this.addElement("cloud")},b}(this.Game.LevelScenery)),b.defineBlock(function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.name="City.BayStart",b.prototype.delta={x:800,y:0},b.prototype.autoNext="Bay",b.prototype.autoPrev="Coast",b.prototype.generate=function(){return b.__super__.generate.apply(this,arguments),this.addElement("cityHorizon"),this.addElement("water"),this.addElement("waterFront"),this.addElement("cityStart")},b}(this.Game.LevelScenery)),b.defineBlock(function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.name="City.Bay",b.prototype.delta={x:800,y:0},b.prototype.assets=function(){return{sprites:{"water-horizon.png":{tile:201,tileh:155,map:{waterHorizon:[0,0]}},"water.png":{tile:400,tileh:105,map:{waterMiddle:[0,0]}},"water-front.png":{tile:400,tileh:90,map:{waterFront1:[0,0],waterFront2:[1,0]}},"horizon-city.png":{tile:200,tileh:30,paddingY:1,map:{coastStart:[0,0],coast:[0,1]}},"city.png":{tile:402,tileh:270,paddingY:1,map:{cityBridge:[0,0],cityStart:[0,1],city:[0,2]}},"city-layer2.png":{tile:297,tileh:220,map:{cityLayer2:[0,0]}}}}},b.prototype.generate=function(){return b.__super__.generate.apply(this,arguments),this.addElement("waterFront"),this.addElement("water"),this.addElement("cityHorizon"),this.addElement("city")},b}(this.Game.LevelScenery)),b.defineBlock(function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.name="City.UnderBridge",b.prototype.delta={x:800,y:0},b.prototype.autoNext="Bay",b.prototype.assets=function(){return{sprites:{"bridge-deck.png":{tile:1,tileh:1,map:{bridgeDeck:[0,0,1024,180],bridgePillar:[0,181,534,180]}}}}},b.prototype.generate=function(){var a,c;return b.__super__.generate.apply(this,arguments),this.notifyOffsetX=-100,this.addElement("waterFront",{lightness:.8}),this.addElement("water"),this.addElement("cityHorizon"),this.addElement("city-bridge"),a=Crafty.viewport.width,c=1.1*Crafty.viewport.height,this.addBackground(0,345,this.deck(.55,{w:550,z:-280}),.55),this.addBackground(0,305,this.deck(.45,{w:600,z:-270}).flip("X"),.6),this.addBackground(0,255,this.deck(.35,{w:650,z:-260}),.65),this.addBackground(140,290,this.pillar(.35,{h:200,z:-261}),.65),this.addBackground(970,290,this.pillarX(.35,{h:200,z:-261}),.65),this.addBackground(0,205,this.deck(.25,{w:700,z:-50}).flip("X"),.7),this.addBackground(0,155,this.deck(.15,{w:750,z:-40}),.75),this.addBackground(160,160,this.pillar(0,{h:350,z:-31}),.8),this.addBackground(990,160,this.pillarX(0,{h:350,z:-31}),.8),this.addBackground(0,95,this.deck(.05,{w:800,z:-30}).flip("X"),.8),this.addBackground(0,20,this.deck(0,{w:900,z:-20}),.9),this.addBackground(0,-60,this.deck(0,{w:1e3,z:-10}).flip("X"),1),this.addBackground(0,-180,this.deck(0,{w:1200,z:100,lightness:.6,blur:3}),1.2),this.addBackground(190,-60,this.pillar(0,{h:750,z:80,lightness:.6,blur:3}),1.2),this.addBackground(1025,-60,this.pillarX(0,{h:750,z:80,lightness:.6,blur:3}),1.2)},b.prototype.deck=function(a,b){var c;return c=1024/180,b.h=b.w/c,Crafty.e("2D, WebGL, bridgeDeck, ColorEffects, Horizon, SunBlock").attr(b).saturationGradient(a,a)},b.prototype.pillar=function(a,b){var c;return c=534/170,b.w=b.h,b.h=b.w/c,b.rotation=90,Crafty.e("2D, WebGL, bridgePillar, ColorEffects, Horizon, SunBlock").attr(b).saturationGradient(a,a)},b.prototype.pillarX=function(a,b){return this.pillar(a,b).flip("Y")},b}(this.Game.LevelScenery)),b.defineBlock(function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.name="City.Skyline",b.prototype.delta={x:800,y:0},b.prototype.assets=function(){return{sprites:{"city-layer2.png":{tile:297,tileh:220,map:{cityLayer2:[0,0]}},"city.png":{tile:402,tileh:270,paddingY:1,map:{city:[0,0]}},"water-horizon.png":{tile:201,tileh:155,map:{waterHorizon:[0,0]}},"horizon-city.png":{tile:200,tileh:30,paddingY:1,map:{coastStart:[0,0],coast:[0,1]}}}}},b.prototype.generate=function(){var a;return b.__super__.generate.apply(this,arguments),a=600,this.add(0,this.level.visibleHeight-a,Crafty.e("2D, WebGL, Color").attr({w:600,h:a,z:-10}).color("#909090")),a=500,this.addBackground(200,this.level.visibleHeight-a,Crafty.e("2D, WebGL, Color").attr({w:700,h:a,z:5}).color("#000000"),1.5),this.addElement("water"),this.addElement("cityHorizon"),this.addElement("city")},b}(this.Game.LevelScenery)),b.defineBlock(function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.name="City.SkylineBase",b.prototype.delta={x:800,y:0},b.prototype.autoNext="Skyline2",b.prototype.assets=function(){return{sprites:{"city-layer2.png":{tile:297,tileh:220,map:{cityLayer2:[0,0]}},"city.png":{tile:402,tileh:270,paddingY:1,map:{city:[0,0]}},"horizon-city.png":{tile:200,tileh:30,paddingY:1,map:{coastStart:[0,0],coast:[0,1]}}}}},b.prototype.generate=function(){var a,c;return b.__super__.generate.apply(this,arguments),c=600,this.add(0,this.level.visibleHeight-c,Crafty.e("2D, WebGL, Color, SunBlock").attr({w:600,h:c,z:-10}).color("#909090")),a=Crafty.e("2D, WebGL, MiliBase, Color").color("#805050").attr({w:200,h:400,z:-598}),this.addBackground(0,this.level.visibleHeight-177,a,.25),this.addElement("city"),c=700,this.add(0,this.level.visibleHeight-100,Crafty.e("2D, WebGL, Color, SunBlock").attr({w:this.delta.x,h:c,z:-10}).color("#505050"))},b}(this.Game.LevelScenery)),b.defineBlock(function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.name="City.Skyline2",b.prototype.delta={x:800,y:0},b.prototype.assets=function(){return{sprites:{"city-layer2.png":{tile:297,tileh:220,map:{cityLayer2:[0,0]}},"city.png":{tile:402,tileh:270,paddingY:1,map:{city:[0,0]}},"water-horizon.png":{tile:201,tileh:155,map:{waterHorizon:[0,0]}},"horizon-city.png":{tile:200,tileh:30,paddingY:1,map:{coastStart:[0,0],coast:[0,1]}}}}},b.prototype.generate=function(){var a;return b.__super__.generate.apply(this,arguments),a=600,this.add(0,this.level.visibleHeight-a,Crafty.e("2D, WebGL, Color, SunBlock").attr({w:600,h:a,z:-10}).color("#909090")),this.addElement("water"),this.addElement("cityHorizon"),this.addElement("city"),a=700,this.add(0,this.level.visibleHeight-100,Crafty.e("2D, WebGL, Color, SunBlock").attr({w:this.delta.x,h:a,z:-10}).color("#505050"))},b}(this.Game.LevelScenery))}).call(this),function(){var a;a=this.Game.levelGenerator,a.defineAssets("drone-mine",{contents:["drone","mine"],spriteMap:"drone.png",sprites:{drone:{tile:80,tileh:80,map:{standardDrone:[0,0]},paddingX:1},mine:{tile:25,tileh:25,map:{standardMine:[0,3]},paddingY:2,paddingX:1}}}),a.defineAssets("general",{contents:["cloud","shadow","rocket"],spriteMap:"general.png",sprites:{all:{tile:1,tileh:1,map:{shadow:[1,18,35,20],standardRocket:[1,1,45,15],cloud:[48,0,250,100]}}}}),a.defineAssets("sun",{contents:["sun"],spriteMap:"sun.png",sprites:{all:{tile:1,tileh:1,map:{sun:[0,0,35,35],directGlare:[0,81,175,175],redGlare:[0,36,10,10],blueGlare:[120,0,80,80],bigGlare:[0,256,200,200]}}}}),a.defineAssets("helicopter",{contents:["helicopter"],spriteMap:"camera-helicopter.png",sprites:{all:{tile:120,tileh:50,map:{cameraHelicopter:[0,0]},paddingX:1}}}),a.defineAssets("largeDrone",{contents:["largeDrone"],spriteMap:"large-drone.png",sprites:{body:{tile:90,tileh:70,map:{standardLargeDrone:[0,0],damage1LargeDrone:[1,0],damage2LargeDrone:[2,0],damage3LargeDrone:[3,0]},paddingX:1},eye:{tile:20,tileh:26,map:{eyeStart:[0,3]},paddingX:1,paddingY:1},wing:{tile:46,tileh:21,map:{wingLoaded:[5,4]},paddingX:1,paddingY:0}}}),a.defineAssets("explosion",{contents:["explosion"],spriteMap:"explosion.png",sprites:{all:{tile:96,tileh:96,map:{explosionStart:[0,0]}}}})}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=this.Game.levelGenerator,a.defineBlock(function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.name="City.Blackness",c.prototype.delta={x:600,y:0},c.prototype.generate=function(){return c.__super__.generate.apply(this,arguments)},c}(this.Game.LevelScenery)),a.defineBlock(function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.name="City.OceanOld",c.prototype.delta={x:800,y:0},c.prototype.generate=function(){var a,b;return c.__super__.generate.apply(this,arguments),b=65,this.add(0,this.level.visibleHeight-10,Crafty.e("2D, Solid").attr({w:this.delta.x,h:10})),this.add(0,this.level.visibleHeight-b,Crafty.e("2D, WebGL, Color").attr({w:this.delta.x,h:b,z:-300}).color("#000080")),this.addBackground(0,this.level.visibleHeight-155,Crafty.e("2D, WebGL, Color").color("#6060E0").attr({z:-600,w:.25*this.delta.x+1,h:155}),.25),a=Crafty.e("2D, WebGL, Color, GoldenStripe").color("#DDDD00").attr({z:-599,w:.25*this.delta.x,h:1,alpha:0}),this.addBackground(0,this.level.visibleHeight-155,a,.25),this.addElement("cloud"),this.addBackground(0,this.level.visibleHeight-125,Crafty.e("2D, WebGL, Color").color("#3030B0").attr({z:-500,w:.5*this.delta.x+1,h:105}),.5),this.addBackground(0,this.level.visibleHeight-90,Crafty.e("2D, WebGL, Color").color("#3030B0").attr({z:-301,w:.5*this.delta.x+1,h:70}),.5)},c}(this.Game.LevelScenery)),a.defineBlock(function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.name="City.OceanToNew",c.prototype.delta={x:800,y:0},c.prototype.autoNext="Ocean",c.prototype.assets=function(){return{images:["water-horizon-old.png","water-old.png"],sprites:{"water-front-old.png":{tile:400,tileh:90,map:{waterFront1Old:[0,0],waterFront2Old:[1,0]}}}}},c.prototype.generate=function(){var a,b,d,e;return c.__super__.generate.apply(this,arguments),this.addBackground(0,this.level.visibleHeight-155,Crafty.e("2D, WebGL, Image").image("images/water-horizon-old.png").attr({z:-600}),.25),a=Crafty.e("2D, WebGL, Color, GoldenStripe").color("#DDDD00").attr({z:-599,w:.25*this.delta.x,h:1,alpha:0}),this.addBackground(0,this.level.visibleHeight-155,a,.25),this.addBackground(0,this.level.visibleHeight-125,Crafty.e("2D, WebGL, Image").image("images/water-old.png").attr({z:-500}),.5),b=65,this.add(0,this.level.visibleHeight-10,Crafty.e("2D, Solid").attr({w:this.delta.x,h:10})),d=Crafty.e("2D, WebGL, waterFront1Old, Wave1").attr({z:-300}),this.add(0,this.level.visibleHeight-b,d),d.originalY=d.y,e=Crafty.e("2D, WebGL, waterFront2Old, Wave2").attr({z:-300}),this.add(400,this.level.visibleHeight-b,e),e.originalX=e.x,e.originalY=e.y},c}(this.Game.LevelScenery)),a.defineBlock(function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.name="City.OpenSpace",c.prototype.delta={x:700,y:0},c.prototype.generate=function(){return c.__super__.generate.apply(this,arguments),this.add(0,150,Crafty.e("2D, WebGL, Solid, Color").color("#505045").attr({w:42,h:70})),this.add(500,50,Crafty.e("2D, WebGL, Solid, Color").color("#404045").attr({w:82,h:70})),this.add(200,250,Crafty.e("2D, WebGL, Solid, Color").color("#505045").attr({w:52,h:80})),this.add(100,450,Crafty.e("2D, WebGL, Solid, Color").color("#505045").attr({w:52,h:40})),this.add(400,550,Crafty.e("2D, WebGL, Solid, Color").color("#404040").attr({w:82,h:30}))},c}(this.Game.LevelScenery)),a.defineBlock(function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.name="City.TunnelStart",c.prototype.delta={x:1e3,y:0},c.prototype.autoNext="Tunnel",c.prototype.generate=function(){return c.__super__.generate.apply(this,arguments),this.addBackground(380,this.level.visibleHeight-180,Crafty.e("2D, WebGL, Color").color("#505050").attr({z:-110,w:40,h:180}),.5),this.addBackground(380,this.level.visibleHeight-90,Crafty.e("2D, WebGL, Color").color("#606060").attr({z:-200,w:40,h:90}),.25),this.addBackground(380,this.level.visibleHeight-360,Crafty.e("2D, WebGL, Color").color("#303030").attr({z:22,w:40,h:360}),1.5),this.add(0,0,Crafty.e("2D, WebGL, Solid, Color").color("#404040").attr({w:350,h:15})),this.add(350,0,Crafty.e("2D, WebGL, Solid, Color").color("#404040").attr({w:100,h:70})),this.add(450,0,Crafty.e("2D, WebGL, Solid, Color").color("#404040").attr({w:550,h:25})),this.add(380,0,Crafty.e("2D, WebGL, Color").color("#202020").attr({z:-10,w:this.delta.x-380,h:this.level.visibleHeight}))},c}(this.Game.LevelScenery)),a.defineBlock(function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.name="City.TunnelEnd",c.prototype.delta={x:1e3,y:0},c.prototype.autoNext="OceanOld",c.prototype.generate=function(){var a;return c.__super__.generate.apply(this,arguments),this.addBackground(380,this.level.visibleHeight-360,Crafty.e("2D, WebGL, Color").color("#303030").attr({z:22,w:40,h:360}),1.5),this.addBackground(380,this.level.visibleHeight-180,Crafty.e("2D, WebGL, Color").color("#505050").attr({z:-110,w:40,h:180}),.5),this.addBackground(380,this.level.visibleHeight-90,Crafty.e("2D, WebGL, Color").color("#606060").attr({z:-200,w:40,h:90}),.25),a=15,this.add(0,this.level.visibleHeight-a,Crafty.e("2D, WebGL, Solid, Color").color("#404040").attr({w:350,h:a})),a=70,this.add(350,this.level.visibleHeight-a,Crafty.e("2D, WebGL, Solid, Color").color("#404040").attr({w:100,h:a})),a=25,this.add(450,this.level.visibleHeight-a,Crafty.e("2D, WebGL, Solid, Color").color("#404040").attr({w:550,h:a})),this.add(0,0,Crafty.e("2D, WebGL, Color").color("#202020").attr({z:-10,w:380,h:this.level.visibleHeight}))},c}(this.Game.LevelScenery)),a.defineBlock(function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.name="City.Tunnel",c.prototype.delta={x:1e3,y:0},c.prototype.generate=function(){var a;return c.__super__.generate.apply(this,arguments),this.add(0,0,Crafty.e("2D, WebGL, Solid, Color").color("#404040").attr({w:350,h:15})),this.add(350,0,Crafty.e("2D, WebGL, Solid, Color").color("#404040").attr({w:100,h:70})),this.add(450,0,Crafty.e("2D, WebGL, Solid, Color").color("#404040").attr({w:550,h:25})),a=15,this.add(0,this.level.visibleHeight-a,Crafty.e("2D, WebGL, Solid, Color").color("#404040").attr({w:350,h:a})),a=70,this.add(350,this.level.visibleHeight-a,Crafty.e("2D, WebGL, Solid, Color").color("#404040").attr({w:100,h:a})),a=25,this.add(450,this.level.visibleHeight-a,Crafty.e("2D, WebGL, Solid, Color").color("#404040").attr({w:550,h:a})),this.add(0,0,Crafty.e("2D, WebGL, Color").color("#202020").attr({z:-1,w:this.delta.x,h:this.level.visibleHeight}))},c}(this.Game.LevelScenery))}.call(this)}(),function(){(function(){var a;a=null,Crafty.defineScene("Game",function(b){var c,d,e,f,g,h,i,j;return null==b&&(b={}),c=window.Game,c.backgroundColor=null,i=null!=(f=null!=b?b.script:void 0)?f:"Stage1",h=c.Scripts[i],a=c.levelGenerator.createLevel(h.prototype.metadata),a.start(),e={startAtCheckpoint:null!=(g=b.checkpoint)?g:0},b.checkpoint?(d="Checkpoint "+b.checkpoint,window.ga("send","event","Game","CheckpointStart",d)):(window.ga("send","event","Game","Start",d),d="Begin"),j=new h(a),j.run(e).then(function(a){return function(){return console.log("end of script!")}}(this))["catch"](function(a){return"sequence mismatch"!==a.message?console.error(a):void 0}),Crafty.bind("GameOver",function(){return window.ga("send","event","Game","End","Checkpoint "+j.currentCheckpoint),j.end(),Crafty.enterScene("GameOver",{checkpoint:j.currentCheckpoint,script:i})}),Crafty.bind("GamePause",function(a){var b,d,f,g,h,i,k,l,m,n;return a?(f=Crafty.e("2D, DOM, Color, PauseMenu").attr({x:-Crafty.viewport.x+.35*Crafty.viewport.width,y:.3*Crafty.viewport.height-Crafty.viewport.y,w:.3*Crafty.viewport.width,h:.3*Crafty.viewport.height,z:100,alpha:.3}).color("#000000"),m=Crafty.e("2D, DOM, Text").attr({x:f.x,y:f.y+20,w:f.w,z:110}).text("Game Paused").textColor("#D0D0D0").css("textAlign","center").textFont({size:"15px",weight:"bold",family:"Press Start 2P"}),f.attach(m),e=["Resume","Restart","Quit"],i=function(){var a,b,c;for(c=[],d=a=0,b=e.length;b>a;d=++a)h=e[d],g=Crafty.e("2D, DOM, Text").attr({x:f.x+60,y:f.y+50+35*d,w:f.w-60,z:110}).text(h).textColor("#D0D0D0").css("textAlign","left").textFont({size:"15px",weight:"bold",family:"Press Start 2P"}),f.attach(g),c.push(g);return c}(),k=0,l=Crafty.e("2D, DOM, Text").attr({x:f.x+20,w:40,z:110}).text(">").textColor("#0000FF").css("textAlign","left").textFont({size:"15px",weight:"bold",family:"Press Start 2P"}),f.attach(l),n=function(){return l.attr({y:i[k].y})},n(),b=function(){return c.togglePause(),setTimeout(function(){return 1===k&&(c.resetCredits(),Crafty("Player").each(function(){return this.softReset()}),j.end(),Crafty.enterScene(c.firstLevel)),2===k?(Crafty("Player").each(function(){return this.reset()}),j.end(),Crafty.enterScene("Intro")):void 0})},Crafty("Player").each(function(){return this.bind("Up",function(){return k=(e.length+k-1)%e.length,n()}),this.bind("Down",function(){return k=(e.length+k+1)%e.length,n()}),this.bind("Fire",function(){return b()})})):(Crafty("Player").each(function(){return this.unbind("Up"),this.unbind("Down"),this.unbind("Fire")}),Crafty("PauseMenu").each(function(){return this.destroy()}))})},function(){return a.stop(),Crafty("Player").each(function(){return this.removeComponent("ShipSpawnable")}),Crafty.unbind("GameOver"),Crafty.unbind("GamePause")})}).call(this),function(){Crafty.defineScene("GameOver",function(a){var b,c,d,e,f,g;return b=window.Game,Crafty.background("#000"),Crafty.viewport.x=0,Crafty.viewport.y=0,g=Crafty.viewport.width,d=Crafty.viewport.height,Crafty.e("2D, DOM, Text").attr({x:0,y:.2*d,w:g}).text("Game Over").textColor("#FF0000").css("textAlign","center").textFont({size:"50px",weight:"bold",family:"Press Start 2P"}),f=function(a){return function(){var b,c,f,h,i,j,k,l,m;for(b=null,c=f=0,i=e.length;i>f;c=++f)l=e[c],l.player===a.player&&(b=c);return m=a.name+": "+a.points,10>b&&(k=function(){switch(b){case 0:return"ACE";case 1:return"2nd";case 2:return"3rd";default:return b+1+"th"}}(),m+=" - "+k),Crafty.e("2D, DOM, Text").attr({x:0,y:.45*d+45*a.index,w:g}).text(m).textColor(a.color).css("textAlign","center").textFont({size:"20px",weight:"bold",family:"Press Start 2P"}),10>b?(j=Crafty.e("2D, DOM, Text").attr({x:.25*g,y:.45*d+45*(a.index+1),w:g}).text("Enter name: ").textColor(a.color).css("textAlign","left").textFont({size:"20px",weight:"bold",family:"Press Start 2P"}),h=Crafty.e("TextInput").attr({x:.6*g,y:.45*d+45*(a.index+1),w:g}).textColor(a.color).css("textAlign","left").textFont({size:"20px",weight:"bold",family:"Press Start 2P"}),h.textInput(a.player,3).then(function(b){var c,d,e,f,g;return g=function(){var a,b,c,d;return(b=localStorage.getItem("SPDLZR"))?(c=b.slice(0,20),a=b.slice(20),l=CryptoJS.AES.decrypt(a,c),d=l.toString(CryptoJS.enc.Utf8),d.length>1?JSON.parse(d):[]):[]},f=g(),f.push({initials:b,score:a.points,time:(new Date).getTime()}),c=JSON.stringify(f),e=CryptoJS.AES.encrypt(c,"secret").toString().slice(8,28),d=CryptoJS.AES.encrypt(c,e).toString(),localStorage.setItem("SPDLZR",e+d),j.destroy(),h.destroy()})):void 0}},c=[],e=_.clone(b.highscores()),Crafty("Player ControlScheme").each(function(a){var b;return b=null,e.push({initials:null,player:this,score:this.points}),c.push(f({index:a,name:this.name,points:this.points,player:this,color:this.color()})),window.ga("send","event","Game","Score",void 0,this.points)}),e=_.sortBy(e,"score").reverse(),WhenJS.sequence(c).then(function(c){return function(){return Crafty.e("Delay").delay(function(){var c,e,f,h;return b.credits>0?(h=10,f=1===b.credits?"1 Credit left":b.credits+" Credits left",Crafty.e("2D, DOM, Text").attr({x:0,y:.8*d,w:g}).textColor("#FF0000").css("textAlign","center").textFont({size:"15px",weight:"bold",family:"Press Start 2P"}).text(f),c=Crafty.e("2D, DOM, Text").attr({x:0,y:.8*d+30,w:g}).textColor("#FF0000").css("textAlign","center").textFont({size:"15px",weight:"bold",family:"Press Start 2P"}),e="Press fire to continue",c.text(e+" "+("00"+h).slice(-2)),this.delay(function(){return h-=1,c.text(e+" "+("00"+h).slice(-2))},1e3,h,function(){return Crafty.enterScene("Scores")}),Crafty("Player").each(function(){return this.reset(),this.one("Activated",function(){return b.credits-=1,Crafty.enterScene(b.firstLevel,a)})})):this.delay(function(){return Crafty.enterScene("Scores")},5e3)},2e3,0)}}(this))},function(){return Crafty("Delay").each(function(){return this.destroy()}),Crafty("Player").each(function(){return this.unbind("Activated")})})}.call(this),function(){Crafty.defineScene("Intro",function(){var a,b,c,d,e;return a=window.Game,a.resetCredits(),Crafty.background("#000000"),Crafty.viewport.x=0,Crafty.viewport.y=0,e=Crafty.viewport.width,c=Crafty.viewport.height,d=.15,Crafty.e("2D, DOM, Text, Tween, Delay").attr({x:e*(.5-d),y:.4*c,w:400}).text("Speedlazer").textColor("#0000ff").textFont({size:"40px",weight:"bold",family:"Press Start 2P"}).delay(function(){return this.tween({x:e*(.5+d)-400},2e3),this.one("TweenEnd",function(){return this.tween({x:e*(.5-d)},2e3)})},4e3,-1),Crafty.e("2D, DOM, Text, Tween, Delay").attr({x:.5*e-150,y:.6*c,w:300}).text("Press fire to start!").textColor("#FF0000").textFont({size:"15px",weight:"bold",family:"Press Start 2P"}).delay(function(){return this.tween({alpha:.5},1e3),this.one("TweenEnd",function(){return this.tween({alpha:1},1e3)})},2e3,-1),b=a.highscores()[0],Crafty.e("2D, DOM, Text").attr({x:0,y:.85*c,w:e}).text("HI SCORE: "+b.score+" "+b.initials).textColor("#FFFF00").css("textAlign","center").textFont({size:"10px",weight:"bold",family:"Press Start 2P"}),Crafty("Player").each(function(){return this.reset(),this.one("Activated",function(){return Crafty.enterScene(a.firstLevel)})}),Crafty.e("Delay").delay(function(){return Crafty.enterScene("Scores")},2e4)},function(){return Crafty("Delay").each(function(){return this.destroy()}),Crafty("Player").each(function(){return this.unbind("Activated")})})}.call(this),function(){Crafty.defineScene("Scores",function(){var a,b,c,d,e;return a=window.Game,a.resetCredits(),Crafty.background("#000000"),Crafty.viewport.x=0,Crafty.viewport.y=0,e=Crafty.viewport.width,b=Crafty.viewport.height,Crafty.e("2D, DOM, Text").attr({x:0,y:.1*b,w:e}).text("Highscores").textColor("#FFFF00").css("textAlign","center").textFont({size:"40px",weight:"bold",family:"Press Start 2P"}),d=a.highscores(),c=0,Crafty.e("Delay").delay(function(){var a,f,g;return a=d[c],a?(f=function(){switch(c){case 0:return"ACE";case 1:return"2nd";case 2:return"3rd";default:return c+1+"th"}}(),g=function(){switch(c){case 0:return"20px";case 1:case 2:return"18px";default:return"15px"}}(),Crafty.e("2D, DOM, Text").attr({x:0,y:.25*b+36*c,w:e}).text(f+"  "+a.score+" "+a.initials).textColor("#FFFF00").css("textAlign","center").textFont({size:g,weight:"bold",family:"Press Start 2P"}),c+=1):void 0},500,9),Crafty("Player").each(function(){return this.reset(),this.one("Activated",function(){return Crafty.enterScene(a.firstLevel)})}),Crafty.e("Delay").delay(function(){return Crafty.enterScene("Intro")},2e4)},function(){return Crafty("Delay").each(function(){return this.destroy()}),Crafty("Player").each(function(){return this.unbind("Activated")})})}.call(this)}(),function(){function a(){var a=$("#cr-stage").height(),b=$("#cr-stage").width(),c=$(window).height(),d=$(window).width();$("body").is(".fullscreen")||(d-=210);var e=c/a,f=d/b,g=Math.min(e,f);$("#cr-stage").css("transform","scale("+g+")")}window.Game.start(!1),$(window).on("resize",function(){a()}),$(document).on("click","#cr-stage",function(){screenfull.enabled&&(screenfull.request($("#theater")[0]),$("body").addClass("fullscreen"),a(),document.addEventListener(screenfull.raw.fullscreenchange,function(){screenfull.isFullscreen||($("body").removeClass("fullscreen"),a())}))}),a()}();