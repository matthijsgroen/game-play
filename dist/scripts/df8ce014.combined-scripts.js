!function(){"use strict"}(),function(){"use strict";Crafty.c("Bullet",{init:function(){this.addComponent("2D, Canvas, Color, Collision")},fire:function(a){return this.attr({damage:a.damage}).bind("EnterFrame",function(){this.x=this.x+a.speed;var b=-Crafty.viewport._x+Crafty.viewport._width/Crafty.viewport._scale;this.x>b+200&&this.destroy()}).onHit("Edge",function(){this.destroy()}),this}})}(),function(){"use strict";Crafty.c("Enemy",{init:function(){this.addComponent("2D, Canvas, Color, Collision")},enemy:function(){return this.attr({w:50,h:50,health:300}).color("#0000FF").bind("EnterFrame",function(){this.x=this.x-2;var a=-Crafty.viewport._x;this.x<a&&this.destroy()}).onHit("Bullet",function(a){var b=a[0].obj;b.trigger("HitTarget",{target:this}),this.health-=b.damage,this.health<=0&&(b.trigger("DestroyTarget",{target:this}),this.destroy()),b.destroy()}),this}})}(),function(){"use strict";Crafty.c("GamepadControls",{init:function(){this.requires("Listener"),this.bind("RemoveComponent",function(a){"ControlScheme"===a&&this.removeComponent("GamepadControls")})},remove:function(){this.unbind("GamepadKeyChange",this._keyHandling)},setupControls:function(a){a.addComponent("GamepadControls").controls(this.controlMap).addComponent("ControlScheme")},controls:function(a){return this.controlMap=a,void 0!==a.gamepadIndex?(this.requires("Gamepad"),this.gamepad(a.gamepadIndex),this.bind("GamepadKeyChange",this._keyHandling),this):void 0},_keyHandling:function(a){a.button===this.controlMap.fire&&a.pressed&&this.trigger("Fire",a)},assignControls:function(a){var b=this.controlMap;a.addComponent("GamepadMultiway, Gamepad").gamepad(b.gamepadIndex).gamepadMultiway({speed:{y:3,x:1.5},gamepadIndex:b.gamepadIndex}),this.listenTo(a,"GamepadKeyChange",function(c){c.button===b.fire&&c.pressed&&a.shoot()})}})}(),function(){"use strict";Crafty.c("HUD",{init:function(){this.requires("2D, Listener")},hud:function(a,b){this.player=b,this.score=Crafty.e("2D, DOM, Text").attr({x:a,y:10,w:150,h:20}).textFont({size:"20px",weight:"bold",family:"Courier new"}),this.player.has("Color")&&this.score.textColor(this.player.color()),this.lives=Crafty.e("2D, DOM, Text").attr({x:a,y:30,w:250,h:20}).textFont({size:"20px",weight:"bold",family:"Courier new"}),this.player.has("Color")&&this.lives.textColor(b.color()),this.updateHud();var c=this.score,d=this.lives;return Crafty.bind("ViewportScroll",function(){c.attr({x:a-Crafty.viewport._x,y:10-Crafty.viewport._y}),d.attr({x:a-Crafty.viewport._x,y:30-Crafty.viewport._y})}),this.listenTo(b,"UpdateLives",this.updateHud),this.listenTo(b,"UpdatePoints",this.updateHud),this.listenTo(b,"NewComponent",function(a){for(var b=0;b<a.length;b++){var c=a[b];"ControlScheme"===c&&this.updateHud()}}),this.listenTo(b,"RemoveComponent",function(a){"ControlScheme"===a&&this.updateHud()}),this},updateHud:function(){this.score.text(this.player.has("ControlScheme")?"Score: "+this.player.points:this.player.name),this.lives.text(this.player.has("ControlScheme")?0===this.player.lives?"Game Over":"Lives: "+this.player.lives:"Press fire to start!")}})}(),function(){"use strict";Crafty.c("Invincible",{init:function(){this.requires("Delay, Color"),this.rawColor=this.color(),this.delay(this._blink,250,-1)},_blink:function(){void 0===this.blinkOn&&(this.blinkOn=!0),this.blinkOn=!this.blinkOn,this.blinkOn?this.color(this.rawColor,.5):this.color(this.rawColor,100)},remove:function(){this.color(this.rawColor),this.cancelDelay(this._blink)},invincibleDuration:function(a){this.delay(function(){this.removeComponent("Invincible")},a,0)}})}(),function(){"use strict";Crafty.c("KeyboardControls",{init:function(){this.requires("Listener"),this.bind("RemoveComponent",function(a){"ControlScheme"===a&&this.removeComponent("KeyboardControls")})},remove:function(){this.unbind("KeyDown",this._keyHandling)},setupControls:function(a){a.addComponent("KeyboardControls").controls(this.controlMap).addComponent("ControlScheme")},controls:function(a){return this.controlMap=a,this.bind("KeyDown",this._keyHandling),this},_keyHandling:function(a){a.key===this.controlMap.fire&&this.trigger("Fire",a)},assignControls:function(a){var b=this.controlMap,c={},d={up:-90,down:90,left:180,right:0};for(var e in d){var f=d[e],g=b[e];for(var h in Crafty.keys)Crafty.keys[h]===g&&(c[h]=f)}a.addComponent("Multiway, Keyboard").multiway({y:3,x:1.5},c),this.listenTo(a,"KeyDown",function(c){c.key===b.fire&&a.shoot()})}})}(),function(){"use strict";Crafty.c("Listener",{init:function(){this.listeners=[]},remove:function(){for(var a;a<this.listeners.length;a++){var b=this.listeners[a];b.object.unbind(b.event,b.callback)}},listenTo:function(a,b,c,d){void 0===d&&(d=this);var e=function(){c.apply(d,arguments)};this.listeners.push({object:a,event:b,callback:e}),a.bind(b,e)}})}(),function(){"use strict";Crafty.c("Player",{lives:2,points:0,init:function(){},loseLife:function(){this.lives<=0||(this.lives-=1,this.trigger("UpdateLives",{lives:this.lives}),this.lives<=0&&Crafty.trigger("PlayerDied",this))},addPoints:function(a){this.lives<=0||(this.points+=a,this.trigger("UpdatePoints",{points:this.points}))}})}(),function(){"use strict";Crafty.c("PlayerAssignable",{init:function(){this.one("Fire",this._assignControls),this.preferredPlayer=null},_assignControls:function(){var a=this._playerWithoutControls(this.preferredPlayer);if(void 0===a)return void this.one("Fire",this._assignControls);this.preferredPlayer=a.getId(),this.setupControls(a);var b=this;a.one("Deactivated",function(){b.one("Fire",b._assignControls)})},_playerWithoutControls:function(a){if(null!==a){var b=Crafty(a);if(!b.has("ControlScheme"))return b}for(var c=Crafty("Player"),d=0;d<c.length;d++){var e=Crafty(c[d]);if(!e.has("ControlScheme"))return e}}}),Crafty.c("ControlScheme",{init:function(){this.trigger("Activated"),Crafty.trigger("PlayerActivated")},remove:function(){this.trigger("Deactivated"),Crafty.trigger("PlayerDeactivated")}})}(),function(){"use strict";Crafty.c("PlayerControlledShip",{init:function(){this.requires("2D, Canvas, Color, Collision, Delay"),this.attr({w:30,h:30}).bind("Moved",function(a){this.hit("Edge")&&this.attr({x:a.x,y:a.y})}),this._forcedSpeed={x:0,y:0},this.delay(function(){this.addComponent("Invincible").invincibleDuration(2e3),this.onHit("Enemy",function(){this.has("Invincible")||this.trigger("Hit")})},10,0),this.bind("EnterFrame",function(){this.x+=this._forcedSpeed.x,this.hit("Edge")&&(this.x-=this._forcedSpeed.x),this.hit("Edge")&&this.trigger("Hit")})},forcedSpeed:function(a){return void 0!==a.x&&void 0!==a.y?(this._forcedSpeed.x=a.x,this._forcedSpeed.y=a.y):(this._forcedSpeed.x=a,this._forcedSpeed.y=a),this},shoot:function(){var a=this;Crafty.e("Bullet").color(this.color()).attr({x:this.x+this.w,y:this.y+this.h/2,w:5,h:5}).fire({origin:this,damage:100,speed:this._forcedSpeed.x+3,direction:0}).bind("HitTarget",function(){a.trigger("BulletHit")}).bind("DestroyTarget",function(){a.trigger("BulletDestroyedTarget")})}})}(),function(){"use strict";Crafty.c("ScrollWall",{init:function(){this.requires("2D, Canvas, Color, Edge, Collision"),this.attr({x:0,y:50,w:2,h:710,speed:{x:0,y:0}}),this._speed={x:0,y:0},this.bind("EnterFrame",function(){var a=this._speed.x;Crafty("PlayerControlledShip").each(function(){var b=Crafty.viewport.width/3;this.x>-(Crafty.viewport.x-Crafty.viewport.width)-b&&(a+=2)}),this.x+=a,Crafty.viewport.scroll("_x",-this.x),Crafty.viewport._clamp()}),this.onHit("PlayerControlledShip",function(a){for(var b=0;b<a.length;b++){var c=a[b].obj;c.attr({x:c.x+this._speed.x})}})},scrollWall:function(a){return void 0!==a.x&&void 0!==a.y?(this._speed.x=a.x,this._speed.y=a.y):(this._speed.x=a,this._speed.y=a),this},off:function(){this.unbind("EnterFrame")}})}(),function(){"use strict";Crafty.c("ShipSpawnable",{init:function(){this.requires("Listener"),this.bind("Activated",this.spawnShip)},remove:function(){this.unbind("Activated",this.spawnShip)},spawnPosition:function(a,b){return this.spawnPosition={x:a,y:b},this},spawnShip:function(){if(this.has("ControlScheme")&&!(this.lives<=0)){var a=Crafty.e("PlayerControlledShip").attr({x:this.spawnPosition.x-Crafty.viewport.x,y:this.spawnPosition.y-Crafty.viewport.y});return this.has("Color")&&a.color(this.color()),this.has("ControlScheme")&&this.assignControls(a),this.listenTo(a,"BulletHit",function(){this.addPoints(10)}),this.listenTo(a,"BulletDestroyedTarget",function(){this.addPoints(50)}),this.listenTo(a,"Hit",function(){a.destroy(),this.loseLife(),this.spawnShip()}),Crafty.trigger("ShipSpawned",a),this}}})}(),function(){"use strict";Crafty.defineScene("GameOver",function(){Crafty.background("#111"),Crafty.viewport.x=0,Crafty.viewport.y=0,Crafty.e("2D, DOM, Text").attr({x:200,y:210,w:450}).text("Game Over").textColor("#FF0000").textFont({size:"80px",weight:"bold",family:"Courier new"}),Crafty("Player ControlScheme").each(function(a){Crafty.e("2D, DOM, Text").attr({x:240,y:310+50*a,w:700}).text(this.name+": "+this.points).textColor(this.color()).textFont({size:"50px",weight:"bold",family:"Courier new"})}),Crafty.e("Delay").delay(function(){Crafty.e("2D, DOM, Text").attr({x:200,y:590,w:750}).text("Press fire to start again").textColor("#FF0000").textFont({size:"30px",weight:"bold",family:"Courier new"}),Crafty("Player").each(function(){this.removeComponent("ControlScheme").attr({lives:2,points:0}),this.one("Activated",function(){Crafty.enterScene("Space",{stage:1})})}),this.delay(function(){Crafty.enterScene("Intro")},6e4,0)},2e3,0)},function(){Crafty("Delay").each(function(){this.destroy()}),Crafty("Player").each(function(){this.unbind("Activated")})})}(),function(){"use strict";Crafty.defineScene("Intro",function(){Crafty.background("#111"),Crafty.viewport.x=0,Crafty.viewport.y=0,Crafty.e("2D, DOM, Text, Tween, Delay").attr({x:200,y:210,w:450}).text("Speedlazer").textColor("#0000ff").textFont({size:"80px",weight:"bold",family:"Courier new"}).delay(function(){this.tween({x:300},1e3),this.one("TweenEnd",function(){this.tween({x:200},1e3)})},2e3,-1),Crafty.e("2D, DOM, Text, Tween, Delay").attr({x:300,y:490,w:750}).text("Press fire to start!").textColor("#FF0000").textFont({size:"30px",weight:"bold",family:"Courier new"}).delay(function(){this.tween({alpha:0},1e3),this.one("TweenEnd",function(){this.tween({alpha:1},1e3)})},2e3,-1),Crafty("Player").each(function(){this.removeComponent("ControlScheme").attr({lives:2,points:0}),this.one("Activated",function(){Crafty.enterScene("Space",{stage:1})})})},function(){Crafty("Player").each(function(){this.unbind("Activated")})})}(),function(){"use strict";Crafty.defineScene("Space",function(a){var b=window.Game;Crafty.background("#000"),Crafty.viewport.x=0,Crafty.viewport.y=0;var c=2;Crafty.one("ShipSpawned",function(){Crafty.e("ScrollWall").scrollWall(2)}),Crafty.bind("ShipSpawned",function(a){a.forcedSpeed(c)}),Crafty("Player").each(function(a){this.addComponent("ShipSpawnable").spawnPosition(140,300+50*a),Crafty.e("HUD").hud(30+300*a,this)}),Crafty("Player ControlScheme").each(function(){this.spawnShip()});var d=b.levelGenerator.createLevel();d.addBlock("cityStart",{stage:a.stage}),d.generateBlocks("openSpace",20),d.addBlock("levelEnd"),d.start(),Crafty.bind("EndOfLevel",function(){d.stop(),Crafty.enterScene("Space",{stage:a.stage+1})}),Crafty.bind("PlayerDied",function(){var a=!1;Crafty("Player ControlScheme").each(function(){this.lives>0&&(a=!0)}),a===!1&&(d.stop(),Crafty.enterScene("GameOver"))})},function(){Crafty.unbind("EnterFrame"),Crafty.unbind("PlayerDied"),Crafty.unbind("ShipSpawned"),Crafty.unbind("EndOfLevel"),Crafty("Player").each(function(){this.removeComponent("ShipSpawnable")})})}(),function(){"use strict";var a={start:function(){Crafty.load([],function(){Crafty.init(1024,768),Crafty.background("#000000"),Crafty.e("Player, Color").attr({name:"Player 1"}).setName("Player 1").color("#FF0000"),Crafty.e("Player, Color").attr({name:"Player 2"}).setName("Player 2").color("#00FF00"),Crafty.e("Player, Color").attr({name:"Player 3"}).setName("Player 3").color("#0000FF"),Crafty.e("KeyboardControls, PlayerAssignable").controls({fire:Crafty.keys.SPACE,up:Crafty.keys.UP_ARROW,down:Crafty.keys.DOWN_ARROW,left:Crafty.keys.LEFT_ARROW,right:Crafty.keys.RIGHT_ARROW}),Crafty.e("KeyboardControls, PlayerAssignable").controls({fire:Crafty.keys.G,up:Crafty.keys.W,down:Crafty.keys.S,left:Crafty.keys.A,right:Crafty.keys.D}),Crafty.e("GamepadControls, PlayerAssignable").controls({gamepadIndex:0,fire:0}),Crafty.e("GamepadControls, PlayerAssignable").controls({gamepadIndex:1,fire:0}),Crafty.enterScene("Intro")})}};window.Game=a}(),function(){"use strict";var a={buildingBlocks:{},createLevel:function(){var a={blocks:[],bufferLength:3,generator:this,generationPosition:{x:0,y:50},generateBlocks:this._generateBlocks,addBlock:this._addBlock,start:this._startLevel,stop:this._stopLevel,_update:this._updateLevel};return a},defineBlock:function(a,b){this.buildingBlocks[a]=b},_generateBlocks:function(a,b){for(var c=a,d=0;b>d;d++)this.addBlock(c),c=this.generator._determineNextTileType.call(this,c)},_determineNextTileType:function(a){var b=this.generator.buildingBlocks[a].next,c=2,d=this.blocks.length;if(d>=c){for(var e=0,f=d-1;f>=0;f--){var g=this.blocks[f];if(g.tileType!==a)break;e++}if(e>=c){for(var h=[],i=0;i<b.length;i++)b[i]!==a&&h.push(b[i]);b=h}}return b[Math.floor(Math.random()*b.length)]},_addBlock:function(a,b){this.blocks.push({index:this.blocks.length,tileType:a,deltaX:this.generator.buildingBlocks[a].deltaX,deltaY:this.generator.buildingBlocks[a].deltaY,generated:!1,settings:b,createdElements:[],createdBindings:[],add:this.generator._addElementToBlock,bind:this.generator._addBindingToBlock})},_startLevel:function(){this._update(0);var a=this;Crafty.bind("EnterBlock",function(b){a._update(b)})},_stopLevel:function(){Crafty.unbind("EnterBlock")},_updateLevel:function(a){var b=a+this.bufferLength;b>=this.blocks.length&&(b=this.blocks.length),this.generator._buildPieces.call(this,a,b),0>=a||this.generator._cleanupPieces.call(this,a)},_buildPieces:function(a,b){for(var c=a;b>c;c++){var d=this.blocks[c];d.x=d.x||this.generationPosition.x,d.y=d.y||this.generationPosition.y,d.generated||(this.generator.buildingBlocks[d.tileType].generate.call(d,d.settings),this.generator._notifyEnterFunction.call(d),d.generated=!0),this.generationPosition.x=d.x+d.deltaX,this.generationPosition.y=d.y+d.deltaY}},_cleanupPieces:function(a){var b=a-2*this.bufferLength;0>b&&(b=0);for(var c=b;a>c;c++){var d=this.blocks[c];this.generator._cleanupFunction.call(d)}},_notifyEnterFunction:function(){var a=this.index;Crafty.e("2D, Canvas, Color, Collision").attr({x:this.x,y:this.y,w:10,h:800}).onHit("ScrollWall",function(){this.destroy(),Crafty.trigger("EnterBlock",a)})},_cleanupFunction:function(){for(var a=0;a<this.createdElements.length;a++)this.createdElements[a].destroy();this.createdElements=[];for(var b=0;b<this.createdBindings.length;b++){var c=this.createdBindings[b];Crafty.unbind(c.event,c.callback)}this.createdBindings=[]},_addElementToBlock:function(a,b,c){c.attr({x:this.x+a,y:this.y+b}),this.createdElements.push(c)},_addBindingToBlock:function(a,b){var c=this,d=function(){b.call(c,arguments)};this.createdBindings.push({event:a,callback:d}),Crafty.bind(a,d)}};window.Game.levelGenerator=a}(),function(){"use strict";var a=window.Game.levelGenerator;a.defineBlock("cityStart",{deltaX:1e3,deltaY:0,next:["topFloor","openSpace"],generate:function(a){this.add(0,0,Crafty.e("2D, Canvas, Edge, Color").attr({w:1e3,h:2})),this.add(0,700,Crafty.e("2D, Canvas, Edge, Color").attr({w:1e3,h:2}));var b=Crafty.e("2D, DOM, Text, Tween, Delay").attr({w:750,z:1}).text("Stage "+a.stage),c=400;this.add(c,340,b),b.textColor("#FF0000").textFont({size:"30px",weight:"bold",family:"Courier new"}).delay(function(){this.tween({y:b.y+500,alpha:0},3e3)},3e3,0),this.bind("ViewportScroll",function(){b.attr({x:c-Crafty.viewport._x})})}}),a.defineBlock("levelEnd",{deltaX:1500,deltaY:0,next:[],generate:function(){this.add(0,0,Crafty.e("2D, Canvas, Edge, Color").attr({w:1500,h:2})),this.add(0,700,Crafty.e("2D, Canvas, Edge, Color").attr({w:1500,h:2}));var a=Crafty.e("2D, Canvas, Color, Collision").attr({w:10,h:700}).onHit("ScrollWall",function(){Crafty("ScrollWall").each(function(){this.off()}),this.destroy()});this.add(0,0,a);var b=Crafty.e("2D, Canvas, Color, Collision").attr({w:10,h:700}).onHit("PlayerControlledShip",function(){Crafty.trigger("EndOfLevel"),this.destroy()});this.add(1e3,0,b)}}),a.defineBlock("openSpace",{deltaX:1e3,deltaY:0,next:["topFloor","openSpace"],generate:function(){this.add(0,0,Crafty.e("2D, Canvas, Edge, Color").attr({w:1e3,h:2})),this.add(0,700,Crafty.e("2D, Canvas, Edge, Color").attr({w:1e3,h:2})),this.add(400,150,Crafty.e("2D, Canvas, Edge, Color").color("#505045").attr({w:42,h:70})),this.add(900,50,Crafty.e("2D, Canvas, Edge, Color").color("#404045").attr({w:82,h:70})),this.add(600,250,Crafty.e("2D, Canvas, Edge, Color").color("#505045").attr({w:52,h:80})),this.add(500,450,Crafty.e("2D, Canvas, Edge, Color").color("#505045").attr({w:52,h:40})),this.add(800,550,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:82,h:30}))}}),a.defineBlock("topFloor",{deltaX:1e3,deltaY:0,next:["tunnel","openSpace"],generate:function(){this.add(0,0,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:350,h:30})),this.add(350,0,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:100,h:140})),this.add(450,0,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:550,h:50})),this.add(0,700,Crafty.e("2D, Canvas, Edge, Color").attr({w:1e3,h:2}));var a=this,b=Crafty.e("2D, Canvas, Color, Collision").attr({w:10,h:700}).onHit("ScrollWall",function(){a.add(650,300,Crafty.e("Enemy").enemy()),a.add(1e3+50*Math.random(),400+150*Math.random(),Crafty.e("Enemy").enemy()),a.add(1200+50*Math.random(),100+250*Math.random(),Crafty.e("Enemy").enemy()),a.add(1200+250*Math.random(),600+100*Math.random(),Crafty.e("Enemy").enemy()),this.destroy()});this.add(-700,0,b)}}),a.defineBlock("tunnel",{deltaX:1e3,deltaY:0,next:["topFloor","tunnel","tunnelTwist"],generate:function(){this.add(0,0,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:350,h:30})),this.add(350,0,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:100,h:140})),this.add(450,0,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:550,h:50})),this.add(0,670,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:350,h:30})),this.add(350,560,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:100,h:140})),this.add(450,650,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:550,h:50}));var a=this,b=Crafty.e("2D, Canvas, Color, Collision").attr({w:10,h:700}).onHit("ScrollWall",function(){a.add(1e3+50*Math.random(),400+150*Math.random(),Crafty.e("Enemy").enemy()),a.add(1200+50*Math.random(),300+250*Math.random(),Crafty.e("Enemy").enemy()),a.add(1200+250*Math.random(),200+100*Math.random(),Crafty.e("Enemy").enemy()),this.destroy()});this.add(-700,0,b)}}),a.defineBlock("tunnelTwist",{deltaX:1e3,deltaY:0,next:["tunnel","tunnelTwist"],generate:function(){this.add(0,0,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:250,h:30})),this.add(250,0,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:100,h:440})),this.add(350,0,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:650,h:50})),this.add(0,670,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:650,h:30})),this.add(650,260,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:100,h:440})),this.add(750,650,Crafty.e("2D, Canvas, Edge, Color").color("#404040").attr({w:250,h:50}))}})}(),function(){window.Game.start(),$(document).on("click","button",function(){screenfull.enabled&&(screenfull.request($("#cr-stage")[0]),$(this).blur())}),Crafty.debugBar.show()}();