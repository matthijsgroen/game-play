!function(){"use strict";Crafty.c("Bullet",{init:function(){this.addComponent("2D, Canvas, Color")},fire:function(a){this.attr({damage:a.damage}).bind("EnterFrame",function(){this.x=this.x+a.speed,this.x>1200&&this.destroy()}).bind("HitTarget",function(b){a.origin.trigger("BulletHit",{bullet:this,target:b.target})}).bind("DestroyTarget",function(b){a.origin.trigger("BulletDestroy",{bullet:this,target:b.target})})}})}(),function(){"use strict";Crafty.c("Enemy",{init:function(){this.addComponent("2D, Canvas, Color, Collision")},enemy:function(a){this.attr({x:a.x,y:a.y,w:50,h:50,health:300}).color("#00F").bind("EnterFrame",function(){this.x=this.x-2,this.x<-100&&(this.destroy(),console.log("Uhoh"))}).onHit("Bullet",function(a){var b=a[0].obj;b.trigger("HitTarget",{target:this}),this.health-=b.damage,this.health<=0&&(b.trigger("DestroyTarget",{target:this}),this.destroy()),b.destroy()})}})}(),function(){"use strict";Crafty.c("Player",{init:function(){this.addComponent("2D, Canvas, Color, Collision"),this.attr({w:30,h:30,lives:1,points:0}).bind("Moved",function(a){this.hit("Edge")&&this.attr({x:a.x,y:a.y})}).onHit("Enemy",function(){this.loseLife()}).bind("BulletHit",function(){this.addPoints(10)}).bind("BulletDestroy",function(){this.addPoints(50)})},shoot:function(){Crafty.e("Bullet").color(this.color()).attr({x:this.x+this.w,y:this.y+this.h/2,w:5,h:5}).fire({origin:this,damage:100,speed:4,direction:0})},loseLife:function(){this.lives-=1,this.attr({x:140,y:350}),this.trigger("UpdateLives",{lives:this.lives}),this.lives<=0&&Crafty.trigger("PlayerDied",this)},addPoints:function(a){this.points+=a,this.trigger("UpdatePoints",{points:this.points})}})}(),function(){"use strict";Crafty.defineScene("GameOver",function(a){Crafty.background("#111"),Crafty.e("2D, Canvas, Text").attr({x:200,y:210,w:150}).text("Game Over").textColor("#F00").textFont({size:"80px",weight:"bold",family:"Courier new"}),Crafty.e("2D, Canvas, Text").attr({x:240,y:410,w:200}).text("Score: "+a.score).textColor("#F00").textFont({size:"50px",weight:"bold",family:"Courier new"})},function(){})}(),function(){"use strict";Crafty.defineScene("Space",function(){Crafty.background("#111");var a=function(a){var c=10+350*a,d=b[a].player,e=Crafty.e("2D, Canvas, Text").attr({x:c,y:10,w:150}).text("Score: "+d.points).textColor(d.color()).textFont({size:"20px",weight:"bold",family:"Courier new"});d.bind("UpdatePoints",function(a){e.text("Score: "+a.points)});var f=Crafty.e("2D, Canvas, Text").attr({x:c,y:30,w:150}).text("Lives: "+d.lives).textColor(d.color()).textFont({size:"20px",weight:"bold",family:"Courier new"});d.bind("UpdateLives",function(a){f.text(0===a.lives?"Game Over":"Lives: "+a.lives)}),b[a].score=e,b[a].lives=f};Crafty.e("Keyboard").bind("KeyDown",function(a){a.key===Crafty.keys.SPACE&&(d("keyboard",1),this.destroy())}),Crafty.e("Gamepad").gamepad(0).bind("GamepadKeyChange",function(a){0===a.button&&a.pressed&&(d("gamepad",0),this.destroy())}),Crafty.e("Gamepad").gamepad(1).bind("GamepadKeyChange",function(a){0===a.button&&a.pressed&&(d("gamepad",1),this.destroy())});var b=[],c=["#F00","#0F0","#F0F"],d=function(d,e){var f=Crafty.e("Player").attr({x:140,y:320,playerIndex:b.length}).color(c[b.length]);b.push({controlType:d,controlIndex:e,player:f}),a(b.length-1),Crafty.trigger("PlayerStart",f),"keyboard"===d&&1===e&&f.addComponent("Multiway, Keyboard").multiway({y:3,x:1},{UP_ARROW:-90,DOWN_ARROW:90,LEFT_ARROW:180,RIGHT_ARROW:0}).bind("KeyDown",function(a){a.key===Crafty.keys.SPACE&&this.shoot()}),"gamepad"===d&&f.addComponent("GamepadMultiway, Gamepad").gamepad(e).gamepadMultiway({speed:{y:3,x:1},gamepadIndex:e}).bind("GamepadKeyChange",function(a){0===a.button&&a.pressed&&this.shoot()})};Crafty.e("2D, Canvas, Edge").attr({x:10,y:50,w:900,h:2}),Crafty.e("2D, Canvas, Edge").attr({x:10,y:750,w:900,h:2}),Crafty.e("2D, Canvas, Edge").attr({x:10,y:50,w:2,h:730}),Crafty.e("2D, Canvas, Edge").attr({x:910,y:50,w:2,h:730});var e=.4,f=5e3,g=null;Crafty.bind("PlayerStart",function(){1===b.length&&(g=(new Date).getTime(),Crafty.bind("EnterFrame",function(){var a=((new Date).getTime()-g)*e;if(a>f){var b=Crafty.math.randomInt(40,720);Crafty.e("Enemy").enemy({x:1200,y:b}),f+=Crafty.math.randomInt(100,2e3),console.log("Time to spawn!")}}))}),Crafty.bind("PlayerDied",function(){Crafty.enterScene("GameOver",{score:"later!"})})},function(){Crafty.unbind("EnterFrame")})}(),function(){"use strict";var a={start:function(){Crafty.load([],function(){Crafty.init(1024,768),Crafty.background("#111"),Crafty.enterScene("Space")})}};a.start(),$(document).on("click","button",function(){screenfull.enabled&&(screenfull.request($("#cr-stage")[0]),$(this).blur())})}(),function(){Crafty.debugBar.show()}();